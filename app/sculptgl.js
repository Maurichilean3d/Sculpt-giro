/*! For license information please see sculptgl.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.sculptgl=t():e.sculptgl=t()}(self,(function(){return(()=>{var __webpack_modules__={751:function(e,t,r){var i,n,a,s;function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e=r.nmd(e),s=function(){return function(e){function t(i){if(r[i])return r[i].exports;var n=r[i]={exports:{},id:i,loaded:!1};return e[i].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){function i(e){if(!e)throw new Error("SketchfabOAuth2 config is missing.");if(e.hasOwnProperty("hostname")||(e.hostname="sketchfab.com"),!e.hasOwnProperty("client_id"))throw new Error("client_id is missing. Please check the config of SketchfabOAuth2.");if(!e.hasOwnProperty("redirect_uri"))throw new Error("redirect_uri is missing. Please check the config of SketchfabOAuth2.");this.config=e}r(5);var n=r(2),a=r(6),s=a.buildQueryString,o=a.parseQueryString;i.prototype.connect=function(e){return new n(function(t,r){if(this.config.client_id)var i={response_type:"token",state:+new Date,client_id:this.config.client_id,redirect_uri:this.config.redirect_uri},n=Object.assign({},i,e),a="https://"+this.config.hostname+"/oauth2/authorize/?"+s(n),l=window.open(a,"loginWindow","width=640,height=400"),u=setInterval(function(){try{var e=l.location.href;if(void 0===e)return clearInterval(u),void r(new Error("Access denied (User closed popup)"));if(-1!==e.indexOf("?error=access_denied"))return clearInterval(u),void r(new Error("Access denied (User canceled)"));if(-1!==e.indexOf(this.config.redirect_uri)){clearInterval(u);var i,n=l.location.hash,a=RegExp("access_token=([^&]+)");return n.match(a)?(i=o(n.substring(1)),void t(i)):void r(new Error("Access denied (missing token)"))}}catch(e){}}.bind(this),1e3);else r(new Error("client_id is missing."))}.bind(this))},e.exports=i},function(e,t){function r(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function n(e){if(u===setTimeout)return setTimeout(e,0);if((u===r||!u)&&setTimeout)return u=setTimeout,setTimeout(e,0);try{return u(e,0)}catch(t){try{return u.call(null,e,0)}catch(t){return u.call(this,e,0)}}}function a(){p&&d&&(p=!1,d.length?f=d.concat(f):_=-1,f.length&&s())}function s(){if(!p){var e=n(a);p=!0;for(var t=f.length;t;){for(d=f,f=[];++_<t;)d&&d[_].run();_=-1,t=f.length}d=null,p=!1,function(e){if(c===clearTimeout)return clearTimeout(e);if((c===i||!c)&&clearTimeout)return c=clearTimeout,clearTimeout(e);try{c(e)}catch(t){try{return c.call(null,e)}catch(t){return c.call(this,e)}}}(e)}}function o(e,t){this.fun=e,this.array=t}function l(){}var u,c,h=e.exports={};!function(){try{u="function"==typeof setTimeout?setTimeout:r}catch(e){u=r}try{c="function"==typeof clearTimeout?clearTimeout:i}catch(e){c=i}}();var d,f=[],p=!1,_=-1;h.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];f.push(new o(e,t)),1!==f.length||p||n(s)},o.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=l,h.addListener=l,h.once=l,h.off=l,h.removeListener=l,h.removeAllListeners=l,h.emit=l,h.prependListener=l,h.prependOnceListener=l,h.listeners=function(e){return[]},h.binding=function(e){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(e){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},function(e,t,r){(function(t){"use strict";function r(){}function i(e){if(!(this instanceof i))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],c(e,this)}function n(e,t){for(;3===e._state;)e=e._value;return 0===e._state?void e._deferreds.push(t):(e._handled=!0,void i._immediateFn((function(){var r=1===e._state?t.onFulfilled:t.onRejected;if(null!==r){var i;try{i=r(e._value)}catch(e){return void s(t.promise,e)}a(t.promise,i)}else(1===e._state?a:s)(t.promise,e._value)})))}function a(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==o(t)||"function"==typeof t)){var r=t.then;if(t instanceof i)return e._state=3,e._value=t,void l(e);if("function"==typeof r)return void c(function(e,t){return function(){e.apply(t,arguments)}}(r,t),e)}e._state=1,e._value=t,l(e)}catch(t){s(e,t)}}function s(e,t){e._state=2,e._value=t,l(e)}function l(e){2===e._state&&0===e._deferreds.length&&i._immediateFn((function(){e._handled||i._unhandledRejectionFn(e._value)}));for(var t=0,r=e._deferreds.length;t<r;t++)n(e,e._deferreds[t]);e._deferreds=null}function u(e,t,r){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=r}function c(e,t){var r=!1;try{e((function(e){r||(r=!0,a(t,e))}),(function(e){r||(r=!0,s(t,e))}))}catch(e){if(r)return;r=!0,s(t,e)}}var h=setTimeout;i.prototype.catch=function(e){return this.then(null,e)},i.prototype.then=function(e,t){var i=new this.constructor(r);return n(this,new u(e,t,i)),i},i.prototype.finally=function(e){var t=this.constructor;return this.then((function(r){return t.resolve(e()).then((function(){return r}))}),(function(r){return t.resolve(e()).then((function(){return t.reject(r)}))}))},i.all=function(e){return new i((function(t,r){function i(e,s){try{if(s&&("object"==o(s)||"function"==typeof s)){var l=s.then;if("function"==typeof l)return void l.call(s,(function(t){i(e,t)}),r)}n[e]=s,0==--a&&t(n)}catch(e){r(e)}}if(!e||void 0===e.length)throw new TypeError("Promise.all accepts an array");var n=Array.prototype.slice.call(e);if(0===n.length)return t([]);for(var a=n.length,s=0;s<n.length;s++)i(s,n[s])}))},i.resolve=function(e){return e&&"object"==o(e)&&e.constructor===i?e:new i((function(t){t(e)}))},i.reject=function(e){return new i((function(t,r){r(e)}))},i.race=function(e){return new i((function(t,r){for(var i=0,n=e.length;i<n;i++)e[i].then(t,r)}))},i._immediateFn="function"==typeof t&&function(e){t(e)}||function(e){h(e,0)},i._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},e.exports=i}).call(t,r(4).setImmediate)},function(e,t,r){(function(e,t){!function(e,r){"use strict";function i(e){delete o[e]}function n(e){if(l)setTimeout(n,0,e);else{var t=o[e];if(t){l=!0;try{!function(e){var t=e.callback,r=e.args;switch(r.length){case 0:t();break;case 1:t(r[0]);break;case 2:t(r[0],r[1]);break;case 3:t(r[0],r[1],r[2]);break;default:t.apply(void 0,r)}}(t)}finally{i(e),l=!1}}}}if(!e.setImmediate){var a,s=1,o={},l=!1,u=e.document,c=Object.getPrototypeOf&&Object.getPrototypeOf(e);c=c&&c.setTimeout?c:e,"[object process]"==={}.toString.call(e.process)?a=function(e){t.nextTick((function(){n(e)}))}:function(){if(e.postMessage&&!e.importScripts){var t=!0,r=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=r,t}}()?function(){var t="setImmediate$"+Math.random()+"$",r=function(r){r.source===e&&"string"==typeof r.data&&0===r.data.indexOf(t)&&n(+r.data.slice(t.length))};e.addEventListener?e.addEventListener("message",r,!1):e.attachEvent("onmessage",r),a=function(r){e.postMessage(t+r,"*")}}():e.MessageChannel?function(){var e=new MessageChannel;e.port1.onmessage=function(e){n(e.data)},a=function(t){e.port2.postMessage(t)}}():u&&"onreadystatechange"in u.createElement("script")?function(){var e=u.documentElement;a=function(t){var r=u.createElement("script");r.onreadystatechange=function(){n(t),r.onreadystatechange=null,e.removeChild(r),r=null},e.appendChild(r)}}():a=function(e){setTimeout(n,0,e)},c.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),r=0;r<t.length;r++)t[r]=arguments[r+1];var i={callback:e,args:t};return o[s]=i,a(s),s++},c.clearImmediate=i}}("undefined"==typeof self?void 0===e?this:e:self)}).call(t,function(){return this}(),r(1))},function(e,t,r){(function(e){function i(e,t){this._id=e,this._clearFn=t}var n=Function.prototype.apply;t.setTimeout=function(){return new i(n.call(setTimeout,window,arguments),clearTimeout)},t.setInterval=function(){return new i(n.call(setInterval,window,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(window,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},r(3),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(t,function(){return this}())},function(e,t){"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){"use strict";if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(e),i=1;i<arguments.length;i++){var n=arguments[i];if(null!=n)for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])}return r},writable:!0,configurable:!0})},function(e,t){e.exports={parseQueryString:function(e){var t={};return e.split("&").forEach((function(e){var r=e.split("=");t[r[0]]=decodeURIComponent(r[1])})),t},buildQueryString:function(e){for(var t=Object.keys(e),r=[],i=0,n=t.length;i<n;i++)r.push(t[i]+"="+encodeURIComponent(e[t[i]]));return r.join("&")}}}])},"object"==o(t)&&"object"==o(e)?e.exports=s():(n=[],void 0===(a="function"==typeof(i=s)?i.apply(t,n):i)||(e.exports=a))},141:function(){!function(e){"use strict";var t,r="File format is not recognized.",i="Error while reading zip file.",n="Error while reading file data.",a=524288,s="text/plain";try{t=0===new Blob([new DataView(new ArrayBuffer(0))]).size}catch(e){}function o(){this.crc=-1}function l(){}function u(e,t){var r,i;return r=new ArrayBuffer(e),i=new Uint8Array(r),t&&i.set(t,0),{buffer:r,array:i,view:new DataView(r)}}function c(){}function h(e){var t,r=this;r.size=0,r.init=function(i,n){var a=new Blob([e],{type:s});(t=new f(a)).init((function(){r.size=t.size,i()}),n)},r.readUint8Array=function(e,r,i,n){t.readUint8Array(e,r,i,n)}}function d(t){var r,i=this;i.size=0,i.init=function(e){for(var n=t.length;"="==t.charAt(n-1);)n--;r=t.indexOf(",")+1,i.size=Math.floor(.75*(n-r)),e()},i.readUint8Array=function(i,n,a){var s,o=u(n),l=4*Math.floor(i/3),c=4*Math.ceil((i+n)/3),h=e.atob(t.substring(l+r,c+r)),d=i-3*Math.floor(l/4);for(s=d;s<d+n;s++)o.array[s-d]=h.charCodeAt(s);a(o.array)}}function f(e){var t=this;t.size=0,t.init=function(r){t.size=e.size,r()},t.readUint8Array=function(t,r,i,n){var a=new FileReader;a.onload=function(e){i(new Uint8Array(e.target.result))},a.onerror=n;try{a.readAsArrayBuffer(function(e,t,r){if(t<0||r<0||t+r>e.size)throw new RangeError("offset:"+t+", length:"+r+", size:"+e.size);return e.slice?e.slice(t,t+r):e.webkitSlice?e.webkitSlice(t,t+r):e.mozSlice?e.mozSlice(t,t+r):e.msSlice?e.msSlice(t,t+r):void 0}(e,t,r))}catch(e){n(e)}}}function p(){}function _(e){var r,i=this;i.init=function(e){r=new Blob([],{type:s}),e()},i.writeUint8Array=function(e,i){r=new Blob([r,t?e:e.buffer],{type:s}),i()},i.getData=function(t,i){var n=new FileReader;n.onload=function(e){t(e.target.result)},n.onerror=i,n.readAsText(r,e)}}function m(t){var r=this,i="",n="";r.init=function(e){i+="data:"+(t||"")+";base64,",e()},r.writeUint8Array=function(t,r){var a,s=n.length,o=n;for(n="",a=0;a<3*Math.floor((s+t.length)/3)-s;a++)o+=String.fromCharCode(t[a]);for(;a<t.length;a++)n+=String.fromCharCode(t[a]);o.length>2?i+=e.btoa(o):n=o,r()},r.getData=function(t){t(i+e.btoa(n))}}function g(e){var r,i=this;i.init=function(t){r=new Blob([],{type:e}),t()},i.writeUint8Array=function(i,n){r=new Blob([r,t?i:i.buffer],{type:e}),n()},i.getData=function(e){e(r)}}function v(e,t,r,i,n,s,o,l,u,c){var h,d,f,p=0,_=t.sn;function m(){e.removeEventListener("message",g,!1),l(d,f)}function g(t){var r=t.data,n=r.data,a=r.error;if(a)return a.toString=function(){return"Error: "+this.message},void u(a);if(r.sn===_)switch("number"==typeof r.codecTime&&(e.codecTime+=r.codecTime),"number"==typeof r.crcTime&&(e.crcTime+=r.crcTime),r.type){case"append":n?(d+=n.length,i.writeUint8Array(n,(function(){v()}),c)):v();break;case"flush":f=r.crc,n?(d+=n.length,i.writeUint8Array(n,(function(){m()}),c)):m();break;case"progress":o&&o(h+r.loaded,s);break;case"importScripts":case"newTask":case"echo":break;default:console.warn("zip.js:launchWorkerProcess: unknown message: ",r)}}function v(){(h=p*a)<s?r.readUint8Array(n+h,Math.min(a,s-h),(function(r){o&&o(h,s);var i=0===h?t:{sn:_};i.type="append",i.data=r,e.postMessage(i,[r.buffer]),p++}),u):e.postMessage({sn:_,type:"flush"})}d=0,e.addEventListener("message",g,!1),v()}function y(e,t,r,i,n,s,l,u,c,h){var d,f=0,p=0,_="input"===s,m="output"===s,g=new o;!function s(){var o;if((d=f*a)<n)t.readUint8Array(i+d,Math.min(a,n-d),(function(t){var i;try{i=e.append(t,(function(e){l&&l(d+e,n)}))}catch(e){return void c(e)}i?(p+=i.length,r.writeUint8Array(i,(function(){f++,setTimeout(s,1)}),h),m&&g.append(i)):(f++,setTimeout(s,1)),_&&g.append(t),l&&l(d,n)}),c);else{try{o=e.flush()}catch(e){return void c(e)}o?(m&&g.append(o),p+=o.length,r.writeUint8Array(o,(function(){u(p,g.get())}),h)):u(p,g.get())}}()}function b(t,r,i,n,a,s,o,u,c,h,d){var f="input";e.zip.useWebWorkers&&o?v(t,{sn:r,codecClass:"NOOP",crcType:f},i,n,a,s,c,u,h,d):y(new l,i,n,a,s,f,c,u,h,d)}function T(e){var t,r,i="",n=["Ç","ü","é","â","ä","à","å","ç","ê","ë","è","ï","î","ì","Ä","Å","É","æ","Æ","ô","ö","ò","û","ù","ÿ","Ö","Ü","ø","£","Ø","×","ƒ","á","í","ó","ú","ñ","Ñ","ª","º","¿","®","¬","½","¼","¡","«","»","_","_","_","¦","¦","Á","Â","À","©","¦","¦","+","+","¢","¥","+","+","-","-","+","-","+","ã","Ã","+","+","-","-","¦","-","+","¤","ð","Ð","Ê","Ë","È","i","Í","Î","Ï","+","+","_","_","¦","Ì","_","Ó","ß","Ô","Ò","õ","Õ","µ","þ","Þ","Ú","Û","Ù","ý","Ý","¯","´","­","±","_","¾","¶","§","÷","¸","°","¨","·","¹","³","²","_"," "];for(t=0;t<e.length;t++)i+=(r=255&e.charCodeAt(t))>127?n[r-128]:String.fromCharCode(r);return i}function k(e){return decodeURIComponent(escape(e))}function M(e){var t,r="";for(t=0;t<e.length;t++)r+=String.fromCharCode(e[t]);return r}function x(e,t,r,i,n){e.version=t.view.getUint16(r,!0),e.bitFlag=t.view.getUint16(r+2,!0),e.compressionMethod=t.view.getUint16(r+4,!0),e.lastModDateRaw=t.view.getUint32(r+6,!0),e.lastModDate=function(e){var t=(4294901760&e)>>16,r=65535&e;try{return new Date(1980+((65024&t)>>9),((480&t)>>5)-1,31&t,(63488&r)>>11,(2016&r)>>5,2*(31&r),0)}catch(e){}}(e.lastModDateRaw),1!=(1&e.bitFlag)?((i||8!=(8&e.bitFlag))&&(e.crc32=t.view.getUint32(r+10,!0),e.compressedSize=t.view.getUint32(r+14,!0),e.uncompressedSize=t.view.getUint32(r+18,!0)),4294967295!==e.compressedSize&&4294967295!==e.uncompressedSize?(e.filenameLength=t.view.getUint16(r+22,!0),e.extraFieldLength=t.view.getUint16(r+24,!0)):n("File is using Zip64 (4gb+ file size).")):n("File contains encrypted entry.")}function S(e){return unescape(encodeURIComponent(e))}function A(e){var t,r=[];for(t=0;t<e.length;t++)r.push(e.charCodeAt(t));return r}function E(t,r,i,a){var s={},o=[],l=0,c=0;function h(e){i(e||"Error while writing zip file.")}function d(e){i(e||n)}var f={add:function(r,n,f,p,_){var m,g,T,k=this._worker;function M(e,r){var i=u(16);l+=e||0,i.view.setUint32(0,1347094280),void 0!==r&&(m.view.setUint32(10,r,!0),i.view.setUint32(4,r,!0)),n&&(i.view.setUint32(8,e,!0),m.view.setUint32(14,e,!0),i.view.setUint32(12,n.size,!0),m.view.setUint32(18,n.size,!0)),t.writeUint8Array(i.array,(function(){l+=16,f()}),h)}function x(){var f;_=_||{},r=r.trim(),_.directory&&"/"!=r.charAt(r.length-1)&&(r+="/"),s.hasOwnProperty(r)?i("File already exists."):(g=A(S(r)),o.push(r),T=_.lastModDate||new Date,m=u(26),s[r]={headerArray:m.array,directory:_.directory,filename:g,offset:l,comment:A(S(_.comment||""))},m.view.setUint32(0,335546376),_.version&&m.view.setUint8(0,_.version),a||0===_.level||_.directory||m.view.setUint16(4,2048),m.view.setUint16(6,(T.getHours()<<6|T.getMinutes())<<5|T.getSeconds()/2,!0),m.view.setUint16(8,(T.getFullYear()-1980<<4|T.getMonth()+1)<<5|T.getDate(),!0),m.view.setUint16(22,g.length,!0),(f=u(30+g.length)).view.setUint32(0,1347093252),f.array.set(m.array,4),f.array.set(g,30),l+=f.array.length,t.writeUint8Array(f.array,(function(){n?a||0===_.level?b(k,c++,n,t,0,n.size,!0,M,p,d,h):function(t,r,i,n,a,s,o,l,u){var c="input";e.zip.useWebWorkers?v(t,{sn:r,options:{level:a},codecClass:"Deflater",crcType:c},i,n,0,i.size,o,s,l,u):y(new e.zip.Deflater,i,n,0,i.size,c,o,s,l,u)}(k,c++,n,t,_.level,M,p,d,h):M()}),h))}n?n.init(x,d):x()},close:function(e){this._worker&&(this._worker.terminate(),this._worker=null);var r,i,n,a=0,c=0;for(i=0;i<o.length;i++)a+=46+(n=s[o[i]]).filename.length+n.comment.length;for(r=u(a+22),i=0;i<o.length;i++)n=s[o[i]],r.view.setUint32(c,1347092738),r.view.setUint16(c+4,5120),r.array.set(n.headerArray,c+6),r.view.setUint16(c+32,n.comment.length,!0),n.directory&&r.view.setUint8(c+38,16),r.view.setUint32(c+42,n.offset,!0),r.array.set(n.filename,c+46),r.array.set(n.comment,c+46+n.filename.length),c+=46+n.filename.length+n.comment.length;r.view.setUint32(c,1347093766),r.view.setUint16(c+8,o.length,!0),r.view.setUint16(c+10,o.length,!0),r.view.setUint32(c+12,a,!0),r.view.setUint32(c+16,l,!0),t.writeUint8Array(r.array,(function(){t.getData(e)}),h)},_worker:null};e.zip.useWebWorkers?w("deflater",(function(e){f._worker=e,r(f)}),(function(e){i(e)})):r(f)}o.prototype.append=function(e){for(var t=0|this.crc,r=this.table,i=0,n=0|e.length;i<n;i++)t=t>>>8^r[255&(t^e[i])];this.crc=t},o.prototype.get=function(){return~this.crc},o.prototype.table=function(){var e,t,r,i=[];for(e=0;e<256;e++){for(r=e,t=0;t<8;t++)1&r?r=r>>>1^3988292384:r>>>=1;i[e]=r}return i}(),l.prototype.append=function(e,t){return e},l.prototype.flush=function(){},h.prototype=new c,h.prototype.constructor=h,d.prototype=new c,d.prototype.constructor=d,f.prototype=new c,f.prototype.constructor=f,p.prototype.getData=function(e){e(this.data)},_.prototype=new p,_.prototype.constructor=_,m.prototype=new p,m.prototype.constructor=m,g.prototype=new p,g.prototype.constructor=g;var R={deflater:["z-worker.js","deflate.js"],inflater:["z-worker.js","inflate.js"]};function w(t,r,i){if(null===e.zip.workerScripts||null===e.zip.workerScriptsPath){var n,a,s;if(e.zip.workerScripts){if(n=e.zip.workerScripts[t],!Array.isArray(n))return void i(new Error("zip.workerScripts."+t+" is not an array!"));a=n,s=document.createElement("a"),n=a.map((function(e){return s.href=e,s.href}))}else(n=R[t].slice(0))[0]=(e.zip.workerScriptsPath||"")+n[0];var o=new Worker(n[0]);o.codecTime=o.crcTime=0,o.postMessage({type:"importScripts",scripts:n.slice(1)}),o.addEventListener("message",(function e(t){var n=t.data;if(n.error)return o.terminate(),void i(n.error);"importScripts"===n.type&&(o.removeEventListener("message",e),o.removeEventListener("error",l),r(o))})),o.addEventListener("error",l)}else i(new Error("Either zip.workerScripts or zip.workerScriptsPath may be set, not both."));function l(e){o.terminate(),i(e)}}function C(e){console.error(e)}e.zip={Reader:c,Writer:p,BlobReader:f,Data64URIReader:d,TextReader:h,BlobWriter:g,Data64URIWriter:m,TextWriter:_,createReader:function(t,a,s){s=s||C,t.init((function(){!function(t,a,s){var o=0;function l(){}l.prototype.getData=function(i,a,l,c){var h=this;function d(e,t){c&&!function(e){var t=u(4);return t.view.setUint32(0,e),h.crc32==t.view.getUint32(0)}(t)?s("CRC failed."):i.getData((function(e){a(e)}))}function f(e){s(e||n)}function p(e){s(e||"Error while writing file data.")}t.readUint8Array(h.offset,30,(function(n){var a,_=u(n.length,n);1347093252==_.view.getUint32(0)?(x(h,_,4,!1,s),a=h.offset+30+h.filenameLength+h.extraFieldLength,i.init((function(){0===h.compressionMethod?b(h._worker,o++,t,i,a,h.compressedSize,c,d,l,f,p):function(t,r,i,n,a,s,o,l,u,c,h){var d=o?"output":"none";e.zip.useWebWorkers?v(t,{sn:r,codecClass:"Inflater",crcType:d},i,n,a,s,u,l,c,h):y(new e.zip.Inflater,i,n,a,s,d,u,l,c,h)}(h._worker,o++,t,i,a,h.compressedSize,c,d,l,f,p)}),p)):s(r)}),f)};var c={getEntries:function(e){var n=this._worker;!function(e){function n(r,n){t.readUint8Array(t.size-r,r,(function(t){for(var r=t.length-22;r>=0;r--)if(80===t[r]&&75===t[r+1]&&5===t[r+2]&&6===t[r+3])return void e(new DataView(t.buffer,r,22));n()}),(function(){s(i)}))}t.size<22?s(r):n(22,(function(){n(Math.min(65558,t.size),(function(){s(r)}))}))}((function(a){var o,c;o=a.getUint32(16,!0),c=a.getUint16(8,!0),o<0||o>=t.size?s(r):t.readUint8Array(o,t.size-o,(function(t){var i,a,o,h,d=0,f=[],p=u(t.length,t);for(i=0;i<c;i++){if((a=new l)._worker=n,1347092738!=p.view.getUint32(d))return void s(r);x(a,p,d+6,!0,s),a.commentLength=p.view.getUint16(d+32,!0),a.directory=16==(16&p.view.getUint8(d+38)),a.offset=p.view.getUint32(d+42,!0),o=M(p.array.subarray(d+46,d+46+a.filenameLength)),a.filename=2048==(2048&a.bitFlag)?k(o):T(o),a.directory||"/"!=a.filename.charAt(a.filename.length-1)||(a.directory=!0),h=M(p.array.subarray(d+46+a.filenameLength+a.extraFieldLength,d+46+a.filenameLength+a.extraFieldLength+a.commentLength)),a.comment=2048==(2048&a.bitFlag)?k(h):T(h),f.push(a),d+=46+a.filenameLength+a.extraFieldLength+a.commentLength}e(f)}),(function(){s(i)}))}))},close:function(e){this._worker&&(this._worker.terminate(),this._worker=null),e&&e()},_worker:null};e.zip.useWebWorkers?w("inflater",(function(e){c._worker=e,a(c)}),(function(e){s(e)})):a(c)}(t,a,s)}),s)},createWriter:function(e,t,r,i){r=r||C,i=!!i,e.init((function(){E(e,t,r,i)}),r)},useWebWorkers:!0,workerScriptsPath:null,workerScripts:null}}(this)},871:(e,t,r)=>{"use strict";r.r(t),r(50);var i=r(174),n=r(297),a=r(522),s=r(839),o=r(781),l=r(52);function u(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}const c=function(){function e(t,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._gl=t,this._buffer=t.createBuffer(),this._type=r,this._hint=i,this._size=0}var t,r;return t=e,(r=[{key:"bind",value:function(){this._buffer||(this._buffer=this._gl.createBuffer()),this._gl.bindBuffer(this._type,this._buffer)}},{key:"release",value:function(){this._gl.deleteBuffer(this._buffer),this._buffer=null,this._size=0}},{key:"update",value:function(e,t){this.bind(),void 0!==t&&t!==e.length&&(e=e.subarray(0,t)),e.length>this._size?(this._gl.bufferData(this._type,e,this._hint),this._size=e.length):this._gl.bufferSubData(this._type,0,e)}}])&&u(t.prototype,r),e}();function h(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}const d=function(){function e(t,r,i,n,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._gl=t,this._location=t.getAttribLocation(r,i),this._size=n,this._type=a}var t,r;return t=e,(r=[{key:"unbind",value:function(){this._gl.disableVertexAttribArray(this._location)}},{key:"bindToBuffer",value:function(e){var t=this._gl;e.bind(),t.enableVertexAttribArray(this._location),t.vertexAttribPointer(this._location,this._size,this._type,!1,0,0)}}])&&h(t.prototype,r),e}(),f="/*\nMódulo de renderizado WebGL de SculptGL.\nDibuja la escena 3D y administra shaders, buffers y el pipeline de dibujo.\n*/\n// reference\n// https://www.khronos.org/registry/gles/extensions/EXT/EXT_sRGB.txt\n\n#define LIN_SRGB(x) x < 0.0031308 ? x * 12.92 : 1.055 * pow(x, 1.0/2.4) - 0.055\nfloat linearTosRGB(const in float c) {\n    return LIN_SRGB(c);\n}\nvec3 linearTosRGB(const in vec3 c) {\n    return vec3(LIN_SRGB(c.r), LIN_SRGB(c.g), LIN_SRGB(c.b));\n}\nvec4 linearTosRGB(const in vec4 c) {\n    return vec4(LIN_SRGB(c.r), LIN_SRGB(c.g), LIN_SRGB(c.b), c.a);\n}\n\n#define SRGB_LIN(x) x < 0.04045 ? x * (1.0 / 12.92) : pow((x + 0.055) * (1.0 / 1.055), 2.4)\nfloat sRGBToLinear(const in float c) {\n    return SRGB_LIN(c);\n}\nvec3 sRGBToLinear(const in vec3 c) {\n    return vec3(SRGB_LIN(c.r), SRGB_LIN(c.g), SRGB_LIN(c.b));\n}\nvec4 sRGBToLinear(const in vec4 c) {\n    return vec4(SRGB_LIN(c.r), SRGB_LIN(c.g), SRGB_LIN(c.b), c.a);\n}\n\n#define RANGE 5.0\n// http://graphicrants.blogspot.fr/2009/04/rgbm-color-encoding.html\nvec4 encodeRGBM(const in vec3 col) {\n    vec4 rgbm;\n    vec3 color = col / RANGE;\n    rgbm.a = clamp( max( max( color.r, color.g ), max( color.b, 1e-6 ) ), 0.0, 1.0 );\n    rgbm.a = ceil( rgbm.a * 255.0 ) / 255.0;\n    rgbm.rgb = color / rgbm.a;\n    return rgbm;\n}\n\nvec3 decodeRGBM(const in vec4 col) {\n  return RANGE * col.rgb * col.a;\n}\n";var p={vertexName:"VertexName",fragmentName:"FragmentName",activeAttributes:{vertex:!0,normal:!0,material:!0,color:!0}};p.showSymmetryLine=(0,l.Z)().mirrorline,p.darkenUnselected=(0,l.Z)().darkenunselected,p.uniformNames={},p.uniformNames.commonUniforms=["uMV","uMVP","uN","uEM","uEN","uFlat","uPlaneO","uPlaneN","uSym","uCurvature","uAlpha","uFov","uDarken"],p.strings={},p.strings.colorSpaceGLSL=f,p.strings.vertUniforms=["uniform mat4 uMV;","uniform mat4 uMVP;","uniform mat3 uN;","uniform mat4 uEM;","uniform mat3 uEN;","uniform float uAlpha;"].join("\n"),p.strings.fragColorUniforms=["uniform vec3 uPlaneN;","uniform vec3 uPlaneO;","uniform int uSym;","uniform int uDarken;","uniform float uCurvature;","uniform float uFov;","varying float vMasking;","uniform int uFlat;"].join("\n"),p.strings.fragColorFunction=["/*\nMódulo de renderizado WebGL de SculptGL.\nDibuja la escena 3D y administra shaders, buffers y el pipeline de dibujo.\n*/\n// http://madebyevan.com/shaders/curvature/\n#extension GL_OES_standard_derivatives : enable\nvec3 computeCurvature( const in vec3 vertex, const in vec3 normal, const in vec3 color, const in float str, const in float fov) {\n  if(str < 1e-3)\n    return color;\n#ifndef GL_OES_standard_derivatives\n    return color * pow(length(normal), str * 100.0);\n#else\n  vec3 n = normalize(normal);\n  // Compute curvature\n  vec3 dx = dFdx(n);\n  vec3 dy = dFdy(n);\n  vec3 xneg = n - dx;\n  vec3 xpos = n + dx;\n  vec3 yneg = n - dy;\n  vec3 ypos = n + dy;\n  // fov < 0.0 means ortho\n  float depth = fov > 0.0 ? length(vertex) * fov : -fov;\n  float cur = (cross(xneg, xpos).y - cross(yneg, ypos).x) * str * 80.0 / depth;\n  return mix(mix(color, color * 0.3, clamp(-cur * 15.0, 0.0, 1.0)), color * 2.0, clamp(cur * 25.0, 0.0, 1.0));\n#endif\n}\n",f,"#extension GL_OES_standard_derivatives : enable","vec3 getNormal() {","  #ifndef GL_OES_standard_derivatives","    return normalize(gl_FrontFacing ? vNormal : -vNormal);","  #else","    return uFlat == 0 ? normalize(gl_FrontFacing ? vNormal : -vNormal) : -normalize(cross(dFdy(vVertex), dFdx(vVertex)));","  #endif","}","vec4 encodeFragColor(const in vec3 frag, const in float alpha) {","  vec3 col = computeCurvature(vVertex, vNormal, frag, uCurvature, uFov);","  if(uDarken == 1) col *= 0.3;","  col *= (0.3 + 0.7 * vMasking);","  if(uSym == 1 && abs(dot(uPlaneN, vVertex - uPlaneO)) < 0.15)","      col = min(col * 1.5, 1.0);","  return alpha != 1.0 ? vec4(col * alpha, alpha) : encodeRGBM(col);","}"].join("\n");var _,m=function(e){var t="",r=e.match(/^\s*(#extension).*/gm);if(r)for(var i={},n=0,a=r.length;n<a;++n){var s=r[n].substr(r[n].indexOf("#extension"));e=e.replace(r[n],""),i[s]||(i[s]=!0,t+=s+"\n")}var o="";-1===e.indexOf("#version")&&(o+="#version 100\n");var l="";return/precision\s+(high|low|medium)p\s+float/.test(e)||(l+="#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n#else\n  precision mediump float;\n#endif\n"),o+t+l+e};p.getOrCreate=function(e){if(this.program)return this;var t="\n#define SHADER_NAME "+this.vertexName+"\n",r="\n#define SHADER_NAME "+this.fragmentName+"\n",i=e.createShader(e.VERTEX_SHADER);e.shaderSource(i,m(this.vertex+t)),e.compileShader(i);var n=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(n,m(this.fragment+r)),e.compileShader(n);var a=this.program=e.createProgram();e.attachShader(a,i),e.attachShader(a,n),e.linkProgram(a),e.useProgram(a);var s=e.getShaderInfoLog(i),o=e.getShaderInfoLog(n),l=e.getProgramInfoLog(a);return s&&console.warn(this.vertexName+" (vertex)\n"+s),o&&console.warn(this.fragmentName+" (fragment)\n"+o),l&&console.warn(this.fragmentName+" (program)\n"+l),this.initAttributes(e),this.initUniforms(e),this},p.initUniforms=function(e){for(var t=this.program,r=this.uniformNames,i=this.uniforms,n=0,a=r.length;n<a;++n){var s=r[n];i[s]=e.getUniformLocation(t,s)}},p.updateUniforms=(_=[0,0,0],function(e,t){var r=e.getGL(),n=p.darkenUnselected&&t.getIndexSelectMesh(e)<0,a=p.showSymmetryLine&&e.getID()===t.getMesh().getID()&&t.getSculptManager().getSymmetry(),s=this.uniforms;r.uniformMatrix4fv(s.uEM,!1,e.getEditMatrix()),r.uniformMatrix3fv(s.uEN,!1,e.getEN()),r.uniformMatrix4fv(s.uMV,!1,e.getMV()),r.uniformMatrix4fv(s.uMVP,!1,e.getMVP()),r.uniformMatrix3fv(s.uN,!1,e.getN()),r.uniform1i(s.uDarken,n?1:0),r.uniform1i(s.uFlat,e.getFlatShading()),r.uniform3fv(s.uPlaneO,i.R3.transformMat4(_,e.getSymmetryOrigin(),e.getMV())),r.uniform3fv(s.uPlaneN,i.R3.normalize(_,i.R3.transformMat3(_,e.getSymmetryNormal(),e.getN()))),r.uniform1i(s.uSym,a?1:0),r.uniform1f(s.uAlpha,e.getOpacity()),r.uniform1f(s.uCurvature,e.getCurvature());var o=t.getCamera();r.uniform1f(s.uFov,o.isOrthographic()?25*-Math.abs(o._trans[2]):o.getFov())}),p.draw=function(e,t){e.getGL().useProgram(this.program),this.bindAttributes(e),this.updateUniforms(e,t),this.drawBuffer(e)},p.drawBuffer=function(e){var t=e.getGL();e.isUsingDrawArrays()?t.drawArrays(e.getMode(),0,e.getCount()):(e.getIndexBuffer().bind(),t.drawElements(e.getMode(),e.getCount(),t.UNSIGNED_INT,0)),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),this.unbindAttributes()},p.setTextureParameters=function(e,t){e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),o.Z.isPowerOfTwo(t.width)&&o.Z.isPowerOfTwo(t.height)?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.generateMipmap(e.TEXTURE_2D)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE))},p.onLoadTexture0=function(e,t,r){this.texture0=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture0),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),p.setTextureParameters(e,t),e.bindTexture(e.TEXTURE_2D,null),r&&r.render()},p.getDummyTexture=function(e){return this._dummyTex||(this._dummyTex=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this._dummyTex),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array(4)),e.bindTexture(e.TEXTURE_2D,null)),this._dummyTex},p.getOrCreateTexture0=function(e,t,r){if(void 0!==this.texture0)return this.texture0;this.texture0=null;var i=new Image;return i.src=t,i.onload=this.onLoadTexture0.bind(this,e,i,r),!1},p.initAttributes=function(e){var t=this.program,r=this.attributes;r.aVertex=new d(e,t,"aVertex",3,e.FLOAT),r.aNormal=new d(e,t,"aNormal",3,e.FLOAT),r.aColor=new d(e,t,"aColor",3,e.FLOAT),r.aMaterial=new d(e,t,"aMaterial",3,e.FLOAT)},p.bindAttributes=function(e){var t=this.attributes,r=this.activeAttributes;r.vertex&&t.aVertex.bindToBuffer(e.getVertexBuffer()),r.normal&&t.aNormal.bindToBuffer(e.getNormalBuffer()),r.color&&t.aColor.bindToBuffer(e.getColorBuffer()),r.material&&t.aMaterial.bindToBuffer(e.getMaterialBuffer())},p.unbindAttributes=function(){var e=this.attributes,t=this.activeAttributes;t.vertex&&e.aVertex.unbind(),t.normal&&e.aNormal.unbind(),t.color&&e.aColor.unbind(),t.material&&e.aMaterial.unbind()},p.getCopy=function(){for(var e=Object.keys(p),t={},r=0,i=e.length;r<i;++r)t[e[r]]=this[e[r]];return t.program=null,t};const g=p,v="/*\nMódulo de renderizado WebGL de SculptGL.\nDibuja la escena 3D y administra shaders, buffers y el pipeline de dibujo.\n*/\n#define PI 3.1415926535897932384626433832795\n#define PI_2 (2.0 * 3.1415926535897932384626433832795)\n#define INV_PI 1.0 / PI\n#define INV_LOG2 1.4426950408889634073599246810019\n\nuniform sampler2D uTexture0;\nuniform float uExposure;\nuniform mat3 uIblTransform;\nuniform vec3 uSPH[9];\n\nuniform vec2 uEnvSize;\n#define LIMIT_LOD 5.0\n\n// https://mynameismjp.wordpress.com/2008/12/12/logluv-encoding-for-hdr/\nconst mat3 LUVInverse = mat3(6.0013, -2.700, -1.7995, -1.332, 3.1029, -5.7720,\n                             0.3007, -1.088, 5.6268);\nvec3 decodeLUV(const in vec4 logLuv) {\n  float Le = logLuv.z * 255.0 + logLuv.w;\n  vec3 xp;\n  xp.y = exp2((Le - 127.0) / 2.0);\n  xp.z = xp.y / logLuv.y;\n  xp.x = logLuv.x * xp.z;\n  return max(LUVInverse * xp, 0.0);\n}\n\nvec2 toUVMipmap(const in float lod, const in vec2 uv) {\n  float widthForLevel = uEnvSize.x / exp2(lod);\n  vec2 uvSpaceLocal = vec2(1.0) + uv * (widthForLevel - 2.0);\n  uvSpaceLocal.y += uEnvSize.y - widthForLevel * 2.0;\n  return uvSpaceLocal / uEnvSize;\n}\n\nvec2 directionToUV(const in vec3 dir) {\n  vec3 signOct = sign(dir);\n  vec3 uvOct = dir / dot(dir, signOct);\n  if (uvOct.z < 0.0) {\n    uvOct.xy = signOct.xy * (1.0 - abs(uvOct)).yx;\n  }\n  return uvOct.xy * 0.5 + 0.5;\n}\n\nvec3 texturePanoramaLod(const in vec3 direction, const in float rLinear) {\n  float lod = rLinear * (LIMIT_LOD - 1.0);\n  vec2 uvBase = directionToUV(direction);\n  return decodeLUV(mix(texture2D(uTexture0, toUVMipmap(floor(lod), uvBase)),\n                       texture2D(uTexture0, toUVMipmap(ceil(lod), uvBase)),\n                       fract(lod)));\n}\n\nvec3 integrateBRDFApprox(const in vec3 specular, float roughness, float NoV) {\n  const vec4 c0 = vec4(-1, -0.0275, -0.572, 0.022);\n  const vec4 c1 = vec4(1, 0.0425, 1.04, -0.04);\n  vec4 r = roughness * c0 + c1;\n  float a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\n  vec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\n  return specular * AB.x + AB.y;\n}\n\nvec3 getSpecularDominantDir(const in vec3 N, const in vec3 R,\n                            const in float realRoughness) {\n  float smoothness = 1.0 - realRoughness;\n  return mix(N, R, smoothness * (sqrt(smoothness) + realRoughness));\n}\n\nvec3 approximateSpecularIBL(const in vec3 specularColor, float rLinear,\n                            const in vec3 N, const in vec3 V) {\n  float NoV = clamp(dot(N, V), 0.0, 1.0);\n  vec3 R = normalize((2.0 * NoV) * N - V);\n  R = getSpecularDominantDir(N, R, rLinear);\n  vec3 prefilteredColor = texturePanoramaLod(uIblTransform * R, rLinear);\n  return prefilteredColor * integrateBRDFApprox(specularColor, rLinear, NoV);\n}\n\n// expect shCoefs uniform\n// https://github.com/cedricpinson/envtools/blob/master/Cubemap.cpp#L523\nvec3 sphericalHarmonics(const in vec3 N) {\n  float x = N.x;\n  float y = N.y;\n  float z = -N.z;\n  vec3 result = uSPH[0] + uSPH[1] * y + uSPH[2] * z + uSPH[3] * x +\n                uSPH[4] * y * x + uSPH[5] * y * z +\n                uSPH[6] * (3.0 * z * z - 1.0) + uSPH[7] * (z * x) +\n                uSPH[8] * (x * x - y * y);\n  return max(result, vec3(0.0));\n}\n\nvec3 computeIBL_UE4(const in vec3 N, const in vec3 V, const in vec3 albedo,\n                    const in float roughness, const in vec3 specular) {\n  vec3 color = albedo * sphericalHarmonics(uIblTransform * N);\n  color += approximateSpecularIBL(specular, roughness, N, V);\n  return color;\n}\n";var y=g.getCopy();y.vertexName=y.fragmentName="ShadingPBR",y.textures={};var b="resources/environments/";y.environments=[{path:b+"mpumalanga_veld_1k.png",sph:[.136819,.174125,.253762,.027778,.056838,.131221,.074356,.086793,.099181,-.07904,-.091269,-.102346,-.02755,-.0323,-.039217,.031822,.034773,.039945,.017235,.021044,.026136,-.106608,-.11864,-.132761,.041,.049794,.061183],exposure:2.5,name:"Mpumalanga veld"},{path:b+"venetian_crossroads_1k.png",sph:[.200626,.198426,.209579,.090452,.127807,.18839,.093188,.103245,.106131,.033349,.054751,.067044,.07435,.08167,.079716,.063127,.08594,.10171,.007751,.00571,-791e-6,.104134,.103979,.094236,-.022747,-.028166,-.037714],exposure:2.5,name:"Venetian crossroads"},{path:b+"studio_small_01_1k.png",sph:[.534107,.589985,.617478,.119999,.13048,.128019,.089872,.088707,.088017,.099999,.151282,.138458,.005015,.035588,.027592,.114999,.116739,.120579,-.057997,-.069532,-.070401,.385123,.411714,.454725,.303242,.333004,.35027],exposure:.5,name:"Studio small 01"},{path:b+"moonless_golf_1k.png",sph:[.137579,.112906,.09347,.070711,.066043,.065337,-.029564,-.02072,-.007737,-.037254,-.03327,-.028294,-.023847,-.021208,-.018767,-.007873,-.002587,.003955,.009241,.007711,.006063,.017917,.011733,.007669,.036859,.026285,.01474],exposure:1,name:"Moonless golf"},{path:b+"winter_river_1k.png",sph:[.560145,.554695,.513523,-.213105,-.15519,-.063568,.135182,.114211,.069349,.172852,.15182,.105477,.065753,.06405,.052622,.096352,.086557,.063826,.02183,.01656,.008804,.186193,.16372,.119627,.025363,.022278,.014461],exposure:.5,name:"Winter river"}];var T=(0,l.Z)();y.idEnv=Math.min(T.environment,y.environments.length-1),y.exposure=void 0===T.exposure?y.environments[y.idEnv].exposure:Math.min(T.exposure,5),y.uniforms={},y.attributes={},y.uniformNames=["uIblTransform","uTexture0","uAlbedo","uRoughness","uMetallic","uExposure","uSPH","uEnvSize"],Array.prototype.push.apply(y.uniformNames,g.uniformNames.commonUniforms),y.vertex=["attribute vec3 aVertex;","attribute vec3 aNormal;","attribute vec3 aColor;","attribute vec3 aMaterial;",g.strings.vertUniforms,"uniform float uRoughness;","uniform float uMetallic;","uniform vec3 uAlbedo;","varying vec3 vVertex;","varying vec3 vNormal;","varying vec3 vAlbedo;","varying float vRoughness;","varying float vMetallic;","varying float vMasking;","void main() {","  vAlbedo = uAlbedo.x >= 0.0 ? uAlbedo : aColor;","  vRoughness = uRoughness >= 0.0 ? uRoughness : aMaterial.x;","  vMetallic = uMetallic >= 0.0 ? uMetallic : aMaterial.y;","  vMasking = aMaterial.z;","  vNormal = mix(aNormal, uEN * aNormal, vMasking);","  vNormal = normalize(uN * vNormal);","  vec4 vertex4 = vec4(aVertex, 1.0);","  vertex4 = mix(vertex4, uEM * vertex4, vMasking);","  vVertex = vec3(uMV * vertex4);","  gl_Position = uMVP * vertex4;","}"].join("\n"),y.fragment=["varying vec3 vVertex;","varying vec3 vNormal;","varying vec3 vAlbedo;","varying float vRoughness;","varying float vMetallic;","uniform float uAlpha;",g.strings.fragColorUniforms,g.strings.fragColorFunction,v,"","void main(void) {","  vec3 normal = getNormal();","  float roughness = max( 0.0001, vRoughness );","  vec3 linColor = sRGBToLinear(vAlbedo);","  vec3 albedo = linColor * (1.0 - vMetallic);","  vec3 specular = mix( vec3(0.04), linColor, vMetallic);","","  vec3 color = uExposure * computeIBL_UE4( normal, -normalize(vVertex), albedo, roughness, specular );","  gl_FragColor = encodeFragColor(color, uAlpha);","}"].join("\n"),y.onLoadEnvironment=function(e,t,r,i){if(!e.status||200===e.status||e.response&&e.response.byteLength){var n=e.width||Math.sqrt(e.response.byteLength/8),a=2*n;i.size=[n,a],i.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,i.texture),e.response?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n,a,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(e.response)):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.bindTexture(t.TEXTURE_2D,null),r&&r.render()}},y.getOrCreateEnvironment=function(e,t,r){if(void 0!==r.texture)return r.texture;if(r.texture=null,r.path.endsWith("png")){var i=new Image;return i.src=r.path,i.onload=y.onLoadEnvironment.bind(this,i,e,t,r),null}var n=new XMLHttpRequest;return n.open("GET",r.path,!0),n.responseType="arraybuffer",n.onload=y.onLoadEnvironment.bind(this,n,e,t,r),n.send(null),null};var k=i.wO.create();y.updateUniforms=function(e,t){var r=e.getGL(),n=this.uniforms;i.wO.fromMat4(k,t.getCamera().getView()),r.uniformMatrix3fv(n.uIblTransform,!1,i.wO.transpose(k,k)),r.uniform3fv(n.uAlbedo,e.getAlbedo()),r.uniform1f(n.uRoughness,e.getRoughness()),r.uniform1f(n.uMetallic,e.getMetallic()),r.uniform1f(n.uExposure,y.exposure);var a=y.environments[y.idEnv];r.uniform3fv(n.uSPH,a.sph),a.size&&r.uniform2fv(n.uEnvSize,a.size),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,y.getOrCreateEnvironment(r,t,a)||this.getDummyTexture(r)),r.uniform1i(n.uTexture0,0),g.updateUniforms.call(this,e,t)};const M=y;var x=r(183),S=g.getCopy();S.vertexName=S.fragmentName="Matcap",S.textures={},S.createTexture=function(e,t,r){var i=e.createTexture();e.bindTexture(e.TEXTURE_2D,i),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),S.setTextureParameters(e,t),e.bindTexture(e.TEXTURE_2D,null),S.textures[r]=i},S.matcaps=[{path:"resources/matcaps/matcapFV.jpg",name:"matcap FV"},{path:"resources/matcaps/redClay.jpg",name:"Red clay"},{path:"resources/matcaps/skinHazardousarts.jpg",name:"Skin hazardousarts"},{path:"resources/matcaps/skinHazardousarts2.jpg",name:"Skin Hazardousarts2"},{path:"resources/matcaps/pearl.jpg",name:(0,x.Z)("matcapPearl")},{path:"resources/matcaps/clay.jpg",name:(0,x.Z)("matcapClay")},{path:"resources/matcaps/skin.jpg",name:(0,x.Z)("matcapSkin")},{path:"resources/matcaps/green.jpg",name:(0,x.Z)("matcapGreen")},{path:"resources/matcaps/white.jpg",name:(0,x.Z)("matcapWhite")}],S.uniforms={},S.attributes={},S.uniformNames=["uTexture0","uAlbedo"],Array.prototype.push.apply(S.uniformNames,g.uniformNames.commonUniforms),S.vertex=["attribute vec3 aVertex;","attribute vec3 aNormal;","attribute vec3 aColor;","attribute vec3 aMaterial;",g.strings.vertUniforms,"varying vec3 vVertex;","varying vec3 vNormal;","varying vec3 vColor;","varying float vMasking;","varying vec3 vVertexPres;","uniform vec3 uAlbedo;","void main() {","  vColor = uAlbedo.x >= 0.0 ? uAlbedo : aColor;","  vMasking = aMaterial.z;","  vNormal = mix(aNormal, uEN * aNormal, vMasking);","  vNormal = normalize(uN * vNormal);","  vec4 vertex4 = vec4(aVertex, 1.0);","  vertex4 = mix(vertex4, uEM * vertex4, vMasking);","  vVertex = vec3(uMV * vertex4);","  vVertexPres = vVertex / max(1.0, abs(uMV[3][2]));","  gl_Position = uMVP * vertex4;","}"].join("\n"),S.fragment=["uniform sampler2D uTexture0;","varying vec3 vVertex;","varying vec3 vVertexPres;","varying vec3 vNormal;","varying vec3 vColor;","uniform float uAlpha;",g.strings.fragColorUniforms,g.strings.fragColorFunction,"void main() {","  vec3 normal = getNormal();","  vec3 nm_z = normalize(vVertexPres);","  vec3 nm_x = vec3(-nm_z.z, 0.0, nm_z.x);","  vec3 nm_y = cross(nm_x, nm_z);","  vec2 texCoord = 0.5 + 0.5 * vec2(dot(normal, nm_x), dot(normal, nm_y));","  vec3 color = sRGBToLinear(texture2D(uTexture0, texCoord).rgb) * sRGBToLinear(vColor);","  gl_FragColor = encodeFragColor(color, uAlpha);","}"].join("\n"),S.updateUniforms=function(e,t){var r=e.getGL(),i=this.uniforms;r.activeTexture(r.TEXTURE0),e.setTexture0(S.textures[e.getMatcap()]),r.bindTexture(r.TEXTURE_2D,e.getTexture0()||this.getDummyTexture(r)),r.uniform1i(i.uTexture0,0),r.uniform3fv(i.uAlbedo,e.getAlbedo()),g.updateUniforms.call(this,e,t)};const A=S;var E=g.getCopy();E.vertexName=E.fragmentName="ShowNormal",E.uniforms={},E.attributes={},E.activeAttributes={vertex:!0,normal:!0,material:!0},E.uniformNames=[],Array.prototype.push.apply(E.uniformNames,g.uniformNames.commonUniforms),E.vertex=["attribute vec3 aVertex;","attribute vec3 aNormal;","attribute vec3 aMaterial;",g.strings.vertUniforms,"varying vec3 vVertex;","varying vec3 vNormal;","varying float vMasking;","void main() {","  vMasking = aMaterial.z;","  vNormal = mix(aNormal, uEN * aNormal, vMasking);","  vNormal = normalize(uN * vNormal);","  vec4 vertex4 = vec4(aVertex, 1.0);","  vertex4 = mix(vertex4, uEM *vertex4, vMasking);","  vVertex = vec3(uMV * vertex4);","  gl_Position = uMVP * vertex4;","}"].join("\n"),E.fragment=["varying vec3 vVertex;","varying vec3 vNormal;","uniform float uAlpha;",g.strings.fragColorUniforms,g.strings.fragColorFunction,"void main() {","  gl_FragColor = encodeFragColor(sRGBToLinear(getNormal() * 0.5 + 0.5), uAlpha);","}"].join("\n");const R=E;var w=g.getCopy();w.vertexName=w.fragmentName="ShowUV",w.texPath="resources/uv.png",w.uniforms={},w.attributes={},w.uniformNames=["uTexture0","uAlbedo"],Array.prototype.push.apply(w.uniformNames,g.uniformNames.commonUniforms),w.vertex=["attribute vec3 aVertex;","attribute vec3 aNormal;","attribute vec3 aColor;","attribute vec2 aTexCoord;","attribute vec3 aMaterial;",g.strings.vertUniforms,"varying vec3 vVertex;","varying vec3 vNormal;","varying vec3 vColor;","varying vec2 vTexCoord;","varying float vMasking;","uniform vec3 uAlbedo;","void main() {","  vColor = uAlbedo.x >= 0.0 ? uAlbedo : aColor;","  vTexCoord = aTexCoord;","  vMasking = aMaterial.z;","  vNormal = mix(aNormal, uEN * aNormal, vMasking);","  vNormal = normalize(uN * vNormal);","  vec4 vertex4 = vec4(aVertex, 1.0);","  vertex4 = mix(vertex4, uEM *vertex4, vMasking);","  vVertex = vec3(uMV * vertex4);","  gl_Position = uMVP * vertex4;","}"].join("\n"),w.fragment=["uniform sampler2D uTexture0;","varying vec3 vVertex;","varying vec3 vNormal;","varying vec3 vColor;","varying vec2 vTexCoord;","uniform float uAlpha;",g.strings.fragColorUniforms,g.strings.fragColorFunction,"void main() {","  vec3 color = sRGBToLinear(texture2D(uTexture0, vTexCoord).rgb) * sRGBToLinear(vColor);","  gl_FragColor = encodeFragColor(color, uAlpha);","}"].join("\n"),w.draw=g.draw,w.drawBuffer=g.drawBuffer,w.getOrCreate=g.getOrCreate,w.initUniforms=g.initUniforms,w.initAttributes=function(e){g.initAttributes.call(this,e),w.attributes.aTexCoord=new d(e,w.program,"aTexCoord",2,e.FLOAT)},w.bindAttributes=function(e){g.bindAttributes.call(this,e),w.attributes.aTexCoord.bindToBuffer(e.getTexCoordBuffer())},w.updateUniforms=function(e,t){var r=e.getGL(),i=this.uniforms;r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,this.getOrCreateTexture0(r,w.texPath,t)||this.getDummyTexture(r)),r.uniform1i(i.uTexture0,0),r.uniform3fv(i.uAlbedo,e.getAlbedo()),g.updateUniforms.call(this,e,t)};const C=w;var P=g.getCopy();P.vertexName=P.fragmentName="Wireframe",P.uniforms={},P.attributes={},P.activeAttributes={vertex:!0,material:!0},P.uniformNames=["uMVP","uEM"],P.vertex=["attribute vec3 aVertex;","attribute vec3 aMaterial;","uniform mat4 uMVP;","uniform mat4 uEM;","void main() {","  vec4 vertex4 = vec4(aVertex, 1.0);","  vec4 pos = uMVP * mix(vertex4, uEM * vertex4, aMaterial.z);","  pos[3] += 0.0001;","  gl_Position = pos;","}"].join("\n"),P.fragment=["void main() {","  gl_FragColor = vec4(0.0, 0.0, 0.0, 0.4);","}"].join("\n"),P.getOrCreate=g.getOrCreate,P.draw=function(e){var t=e.getGL();t.useProgram(this.program),this.bindAttributes(e),this.updateUniforms(e),e.getWireframeBuffer().bind(),t.drawElements(t.LINES,2*e.getRenderNbEdges(),t.UNSIGNED_INT,0)},P.updateUniforms=function(e){var t=e.getGL();t.uniformMatrix4fv(this.uniforms.uMVP,!1,e.getMVP()),t.uniformMatrix4fv(this.uniforms.uEM,!1,e.getEditMatrix())};const D=P;var I=g.getCopy();I.vertexName=I.fragmentName="FlatColor",I.uniforms={},I.attributes={},I.activeAttributes={vertex:!0,material:!0},I.uniformNames=["uColor"],Array.prototype.push.apply(I.uniformNames,g.uniformNames.commonUniforms),I.vertex=["attribute vec3 aVertex;","attribute vec3 aMaterial;",g.strings.vertUniforms,"varying vec3 vVertex;","void main() {","  vec4 vertex4 = vec4(aVertex, 1.0);","  gl_Position = uMVP * mix(vertex4, uEM * vertex4, aMaterial.z);","}"].join("\n"),I.fragment=["uniform vec3 uColor;","void main() {","  gl_FragColor = vec4(uColor, 1.0);","}"].join("\n"),I.updateUniforms=function(e,t){e.getGL().uniform3fv(this.uniforms.uColor,e.getFlatColor()),g.updateUniforms.call(this,e,t)};const F=I;var O=g.getCopy();O.vertexName=O.fragmentName="ShowSelection",O.uniforms={},O.attributes={},O.activeAttributes={vertex:!0},O.uniformNames=["uMVP","uColor"],O.vertex=["attribute vec3 aVertex;","uniform mat4 uMVP;","void main() {","  gl_Position = uMVP * vec4(aVertex, 1.0);","}"].join("\n"),O.fragment=["uniform vec3 uColor;","void main() {","  gl_FragColor = vec4(uColor, 1.0);","}"].join("\n"),O.draw=function(e,t,r){var i=e.getGL();i.useProgram(this.program),i.uniform3fv(this.uniforms.uColor,e.getColor()),t&&(i.uniformMatrix4fv(this.uniforms.uMVP,!1,e.getCircleMVP()),O.attributes.aVertex.bindToBuffer(e.getCircleBuffer()),i.drawArrays(i.LINE_LOOP,0,e.getCircleBuffer()._size/3)),i.uniformMatrix4fv(this.uniforms.uMVP,!1,e.getDotMVP()),O.attributes.aVertex.bindToBuffer(e.getDotBuffer()),i.drawArrays(i.TRIANGLE_FAN,0,e.getDotBuffer()._size/3),r&&(i.uniformMatrix4fv(this.uniforms.uMVP,!1,e.getDotSymmetryMVP()),i.drawArrays(i.TRIANGLE_FAN,0,e.getDotBuffer()._size/3))};const V=O;var L=g.getCopy();L.vertexName=L.fragmentName="Background",L.uniforms={},L.attributes={},L.uniformNames=["uTexture0","uBackgroundType","uIblTransform","uSPH","uBlur","uEnvSize"],L.vertex=["attribute vec2 aVertex;","attribute vec2 aTexCoord;","varying vec2 vTexCoord;","void main() {","  vTexCoord = aTexCoord;","  gl_Position = vec4(aVertex, 1.0, 1.0);","}"].join("\n"),L.fragment=["varying vec2 vTexCoord;",g.strings.colorSpaceGLSL,v,"/*\nMódulo de renderizado WebGL de SculptGL.\nDibuja la escena 3D y administra shaders, buffers y el pipeline de dibujo.\n*/\nuniform int uBackgroundType;\nuniform float uBlur;\n\nvoid main() {\n  vec3 color;\n  if (uBackgroundType == 0) {\n    color = sRGBToLinear(texture2D(uTexture0, vTexCoord).rgb);\n  } else {\n    vec3 dir = uIblTransform * vec3(vTexCoord.xy * 2.0 - 1.0, -1.0);\n    dir = normalize(dir);\n    if (uBackgroundType == 1) {\n      color = texturePanoramaLod(dir, uBlur * uBlur);\n    } else {\n      color = sphericalHarmonics(dir);\n    }\n  }\n  gl_FragColor = encodeRGBM(color);\n}\n"].join("\n"),L.draw=function(e){var t=e.getGL();t.useProgram(this.program),this.bindAttributes(e),this.updateUniforms(e),t.drawArrays(t.TRIANGLE_STRIP,0,4)},L.initAttributes=function(e){var t=L.program,r=L.attributes;r.aVertex=new d(e,t,"aVertex",2,e.FLOAT),r.aTexCoord=new d(e,t,"aTexCoord",2,e.FLOAT)},L.bindAttributes=function(e){var t=L.attributes;t.aVertex.bindToBuffer(e.getVertexBuffer()),t.aTexCoord.bindToBuffer(e.getTexCoordBuffer())};var N=i.wO.create();L.updateUniforms=function(e){var t,r=this.uniforms,n=e._main,a=M.environments[M.idEnv],s=e.getGL();s.uniform1i(r.uBackgroundType,e.getType()),t=0===e.getType()?e.getTexture():M.getOrCreateEnvironment(s,n,a)||e.getTexture(),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,t),s.uniform1i(r.uTexture0,0),i.wO.fromMat4(N,n.getCamera().getView()),s.uniformMatrix3fv(r.uIblTransform,!1,i.wO.transpose(N,N)),s.uniform3fv(r.uSPH,a.sph),a.size&&s.uniform2fv(r.uEnvSize,a.size),s.uniform1f(r.uBlur,e.getBlur())};const B=L;var U=g.getCopy();U.vertexName=U.fragmentName="Merge",U.FILMIC=(0,l.Z)().filmic,U.uniforms={},U.attributes={},U.uniformNames=["uTexture0","uTexture1","uFilmic"],U.vertex=["attribute vec2 aVertex;","varying vec2 vTexCoord;","void main() {","  vTexCoord = aVertex * 0.5 + 0.5;","  gl_Position = vec4(aVertex, 0.5, 1.0);","}"].join("\n"),U.fragment=["uniform sampler2D uTexture0;","uniform sampler2D uTexture1;","uniform int uFilmic;","varying vec2 vTexCoord;",g.strings.colorSpaceGLSL,"void main() {","  vec4 transparent = texture2D(uTexture1, vTexCoord);","  vec3 color = decodeRGBM(texture2D(uTexture0, vTexCoord))*(1.0-transparent.a) + transparent.rgb;","  if(uFilmic == 1){","    vec3 x = max(vec3(0.0), color - vec3(0.004));","    gl_FragColor = vec4((x*(6.2*x+0.5))/(x*(6.2*x+1.7)+0.06), 1.0);","  }else{","    gl_FragColor = vec4(linearTosRGB(color), 1.0);","  }","}"].join("\n"),U.draw=function(e,t){var r=e.getGL();r.useProgram(this.program),U.attributes.aVertex.bindToBuffer(e.getVertexBuffer()),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,t._rttOpaque.getTexture()),r.uniform1i(this.uniforms.uTexture0,0),r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,t._rttTransparent.getTexture()),r.uniform1i(this.uniforms.uTexture1,1),r.uniform1i(this.uniforms.uFilmic,U.FILMIC),r.drawArrays(r.TRIANGLES,0,3)},U.initAttributes=function(e){U.attributes.aVertex=new d(e,U.program,"aVertex",2,e.FLOAT)};const Z=U;var z=g.getCopy();z.vertexName=z.fragmentName="Fxaa",z.FILMIC=(0,l.Z)().filmic,z.uniforms={},z.attributes={},z.uniformNames=["uTexture0","uInvSize"],z.vertex=["attribute vec2 aVertex;","uniform vec2 uInvSize;","varying vec2 vUVNW;","varying vec2 vUVNE;","varying vec2 vUVSW;","varying vec2 vUVSE;","varying vec2 vUVM;","void main() {","  vUVM = aVertex * 0.5 + 0.5;","  vUVNW = vUVM + vec2(-1.0, -1.0) * uInvSize;","  vUVNE = vUVM + vec2(1.0, -1.0) * uInvSize;","  vUVSW = vUVM + vec2(-1.0, 1.0) * uInvSize;","  vUVSE = vUVM + vec2(1.0, 1.0) * uInvSize;","  gl_Position = vec4(aVertex, 0.5, 1.0);","}"].join("\n"),z.fragment=["uniform sampler2D uTexture0;","uniform vec2 uInvSize;","varying vec2 vUVNW;","varying vec2 vUVNE;","varying vec2 vUVSW;","varying vec2 vUVSE;","varying vec2 vUVM;","/*\nMódulo de renderizado WebGL de SculptGL.\nDibuja la escena 3D y administra shaders, buffers y el pipeline de dibujo.\n*/\n// https://github.com/mattdesl/glsl-fxaa\n#define FXAA_REDUCE_MIN (1.0/ 128.0)\n#define FXAA_REDUCE_MUL (1.0 / 8.0)\n#define FXAA_SPAN_MAX 8.0\n\nvec3 fxaa(const in sampler2D tex, const in vec2 uvNW, const in vec2 uvNE, const in vec2 uvSW, const in vec2 uvSE, const in vec2 uvM, const in vec2 invRes) {\n    const vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(texture2D(tex, uvNW).xyz, luma);\n    float lumaNE = dot(texture2D(tex, uvNE).xyz, luma);\n    float lumaSW = dot(texture2D(tex, uvSW).xyz, luma);\n    float lumaSE = dot(texture2D(tex, uvSE).xyz, luma);\n    float lumaM  = dot(texture2D(tex, uvM).xyz,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    vec2 dir = vec2(-((lumaNW + lumaNE) - (lumaSW + lumaSE)), ((lumaNW + lumaSW) - (lumaNE + lumaSE)));\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX), max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), dir * rcpDirMin)) * invRes;\n    \n    vec3 rgbA = 0.5 * ( texture2D(tex, uvM + dir * (1.0 / 3.0 - 0.5)).xyz + texture2D(tex, uvM + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * ( texture2D(tex, uvM - dir * 0.5).xyz + texture2D(tex, uvM + dir * 0.5).xyz);\n    \n    float lumaB = dot(rgbB, luma);\n    if((lumaB < lumaMin) || (lumaB > lumaMax))\n      return rgbA;\n    return rgbB;\n}",g.strings.colorSpaceGLSL,"void main() {","  gl_FragColor = vec4(fxaa(uTexture0, vUVNW, vUVNE, vUVSW, vUVSE, vUVM, uInvSize), 1.0);","}"].join("\n"),z.draw=function(e,t){var r=e.getGL();r.useProgram(this.program),z.attributes.aVertex.bindToBuffer(e.getVertexBuffer()),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,t._rttMerge.getTexture()),r.uniform1i(this.uniforms.uTexture0,0),r.uniform2fv(this.uniforms.uInvSize,e.getInverseSize()),r.drawArrays(r.TRIANGLES,0,3)},z.initAttributes=function(e){z.attributes.aVertex=new d(e,z.program,"aVertex",2,e.FLOAT)};const G=z;var W=g.getCopy();W.vertexName=W.fragmentName="SobelContour",W.color=(0,l.Z)().outlinecolor,W.uniforms={},W.attributes={},W.uniformNames=["uTexture0","uColor","uInvSize"],W.vertex=["attribute vec2 aVertex;","varying vec2 vTexCoord;","void main() {","  vTexCoord = aVertex * 0.5 + 0.5;","  gl_Position = vec4(aVertex, 0.0, 1.0);","}"].join("\n"),W.fragment=["#extension GL_OES_standard_derivatives : enable","uniform sampler2D uTexture0;","uniform vec4 uColor;","varying vec2 vTexCoord;","uniform vec2 uInvSize;","/*\nMódulo de renderizado WebGL de SculptGL.\nDibuja la escena 3D y administra shaders, buffers y el pipeline de dibujo.\n*/\n\nfloat outlineDistance( const in vec2 uv, const in sampler2D tex, const in vec2 invSize ) {\n  float fac0 = 2.0;\n  float fac1 = 1.0;\n  float ox = invSize.x;\n  float oy = invSize.y;\n  vec4 texel0 = texture2D(tex, uv + vec2(ox, oy));\n  vec4 texel1 = texture2D(tex, uv + vec2(ox, 0.0));\n  vec4 texel2 = texture2D(tex, uv + vec2(ox, -oy));\n  vec4 texel3 = texture2D(tex, uv + vec2(0.0, -oy));\n  vec4 texel4 = texture2D(tex, uv + vec2(-ox, -oy));\n  vec4 texel5 = texture2D(tex, uv + vec2(-ox, 0.0));\n  vec4 texel6 = texture2D(tex, uv + vec2(-ox, oy));\n  vec4 texel7 = texture2D(tex, uv + vec2(0.0, oy));\n  vec4 rowx = -fac0 * texel5 + fac0 * texel1 + -fac1 * texel6 + fac1 * texel0 + -fac1 * texel4 + fac1 * texel2;\n  vec4 rowy = -fac0 * texel3 + fac0 * texel7 + -fac1 * texel4 + fac1 * texel6 + -fac1 * texel2 + fac1 * texel0;\n  return dot(rowy, rowy) + dot(rowx, rowx);\n}\n",g.strings.colorSpaceGLSL,"void main() {","  float mag = outlineDistance(vTexCoord, uTexture0, uInvSize);","  if (mag < 1.5) discard;","  gl_FragColor = vec4(sRGBToLinear(uColor.rgb) * uColor.a, uColor.a);","}"].join("\n"),W.draw=function(e){var t=e.getGL();t.useProgram(this.program),W.attributes.aVertex.bindToBuffer(e.getVertexBuffer()),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,e.getTexture()),t.uniform1i(this.uniforms.uTexture0,0),t.uniform4fv(this.uniforms.uColor,W.color),t.uniform2fv(this.uniforms.uInvSize,e.getInverseSize()),t.drawArrays(t.TRIANGLES,0,3)},W.initAttributes=function(e){W.attributes.aVertex=new d(e,W.program,"aVertex",2,e.FLOAT)};const j=W;var X=g.getCopy();X.CHANNEL_VALUE=0,X.vertexName=X.fragmentName="PaintUV",X.uniforms={},X.attributes={},X.uniformNames=["uChannelPaint"],X.activeAttributes={color:!0,material:!0},X.vertex=["attribute vec2 aTexCoord;","attribute vec3 aColor;","attribute vec3 aMaterial;","varying vec3 vColor;","varying vec2 vMaterial;","void main() {","  vColor = aColor;","  vMaterial = aMaterial.xy;","  gl_Position = vec4((aTexCoord * 2.0 - 1.0) * vec2(1.0, -1.0), 0.5, 1.0);","}"].join("\n"),X.fragment=["varying vec3 vColor;","varying vec2 vMaterial;","uniform int uChannelPaint;","void main() {","  gl_FragColor = vec4(uChannelPaint == 0 ? vColor : uChannelPaint == 1 ? vMaterial.xxx : vMaterial.yyy, 1.0);","}"].join("\n"),X.initAttributes=function(e){g.initAttributes.call(this,e),X.attributes.aTexCoord=new d(e,X.program,"aTexCoord",2,e.FLOAT)},X.bindAttributes=function(e){g.bindAttributes.call(this,e),X.attributes.aTexCoord.bindToBuffer(e.getTexCoordBuffer())},X.updateUniforms=function(e){e.getGL().uniform1i(this.uniforms.uChannelPaint,X.CHANNEL_VALUE)};const H=X;var Y=g.getCopy();Y.vertexName=Y.fragmentName="Blur",Y.INPUT_TEXTURE=null,Y.uniforms={},Y.attributes={},Y.uniformNames=["uTexture0","uInvSize"],Y.vertex=["attribute vec2 aVertex;","varying vec2 vTexCoord;","void main() {","  vTexCoord = aVertex * 0.5 + 0.5;","  gl_Position = vec4(aVertex, 0.5, 1.0);","}"].join("\n"),Y.fragment=["uniform sampler2D uTexture0;","varying vec2 vTexCoord;","uniform vec2 uInvSize;",g.strings.colorSpaceGLSL,"void main() {","    const int KER_SIZE = 8;","    vec4 avg = texture2D(uTexture0, vTexCoord);","    if (avg.a < 0.1) {","        for (int i = -KER_SIZE; i <= KER_SIZE; ++i) {","            for (int j = -KER_SIZE; j <= KER_SIZE; ++j) {","                if (i == 0 && j == 0) continue;","                vec4 fetch = texture2D(uTexture0, vTexCoord + vec2(i, j) * uInvSize);","                avg.rgb += sRGBToLinear(fetch.rgb) * fetch.a;","                avg.a += fetch.a;","            }","        }","        avg.rgb = avg.a == 0.0 ? vec3(0.0) : linearTosRGB(avg.rgb / avg.a);","    }","    gl_FragColor = vec4(avg.rgb, 1.0);","}"].join("\n"),Y.draw=function(e){var t=e.getGL();t.useProgram(this.program),Y.attributes.aVertex.bindToBuffer(e.getVertexBuffer()),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,Y.INPUT_TEXTURE.getTexture()),t.uniform1i(this.uniforms.uTexture0,0),t.uniform2fv(this.uniforms.uInvSize,Y.INPUT_TEXTURE.getInverseSize()),t.drawArrays(t.TRIANGLES,0,3)},Y.initAttributes=function(e){Y.attributes.aVertex=new d(e,Y.program,"aVertex",2,e.FLOAT)};const K=Y;var q=[];q[s.Z.Shader.PBR]=M,q[s.Z.Shader.MATCAP]=A,q[s.Z.Shader.NORMAL]=R,q[s.Z.Shader.UV]=C,q[s.Z.Shader.WIREFRAME]=D,q[s.Z.Shader.FLAT]=F,q[s.Z.Shader.SELECTION]=V,q[s.Z.Shader.BACKGROUND]=B,q[s.Z.Shader.MERGE]=Z,q[s.Z.Shader.FXAA]=G,q[s.Z.Shader.CONTOUR]=j,q[s.Z.Shader.PAINTUV]=H,q[s.Z.Shader.BLUR]=K;const J=q;function Q(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var $=i._E.create(),ee=i._E.create(),te=[0,0,0],re=[0,0,0],ie=[0,0,1];const ne=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._gl=t,this._circleBuffer=new c(t,t.ARRAY_BUFFER,t.STATIC_DRAW),this._dotBuffer=new c(t,t.ARRAY_BUFFER,t.STATIC_DRAW),this._cacheDotMVP=i._E.create(),this._cacheDotSymMVP=i._E.create(),this._cacheCircleMVP=i._E.create(),this._color=new Float32Array([.8,0,0]),this._offsetX=0,this._isEditMode=!1,this.init()}var t,r;return t=e,(r=[{key:"getGL",value:function(){return this._gl}},{key:"getCircleBuffer",value:function(){return this._circleBuffer}},{key:"getDotBuffer",value:function(){return this._dotBuffer}},{key:"getCircleMVP",value:function(){return this._cacheCircleMVP}},{key:"getDotMVP",value:function(){return this._cacheDotMVP}},{key:"getDotSymmetryMVP",value:function(){return this._cacheDotSymMVP}},{key:"getColor",value:function(){return this._color}},{key:"setIsEditMode",value:function(e){this._isEditMode=e}},{key:"getIsEditMode",value:function(){return this._isEditMode}},{key:"setOffsetX",value:function(e){this._offsetX=e}},{key:"getOffsetX",value:function(){return this._offsetX}},{key:"init",value:function(){this.getCircleBuffer().update(this._getCircleVertices(1)),this.getDotBuffer().update(this._getDotVertices(.05,10))}},{key:"release",value:function(){this.getCircleBuffer().release(),this.getDotBuffer().release()}},{key:"_getCircleVertices",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=2*Math.PI,n=r?1:0,a=r?t+2:t,s=new Float32Array(3*a),o=n;o<a;++o){var l=3*o,u=i*o/t;s[l]=Math.cos(u)*e,s[l+1]=Math.sin(u)*e}return s}},{key:"_getDotVertices",value:function(e,t){return this._getCircleVertices(e,t,!0)}},{key:"_updateMatricesBackground",value:function(e,t){var r=t.getSculptManager().getCurrentTool().getScreenRadius(),n=.5*e._width,a=.5*e._height;i._E.ortho($,-n,n,-a,a,-10,10),i._E.identity(ee),i._E.translate(ee,ee,i.R3.set(te,-n+t._mouseX+this._offsetX,a-t._mouseY,0)),i._E.scale(this._cacheCircleMVP,ee,i.R3.set(te,r,r,r)),i._E.mul(this._cacheCircleMVP,$,this._cacheCircleMVP),i._E.scale(this._cacheDotMVP,ee,i.R3.set(te,50,50,50)),i._E.mul(this._cacheDotMVP,$,this._cacheDotMVP),i._E.scale(this._cacheDotSymMVP,this._cacheDotSymMVP,[0,0,0])}},{key:"_updateMatricesMesh",value:function(e,t){var r=t.getPicking(),n=t.getPickingSymmetry(),a=Math.sqrt(r.computeWorldRadius2(!0)),s=t.getSculptManager().getCurrentTool().getScreenRadius(),o=r.getMesh(),l=a/s*50;r.polyLerp(o.getNormals(),re),i.R3.transformMat3(re,re,i.wO.normalFromMat4(ee,o.getMatrix())),i.R3.normalize(re,re);var u=Math.acos(i.R3.dot(ie,re));i.R3.cross(re,ie,re),i._E.identity(ee),i._E.translate(ee,ee,i.R3.transformMat4(te,r.getIntersectionPoint(),o.getMatrix())),i._E.rotate(ee,ee,u,re),i._E.mul($,e.getProjection(),e.getView()),i._E.scale(this._cacheCircleMVP,ee,i.R3.set(te,a,a,a)),i._E.mul(this._cacheCircleMVP,$,this._cacheCircleMVP),i._E.scale(this._cacheDotMVP,ee,i.R3.set(te,l,l,l)),i._E.mul(this._cacheDotMVP,$,this._cacheDotMVP),i.R3.transformMat4(te,n.getIntersectionPoint(),o.getMatrix()),i._E.identity(ee),i._E.translate(ee,ee,te),i._E.rotate(ee,ee,u,re),i._E.scale(ee,ee,i.R3.set(te,l,l,l)),i._E.mul(this._cacheDotSymMVP,$,ee)}},{key:"render",value:function(e){var t=e.getPicking().getMesh()&&!this._isEditMode;t?this._updateMatricesMesh(e.getCamera(),e):this._updateMatricesBackground(e.getCamera(),e);var r=e._action===s.Z.Action.NOTHING;i.R3.set(this._color,.8,r&&t?0:.4,0),J[s.Z.Shader.SELECTION].getOrCreate(this._gl).draw(this,r,e.getSculptManager().getSymmetry()),this._isEditMode=!1}}])&&Q(t.prototype,r),e}();function ae(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}const se=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=t,this._cbContinuous=this.updateContinuous.bind(this),this._lastMouseX=0,this._lastMouseY=0}var t,r;return t=e,(r=[{key:"setToolMesh",value:function(e){this._forceToolMesh=e}},{key:"getMesh",value:function(){return this._forceToolMesh||this._main.getMesh()}},{key:"start",value:function(e){var t=this._main,r=t.getPicking();if(!r.intersectionMouseMeshes())return!1;var i=t.setOrUnsetMesh(r.getMesh(),e);if(!i)return!1;r.initAlpha();var n=t.getSculptManager().getSymmetry()?t.getPickingSymmetry():null;return n&&(n.intersectionMouseMesh(i),n.initAlpha()),this.pushState(),this._lastMouseX=t._mouseX,this._lastMouseY=t._mouseY,this.startSculpt(),!0}},{key:"end",value:function(){this.getMesh()&&this.getMesh().balanceOctree()}},{key:"pushState",value:function(){this._main.getStateManager().pushStateGeometry(this.getMesh())}},{key:"startSculpt",value:function(){!0!==this._lockPosition&&this.sculptStroke()}},{key:"preUpdate",value:function(e){var t=this._main,r=t.getPicking(),i=t._action===s.Z.Action.SCULPT_EDIT;if(!i||e){i?r.intersectionMouseMesh():r.intersectionMouseMeshes();var n=r.getMesh();n&&t.getSculptManager().getSymmetry()&&t.getPickingSymmetry().intersectionMouseMesh(n)}}},{key:"update",value:function(e){if(!0===this._lockPosition)return this.updateSculptLock(e);this.sculptStroke()}},{key:"updateSculptLock",value:function(e){var t=this._main;e||this._main.getStateManager().getCurrentState().undo();var r=t.getPicking(),i=this._radius,n=t.getSculptManager().getSymmetry()?t.getPickingSymmetry():null,a=t._mouseX-this._lastMouseX,s=t._mouseY-this._lastMouseY;this._radius=Math.sqrt(a*a+s*s);var o=a/this._radius,l=s/this._radius;this.makeStroke(this._lastMouseX+.001*o,this._lastMouseY+.001*l,r,n),this._radius=i,this.updateRender(),t.setCanvasCursor("default")}},{key:"sculptStroke",value:function(){var e=this._main,t=e.getPicking(),r=e.getSculptManager().getSymmetry()?e.getPickingSymmetry():null,i=e._mouseX-this._lastMouseX,n=e._mouseY-this._lastMouseY,a=Math.sqrt(i*i+n*n),s=.15*this._radius*e.getPixelRatio();if(!(a<=s)){var o=1/Math.floor(a/s);i*=o,n*=o;for(var l=this._lastMouseX+i,u=this._lastMouseY+n,c=o;c<=1&&this.makeStroke(l,u,t,r);c+=o)l+=i,u+=n;this.updateRender(),this._lastMouseX=e._mouseX,this._lastMouseY=e._mouseY}}},{key:"updateRender",value:function(){this.updateMeshBuffers(),this._main.render()}},{key:"makeStroke",value:function(e,t,r,i){var n=this.getMesh();r.intersectionMouseMesh(n,e,t);var a=r.getMesh();a&&(r.pickVerticesInSphere(r.getLocalRadius2()),r.computePickedNormal());var s,o=n.isDynamic&&!this._lockPosition;return o&&a&&this.stroke(r,!1),i&&(i.intersectionMouseMesh(n,e,t),(s=i.getMesh())&&(i.setLocalRadius2(r.getLocalRadius2()),i.pickVerticesInSphere(i.getLocalRadius2()),i.computePickedNormal())),!o&&a&&this.stroke(r,!1),s&&this.stroke(i,!0),a||s}},{key:"updateMeshBuffers",value:function(){var e=this.getMesh();e.isDynamic?e.updateBuffers():e.updateGeometryBuffers()}},{key:"updateContinuous",value:function(){if(this._lockPosition)return this.update(!0);var e=this._main,t=e.getPicking(),r=e.getSculptManager().getSymmetry()?e.getPickingSymmetry():null;this.makeStroke(e._mouseX,e._mouseY,t,r),this.updateRender()}},{key:"getFrontVertices",value:function(e,t){for(var r=e.length,i=new Uint32Array(o.Z.getMemory(4*r),0,r),n=0,a=this.getMesh().getNormals(),s=t[0],l=t[1],u=t[2],c=0;c<r;++c){var h=e[c],d=3*h;a[d]*s+a[d+1]*l+a[d+2]*u<=0&&(i[n++]=h)}return new Uint32Array(i.subarray(0,n))}},{key:"areaNormal",value:function(e){for(var t=this.getMesh(),r=t.getNormals(),i=t.getMaterials(),n=0,a=0,s=0,o=0,l=e.length;o<l;++o){var u=3*e[o],c=i[u+2];n+=r[u]*c,a+=r[u+1]*c,s+=r[u+2]*c}var h=Math.sqrt(n*n+a*a+s*s);if(0!==h)return[n*(h=1/h),a*h,s*h]}},{key:"areaCenter",value:function(e){for(var t=this.getMesh(),r=t.getVertices(),i=t.getMaterials(),n=e.length,a=0,s=0,o=0,l=0,u=0;u<n;++u){var c=3*e[u],h=i[c+2];l+=h,a+=r[c]*h,s+=r[c+1]*h,o+=r[c+2]*h}return[a/l,s/l,o/l]}},{key:"updateProxy",value:function(e){var t=this.getMesh(),r=t.getVertices(),i=t.getVerticesProxy();if(r!==i)for(var n=t.getVerticesStateFlags(),a=o.Z.STATE_FLAG,s=0,l=e.length;s<l;++s){var u=e[s];if(n[u]!==a){var c=3*u;i[c]=r[c],i[c+1]=r[c+1],i[c+2]=r[c+2]}}}},{key:"laplacianSmooth",value:function(e,t,r){for(var i=this.getMesh(),n=i.getVerticesRingVertStartCount(),a=i.getVerticesRingVert(),s=a instanceof Array?a:null,o=i.getVerticesOnEdge(),l=r||i.getVertices(),u=e.length,c=0;c<u;++c){var h,d,f=3*c,p=e[c];s?(h=0,d=(a=s[p]).length):d=(h=n[2*p])+n[2*p+1];var _=0,m=d-h;if(m<=2)_=3*p,t[f]=l[_],t[f+1]=l[_+1],t[f+2]=l[_+2];else{var g=0,v=0,y=0,b=0;if(1===o[p]){var T=0;for(b=h;b<d;++b)1===o[_=a[b]]&&(g+=l[_*=3],v+=l[_+1],y+=l[_+2],++T);if(T>=2){t[f]=g/T,t[f+1]=v/T,t[f+2]=y/T;continue}g=v=y=0}for(b=h;b<d;++b)g+=l[_=3*a[b]],v+=l[_+1],y+=l[_+2];t[f]=g/m,t[f+1]=v/m,t[f+2]=y/m}}}},{key:"dynamicTopology",value:function(e){var t=this.getMesh(),r=e.getPickedVertices();if(!t.isDynamic)return r;var i=t.getSubdivisionFactor(),n=t.getDecimationFactor();if(0===i&&0===n)return r;0===r.length&&(r=t.getVerticesFromFaces([e.getPickedFace()]),this._main.getStateManager().pushVertices(r));var a=t.getFacesFromVertices(r),s=e.getLocalRadius2(),l=e.getIntersectionPoint(),u=s*(1.1-i)*.2,c=u/4.2025*n;this._main.getStateManager().pushFaces(a),i&&(a=t.subdivide(a,l,s,u,this._main.getStateManager())),n&&(a=t.decimate(a,l,s,c,this._main.getStateManager()));for(var h=(r=t.getVerticesFromFaces(a)).length,d=o.Z.SCULPT_FLAG,f=t.getVerticesSculptFlags(),p=new Uint32Array(o.Z.getMemory(4*h),0,h),_=0,m=0;m<h;++m){var g=r[m];f[g]===d&&(p[_++]=g)}return p=new Uint32Array(p.subarray(0,_)),t.updateTopology(a,r),t.updateGeometry(a,r),p}},{key:"getUnmaskedVertices",value:function(){return this.filterMaskedVertices(0,1/0)}},{key:"getMaskedVertices",value:function(){return this.filterMaskedVertices(-1/0,1)}},{key:"filterMaskedVertices",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1/0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,r=this.getMesh(),i=r.getMaterials(),n=r.getNbVertices(),a=new Uint32Array(o.Z.getMemory(4*n),0,n),s=0,l=0;l<n;++l){var u=i[3*l+2];u>e&&u<t&&(a[s++]=l)}return new Uint32Array(a.subarray(0,s))}},{key:"postRender",value:function(e){e.render(this._main)}},{key:"addSculptToScene",value:function(){}},{key:"getScreenRadius",value:function(){return(this._radius||1)*this._main.getPixelRatio()}}])&&ae(t.prototype,r),e}();function oe(e){return(oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function le(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ue(e,t){return(ue=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ce(e,t){return!t||"object"!==oe(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function he(e){return(he=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}const de=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ue(e,t)}(o,e);var t,r,i,n,s=(i=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=he(i);if(n){var r=he(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return ce(this,e)});function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=s.call(this,e))._radius=50,t._intensity=.75,t._negative=!0,t._culling=!1,t._idAlpha=0,t._lockPosition=!1,t}return t=o,(r=[{key:"stroke",value:function(e){var t=e.getPickedVertices(),r=this._intensity*a.Z.getPressureIntensity();this._main.getStateManager().pushVertices(t),t=this.dynamicTopology(e);var i=this.getFrontVertices(t,e.getEyeDirection());this._culling&&(t=i);var n=this.areaNormal(i);if(n){var s=this.areaCenter(i);e.updateAlpha(this._lockPosition),e.setIdAlpha(this._idAlpha),this.flatten(t,n,s,e.getIntersectionPoint(),e.getLocalRadius2(),r,e);var o=this.getMesh();o.updateGeometry(o.getFacesFromVertices(t),t)}}},{key:"flatten",value:function(e,t,r,i,n,a,s){for(var o=this.getMesh(),l=o.getVertices(),u=o.getMaterials(),c=Math.sqrt(n),h=!1===this._accumulate&&!1===this._lockPosition?o.getVerticesProxy():l,d=i[0],f=i[1],p=i[2],_=r[0],m=r[1],g=r[2],v=t[0],y=t[1],b=t[2],T=this._negative?-1:1,k=0,M=e.length;k<M;++k){var x=3*e[k],S=l[x],A=l[x+1],E=l[x+2],R=(S-_)*v+(A-m)*y+(E-g)*b;if(!(R*T>0)){var w=h[x]-d,C=h[x+1]-f,P=h[x+2]-p,D=Math.sqrt(w*w+C*C+P*P)/c;if(!(D>=1)){var I=D*D;I=3*I*I-4*I*D+1,I*=R*a*u[x+2]*s.getAlpha(S,A,E),l[x]-=v*I,l[x+1]-=y*I,l[x+2]-=b*I}}}}}])&&le(t.prototype,r),o}(se);function fe(e){return(fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function pe(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _e(e,t){return(_e=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function me(e,t){return!t||"object"!==fe(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ge(e){return(ge=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}const ve=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_e(e,t)}(l,e);var t,r,n,s,o=(n=l,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ge(n);if(s){var r=ge(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return me(this,e)});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=o.call(this,e))._radius=50,t._intensity=.5,t._negative=!1,t._clay=!0,t._culling=!1,t._accumulate=!0,t._idAlpha=0,t._lockPosition=!1,t}return t=l,(r=[{key:"stroke",value:function(e){var t=e.getPickedVertices(),r=this._intensity*a.Z.getPressureIntensity();this._accumulate||this._lockPosition||this.updateProxy(t),this._main.getStateManager().pushVertices(t),this._lockPosition||(t=this.dynamicTopology(e));var n=this.getFrontVertices(t,e.getEyeDirection());this._culling&&(t=n);var s=e.getLocalRadius2();if(e.updateAlpha(this._lockPosition),e.setIdAlpha(this._idAlpha),this._clay){var o=this.areaNormal(n);if(!o)return;var l=this._lockPosition?e.getIntersectionPoint():this.areaCenter(n),u=.1*Math.sqrt(s);i.R3.scaleAndAdd(l,l,o,this._negative?-u:u),de.prototype.flatten.call(this,t,o,l,e.getIntersectionPoint(),s,r,e)}else this.brush(t,e.getPickedNormal(),e.getIntersectionPoint(),s,r,e);var c=this.getMesh();c.updateGeometry(c.getFacesFromVertices(t),t)}},{key:"brush",value:function(e,t,r,i,n,a){var s=this.getMesh(),o=s.getVertices(),l=s.getMaterials(),u=this._accumulate||this._lockPosition?o:s.getVerticesProxy(),c=Math.sqrt(i),h=n*c*.1;this._negative&&(h=-h);for(var d=r[0],f=r[1],p=r[2],_=t[0],m=t[1],g=t[2],v=0,y=e.length;v<y;++v){var b=3*e[v],T=u[b]-d,k=u[b+1]-f,M=u[b+2]-p,x=Math.sqrt(T*T+k*k+M*M)/c;if(!(x>=1)){var S=o[b],A=o[b+1],E=o[b+2],R=x*x;R=3*R*R-4*R*x+1,R*=l[b+2]*h*a.getAlpha(S,A,E),o[b]=S+_*R,o[b+1]=A+m*R,o[b+2]=E+g*R}}}}])&&pe(t.prototype,r),l}(se);function ye(e){return(ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function be(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Te(e,t){return(Te=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ke(e,t){return!t||"object"!==ye(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Me(e){return(Me=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}const xe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Te(e,t)}(o,e);var t,r,i,n,s=(i=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Me(i);if(n){var r=Me(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return ke(this,e)});function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=s.call(this,e))._radius=50,t._intensity=.3,t._negative=!1,t._culling=!1,t._idAlpha=0,t._lockPosition=!1,t}return t=o,(r=[{key:"stroke",value:function(e){var t=e.getPickedVertices(),r=this._intensity*a.Z.getPressureIntensity();this.updateProxy(t),this._main.getStateManager().pushVertices(t),t=this.dynamicTopology(e),this._culling&&(t=this.getFrontVertices(t,e.getEyeDirection())),e.updateAlpha(this._lockPosition),e.setIdAlpha(this._idAlpha),this.inflate(t,e.getIntersectionPoint(),e.getLocalRadius2(),r,e);var i=this.getMesh();i.updateGeometry(i.getFacesFromVertices(t),t)}},{key:"inflate",value:function(e,t,r,i,n){var a=this.getMesh(),s=a.getVertices(),o=a.getMaterials(),l=a.getVerticesProxy(),u=a.getNormals(),c=Math.sqrt(r),h=i*c*.1;this._negative&&(h=-h);for(var d=t[0],f=t[1],p=t[2],_=0,m=e.length;_<m;++_){var g=3*e[_],v=l[g]-d,y=l[g+1]-f,b=l[g+2]-p,T=Math.sqrt(v*v+y*y+b*b)/c;if(!(T>=1)){var k=T*T;k=3*k*k-4*k*T+1,k*=h;var M=s[g],x=s[g+1],S=s[g+2],A=u[g],E=u[g+1],R=u[g+2];k/=Math.sqrt(A*A+E*E+R*R),k*=o[g+2]*n.getAlpha(M,x,S),s[g]=M+A*k,s[g+1]=x+E*k,s[g+2]=S+R*k}}}}])&&be(t.prototype,r),o}(se);var Se=r(165);function Ae(e){return(Ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ee(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Re(e,t){return(Re=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function we(e,t){return!t||"object"!==Ae(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ce(e){return(Ce=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}const Pe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Re(e,t)}(o,e);var t,r,n,a,s=(n=o,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ce(n);if(a){var r=Ce(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return we(this,e)});function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=s.call(this,e))._radius=75,t._culling=!1,t._twistData={normal:[0,0,0],center:[0,0]},t._twistDataSym={normal:[0,0,0],center:[0,0]},t._idAlpha=0,t}return t=o,(r=[{key:"startSculpt",value:function(){var e=this._main,t=e._mouseX,r=e._mouseY,i=e.getPicking();if(this.initTwistData(i,t,r,this._twistData),e.getSculptManager().getSymmetry()){var n=e.getPickingSymmetry();n.intersectionMouseMesh(),n.setLocalRadius2(i.getLocalRadius2()),n.getMesh()&&this.initTwistData(n,t,r,this._twistDataSym)}}},{key:"initTwistData",value:function(e,t,r,n){e.pickVerticesInSphere(e.getLocalRadius2()),i.R3.negate(n.normal,e.getEyeDirection()),i.K4.set(n.center,t,r)}},{key:"sculptStroke",value:function(){var e=this._main,t=e._mouseX,r=e._mouseY,i=e._lastMouseX,n=e._lastMouseY,a=e.getPicking(),s=a.getLocalRadius2();if(a.pickVerticesInSphere(s),this.stroke(a,t,r,i,n,this._twistData),e.getSculptManager().getSymmetry()){var o=e.getPickingSymmetry();o.getMesh()&&(o.pickVerticesInSphere(s),this.stroke(o,i,n,t,r,this._twistDataSym))}this.updateRender(),e.setCanvasCursor("default")}},{key:"stroke",value:function(e,t,r,i,n,a){var s=e.getPickedVertices();this._main.getStateManager().pushVertices(s),s=this.dynamicTopology(e),this._culling&&(s=this.getFrontVertices(s,e.getEyeDirection())),e.updateAlpha(!1),e.setIdAlpha(this._idAlpha),this.twist(s,e.getIntersectionPoint(),e.getLocalRadius2(),t,r,i,n,a,e);var o=this.getMesh();o.updateGeometry(o.getFacesFromVertices(s),s)}},{key:"twist",value:function(e,t,r,n,a,s,o,l,u){var c=this.getMesh(),h=l.center,d=[n-h[0],a-h[1]];if(!(i.K4.len(d)<30)){i.K4.normalize(d,d);var f=l.normal,p=[0,0,0,0],_=[s-h[0],o-h[1]];i.K4.normalize(_,_);for(var m=Se.Z.signedAngle2d(d,_),g=c.getVertices(),v=c.getMaterials(),y=1/Math.sqrt(r),b=t[0],T=t[1],k=t[2],M=[0,0,0],x=0,S=e.length;x<S;++x){var A=3*e[x],E=g[A],R=g[A+1],w=g[A+2],C=E-b,P=R-T,D=w-k,I=Math.sqrt(C*C+P*P+D*D)*y,F=I*I;F=3*F*F-4*F*I+1,F*=m*v[A+2]*u.getAlpha(E,R,w),i.gf.setAxisAngle(p,f,F),i.R3.set(M,E,R,w),i.R3.sub(M,M,t),i.R3.transformQuat(M,M,p),i.R3.add(M,M,t),g[A]=M[0],g[A+1]=M[1],g[A+2]=M[2]}}}}])&&Ee(t.prototype,r),o}(se);function De(e){return(De="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ie(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Fe(e,t){return(Fe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Oe(e,t){return!t||"object"!==De(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ve(e){return(Ve=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}const Le=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Fe(e,t)}(l,e);var t,r,i,n,s=(i=l,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ve(i);if(n){var r=Ve(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return Oe(this,e)});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=s.call(this,e))._radius=50,t._intensity=.75,t._culling=!1,t._tangent=!1,t._idAlpha=0,t._lockPosition=!1,t}return t=l,(r=[{key:"stroke",value:function(e){var t=e.getPickedVertices(),r=this._intensity*a.Z.getPressureIntensity();this._main.getStateManager().pushVertices(t),this._culling&&(t=this.getFrontVertices(t,e.getEyeDirection())),e.updateAlpha(this._lockPosition),e.setIdAlpha(this._idAlpha),this._tangent?this.smoothTangent(t,r,e):this.smooth(t,r,e);var i=this.getMesh();i.updateGeometry(i.getFacesFromVertices(t),t)}},{key:"smooth",value:function(e,t,r){var i=this.getMesh(),n=i.getVertices(),a=i.getMaterials(),s=e.length,l=new Float32Array(o.Z.getMemory(4*s*3),0,3*s);this.laplacianSmooth(e,l);for(var u=0;u<s;++u){var c=3*e[u],h=n[c],d=n[c+1],f=n[c+2],p=3*u,_=t*a[c+2];r&&(_*=r.getAlpha(h,d,f));var m=1-_;n[c]=h*m+l[p]*_,n[c+1]=d*m+l[p+1]*_,n[c+2]=f*m+l[p+2]*_}}},{key:"smoothTangent",value:function(e,t,r){var i=this.getMesh(),n=i.getVertices(),a=i.getMaterials(),s=i.getNormals(),l=e.length,u=new Float32Array(o.Z.getMemory(4*l*3),0,3*l);this.laplacianSmooth(e,u);for(var c=0;c<l;++c){var h=3*e[c],d=n[h],f=n[h+1],p=n[h+2],_=s[h],m=s[h+1],g=s[h+2],v=_*_+m*m+g*g;if(0!==v){_*=v=1/Math.sqrt(v),m*=v,g*=v;var y=3*c,b=u[y],T=u[y+1],k=u[y+2],M=_*(b-d)+m*(T-f)+g*(k-p),x=t*a[h+2];r&&(x*=r.getAlpha(d,f,p)),n[h]=d+(b-_*M-d)*x,n[h+1]=f+(T-m*M-f)*x,n[h+2]=p+(k-g*M-p)*x}}}},{key:"smoothAlongNormals",value:function(e,t,r){var i=this.getMesh(),n=i.getVertices(),a=i.getMaterials(),s=i.getNormals(),l=e.length,u=new Float32Array(o.Z.getMemory(4*l*3),0,3*l);this.laplacianSmooth(e,u);for(var c=0;c<l;++c){var h=3*e[c],d=n[h],f=n[h+1],p=n[h+2],_=s[h],m=s[h+1],g=s[h+2],v=3*c,y=1/(_*_+m*m+g*g),b=_*(u[v]-d)+m*(u[v+1]-f)+g*(u[v+2]-p);b*=y*t*a[h+2],r&&(b*=r.getAlpha(d,f,p)),n[h]=d+_*b,n[h+1]=f+m*b,n[h+2]=p+g*b}}}])&&Ie(t.prototype,r),l}(se);function Ne(e){return(Ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Be(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Ue(e,t){return(Ue=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ze(e,t){return!t||"object"!==Ne(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ze(e){return(ze=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}const Ge=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ue(e,t)}(o,e);var t,r,i,n,s=(i=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ze(i);if(n){var r=ze(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return Ze(this,e)});function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=s.call(this,e))._radius=50,t._intensity=.75,t._negative=!1,t._culling=!1,t._idAlpha=0,t._lockPosition=!1,t}return t=o,(r=[{key:"stroke",value:function(e){var t=e.getPickedVertices(),r=this._intensity*a.Z.getPressureIntensity();this._main.getStateManager().pushVertices(t),t=this.dynamicTopology(e),this._culling&&(t=this.getFrontVertices(t,e.getEyeDirection())),e.updateAlpha(this._lockPosition),e.setIdAlpha(this._idAlpha),this.pinch(t,e.getIntersectionPoint(),e.getLocalRadius2(),r,e);var i=this.getMesh();i.updateGeometry(i.getFacesFromVertices(t),t)}},{key:"pinch",value:function(e,t,r,i,n){var a=this.getMesh(),s=a.getVertices(),o=a.getMaterials(),l=Math.sqrt(r),u=t[0],c=t[1],h=t[2],d=.05*i;this._negative&&(d=-d);for(var f=0,p=e.length;f<p;++f){var _=3*e[f],m=s[_],g=s[_+1],v=s[_+2],y=u-m,b=c-g,T=h-v,k=Math.sqrt(y*y+b*b+T*T)/l,M=k*k;M=3*M*M-4*M*k+1,M*=d*o[_+2]*n.getAlpha(m,g,v),s[_]=m+y*M,s[_+1]=g+b*M,s[_+2]=v+T*M}}}])&&Be(t.prototype,r),o}(se);function We(e){return(We="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function je(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Xe(e,t){return(Xe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function He(e,t){return!t||"object"!==We(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ye(e){return(Ye=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}const Ke=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Xe(e,t)}(o,e);var t,r,i,n,s=(i=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ye(i);if(n){var r=Ye(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return He(this,e)});function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=s.call(this,e))._radius=25,t._intensity=.75,t._negative=!0,t._culling=!1,t._idAlpha=0,t._lockPosition=!1,t}return t=o,(r=[{key:"stroke",value:function(e){var t=e.getPickedVertices(),r=this._intensity*a.Z.getPressureIntensity();this.updateProxy(t),this._main.getStateManager().pushVertices(t),t=this.dynamicTopology(e),this._culling&&(t=this.getFrontVertices(t,e.getEyeDirection())),e.updateAlpha(this._lockPosition),e.setIdAlpha(this._idAlpha),this.crease(t,e.getPickedNormal(),e.getIntersectionPoint(),e.getLocalRadius2(),r,e);var i=this.getMesh();i.updateGeometry(i.getFacesFromVertices(t),t)}},{key:"crease",value:function(e,t,r,i,n,a){var s=this.getMesh(),o=s.getVertices(),l=s.getMaterials(),u=s.getVerticesProxy(),c=Math.sqrt(i),h=r[0],d=r[1],f=r[2],p=t[0],_=t[1],m=t[2],g=.07*n,v=g*c;this._negative&&(v=-v);for(var y=0,b=e.length;y<b;++y){var T=3*e[y],k=h-u[T],M=d-u[T+1],x=f-u[T+2],S=Math.sqrt(k*k+M*M+x*x)/c;if(!(S>=1)){var A=o[T],E=o[T+1],R=o[T+2],w=S*S;w=3*w*w-4*w*S+1,w*=l[T+2]*a.getAlpha(A,E,R);var C=Math.pow(w,5)*v;w*=g,o[T]=A+k*w+p*C,o[T+1]=E+M*w+_*C,o[T+2]=R+x*w+m*C}}}}])&&je(t.prototype,r),o}(se);function qe(e){return(qe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Je(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Qe(e,t){return(Qe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function $e(e,t){return!t||"object"!==qe(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function et(e){return(et=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}const tt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Qe(e,t)}(o,e);var t,r,n,a,s=(n=o,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=et(n);if(a){var r=et(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return $e(this,e)});function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=s.call(this,e))._radius=150,t._dragDir=[0,0,0],t._dragDirSym=[0,0,0],t._idAlpha=0,t}return t=o,(r=[{key:"sculptStroke",value:function(){var e=this._main,t=this.getMesh(),r=e.getPicking(),n=e.getSculptManager().getSymmetry()?e.getPickingSymmetry():null,a=e._mouseX-this._lastMouseX,s=e._mouseY-this._lastMouseY,o=Math.sqrt(a*a+s*s),l=.15*this._radius,u=1/Math.floor(o/l);a*=u,s*=u;var c=this._lastMouseX,h=this._lastMouseY;if(r.getMesh()){r._mesh=t,n&&(n._mesh=t,i.R3.copy(n.getIntersectionPoint(),r.getIntersectionPoint()),Se.Z.mirrorPoint(n.getIntersectionPoint(),t.getSymmetryOrigin(),t.getSymmetryNormal()));for(var d=0;d<1&&this.makeStroke(c,h,r,n);d+=u)c+=a,h+=s;this.updateRender(),this._lastMouseX=e._mouseX,this._lastMouseY=e._mouseY}}},{key:"makeStroke",value:function(e,t,r,i){var n=this.getMesh();return this.updateDragDir(r,e,t),r.pickVerticesInSphere(r.getLocalRadius2()),r.computePickedNormal(),n.isDynamic&&this.stroke(r,!1),i&&(this.updateDragDir(i,e,t,!0),i.setLocalRadius2(r.getLocalRadius2()),i.pickVerticesInSphere(i.getLocalRadius2())),n.isDynamic||this.stroke(r,!1),i&&this.stroke(i,!0),!0}},{key:"stroke",value:function(e,t){var r=e.getPickedVertices();this._main.getStateManager().pushVertices(r),r=this.dynamicTopology(e),e.updateAlpha(this._lockPosition),e.setIdAlpha(this._idAlpha),this.drag(r,e.getIntersectionPoint(),e.getLocalRadius2(),t,e);var i=this.getMesh();i.updateGeometry(i.getFacesFromVertices(r),r)}},{key:"drag",value:function(e,t,r,i,n){for(var a=this.getMesh(),s=a.getVertices(),o=a.getMaterials(),l=Math.sqrt(r),u=t[0],c=t[1],h=t[2],d=i?this._dragDirSym:this._dragDir,f=d[0],p=d[1],_=d[2],m=0,g=e.length;m<g;++m){var v=3*e[m],y=s[v],b=s[v+1],T=s[v+2],k=y-u,M=b-c,x=T-h,S=Math.sqrt(k*k+M*M+x*x)/l,A=S*S;A=3*A*A-4*A*S+1,A*=o[v+2]*n.getAlpha(y,b,T),s[v]=y+f*A,s[v+1]=b+p*A,s[v+2]=T+_*A}}},{key:"updateDragDir",value:function(e,t,r,n){var a=this.getMesh(),s=e.unproject(t,r,0),o=e.unproject(t,r,.1),l=i._E.create();i._E.invert(l,a.getMatrix()),i.R3.transformMat4(s,s,l),i.R3.transformMat4(o,o,l);var u=this._dragDir;if(n){u=this._dragDirSym;var c=a.getSymmetryOrigin(),h=a.getSymmetryNormal();Se.Z.mirrorPoint(s,c,h),Se.Z.mirrorPoint(o,c,h)}var d=e.getIntersectionPoint();e.setIntersectionPoint(Se.Z.vertexOnLine(d,s,o)),i.R3.sub(u,e.getIntersectionPoint(),d),e._mesh=a,e.updateLocalAndWorldRadius2();var f=e.getEyeDirection();i.R3.sub(f,o,s),i.R3.normalize(f,f)}}])&&Je(t.prototype,r),o}(se);function rt(e){return(rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function it(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function nt(e,t,r){return(nt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ot(e)););return e}(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(r):n.value}})(e,t,r||e)}function at(e,t){return(at=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function st(e,t){return!t||"object"!==rt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ot(e){return(ot=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}const lt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&at(e,t)}(l,e);var t,r,n,s,o=(n=l,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ot(n);if(s){var r=ot(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return st(this,e)});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=o.call(this,e))._radius=50,t._hardness=.75,t._intensity=.75,t._culling=!1,t._color=i.R3.fromValues(1,.766,.336),t._material=i.R3.fromValues(.3,.95,0),t._pickColor=!1,t._pickCallback=null,t._idAlpha=0,t._lockPosition=!1,t._writeAlbedo=!0,t._writeRoughness=!0,t._writeMetalness=!0,t}return t=l,(r=[{key:"end",value:function(){this._pickColor=!1,nt(ot(l.prototype),"end",this).call(this)}},{key:"pushState",value:function(e){this._pickColor&&!e||this._main.getStateManager().pushStateColorAndMaterial(this.getMesh())}},{key:"startSculpt",value:function(){if(this._pickColor)return this.pickColor(this._main.getPicking());nt(ot(l.prototype),"startSculpt",this).call(this)}},{key:"update",value:function(e){if(!0===this._pickColor)return this.updatePickColor();nt(ot(l.prototype),"update",this).call(this,e)}},{key:"updateContinuous",value:function(){if(!0===this._pickColor)return this.updatePickColor();nt(ot(l.prototype),"updateContinuous",this).call(this)}},{key:"updateMeshBuffers",value:function(){var e=this.getMesh();e.isDynamic?e.updateBuffers():(e.updateColorBuffer(),e.updateMaterialBuffer())}},{key:"updatePickColor",value:function(){var e=this._main.getPicking();e.intersectionMouseMesh()&&this.pickColor(e)}},{key:"setPickCallback",value:function(e){this._pickCallback=e}},{key:"pickColor",value:function(e){var t=this.getMesh(),r=this._color;e.polyLerp(t.getMaterials(),r);var i=r[0],n=r[1];e.polyLerp(t.getColors(),r),this._pickCallback(r,i,n)}},{key:"stroke",value:function(e){var t=e.getPickedVertices(),r=this._intensity*a.Z.getPressureIntensity();this._main.getStateManager().pushVertices(t),t=this.dynamicTopology(e),this._culling&&(t=this.getFrontVertices(t,e.getEyeDirection())),e.updateAlpha(this._lockPosition),e.setIdAlpha(this._idAlpha),this.paint(t,e.getIntersectionPoint(),e.getLocalRadius2(),r,this._hardness,e);var i=this.getMesh();i.updateDuplicateColorsAndMaterials(t),i.isUsingDrawArrays()&&i.updateDrawArrays(i.getFacesFromVertices(t))}},{key:"paint",value:function(e,t,r,i,n,a){for(var s=this.getMesh(),o=s.getVertices(),l=s.getColors(),u=s.getMaterials(),c=this._color,h=this._material[0],d=this._material[1],f=Math.sqrt(r),p=c[0],_=c[1],m=c[2],g=t[0],v=t[1],y=t[2],b=2*(1-n),T=0,k=e.length;T<k;++T){var M=3*e[T],x=o[M],S=o[M+1],A=o[M+2],E=x-g,R=S-v,w=A-y,C=Math.sqrt(E*E+R*R+w*w)/f;C>1&&(C=1);var P=Math.pow(1-C,b),D=1-(P*=i*u[M+2]*a.getAlpha(x,S,A));this._writeAlbedo&&(l[M]=l[M]*D+p*P,l[M+1]=l[M+1]*D+_*P,l[M+2]=l[M+2]*D+m*P),this._writeRoughness&&(u[M]=u[M]*D+h*P),this._writeMetalness&&(u[M+1]=u[M+1]*D+d*P)}}},{key:"paintAll",value:function(){var e=this.getMesh(),t=this.getUnmaskedVertices();if(0!==t.length){this.pushState(!0),this._main.getStateManager().pushVertices(t);for(var r=e.getColors(),i=e.getMaterials(),n=this._color,a=this._material[0],s=this._material[1],o=n[0],l=n[1],u=n[2],c=0,h=t.length;c<h;++c){var d=3*t[c],f=i[d+2],p=1-f;this._writeAlbedo&&(r[d]=r[d]*p+o*f,r[d+1]=r[d+1]*p+l*f,r[d+2]=r[d+2]*p+u*f),this._writeRoughness&&(i[d]=i[d]*p+a*f),this._writeMetalness&&(i[d+1]=i[d+1]*p+s*f)}e.updateDuplicateColorsAndMaterials(),e.updateDrawArrays(),this.updateRender()}}}])&&it(t.prototype,r),l}(se);function ut(e){return(ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ct(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ht(e,t){return(ht=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function dt(e,t){return!t||"object"!==ut(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ft(e){return(ft=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}const pt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ht(e,t)}(o,e);var t,r,n,a,s=(n=o,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ft(n);if(a){var r=ft(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return dt(this,e)});function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=s.call(this,e))._radius=150,t._intensity=1,t._topoCheck=!0,t._negative=!1,t._moveData={center:[0,0,0],dir:[0,0],vProxy:null},t._moveDataSym={center:[0,0,0],dir:[0,0],vProxy:null},t._idAlpha=0,t}return t=o,(r=[{key:"startSculpt",value:function(){var e=this._main,t=e.getPicking();if(this.initMoveData(t,this._moveData),e.getSculptManager().getSymmetry()){var r=e.getPickingSymmetry();r.intersectionMouseMesh(),r.setLocalRadius2(t.getLocalRadius2()),r.getMesh()&&this.initMoveData(r,this._moveDataSym)}}},{key:"initMoveData",value:function(e,t){this._topoCheck?e.pickVerticesInSphereTopological(e.getLocalRadius2()):e.pickVerticesInSphere(e.getLocalRadius2()),i.R3.copy(t.center,e.getIntersectionPoint());var r=e.getPickedVertices();this._main.getStateManager().pushVertices(r);for(var n=e.getMesh().getVertices(),a=r.length,s=t.vProxy=new Float32Array(3*a),o=0;o<a;++o){var l=3*r[o],u=3*o;s[u]=n[l],s[u+1]=n[l+1],s[u+2]=n[l+2]}}},{key:"copyVerticesProxy",value:function(e,t){for(var r=e.getPickedVertices(),i=this.getMesh().getVertices(),n=t.vProxy,a=0,s=r.length;a<s;++a){var o=3*r[a],l=3*a;i[o]=n[l],i[o+1]=n[l+1],i[o+2]=n[l+2]}}},{key:"sculptStroke",value:function(){var e=this._main,t=e.getPicking(),r=e.getPickingSymmetry(),i=e.getSculptManager().getSymmetry()&&r.getMesh();t.updateAlpha(this._lockPosition),t.setIdAlpha(this._idAlpha),i&&(r.updateAlpha(!1),r.setIdAlpha(this._idAlpha)),this.copyVerticesProxy(t,this._moveData),i&&this.copyVerticesProxy(r,this._moveDataSym);var n=e._mouseX,a=e._mouseY;this.updateMoveDir(t,n,a),this.move(t.getPickedVertices(),t.getIntersectionPoint(),t.getLocalRadius2(),this._moveData,t),i&&(this.updateMoveDir(r,n,a,!0),this.move(r.getPickedVertices(),r.getIntersectionPoint(),r.getLocalRadius2(),this._moveDataSym,r));var s=this.getMesh();s.updateGeometry(s.getFacesFromVertices(t.getPickedVertices()),t.getPickedVertices()),i&&s.updateGeometry(s.getFacesFromVertices(r.getPickedVertices()),r.getPickedVertices()),this.updateRender(),e.setCanvasCursor("default")}},{key:"move",value:function(e,t,r,i,n){for(var a=this.getMesh(),s=a.getVertices(),o=a.getMaterials(),l=Math.sqrt(r),u=i.vProxy,c=t[0],h=t[1],d=t[2],f=i.dir,p=f[0],_=f[1],m=f[2],g=0,v=e.length;g<v;++g){var y=3*e[g],b=3*g,T=u[b],k=u[b+1],M=u[b+2],x=T-c,S=k-h,A=M-d,E=Math.sqrt(x*x+S*S+A*A)/l,R=E*E;R=3*R*R-4*R*E+1,R*=o[y+2]*n.getAlpha(T,k,M),s[y]+=p*R,s[y+1]+=_*R,s[y+2]+=m*R}}},{key:"updateMoveDir",value:function(e,t,r,n){var a=this.getMesh(),s=e.unproject(t,r,0),o=e.unproject(t,r,.1),l=i._E.create();i._E.invert(l,a.getMatrix()),i.R3.transformMat4(s,s,l),i.R3.transformMat4(o,o,l);var u=n?this._moveDataSym:this._moveData;if(n){var c=a.getSymmetryOrigin(),h=a.getSymmetryNormal();Se.Z.mirrorPoint(s,c,h),Se.Z.mirrorPoint(o,c,h)}if(this._negative){var d=i.R3.dist(Se.Z.vertexOnLine(u.center,s,o),u.center);i.R3.normalize(u.dir,e.computePickedNormal()),i.R3.scale(u.dir,u.dir,t<this._lastMouseX?-d:d)}else i.R3.sub(u.dir,Se.Z.vertexOnLine(u.center,s,o),u.center);i.R3.scale(u.dir,u.dir,this._intensity);var f=e.getEyeDirection();i.R3.sub(f,o,s),i.R3.normalize(f,f)}}])&&ct(t.prototype,r),o}(se);function _t(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var mt=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._parent=t||null,this._depth=t?t._depth+1:0,this._children=[],this._aabbLoose=[1/0,1/0,1/0,-1/0,-1/0,-1/0],this._aabbSplit=[1/0,1/0,1/0,-1/0,-1/0,-1/0],this._iFaces=[],this._flag=0}var t,r;return t=e,(r=[{key:"resetNbFaces",value:function(e){var t=this._iFaces;t.length=e;for(var r=0;r<e;++r)t[r]=r}},{key:"build",value:function(t){var r=0,i=e.STACK;i[0]=this;for(var n=1,a=[];n>0;){var s=i[--n],o=s._iFaces.length;if(o>e.MAX_FACES&&s._depth<e.MAX_DEPTH){s.constructChildren(t);var l=s._children;for(r=0;r<8;++r)i[n+r]=l[r];n+=8}else o>0&&a.push(s)}var u=a.length;for(r=0;r<u;++r)a[r].constructLeaf(t)}},{key:"constructLeaf",value:function(e){for(var t=this._iFaces,r=t.length,i=1/0,n=1/0,a=1/0,s=-1/0,o=-1/0,l=-1/0,u=e.getFaceBoxes(),c=e.getFacePosInLeaf(),h=e.getFaceLeaf(),d=0;d<r;++d){var f=t[d];h[f]=this,c[f]=d;var p=u[f*=6],_=u[f+1],m=u[f+2],g=u[f+3],v=u[f+4],y=u[f+5];p<i&&(i=p),g>s&&(s=g),_<n&&(n=_),v>o&&(o=v),m<a&&(a=m),y>l&&(l=y)}this.expandsAabbLoose(i,n,a,s,o,l)}},{key:"constructChildren",value:function(t){for(var r=this._aabbSplit,i=r[0],n=r[1],a=r[2],s=r[3],o=r[4],l=r[5],u=.5*(s-i),c=.5*(o-n),h=.5*(l-a),d=.5*(s+i),f=.5*(o+n),p=.5*(l+a),_=new e(this),m=new e(this),g=new e(this),v=new e(this),y=new e(this),b=new e(this),T=new e(this),k=new e(this),M=_._iFaces,x=m._iFaces,S=g._iFaces,A=v._iFaces,E=y._iFaces,R=b._iFaces,w=T._iFaces,C=k._iFaces,P=t.getFaceCenters(),D=this._iFaces,I=D.length,F=0;F<I;++F){var O=D[F],V=3*O,L=P[V],N=P[V+1],B=P[V+2];L>d?N>f?B>p?w.push(O):R.push(O):B>p?S.push(O):x.push(O):N>f?B>p?C.push(O):E.push(O):B>p?A.push(O):M.push(O)}_.setAabbSplit(i,n,a,d,f,p),m.setAabbSplit(i+u,n,a,d+u,f,p),g.setAabbSplit(d,f-c,p,s,o-c,l),v.setAabbSplit(i,n,a+h,d,f,p+h),y.setAabbSplit(i,n+c,a,d,f+c,p),b.setAabbSplit(d,f,p-h,s,o,l-h),T.setAabbSplit(d,f,p,s,o,l),k.setAabbSplit(d-u,f,p,s-u,o,l),this._children.length=0,this._children.push(_,m,g,v,y,b,T,k),D.length=0}},{key:"setAabbSplit",value:function(e,t,r,i,n,a){var s=this._aabbSplit;s[0]=e,s[1]=t,s[2]=r,s[3]=i,s[4]=n,s[5]=a}},{key:"setAabbLoose",value:function(e,t,r,i,n,a){var s=this._aabbLoose;s[0]=e,s[1]=t,s[2]=r,s[3]=i,s[4]=n,s[5]=a}},{key:"collectIntersectRay",value:function(t,r,i,n){var a=t[0],s=t[1],o=t[2],l=1/r[0],u=1/r[1],c=1/r[2],h=0,d=e.STACK;d[0]=this;for(var f=1;f>0;){var p=d[--f],_=p._aabbLoose,m=(_[0]-a)*l,g=(_[3]-a)*l,v=(_[1]-s)*u,y=(_[4]-s)*u,b=(_[2]-o)*c,T=(_[5]-o)*c,k=Math.max(Math.min(m,g),Math.min(v,y),Math.min(b,T)),M=Math.min(Math.max(m,g),Math.max(v,y),Math.max(b,T));if(!(M<0||k>M)){var x=p._children;if(8===x.length){for(var S=0;S<8;++S)d[f+S]=x[S];f+=8}else{n&&n.push(p);var A=p._iFaces;i.set(A,h),h+=A.length}}}return new Uint32Array(i.subarray(0,h))}},{key:"collectIntersectSphere",value:function(t,r,i,n){var a=t[0],s=t[1],o=t[2],l=0,u=e.STACK;u[0]=this;for(var c=1;c>0;){var h,d,f,p=u[--c],_=p._aabbLoose;if(!((h=_[0]>a?_[0]-a:_[3]<a?_[3]-a:0)*h+(d=_[1]>s?_[1]-s:_[4]<s?_[4]-s:0)*d+(f=_[2]>o?_[2]-o:_[5]<o?_[5]-o:0)*f>r)){var m=p._children;if(8===m.length){for(var g=0;g<8;++g)u[c+g]=m[g];c+=8}else{n&&n.push(p);var v=p._iFaces;i.set(v,l),l+=v.length}}}return new Uint32Array(i.subarray(0,l))}},{key:"addFace",value:function(t,r,i,n,a,s,o,l,u,c){var h=e.STACK;h[0]=this;for(var d=1;d>0;){var f=h[--d],p=f._aabbSplit;if(!(l<=p[0]||u<=p[1]||c<=p[2]||l>p[3]||u>p[4]||c>p[5])){var _=f._aabbLoose;r<_[0]&&(_[0]=r),i<_[1]&&(_[1]=i),n<_[2]&&(_[2]=n),a>_[3]&&(_[3]=a),s>_[4]&&(_[4]=s),o>_[5]&&(_[5]=o);var m=f._children;if(8!==m.length)return f._iFaces.push(t),f;for(var g=0;g<8;++g)h[d+g]=m[g];d+=8}}}},{key:"pruneIfPossible",value:function(){for(var e=this;e._parent;){var t=e._parent,r=t._children;if(0===r.length)return;for(var i=0;i<8;++i){var n=r[i];if(n._iFaces.length>0||8===n._children.length)return}r.length=0,e=t}}},{key:"expandsAabbLoose",value:function(e,t,r,i,n,a){for(var s=this;s;){var o=s._aabbLoose,l=!1;e<o[0]&&(o[0]=e,l=!0),t<o[1]&&(o[1]=t,l=!0),r<o[2]&&(o[2]=r,l=!0),i>o[3]&&(o[3]=i,l=!0),n>o[4]&&(o[4]=n,l=!0),a>o[5]&&(o[5]=a,l=!0),s=l?s._parent:null}}}])&&_t(t.prototype,r),e}();mt.FLAG=0,mt.MAX_DEPTH=8,mt.MAX_FACES=100,function(){for(var e=1+7*mt.MAX_DEPTH,t=mt.STACK=new Array(e),r=0;r<e;++r)t[r]=null}();const gt=mt;var vt=function(e){var t=(0,l.Z)();return{_gl:e,_shaderType:t.shader,_flatShading:t.flatshading,_showWireframe:t.wireframe,_matcap:Math.min(t.matcap,A.matcaps.length-1),_curvature:Math.min(t.curvature,5),_texture0:null,_useDrawArrays:!1,_vertexBuffer:new c(e,e.ARRAY_BUFFER,e.DYNAMIC_DRAW),_normalBuffer:new c(e,e.ARRAY_BUFFER,e.DYNAMIC_DRAW),_colorBuffer:new c(e,e.ARRAY_BUFFER,e.DYNAMIC_DRAW),_materialBuffer:new c(e,e.ARRAY_BUFFER,e.DYNAMIC_DRAW),_texCoordBuffer:new c(e,e.ARRAY_BUFFER,e.STATIC_DRAW),_indexBuffer:new c(e,e.ELEMENT_ARRAY_BUFFER,e.STATIC_DRAW),_wireframeBuffer:new c(e,e.ELEMENT_ARRAY_BUFFER,e.STATIC_DRAW),_albedo:new Float32Array([-1,-1,-1]),_roughness:-.18,_metallic:-.78,_alpha:1,_flatColor:new Float32Array([1,0,0]),_mode:e.TRIANGLES}};vt.ONLY_DRAW_ARRAYS=!1;const yt=vt;function bt(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Tt=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=e.ID++,this._meshData=null,this._transformData=null,this._renderData=null,this._isVisible=!0}var t,r,n;return t=e,n=[{key:"sortFunction",value:function(e,t){var r=e.isTransparent(),i=t.isTransparent();return r&&!i?1:!r&&i?-1:(t.getDepth()-e.getDepth())*(r&&i?1:-1)}}],(r=[{key:"setID",value:function(e){this._id=e}},{key:"isVisible",value:function(){return this._isVisible}},{key:"setVisible",value:function(e){this._isVisible=e}},{key:"setVertices",value:function(e){this._meshData._verticesXYZ=e,this._meshData._nbVertices=e.length/3}},{key:"setFaces",value:function(e){this._meshData._facesABCD=e,this._meshData._nbFaces=e.length/4}},{key:"setTexCoords",value:function(e){this._meshData._texCoordsST=e,this._meshData._nbTexCoords=e.length/2}},{key:"setColors",value:function(e){this._meshData._colorsRGB=e}},{key:"setMaterials",value:function(e){this._meshData._materialsPBR=e}},{key:"setVerticesDuplicateStartCount",value:function(e){this._meshData._duplicateStartCount=e}},{key:"setFacesTexCoord",value:function(e){this._meshData._UVfacesABCD=e}},{key:"setMeshData",value:function(e){this._meshData=e}},{key:"setRenderData",value:function(e){this._renderData=e}},{key:"setTransformData",value:function(e){this._transformData=e}},{key:"setNbVertices",value:function(e){this._meshData._nbVertices=e}},{key:"setNbFaces",value:function(e){this._meshData._nbFaces=e}},{key:"getID",value:function(){return this._id}},{key:"getRenderData",value:function(){return this._renderData}},{key:"getMeshData",value:function(){return this._meshData}},{key:"getTransformData",value:function(){return this._transformData}},{key:"getNbVertices",value:function(){return this._meshData._nbVertices}},{key:"getNbFaces",value:function(){return this._meshData._nbFaces}},{key:"getNbQuads",value:function(){return this.getNbTriangles()-this.getNbFaces()}},{key:"getNbTriangles",value:function(){return this._meshData._trianglesABC.length/3}},{key:"getNbTexCoords",value:function(){return this._meshData._nbTexCoords}},{key:"hasUV",value:function(){return null!==this._meshData._texCoordsST}},{key:"getVertices",value:function(){return this._meshData._verticesXYZ}},{key:"getColors",value:function(){return this._meshData._colorsRGB}},{key:"getNormals",value:function(){return this._meshData._normalsXYZ}},{key:"getMaterials",value:function(){return this._meshData._materialsPBR}},{key:"getVerticesTagFlags",value:function(){return this._meshData._vertTagFlags}},{key:"getVerticesSculptFlags",value:function(){return this._meshData._vertSculptFlags}},{key:"getVerticesStateFlags",value:function(){return this._meshData._vertStateFlags}},{key:"getVerticesRingVertStartCount",value:function(){return this._meshData._vrvStartCount}},{key:"getVerticesRingVert",value:function(){return this._meshData._vertRingVert}},{key:"getVerticesRingFaceStartCount",value:function(){return this._meshData._vrfStartCount}},{key:"getVerticesRingFace",value:function(){return this._meshData._vertRingFace}},{key:"getVerticesOnEdge",value:function(){return this._meshData._vertOnEdge}},{key:"getVerticesProxy",value:function(){return this._meshData._vertProxy}},{key:"getFaces",value:function(){return this._meshData._facesABCD}},{key:"hasOnlyTriangles",value:function(){return this.getNbTriangles()===this.getNbFaces()}},{key:"hasOnlyQuads",value:function(){return this.getNbTriangles()===2*this.getNbFaces()}},{key:"getFaceNormals",value:function(){return this._meshData._faceNormalsXYZ}},{key:"getFaceBoxes",value:function(){return this._meshData._faceBoxes}},{key:"getFaceCenters",value:function(){return this._meshData._faceCentersXYZ}},{key:"getFacesTagFlags",value:function(){return this._meshData._facesTagFlags}},{key:"getFaceEdges",value:function(){return this._meshData._faceEdges}},{key:"getFacesToTriangles",value:function(){return this._meshData._facesToTriangles}},{key:"getTrianglesTexCoord",value:function(){return this._meshData._UVtrianglesABC}},{key:"getTriangles",value:function(){return this._meshData._trianglesABC}},{key:"getEdges",value:function(){return this._meshData._edges}},{key:"getNbEdges",value:function(){return this._meshData._edges.length}},{key:"getTexCoords",value:function(){return this._meshData._texCoordsST}},{key:"getVerticesDuplicateStartCount",value:function(){return this._meshData._duplicateStartCount}},{key:"getFacesTexCoord",value:function(){return this._meshData._UVfacesABCD}},{key:"getVerticesDrawArrays",value:function(){return this._meshData._DAverticesXYZ||this.updateDrawArrays(),this._meshData._DAverticesXYZ}},{key:"getNormalsDrawArrays",value:function(){return this._meshData._DAnormalsXYZ}},{key:"getColorsDrawArrays",value:function(){return this._meshData._DAcolorsRGB}},{key:"getMaterialsDrawArrays",value:function(){return this._meshData._DAmaterialsPBR}},{key:"getTexCoordsDrawArrays",value:function(){return this._meshData._DAtexCoordsST}},{key:"getOctree",value:function(){return this._meshData._octree}},{key:"getCenter",value:function(){return this._transformData._center}},{key:"getMV",value:function(){return this._transformData._lastComputedMV}},{key:"getMVP",value:function(){return this._transformData._lastComputedMVP}},{key:"getN",value:function(){return this._transformData._lastComputedN}},{key:"getEN",value:function(){return this._transformData._lastComputedEN}},{key:"getDepth",value:function(){return this._transformData._lastComputedDepth}},{key:"getMatrix",value:function(){return this._transformData._matrix}},{key:"getEditMatrix",value:function(){return this._transformData._editMatrix}},{key:"getScale2",value:function(){var e=this._transformData._matrix;return e[0]*e[0]+e[4]*e[4]+e[8]*e[8]}},{key:"getScale",value:function(){return Math.sqrt(this.getScale2())}},{key:"getSymmetryOrigin",value:function(){var e=i.R3.create(),t=this._transformData,r=t._symmetryOffset*this.computeLocalRadius();return i.R3.scaleAndAdd(e,t._center,t._symmetryNormal,r)}},{key:"getSymmetryOffset",value:function(){return this._transformData._symmetryOffset}},{key:"setSymmetryOffset",value:function(e){this._transformData._symmetryOffset=e}},{key:"getSymmetryNormal",value:function(){return this._transformData._symmetryNormal}},{key:"getFacePosInLeaf",value:function(){return this._meshData._facePosInLeaf}},{key:"getFaceLeaf",value:function(){return this._meshData._faceLeaf}},{key:"getLeavesToUpdate",value:function(){return this._meshData._leavesToUpdate}},{key:"getLocalBound",value:function(){return this._meshData._octree._aabbLoose}},{key:"getRenderNbEdges",value:function(){return this.getNbEdges()}},{key:"init",value:function(){this.initColorsAndMaterials(),this.allocateArrays(),this.initTopology(),this.updateGeometry(),this._renderData&&this.updateDuplicateColorsAndMaterials(),this.updateCenter()}},{key:"initTopology",value:function(){this.initFaceRings(),this.optimize(),this.initEdges(),this.initVertexRings(),this.initRenderTriangles()}},{key:"updateGeometry",value:function(e,t){this.updateFacesAabbAndNormal(e),this.updateVerticesNormal(t),this.updateOctree(e),this._renderData&&(this.updateDuplicateGeometry(t),this.updateDrawArrays(e))}},{key:"allocateArrays",value:function(){var e=this.getNbVertices();if(this.hasUV()){var t=this._meshData._texCoordsST.length/2,r=new Float32Array(3*t);r.set(this._meshData._verticesXYZ),this._meshData._verticesXYZ=r,this._meshData._normalsXYZ=new Float32Array(3*t),r=new Float32Array(3*t),this._meshData._colorsRGB&&r.set(this._meshData._colorsRGB),this._meshData._colorsRGB=r,r=new Float32Array(3*t),this._meshData._materialsPBR&&r.set(this._meshData._materialsPBR),this._meshData._materialsPBR=r}else this._meshData._normalsXYZ=this._meshData._normalsXYZ||new Float32Array(3*e),this._meshData._colorsRGB=this._meshData._colorsRGB||new Float32Array(3*e),this._meshData._materialsPBR=this._meshData._materialsPBR||new Float32Array(3*e);this._meshData._vertOnEdge=new Uint8Array(e),this._meshData._vrvStartCount=new Uint32Array(2*e),this._meshData._vrfStartCount=new Uint32Array(2*e),this._meshData._vertTagFlags=new Int32Array(e),this._meshData._vertSculptFlags=new Int32Array(e),this._meshData._vertStateFlags=new Int32Array(e),this._meshData._vertProxy=new Float32Array(3*e);var i=this.getNbFaces();this._meshData._faceEdges=new Uint32Array(4*i),this._meshData._facesToTriangles=new Uint32Array(i),this._meshData._faceBoxes=new Float32Array(6*i),this._meshData._faceNormalsXYZ=new Float32Array(3*i),this._meshData._faceCentersXYZ=new Float32Array(3*i),this._meshData._facesTagFlags=new Int32Array(i),this._meshData._facePosInLeaf=new Uint32Array(i);var n=this._meshData._faceLeaf;n.length=i;for(var a=0;a<i;++a)n[a]=null}},{key:"initColorsAndMaterials",value:function(){var e=this.getNbVertices(),t=0,r=3*e;if(!this._meshData._colorsRGB||this._meshData._colorsRGB.length!==r){var i=this._meshData._colorsRGB=new Float32Array(r);for(t=0;t<r;++t)i[t]=1}if(!this._meshData._materialsPBR||this._meshData._materialsPBR.length!==r){var n=this._meshData._materialsPBR=new Float32Array(r);for(t=0;t<e;++t){var a=3*t;n[a]=.18,n[a+1]=.08,n[a+2]=1}}}},{key:"initFaceRings",value:function(){var e=this.getFaces(),t=this.getNbVertices(),r=this.getNbFaces(),i=0,n=0,a=new Uint32Array(t);for(i=0;i<r;++i){a[e[n=4*i]]++,a[e[n+1]]++,a[e[n+2]]++;var s=e[n+3];s!==o.Z.TRI_INDEX&&a[s]++}var l=this.getVerticesRingFaceStartCount(),u=0;for(i=0;i<t;++i){var c=a[i];l[2*i]=u,l[2*i+1]=c,u+=c}var h=new Uint32Array(o.Z.getMemory(4*r*6),0,6*r);for(u=0,i=0;i<r;++i){var d=e[n=4*i],f=e[n+1],p=e[n+2],_=e[n+3];h[l[2*d]+--a[d]]=i,h[l[2*f]+--a[f]]=i,h[l[2*p]+--a[p]]=i,_!==o.Z.TRI_INDEX&&(h[l[2*_]+--a[_]]=i,++u)}this._meshData._vertRingFace=new Uint32Array(h.subarray(0,3*r+u))}},{key:"updateVerticesNormal",value:function(e){for(var t=this.getVerticesRingFaceStartCount(),r=this.getVerticesRingFace(),i=r instanceof Array?r:null,n=this.getNormals(),a=this.getFaceNormals(),s=void 0===e,o=s?this.getNbVertices():e.length,l=0;l<o;++l){var u,c,h=s?l:e[l];i?(u=0,c=(r=i[h]).length):c=(u=t[2*h])+t[2*h+1];for(var d=0,f=0,p=0,_=u;_<c;++_){var m=3*r[_];d+=a[m],f+=a[m+1],p+=a[m+2]}var g=c-u;0!==g&&(g=1/g),n[h*=3]=d*g,n[h+1]=f*g,n[h+2]=p*g}}},{key:"initVertexRings",value:function(){for(var e=this.getVerticesRingVertStartCount(),t=this._meshData._vertRingVert=new Uint32Array(2*this.getNbEdges()),r=this.getVerticesRingFaceStartCount(),i=this.getVerticesRingFace(),n=this.getVerticesTagFlags(),a=this.getVerticesOnEdge(),s=this.getFaces(),l=0,u=0,c=this.getNbVertices();u<c;++u){for(var h=++o.Z.TAG_FLAG,d=r[2*u],f=d+r[2*u+1],p=0,_=d;_<f;++_){var m=4*i[_],g=s[m],v=s[m+1],y=s[m+2],b=s[m+3];g===u?g=b!==o.Z.TRI_INDEX?b:y:v===u||b===u?v=y:y===u&&b!==o.Z.TRI_INDEX&&(g=b),n[g]!==h&&(t[l+p++]=g,n[g]=h),n[v]!==h&&(t[l+p++]=v,n[v]=h)}e[2*u]=l,e[2*u+1]=p,l+=p,f-d!==p&&(a[u]=1)}}},{key:"expandsVertices",value:function(e,t){var r=++o.Z.TAG_FLAG,i=e.length,n=this.getVerticesRingVertStartCount(),a=this.getVerticesRingVert(),s=a instanceof Array?a:null,l=this.getVerticesTagFlags(),u=i,c=this.getNbVertices(),h=new Uint32Array(o.Z.getMemory(4*c),0,c);h.set(e);var d=0;for(d=0;d<i;++d)l[h[d]]=r;for(var f=0;t;){for(--t,d=f;d<i;++d){var p,_,m=h[d];s?(p=0,_=(a=s[m]).length):_=(p=n[2*m])+n[2*m+1];for(var g=p;g<_;++g){var v=a[g];l[v]!==r&&(l[v]=r,h[u++]=v)}}f=i,i=u}return new Uint32Array(h.subarray(0,u))}},{key:"getVerticesFromFaces",value:function(e){for(var t=++o.Z.TAG_FLAG,r=e.length,i=this.getVerticesTagFlags(),n=this.getFaces(),a=0,s=new Uint32Array(o.Z.getMemory(4*e.length*4),0,4*e.length),l=0;l<r;++l){var u=4*e[l],c=n[u],h=n[u+1],d=n[u+2],f=n[u+3];i[c]!==t&&(i[c]=t,s[a++]=c),i[h]!==t&&(i[h]=t,s[a++]=h),i[d]!==t&&(i[d]=t,s[a++]=d),f!==o.Z.TRI_INDEX&&i[f]!==t&&(i[f]=t,s[a++]=f)}return new Uint32Array(s.subarray(0,a))}},{key:"updateFacesAabbAndNormal",value:function(e){for(var t=this.getFaceNormals(),r=this.getFaceBoxes(),i=this.getFaceCenters(),n=this.getVertices(),a=this.getFaces(),s=void 0===e,l=s?this.getNbFaces():e.length,u=0;u<l;++u){var c=s?u:e[u],h=3*c,d=4*c,f=6*c,p=3*a[d],_=3*a[d+1],m=3*a[d+2],g=a[d+3],v=g!==o.Z.TRI_INDEX;v&&(g*=3);var y=n[p],b=n[p+1],T=n[p+2],k=n[_],M=n[_+1],x=n[_+2],S=n[m],A=n[m+1],E=n[m+2],R=k-y,w=M-b,C=x-T,P=S-y,D=A-b,I=E-T,F=w*I-C*D,O=C*P-R*I,V=R*D-w*P,L=y<k?y<S?y:S:k<S?k:S,N=y>k?y>S?y:S:k>S?k:S,B=b<M?b<A?b:A:M<A?M:A,U=b>M?b>A?b:A:M>A?M:A,Z=T<x?T<E?T:E:x<E?x:E,z=T>x?T>E?T:E:x>E?x:E;if(v){var G=n[g],W=n[g+1],j=n[g+2];G<L&&(L=G),G>N&&(N=G),W<B&&(B=W),W>U&&(U=W),j<Z&&(Z=j),j>z&&(z=j),F+=(w=A-W)*I-(C=E-j)*D,O+=C*P-(R=S-G)*I,V+=R*D-w*P}t[h]=F,t[h+1]=O,t[h+2]=V,r[f]=L,r[f+1]=B,r[f+2]=Z,r[f+3]=N,r[f+4]=U,r[f+5]=z,i[h]=.5*(L+N),i[h+1]=.5*(B+U),i[h+2]=.5*(Z+z)}}},{key:"expandsFaces",value:function(e,t){var r=++o.Z.TAG_FLAG,i=e.length,n=this.getVerticesRingFaceStartCount(),a=this.getVerticesRingFace(),s=a instanceof Array?a:null,l=this.getFacesTagFlags(),u=this.getFaces(),c=i,h=new Uint32Array(o.Z.getMemory(4*this.getNbFaces()),0,this.getNbFaces());h.set(e);var d=0;for(d=0;d<i;++d)l[h[d]]=r;for(var f=0;t;){for(--t,d=f;d<i;++d)for(var p=4*h[d],_=0;_<4;++_){var m=u[p+_];if(m!==o.Z.TRI_INDEX){var g,v;s?(g=0,v=(a=s[m]).length):v=(g=n[2*m])+n[2*m+1];for(var y=g;y<v;++y){var b=a[y];l[b]!==r&&(l[b]=r,h[c++]=b)}}}f=i,i=c}return new Uint32Array(h.subarray(0,c))}},{key:"getFacesFromVertices",value:function(e){for(var t=++o.Z.TAG_FLAG,r=e.length,i=this.getVerticesRingFaceStartCount(),n=this.getVerticesRingFace(),a=n instanceof Array?n:null,s=this.getFacesTagFlags(),l=0,u=new Uint32Array(o.Z.getMemory(4*this.getNbFaces()),0,this.getNbFaces()),c=0;c<r;++c){var h,d,f=e[c];a?(h=0,d=(n=a[f]).length):d=(h=i[2*f])+i[2*f+1];for(var p=h;p<d;++p){var _=n[p];s[_]!==t&&(s[_]=t,u[l++]=_)}}return new Uint32Array(u.subarray(0,l))}},{key:"initRenderTriangles",value:function(){this.hasUV()&&(this._meshData._UVtrianglesABC=this.computeTrianglesFromFaces(this.getFacesTexCoord())),this._meshData._trianglesABC=this.computeTrianglesFromFaces(this.getFaces())}},{key:"computeTrianglesFromFaces",value:function(e){for(var t=this.getNbFaces(),r=this.getFacesToTriangles(),i=new Uint32Array(o.Z.getMemory(4*t*6),0,6*t),n=0,a=0;a<t;++a){r[a]=n;var s=4*a,l=e[s],u=e[s+1],c=e[s+2],h=e[s+3],d=3*n;i[d]=l,i[d+1]=u,i[d+2]=c,++n,h!==o.Z.TRI_INDEX&&(i[d=3*n]=l,i[d+1]=c,i[d+2]=h,++n)}return new Uint32Array(i.subarray(0,3*n))}},{key:"initEdges",value:function(){for(var e=this.getFaces(),t=this.getFaceEdges(),r=0,i=new Uint32Array(this.getNbVertices()),n=this.getVerticesRingFaceStartCount(),a=this.getVerticesRingFace(),s=0,l=this.getNbVertices();s<l;++s)for(var u=n[2*s],c=u+n[2*s+1],h=r,d=u;d<c;++d){var f=4*a[d],p=e[f],_=e[f+1],m=e[f+2],g=e[f+3],v=0,y=0;g===o.Z.TRI_INDEX?(s>p&&(y=f+(s===_?0:2),(v=i[p])<=h?(t[y]=r,i[p]=++r):t[y]=v-1),s>_&&(y=f+(s===p?0:1),(v=i[_])<=h?(t[y]=r,i[_]=++r):t[y]=v-1),s>m&&(y=f+(s===p?2:1),(v=i[m])<=h?(t[y]=r,i[m]=++r):t[y]=v-1),t[f+3]=o.Z.TRI_INDEX):(s>p&&s!==m&&(y=f+(s===_?0:3),(v=i[p])<=h?(t[y]=r,i[p]=++r):t[y]=v-1),s>_&&s!==g&&(y=f+(s===p?0:1),(v=i[_])<=h?(t[y]=r,i[_]=++r):t[y]=v-1),s>m&&s!==p&&(y=f+(s===_?1:2),(v=i[m])<=h?(t[y]=r,i[m]=++r):t[y]=v-1),s>g&&s!==_&&(y=f+(s===p?3:2),(v=i[g])<=h?(t[y]=r,i[g]=++r):t[y]=v-1))}for(var b=this._meshData._edges=new Uint8ClampedArray(r),T=0,k=this.getNbFaces();T<k;++T){var M=4*T;b[t[M]]++,b[t[M+1]]++,b[t[M+2]]++;var x=t[M+3];x!==o.Z.TRI_INDEX&&b[x]++}}},{key:"getWireframe",value:function(){var e,t=this.getNbEdges(),r=this.isUsingDrawArrays();if(r){if(this._meshData._drawArraysWireframe&&this._meshData._drawArraysWireframe.length===2*t)return this._meshData._drawArraysWireframe;e=this._meshData._drawArraysWireframe=new Uint32Array(2*t)}else{if(this._meshData._drawElementsWireframe&&this._meshData._drawElementsWireframe.length===2*t)return this._meshData._drawElementsWireframe;e=this._meshData._drawElementsWireframe=new Uint32Array(2*t)}for(var i=this.getFaces(),n=this.getFaceEdges(),a=this.getNbFaces(),s=this.getFacesToTriangles(),l=0,u=new Uint8Array(t),c=0;c<a;++c){var h,d,f,p=4*c,_=i[p+3],m=_!==o.Z.TRI_INDEX;if(r){var g=3*s[c];h=g,d=g+1,f=g+2,m&&(_=g+5)}else h=i[p],d=i[p+1],f=i[p+2];var v=n[p],y=n[p+1],b=n[p+2],T=n[p+3];0===u[v]&&(u[v]=1,e[2*l]=h,e[2*l+1]=d,l++),0===u[y]&&(u[y]=1,e[2*l]=d,e[2*l+1]=f,l++),0===u[b]&&(u[b]=1,e[2*l]=f,e[2*l+1]=m?_:h,l++),m&&0===u[T]&&(u[T]=1,e[2*l]=_,e[2*l+1]=h,l++)}return r?this._meshData._drawArraysWireframe:this._meshData._drawElementsWireframe}},{key:"updateDuplicateGeometry",value:function(e){if(this.isUsingTexCoords()&&this.hasUV())for(var t=this.getVertices(),r=this.getColors(),i=this.getMaterials(),n=this.getNormals(),a=this.getVerticesDuplicateStartCount(),s=void 0===e,o=s?this.getNbVertices():e.length,l=0;l<o;++l){var u=s?l:e[l],c=a[2*u];if(0!==c)for(var h=c+a[2*u+1],d=3*u,f=t[d],p=t[d+1],_=t[d+2],m=n[d],g=n[d+1],v=n[d+2],y=r[d],b=r[d+1],T=r[d+2],k=i[d],M=i[d+1],x=i[d+2],S=c;S<h;++S){var A=3*S;t[A]=f,t[A+1]=p,t[A+2]=_,n[A]=m,n[A+1]=g,n[A+2]=v,r[A]=y,r[A+1]=b,r[A+2]=T,i[A]=k,i[A+1]=M,i[A+2]=x}}}},{key:"updateDuplicateColorsAndMaterials",value:function(e){if(this.isUsingTexCoords()&&this.hasUV())for(var t=this.getColors(),r=this.getMaterials(),i=this.getVerticesDuplicateStartCount(),n=void 0===e,a=n?this.getNbVertices():e.length,s=0;s<a;++s){var o=n?s:e[s],l=i[2*o];if(0!==l)for(var u=l+i[2*o+1],c=3*o,h=t[c],d=t[c+1],f=t[c+2],p=r[c],_=r[c+1],m=r[c+2],g=l;g<u;++g){var v=3*g;t[v]=h,t[v+1]=d,t[v+2]=f,r[v]=p,r[v+1]=_,r[v+2]=m}}}},{key:"initTexCoordsDataFromOBJData",value:function(e,t){var r=this.getFaces(),i=r.length;if(i==t.length){var n=e.length/2;for(s=0;s<i;++s)t[s]>=n&&(t[s]=r[s]);var a=this.getNbVertices(),s=0,l=0,u=0,c=0,h=new Int32Array(a),d=new Float32Array(o.Z.getMemory(4*a*2),0,2*a),f=[],p=0,_=0;for(s=0;s<i;++s)if((u=r[s])!==o.Z.TRI_INDEX){var m=t[s];if((c=h[u])!==m+1)if(0!==c)if(c>0)h[u]=--p,f.push([m]),++_;else{var g=f[-c-1],v=g.length;for(l=0;l<v&&g[l]!==m;++l);l===v&&(++_,g.push(m))}else h[u]=m+1,d[2*u]=e[2*m],d[2*u+1]=e[2*m+1]}var y=new Float32Array(2*(a+_));y.set(d);var b=this._meshData._duplicateStartCount=new Uint32Array(2*a);for(p=0,s=0;s<a;++s)if(!((c=h[s])>=0)){var T=f[-c-1],k=T.length,M=a+p;for(b[2*s]=M,b[2*s+1]=k,p+=k,l=0;l<k;++l){var x=2*T[l],S=2*(M+l);y[S]=e[x],y[S+1]=e[x+1]}}var A=new Uint32Array(r);for(i=r.length,s=0;s<i;++s)if((u=A[s])!==o.Z.TRI_INDEX&&!((c=h[u])>0)){var E=t[s],R=f[-c-1],w=R.length;for(l=0;l<w;++l)if(E===R[l]){A[s]=b[2*u]+l;break}}this.setTexCoords(y),this.setFacesTexCoord(A)}}},{key:"setAlreadyDrawArrays",value:function(){this._meshData._DAverticesXYZ=this.getVertices(),this._meshData._DAnormalsXYZ=this.getNormals(),this._meshData._DAcolorsRGB=this.getColors(),this._meshData._DAmaterialsPBR=this.getMaterials()}},{key:"updateDrawArrays",value:function(e){if(this.isUsingDrawArrays()){var t=this.getVertices(),r=this.getNormals(),i=this.getColors(),n=this.getMaterials(),a=this.getFaces(),s=this.getNbTriangles(),l=this.hasOnlyTriangles()?null:this.getFacesToTriangles(),u=void 0===e,c=this._meshData._DAverticesXYZ,h=this._meshData._DAnormalsXYZ,d=this._meshData._DAcolorsRGB,f=this._meshData._DAmaterialsPBR;(!c||c.length<9*s)&&(c=this._meshData._DAverticesXYZ=new Float32Array(9*s),h=this._meshData._DAnormalsXYZ=new Float32Array(9*s),d=this._meshData._DAcolorsRGB=new Float32Array(9*s),f=this._meshData._DAmaterialsPBR=new Float32Array(9*s));for(var p=u?this.getNbFaces():e.length,_=0;_<p;++_){var m=u?_:e[_],g=9*(l?l[m]:m),v=3*a[m*=4],y=3*a[m+1],b=3*a[m+2];c[g]=t[v],c[g+1]=t[v+1],c[g+2]=t[v+2],c[g+3]=t[y],c[g+4]=t[y+1],c[g+5]=t[y+2],c[g+6]=t[b],c[g+7]=t[b+1],c[g+8]=t[b+2],d[g]=i[v],d[g+1]=i[v+1],d[g+2]=i[v+2],d[g+3]=i[y],d[g+4]=i[y+1],d[g+5]=i[y+2],d[g+6]=i[b],d[g+7]=i[b+1],d[g+8]=i[b+2],f[g]=n[v],f[g+1]=n[v+1],f[g+2]=n[v+2],f[g+3]=n[y],f[g+4]=n[y+1],f[g+5]=n[y+2],f[g+6]=n[b],f[g+7]=n[b+1],f[g+8]=n[b+2],h[g]=r[v],h[g+1]=r[v+1],h[g+2]=r[v+2],h[g+3]=r[y],h[g+4]=r[y+1],h[g+5]=r[y+2],h[g+6]=r[b],h[g+7]=r[b+1],h[g+8]=r[b+2];var T=a[m+3];T!==o.Z.TRI_INDEX&&(T*=3,c[g+=9]=t[v],c[g+1]=t[v+1],c[g+2]=t[v+2],c[g+3]=t[b],c[g+4]=t[b+1],c[g+5]=t[b+2],c[g+6]=t[T],c[g+7]=t[T+1],c[g+8]=t[T+2],d[g]=i[v],d[g+1]=i[v+1],d[g+2]=i[v+2],d[g+3]=i[b],d[g+4]=i[b+1],d[g+5]=i[b+2],d[g+6]=i[T],d[g+7]=i[T+1],d[g+8]=i[T+2],f[g]=n[v],f[g+1]=n[v+1],f[g+2]=n[v+2],f[g+3]=n[b],f[g+4]=n[b+1],f[g+5]=n[b+2],f[g+6]=n[T],f[g+7]=n[T+1],f[g+8]=n[T+2],h[g]=r[v],h[g+1]=r[v+1],h[g+2]=r[v+2],h[g+3]=r[b],h[g+4]=r[b+1],h[g+5]=r[b+2],h[g+6]=r[T],h[g+7]=r[T+1],h[g+8]=r[T+2])}this.isUsingTexCoords()&&this.updateDrawArraysTexCoord(e)}}},{key:"updateDrawArraysTexCoord",value:function(e){var t=this.getNbTriangles(),r=this.getFacesToTriangles(),i=void 0===e,n=this._meshData._DAtexCoordsST;n&&n.length===6*t||(n=this._meshData._DAtexCoordsST=new Float32Array(6*t));for(var a=this.getTexCoords(),s=this.getFacesTexCoord(),l=i?this.getNbFaces():e.length,u=0;u<l;++u){var c=i?u:e[u],h=6*r[c],d=2*s[c*=4],f=2*s[c+1],p=2*s[c+2];n[h]=a[d],n[h+1]=a[d+1],n[h+2]=a[f],n[h+3]=a[f+1],n[h+4]=a[p],n[h+5]=a[p+1];var _=s[c+3];_!==o.Z.TRI_INDEX&&(_*=3,n[h+=6]=a[d],n[h+1]=a[d+1],n[h+2]=a[p],n[h+3]=a[p+1],n[h+4]=a[_],n[h+5]=a[_+1])}}},{key:"updateCenter",value:function(){var e=this.getLocalBound();i.R3.set(this._transformData._center,.5*(e[0]+e[3]),.5*(e[1]+e[4]),.5*(e[2]+e[5]))}},{key:"updateMatrices",value:function(e){i.wO.normalFromMat4(this._transformData._lastComputedEN,this._transformData._editMatrix),i._E.mul(this._transformData._lastComputedMV,e.getView(),this._transformData._matrix),i.wO.normalFromMat4(this._transformData._lastComputedN,this._transformData._lastComputedMV),i._E.mul(this._transformData._lastComputedMVP,e.getProjection(),this._transformData._lastComputedMV);var t=this._transformData._center,r=this._transformData._lastComputedMVP;this._transformData._lastComputedDepth=r[2]*t[0]+r[6]*t[1]+r[10]*t[2]+r[14]}},{key:"computeLocalRadius",value:function(){var e=this.getLocalBound();return.5*i.R3.dist([e[0],e[1],e[2]],[e[3],e[4],e[5]])}},{key:"normalizeSize",value:function(){var e=o.Z.SCALE/(2*this.computeLocalRadius());i._E.scale(this._transformData._matrix,this._transformData._matrix,[e,e,e])}},{key:"computeWorldBound",value:function(){var e=this._meshData._worldBound,t=this.getLocalBound(),r=this.getMatrix();e[0]=e[3]=r[12],e[1]=e[4]=r[13],e[2]=e[5]=r[14];for(var i=0;i<3;++i)for(var n=4*i,a=t[i],s=t[i+3],o=0;o<3;++o){var l=r[n+o],u=l*s,c=l*a;u<c?(e[o]+=u,e[o+3]+=c):(e[o]+=c,e[o+3]+=u)}return e}},{key:"intersectRay",value:function(e,t,r){var i=this.getNbFaces(),n=new Uint32Array(o.Z.getMemory(4*i),0,i);return this._meshData._octree.collectIntersectRay(e,t,n,r?this._meshData._leavesToUpdate:void 0)}},{key:"intersectSphere",value:function(e,t,r){var i=this.getNbFaces(),n=new Uint32Array(o.Z.getMemory(4*i),0,i);return this._meshData._octree.collectIntersectSphere(e,t,n,r?this._meshData._leavesToUpdate:void 0)}},{key:"updateOctree",value:function(e){e?this.updateOctreeAdd(this.updateOctreeRemove(e)):this.computeOctree()}},{key:"computeAabb",value:function(){for(var e=this.getNbVertices(),t=this.getVertices(),r=1/0,i=1/0,n=1/0,a=-1/0,s=-1/0,o=-1/0,l=0;l<e;++l){var u=3*l,c=t[u],h=t[u+1],d=t[u+2];c<r&&(r=c),c>a&&(a=c),h<i&&(i=h),h>s&&(s=h),d<n&&(n=d),d>o&&(o=d)}return[r,i,n,a,s,o]}},{key:"computeOctree",value:function(){var e=this.computeAabb(),t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],s=e[5],o=n-t,l=a-r,u=s-i,c=.2*Math.sqrt(o*o+l*l+u*u),h=1e-16;n-t<h&&(t-=c,n+=c),a-r<h&&(r-=c,a+=c),s-i<h&&(i-=c,s+=c);var d=.3*o,f=.3*l,p=.3*u,_=t-d,m=n+d,g=r-f,v=a+f,y=i-p,b=s+p,T=this._meshData._octree=new gt;T.resetNbFaces(this.getNbFaces()),T.setAabbLoose(t,r,i,n,a,s),T.setAabbSplit(_,g,y,m,v,b),T.build(this)}},{key:"updateOctreeRemove",value:function(e){for(var t=this.getFaceCenters(),r=this.getFaceBoxes(),i=this._meshData._facePosInLeaf,n=this._meshData._faceLeaf,a=e.length,s=0,l=new Uint32Array(o.Z.getMemory(4*a),0,a),u=0;u<a;++u){var c=e[u],h=6*c,d=3*c,f=n[c],p=f._aabbSplit,_=t[d],m=t[d+1],g=t[d+2];if(_<=p[0]||m<=p[1]||g<=p[2]||_>p[3]||m>p[4]||g>p[5]){l[s++]=e[u];var v=f._iFaces;if(v.length>0){var y=v[v.length-1],b=i[c];v[b]=y,i[y]=b,v.pop()}}else f.expandsAabbLoose(r[h],r[h+1],r[h+2],r[h+3],r[h+4],r[h+5])}return new Uint32Array(l.subarray(0,s))}},{key:"updateOctreeAdd",value:function(e){for(var t=this.getFaceCenters(),r=this.getFaceBoxes(),i=this._meshData._facePosInLeaf,n=this._meshData._faceLeaf,a=e.length,s=this._meshData._octree,o=s._aabbSplit,l=o[0],u=o[1],c=o[2],h=o[3],d=o[4],f=o[5],p=0;p<a;++p){var _=e[p],m=6*_,g=r[m],v=r[m+1],y=r[m+2],b=r[m+3],T=r[m+4],k=r[m+5];if(g>h||b<l||v>d||T<u||y>f||k<c){this.computeOctree(),this._meshData._leavesToUpdate.length=0;break}var M=3*_,x=s.addFace(_,g,v,y,b,T,k,t[M],t[M+1],t[M+2]);if(x)i[_]=x._iFaces.length-1,n[_]=x;else{var S=n[_]._iFaces;i[_]=S.length,S.push(e[p])}}}},{key:"balanceOctree",value:function(){++gt.FLAG;for(var e=this._meshData._leavesToUpdate,t=e.length,r=0;r<t;++r){var i=e[r];i._flag!==gt.FLAG&&(0===i._iFaces.length?i.pruneIfPossible():i._iFaces.length>gt.MAX_FACES&&i._depth<gt.MAX_DEPTH&&i.build(this),i._flag=gt.FLAG)}e.length=0}},{key:"setFlatColor",value:function(e){this.getFlatColor().set(e)}},{key:"setAlbedo",value:function(e){this.getAlbedo().set(e)}},{key:"setMode",value:function(e){this._renderData._mode=e}},{key:"setRoughness",value:function(e){this._renderData._roughness=e}},{key:"setMetallic",value:function(e){this._renderData._metallic=e}},{key:"setOpacity",value:function(e){this._renderData._alpha=e}},{key:"setTexture0",value:function(e){this._renderData._texture0=e}},{key:"setMatcap",value:function(e){this._renderData._matcap=e}},{key:"setCurvature",value:function(e){this._renderData._curvature=e}},{key:"setFlatShading",value:function(e){this._renderData._flatShading=e}},{key:"setShowWireframe",value:function(e){this._renderData._showWireframe=!yt.ONLY_DRAW_ARRAYS&&e,this.updateWireframeBuffer()}},{key:"setUseDrawArrays",value:function(e){this._renderData._useDrawArrays=e}},{key:"getGL",value:function(){return this._renderData._gl}},{key:"getCount",value:function(){var e=this.getGL();return this.getMode()===e.TRIANGLES?3*this.getNbTriangles():this.getMode()===e.LINES?this.getNbVertices():0}},{key:"getVertexBuffer",value:function(){return this._renderData._vertexBuffer}},{key:"getNormalBuffer",value:function(){return this._renderData._normalBuffer}},{key:"getColorBuffer",value:function(){return this._renderData._colorBuffer}},{key:"getMaterialBuffer",value:function(){return this._renderData._materialBuffer}},{key:"getTexCoordBuffer",value:function(){return this._renderData._texCoordBuffer}},{key:"getIndexBuffer",value:function(){return this._renderData._indexBuffer}},{key:"getWireframeBuffer",value:function(){return this._renderData._wireframeBuffer}},{key:"getRoughness",value:function(){return this._renderData._roughness}},{key:"getMetallic",value:function(){return this._renderData._metallic}},{key:"getOpacity",value:function(){return this._renderData._alpha}},{key:"getFlatColor",value:function(){return this._renderData._flatColor}},{key:"getMode",value:function(){return this._renderData._mode}},{key:"getAlbedo",value:function(){return this._renderData._albedo}},{key:"getTexture0",value:function(){return this._renderData._texture0}},{key:"getMatcap",value:function(){return this._renderData._matcap}},{key:"getCurvature",value:function(){return this._renderData._curvature}},{key:"getFlatShading",value:function(){return this._renderData._flatShading}},{key:"getShowWireframe",value:function(){return this._renderData._showWireframe}},{key:"isUsingDrawArrays",value:function(){return this._renderData._useDrawArrays||yt.ONLY_DRAW_ARRAYS}},{key:"isUsingTexCoords",value:function(){var e=this._renderData._shaderType;return e===s.Z.Shader.UV||e===s.Z.Shader.PAINTUV}},{key:"isTransparent",value:function(){return this._renderData._alpha<.99}},{key:"getShaderType",value:function(){return this._renderData._shaderType}},{key:"setShaderType",value:function(e){var t=this.hasUV();if(e===s.Z.Shader.UV&&!t){if(this._renderData._shaderType!==s.Z.Shader.UV)return;e=s.Z.Shader.MATCAP}this._renderData._shaderType=e,t&&(this.updateDuplicateGeometry(),this.updateDrawArrays()),this.updateBuffers()}},{key:"initRender",value:function(){this.setShaderType(this._renderData._shaderType),this.setShowWireframe(this.getShowWireframe())}},{key:"render",value:function(e){this.isVisible()&&J[this.getShaderType()].getOrCreate(this.getGL()).draw(this,e)}},{key:"renderWireframe",value:function(e){this.isVisible()&&J[s.Z.Shader.WIREFRAME].getOrCreate(this.getGL()).draw(this,e)}},{key:"renderFlatColor",value:function(e){this.isVisible()&&J[s.Z.Shader.FLAT].getOrCreate(this.getGL()).draw(this,e)}},{key:"getRenderNbVertices",value:function(){return this.isUsingDrawArrays()?this.getCount():this.isUsingTexCoords()?this.getNbTexCoords():this.getNbVertices()}},{key:"updateVertexBuffer",value:function(){var e=this.isUsingDrawArrays()?this.getVerticesDrawArrays():this.getVertices();this.getVertexBuffer().update(e,3*this.getRenderNbVertices())}},{key:"updateNormalBuffer",value:function(){var e=this.isUsingDrawArrays()?this.getNormalsDrawArrays():this.getNormals();this.getNormalBuffer().update(e,3*this.getRenderNbVertices())}},{key:"updateColorBuffer",value:function(){var e=this.isUsingDrawArrays()?this.getColorsDrawArrays():this.getColors();this.getColorBuffer().update(e,3*this.getRenderNbVertices())}},{key:"updateMaterialBuffer",value:function(){var e=this.isUsingDrawArrays()?this.getMaterialsDrawArrays():this.getMaterials();this.getMaterialBuffer().update(e,3*this.getRenderNbVertices())}},{key:"updateTexCoordBuffer",value:function(){if(this.isUsingTexCoords()){var e=this.isUsingDrawArrays()?this.getTexCoordsDrawArrays():this.getTexCoords();this.getTexCoordBuffer().update(e,2*this.getRenderNbVertices())}}},{key:"updateIndexBuffer",value:function(){if(!this.isUsingDrawArrays()){var e=this.isUsingTexCoords()?this.getTrianglesTexCoord():this.getTriangles();this.getIndexBuffer().update(e,3*this.getNbTriangles())}}},{key:"updateWireframeBuffer",value:function(){this.getShowWireframe()&&this.getWireframeBuffer().update(this.getWireframe(),2*this.getNbEdges())}},{key:"updateGeometryBuffers",value:function(){this.updateVertexBuffer(),this.updateNormalBuffer()}},{key:"updateBuffers",value:function(){this.updateGeometryBuffers(),this.updateColorBuffer(),this.updateMaterialBuffer(),this.updateTexCoordBuffer(),this.updateIndexBuffer(),this.updateWireframeBuffer()}},{key:"release",value:function(){this.getTexture0()&&this.getGL().deleteTexture(this.getTexture0()),this.getVertexBuffer().release(),this.getNormalBuffer().release(),this.getColorBuffer().release(),this.getMaterialBuffer().release(),this.getIndexBuffer().release(),this.getWireframeBuffer().release()}},{key:"copyRenderConfig",value:function(e){this.setFlatShading(e.getFlatShading()),this.setShowWireframe(e.getShowWireframe()),this.setShaderType(e.getShaderType()),this.setMatcap(e.getMatcap()),this.setTexture0(e.getTexture0()),this.setCurvature(e.getCurvature()),this.setOpacity(e.getOpacity())}},{key:"copyTransformData",value:function(e){i.R3.copy(this.getCenter(),e.getCenter()),i._E.copy(this.getMatrix(),e.getMatrix()),i._E.copy(this.getEditMatrix(),e.getEditMatrix()),i.R3.copy(this.getSymmetryNormal(),e.getSymmetryNormal())}},{key:"copyData",value:function(e){this.setVertices(e.getVertices().slice()),this.setFaces(e.getFaces().slice()),this.setColors(e.getColors().slice()),this.setMaterials(e.getMaterials().slice()),e.hasUV()&&this.initTexCoordsDataFromOBJData(e.getTexCoords(),e.getFacesTexCoord()),this.init(),this.initRender(),this.copyTransformData(e),this.copyRenderConfig(e)}},{key:"optimize",value:function(){0!==this.getNbFaces()&&e.OPTIMIZE&&(this.optimizePostTransform(),this.optimizePreTransform(),this.initFaceRings())}},{key:"computeCacheScore",value:function(){var e=this.getFaces(),t=this.getNbFaces(),r=[];r.length=32;for(var i=0,n=0,a=0;a<t;++a)for(var s=3*a,l=e[s+3]!==o.Z.TRI_INDEX?4:3,u=0;u<l;++u){var c=e[s+u];for(n=0;n<32;++n){if(void 0===r[n]){r[n]=c,i++;break}if(r[n]===c)break}32===n&&(i++,r.shift(),r.push(c))}return{ACMR:i/t,ACTVR:i/this.getNbVertices()}}},{key:"optimizePostTransform",value:function(){var e=0,t=this.hasUV(),r=this.getFaces(),i=t?this.getFacesTexCoord():r,n=this.getNbFaces(),a=this.getNbVertices(),s=t?this.getNbTexCoords():a,l=this.getVerticesDuplicateStartCount(),u=new Uint32Array(s-a);if(t)for(e=0;e<s;++e)for(var c=l[2*e],h=c+l[2*e+1],d=c;d<h;++d)u[d-a]=e;var f=this.getVerticesRingFaceStartCount(),p=this.getVerticesRingFace(),_=new Int32Array(s);for(e=0;e<a;++e)_[e]=f[2*e+1];for(e=a;e<s;++e)_[e]=f[2*u[e-a]+1];for(var m=new Uint32Array(s),g=33,v=0,y=new Uint32Array(o.Z.getMemory(4*n*4),0,4*n),b=0,T=new Uint8Array(n),k=new Uint32Array(4*n),M=t?new Uint32Array(4*n):k,x=0,S=0;S>=0;){var A=[],E=S>=a?u[S-a]:S,R=f[2*E],w=R+f[2*E+1];for(e=R;e<w;++e){var C=p[e];if(!T[C]){T[C]=1;var P=4*C,D=y[b++]=k[x++]=i[P],I=y[b++]=k[x++]=i[P+1],F=y[b++]=k[x++]=i[P+2],O=k[x++]=i[P+3],V=O!==o.Z.TRI_INDEX;t&&(M[x-4]=r[P],M[x-3]=r[P+1],M[x-2]=r[P+2],M[x-1]=r[P+3]),A.push(D,I,F),--_[D],--_[I],--_[F],g-m[D]>32&&(m[D]=g++),g-m[I]>32&&(m[I]=g++),g-m[F]>32&&(m[F]=g++),V&&(y[b++]=O,A.push(O),--_[O],g-m[O]>32&&(m[O]=g++))}}S=-1;var L=-1,N=A.length;for(e=0;e<N;++e){var B=A[e],U=_[B];if(!(U<=0)){var Z=0,z=g-m[B];z+2*U<=32&&(Z=z),Z>L&&(L=Z,S=B)}}if(-1===S){for(;b>0;){var G=y[--b];if(_[G]>0){S=G;break}}if(-1===S)for(;v<s;)if(_[v++]>0){S=v-1;break}}}i.set(k.subarray(0,4*n)),t&&r.set(M.subarray(0,4*n))}},{key:"optimizePreTransform",value:function(){var e=this.getVertices(),t=this.getColors(),r=this.getMaterials(),i=this.getNbVertices(),n=this.getFaces(),a=4*this.getNbFaces(),s=new Float32Array(3*i),l=new Float32Array(3*i),u=new Float32Array(3*i),c=new Uint32Array(i),h=0,d=0;for(d=0;d<a;++d){var f=n[d];if(f!==o.Z.TRI_INDEX){var p=c[f]-1;if(-1===p){var _=3*h,m=3*f;s[_]=e[m],s[_+1]=e[m+1],s[_+2]=e[m+2],l[_]=t[m],l[_+1]=t[m+1],l[_+2]=t[m+2],u[_]=r[m],u[_+1]=r[m+1],u[_+2]=r[m+2],p=h++,c[f]=p+1}n[d]=p}}var g=i-h;if(g>0&&this.setNbVertices(h),this.hasUV()){var v=this.getFacesTexCoord();for(d=0;d<a;++d){var y=v[d];y<i?v[d]=c[y]-1:y!==o.Z.TRI_INDEX&&(v[d]-=g)}var b=this.getNbTexCoords(),T=this.getNbTexCoords()-g,k=this.getTexCoords(),M=new Float32Array(2*T),x=new Uint32Array(2*h),S=this.getVerticesDuplicateStartCount();for(d=0;d<i;++d){var A=2*d,E=S[A],R=2*(c[d]-1);R<0||(E>0&&(x[R]=E-g,x[R+1]=S[A+1]),M[R]=k[A],M[R+1]=k[A+1])}for(d=i;d<b;++d){var w=2*d,C=2*(d-g);M[C]=k[w],M[C+1]=k[w+1]}this.setVerticesDuplicateStartCount(x),this.setTexCoords(M)}e.set(s),t.set(l),r.set(u)}}])&&bt(t.prototype,r),n&&bt(t,n),e}();Tt.OPTIMIZE=!0,Tt.ID=0;const kt=Tt,Mt=function(){return{_center:i.R3.create(),_matrix:i._E.create(),_editMatrix:i._E.create(),_symmetryNormal:[1,0,0],_symmetryOffset:0,_lastComputedMV:i._E.create(),_lastComputedMVP:i._E.create(),_lastComputedN:i.wO.create(),_lastComputedEN:i.wO.create(),_lastComputedDepth:0,_lastWorldBound:[1/0,1/0,1/0,-1/0,-1/0,-1/0]}},xt=function(){return{_nbVertices:0,_nbFaces:0,_nbTexCoords:0,_verticesXYZ:null,_normalsXYZ:null,_colorsRGB:null,_materialsPBR:null,_vertOnEdge:null,_vertRingFace:null,_vrfStartCount:null,_vrvStartCount:null,_vertRingVert:null,_vertTagFlags:null,_vertSculptFlags:null,_vertStateFlags:null,_vertProxy:null,_facesABCD:null,_faceEdges:null,_faceNormalsXYZ:null,_facesToTriangles:null,_trianglesABC:null,_facesTagFlags:null,_edges:null,_drawArraysWireframe:null,_drawElementsWireframe:null,_texCoordsST:null,_duplicateStartCount:null,_UVfacesABCD:null,_UVtrianglesABC:null,_DAverticesXYZ:null,_DAnormalsXYZ:null,_DAcolorsRGB:null,_DAmaterialsPBR:null,_DAtexCoordsST:null,_octree:null,_faceBoxes:null,_faceCentersXYZ:null,_facePosInLeaf:null,_faceLeaf:[],_leavesToUpdate:[],_worldBound:[1/0,1/0,1/0,-1/0,-1/0,-1/0]}};function St(e){return(St="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function At(e,t){return(At=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Et(e,t){return!t||"object"!==St(t)&&"function"!=typeof t?Rt(e):t}function Rt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function wt(e){return(wt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}const Ct=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&At(e,t)}(n,e);var t,r,i=(t=n,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,i=wt(t);if(r){var n=wt(this).constructor;e=Reflect.construct(i,arguments,n)}else e=i.apply(this,arguments);return Et(this,e)});function n(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(t=i.call(this))._id=kt.ID++,e&&(t._renderData=new yt(e,Rt(t))),t._meshData=new xt,t._transformData=new Mt,t}return n}(kt);function Pt(e){return(Pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Dt(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function It(e,t){return(It=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ft(e,t){return!t||"object"!==Pt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ot(e){return(Ot=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}const Vt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&It(e,t)}(l,e);var t,r,n,a,s=(n=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ot(n);if(a){var r=Ot(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return Ft(this,e)});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=s.call(this,e))._radius=50,t._hardness=.25,t._intensity=1,t._negative=!0,t._culling=!1,t._idAlpha=0,t._lockPosition=!1,t._thickness=1,t}return t=l,(r=[{key:"pushState",value:function(){this._main.getStateManager().pushStateColorAndMaterial(this.getMesh())}},{key:"updateMeshBuffers",value:function(){var e=this.getMesh();e.isDynamic?e.updateBuffers():e.updateMaterialBuffer()}},{key:"stroke",value:function(e){lt.prototype.stroke.call(this,e)}},{key:"dynamicTopology",value:function(e){return e.getPickedVertices()}},{key:"paint",value:function(e,t,r,i,n,a){for(var s=this.getMesh(),o=s.getVertices(),l=s.getMaterials(),u=Math.sqrt(r),c=t[0],h=t[1],d=t[2],f=2*(1-n),p=this._negative?-i:i,_=0,m=e.length;_<m;++_){var g=3*e[_],v=o[g],y=o[g+1],b=o[g+2],T=v-c,k=y-h,M=b-d,x=Math.sqrt(T*T+k*k+M*M)/u;x>1&&(x=1);var S=Math.pow(1-x,f);S*=p*a.getAlpha(v,y,b),l[g+2]=Math.min(Math.max(l[g+2]+S,0),1)}}},{key:"updateAndRenderMask",value:function(){var e=this.getMesh();e.updateDuplicateColorsAndMaterials(),e.updateDrawArrays(),this.updateRender()}},{key:"blur",value:function(){var e=this.getMesh(),t=this.getMaskedVertices();if(0!==t.length){t=e.expandsVertices(t,1),this.pushState(),this._main.getStateManager().pushVertices(t);var r=e.getMaterials(),i=t.length,n=new Float32Array(3*i);this.laplacianSmooth(t,n,r);for(var a=0;a<i;++a)r[3*t[a]+2]=n[3*a+2];this.updateAndRenderMask()}}},{key:"sharpen",value:function(){var e=this.getMesh(),t=this.getMaskedVertices();if(0!==t.length){this.pushState(),this._main.getStateManager().pushVertices(t);for(var r=e.getMaterials(),i=t.length,n=0;n<i;++n){var a=3*t[n]+2,s=r[a];r[a]=s>.5?Math.min(s+.1,1):Math.max(s-1,0)}this.updateAndRenderMask()}}},{key:"clear",value:function(){var e=this.getMesh(),t=this.getMaskedVertices();if(0!==t.length){this.pushState(),this._main.getStateManager().pushVertices(t);for(var r=e.getMaterials(),i=0,n=t.length;i<n;++i)r[3*t[i]+2]=1;this.updateAndRenderMask()}}},{key:"invert",value:function(e,t){var r=t;r||(r=this.getMesh()),e||this._main.getStateManager().pushStateCustom(this.invert.bind(this,!0,r));for(var i=r.getMaterials(),n=0,a=r.getNbVertices();n<a;++n)i[3*n+2]=1-i[3*n+2];this.updateAndRenderMask()}},{key:"remapAndMirrorIndices",value:function(e,t,r){var i=this.getMesh().getNbVertices(),n=new Uint32Array(o.Z.getMemory(4*i),0,i),a=0,s=0,l=r.length;for(a=0;a<l;++a)n[r[a]]=a;var u=2*t;for(a=0;a<u;++a){var c=a<t?0:l;e[s=4*a]=n[e[s]]+c,e[s+1]=n[e[s+1]]+c,e[s+2]=n[e[s+2]]+c;var h=e[s+3];h!==o.Z.TRI_INDEX&&(e[s+3]=n[h]+c)}var d=e.length/4;for(a=u;a<d;++a)e[s=4*a]=n[e[s]],e[s+1]=n[e[s+1]],e[s+2]=n[e[s+2]]+l,e[s+3]=n[e[s+3]]+l}},{key:"invertFaces",value:function(e){for(var t=0,r=e.length/4;t<r;++t){var i=4*t,n=e[i];e[i]=e[i+2],e[i+2]=n}}},{key:"extractFaces",value:function(e,t,r){for(var i=this.getMesh(),n=i.getFaces(),a=i.getMaterials(),s=i.getVerticesOnEdge(),l=0===this._thickness,u=e.length,c=new Uint32Array(o.Z.getMemory(4*u*4*3),0,4*u*3),h=l?u:2*u,d=0;d<u;++d){var f=4*d,p=4*e[d],_=c[f]=n[p],m=c[f+1]=n[p+1],g=c[f+2]=n[p+2],v=c[f+3]=n[p+3];if(!l){var y=v!==o.Z.TRI_INDEX,b=a[3*_+2]>=r||s[_]>=1,T=a[3*m+2]>=r||s[m]>=1,k=a[3*g+2]>=r||s[g]>=1,M=!!y&&(a[3*v+2]>=r||s[v]>=1);c[f+=4*u]=g,c[f+1]=m,c[f+2]=_,c[f+3]=v,T&&(b&&(c[f=4*h++]=c[f+3]=m,c[f+1]=c[f+2]=_),k&&(c[f=4*h++]=c[f+3]=g,c[f+1]=c[f+2]=m)),y?M&&(b&&(c[f=4*h++]=c[f+3]=_,c[f+1]=c[f+2]=v),k&&(c[f=4*h++]=c[f+3]=v,c[f+1]=c[f+2]=g)):b&&k&&(c[f=4*h++]=c[f+3]=_,c[f+1]=c[f+2]=g)}}var x=new Uint32Array(c.subarray(0,4*h));return this.remapAndMirrorIndices(x,u,t),this._thickness>0&&this.invertFaces(x),x}},{key:"extractVertices",value:function(e){var t=this.getMesh(),r=t.getVertices(),n=t.getNormals(),a=t.getMatrix(),s=i.wO.normalFromMat4(i.wO.create(),a),o=e.length,l=new Float32Array(2*o*3),u=[0,0,0],c=[0,0,0],h=3*o,d=this._thickness,f=.01;d<0&&(f=-f);for(var p=0;p<o;++p){var _=3*p,m=3*e[p];u[0]=r[m],u[1]=r[m+1],u[2]=r[m+2],c[0]=n[m],c[1]=n[m+1],c[2]=n[m+2],i.R3.transformMat3(c,c,s),i.R3.normalize(c,c),i.R3.transformMat4(u,u,a),i.R3.scaleAndAdd(u,u,c,f),l[_]=u[0],l[_+1]=u[1],l[_+2]=u[2],i.R3.scaleAndAdd(u,u,c,d),l[_+=h]=u[0],l[_+1]=u[1],l[_+2]=u[2]}return l}},{key:"smoothBorder",value:function(e,t){for(var r=2*t.length,i=new Uint32Array(e.getNbFaces()-r),n=0,a=i.length;n<a;++n)i[n]=r+n;var s=e.expandsVertices(e.getVerticesFromFaces(i),1),o=new Le;o.setToolMesh(e),o.smooth(s,1),o.smooth(s,1),o.smooth(s,1)}},{key:"extract",value:function(){var e=this.getMesh(),t=this.filterMaskedVertices(-1/0,.5);if(0!==t.length){var r=e.getFacesFromVertices(t);t=e.getVerticesFromFaces(r);var i=this.extractFaces(r,t,.5),n=this.extractVertices(t),a=new Ct(e.getGL());a.setVertices(n),a.setFaces(i),a.initColorsAndMaterials(),a.allocateArrays(),a.initTopology(),0!==this._thickness&&this.smoothBorder(a,r),a.updateGeometry(),a.updateDuplicateColorsAndMaterials(),a.copyRenderConfig(e),a.initRender();var s=this._main;s.addNewMesh(a),s.setMesh(e)}}}])&&Dt(t.prototype,r),l}(se);function Lt(e){return(Lt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Nt(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Bt(e,t){return(Bt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ut(e,t){return!t||"object"!==Lt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Zt(e){return(Zt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}const zt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Bt(e,t)}(s,e);var t,r,i,n,a=(i=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Zt(i);if(n){var r=Zt(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return Ut(this,e)});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=a.call(this,e))._radius=50,t._culling=!1,t._idAlpha=0,t}return t=s,(r=[{key:"startSculpt",value:function(){var e=this._main;if(e.getSculptManager().getSymmetry()){var t=e.getPickingSymmetry();t.intersectionMouseMesh(),t.setLocalRadius2(e.getPicking().getLocalRadius2())}}},{key:"sculptStroke",value:function(){var e=this._main,t=e._mouseX-e._lastMouseX,r=e.getPicking(),i=r.getLocalRadius2();if(r.pickVerticesInSphere(i),this.stroke(r,t),e.getSculptManager().getSymmetry()){var n=e.getPickingSymmetry();n.getMesh()&&(n.pickVerticesInSphere(i),this.stroke(n,t))}this.updateRender()}},{key:"stroke",value:function(e,t){var r=e.getPickedVertices();this._main.getStateManager().pushVertices(r),r=this.dynamicTopology(e),this._culling&&(r=this.getFrontVertices(r,e.getEyeDirection())),e.updateAlpha(!1),e.setIdAlpha(this._idAlpha),this.scale(r,e.getIntersectionPoint(),e.getLocalRadius2(),t,e);var i=this.getMesh();i.updateGeometry(i.getFacesFromVertices(r),r)}},{key:"scale",value:function(e,t,r,i,n){for(var a=this.getMesh(),s=a.getVertices(),o=a.getMaterials(),l=.01*i,u=Math.sqrt(r),c=t[0],h=t[1],d=t[2],f=0,p=e.length;f<p;++f){var _=3*e[f],m=s[_],g=s[_+1],v=s[_+2],y=m-c,b=g-h,T=v-d,k=Math.sqrt(y*y+b*b+T*T)/u,M=k*k;M=3*M*M-4*M*k+1,M*=l*o[_+2]*n.getAlpha(m,g,v),s[_]=m+y*M,s[_+1]=g+b*M,s[_+2]=v+T*M}}}])&&Nt(t.prototype,r),s}(se);var Gt=function(e,t){this.previous=null,this.next=null,this.v1=e,this.v2=t},Wt=function(e){if(!(e.length<=2)){var t=e.length,r=e[0].v1,i=e[0].v2,n=e[0],a=n;e[0]=e[--t];for(var s=0;s<t;){var o=e[s];if(o.v1===i){if(o.previous=a,a.next=o,a=o,i=e[s].v2,e[s]=e[--t],i===r)break;s=0}else s++}if(e.length=t,i===r)return n.previous=a,a.next=n,n}},jt=function(e,t,r,i,n,a){var s=e.getVertices(),l=e.getColors(),u=e.getMaterials(),c=e.getNbVertices()+i.length/3,h=t,d=0,f=0,p=0,_=0,m=0,g=0,v=0,y=0,b=0,T=0;do{var k=h.next,M=h.v1,x=h.v2,S=k.v2;r.push(M,x,c,o.Z.TRI_INDEX),x*=3,S*=3,T++,d+=s[M*=3],f+=s[M+1],p+=s[M+2],_+=l[M],m+=l[M+1],g+=l[M+2],v+=u[M],y+=u[M+1],b+=u[M+2];var A=s[x],E=s[x+1],R=s[x+2],w=s[M]-A,C=s[M+1]-E,P=s[M+2]-R,D=s[S]-A,I=s[S+1]-E,F=s[S+2]-R,O=w*w+C*C+P*P,V=D*D+I*I+F*F;h.angle=Math.acos((w*D+C*I+P*F)/Math.sqrt(O*V)),h=k}while(h!==t);i.push(d/T,f/T,p/T),n.push(_/T,m/T,g/T),a.push(v/T,y/T,b/T)},Xt=function(e,t,r,i,n){var a=new Ct;return a.setID(e.getID()),a.setVertices(t),i&&a.setColors(i),n&&a.setMaterials(n),a.setFaces(r),a.setTransformData(e.getTransformData()),a.setRenderData(e.getRenderData()),kt.OPTIMIZE=!1,a.init(),kt.OPTIMIZE=!0,a};const Ht={createClosedMesh:function(e){var t=function(e){var t=function(e){for(var t=e.getEdges(),r=e.getFaces(),i=e.getFaceEdges(),n=[],a=0,s=e.getNbFaces();a<s;++a){var l=4*a,u=i[l+3],c=u!==o.Z.TRI_INDEX;1===t[i[l]]&&n.push(new Gt(r[l],r[l+1])),1===t[i[l+1]]&&n.push(new Gt(r[l+1],r[l+2])),1===t[i[l+2]]&&n.push(new Gt(r[l+2],r[c?l+3:l])),c&&1===t[u]&&n.push(new Gt(r[l+3],r[l]))}for(var h=[];;){var d=Wt(n);if(!d)break;h.push(d)}return h}(e);if(0===t.length)return e;for(var r=[],i=[],n=[],a=[],s=0,l=t.length;s<l;++s)jt(e,t[s],r,i,n,a);var u=3*e.getNbVertices(),c=u+i.length,h=new Float32Array(c);h.set(e.getVertices().subarray(0,u));var d=new Float32Array(c);d.set(e.getColors().subarray(0,u));var f=new Float32Array(c);f.set(e.getMaterials().subarray(0,u)),c>u&&(h.set(i,u),d.set(n,u),f.set(a,u));var p=new Uint32Array(4*e.getNbFaces()+r.length);return p.set(e.getFaces()),r.length>0&&p.set(r,4*e.getNbFaces()),Xt(e,h,p,d,f)}(e);if(t===e){var r=3*e.getNbVertices(),i=4*e.getNbFaces(),n=new Uint32Array(e.getFaces().subarray(0,i)),a=new Float32Array(e.getVertices().subarray(0,r)),s=new Float32Array(e.getColors().subarray(0,r)),l=new Float32Array(e.getMaterials().subarray(0,r));t=Xt(e,a,n,s,l)}return t}};var Yt={BLOCK:!1},Kt=function(){for(var e=new Uint32Array(24),t=0,r=0;r<8;++r)for(var i=1;i<=4;i<<=1){var n=r^i;r<=n&&(e[t++]=r,e[t++]=n)}return e}(),qt=function(e){for(var t=new Uint32Array(256),r=0;r<256;++r){for(var i=0,n=0;n<24;n+=2)i|=!!(r&1<<e[n])!=!!(r&1<<e[n+1])?1<<(n>>1):0;t[r]=i}return t}(Kt),Jt=function(e,t,r,i,n,a){for(var s=e.colorField,o=e.materialField,l=e.distanceField,u=0,c=0,h=0,d=0,f=0,p=0,_=0,m=0,g=0,v=r[0],y=r[0]*r[1],b=0;b<2;++b)for(var T=0;T<2;++T)for(var k=0;k<2;++k){var M=i+k+T*v+b*y,x=3*M,S=l[M];t[g]=S,m|=S<0?1<<g:0,g++,S!==1/0&&(_+=S=Math.min(1/Math.abs(S),1e15),u+=s[x]*S,c+=s[x+1]*S,h+=s[x+2]*S,d+=o[x]*S,f+=o[x+1]*S,p+=o[x+2]*S)}return 0!==m&&255!==m&&(_>0&&(_=1/_),n.push(u*_,c*_,h*_),a.push(d*_,f*_,p*_)),m},Qt=[0,0,0],$t=function(e,t,r,i,n){Qt[0]=Qt[1]=Qt[2]=0;for(var a=0,s=0;s<12;++s)if(e&1<<s&&(++a,!Yt.BLOCK)){var o=t[s<<1],l=t[1+(s<<1)],u=r[o],c=u-r[l];if(!(Math.abs(c)<1e-7)){c=u/c;for(var h=0,d=1;h<3;++h,d<<=1){var f=o&d;Qt[h]+=f!==(l&d)?f?1-c:c:f?1:0}}}for(var p=1/a,_=0;_<3;++_)Qt[_]=i[_]+p*Qt[_];n.push(Qt[0],Qt[1],Qt[2])},er=function(e,t,r,i,n,a,s){for(var o=0;o<3;++o)if(e&1<<o){var l=(o+1)%3,u=(o+2)%3;if(0!==a[l]&&0!==a[u]){var c=i[l],h=i[u];1&t?s.push(r[n],r[n-c],r[n-c-h],r[n-h]):s.push(r[n],r[n-h],r[n-c-h],r[n-c])}}};Yt.computeSurface=function(e){var t=e.dims,r=[],i=[],n=[],a=[],s=0,o=new Int32Array(3),l=new Int32Array([1,t[0]+1,(t[0]+1)*(t[1]+1)]),u=new Float32Array(8),c=1,h=new Int32Array(2*l[2]);for(o[2]=0;o[2]<t[2]-1;++o[2],s+=t[0],c^=1,l[2]=-l[2]){var d=1+(t[0]+1)*(1+c*(t[1]+1));for(o[1]=0;o[1]<t[1]-1;++o[1],++s,d+=2)for(o[0]=0;o[0]<t[0]-1;++o[0],++s,++d){var f=Jt(e,u,t,s,i,n);if(0!==f&&255!==f){var p=qt[f];h[d]=r.length/3,$t(p,Kt,u,o,r),er(p,f,h,l,d,o,a)}}}return{colors:new Float32Array(i),materials:new Float32Array(n),vertices:new Float32Array(r),faces:new Uint32Array(a)}};const tr=Yt;var rr={BLOCK:!1},ir=new Uint32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]),nr=[[],[0,8,3],[0,1,9],[1,8,3,9,8,1],[1,2,10],[0,8,3,1,2,10],[9,2,10,0,2,9],[2,8,3,2,10,8,10,9,8],[3,11,2],[0,11,2,8,11,0],[1,9,0,2,3,11],[1,11,2,1,9,11,9,8,11],[3,10,1,11,10,3],[0,10,1,0,8,10,8,11,10],[3,9,0,3,11,9,11,10,9],[9,8,10,10,8,11],[4,7,8],[4,3,0,7,3,4],[0,1,9,8,4,7],[4,1,9,4,7,1,7,3,1],[1,2,10,8,4,7],[3,4,7,3,0,4,1,2,10],[9,2,10,9,0,2,8,4,7],[2,10,9,2,9,7,2,7,3,7,9,4],[8,4,7,3,11,2],[11,4,7,11,2,4,2,0,4],[9,0,1,8,4,7,2,3,11],[4,7,11,9,4,11,9,11,2,9,2,1],[3,10,1,3,11,10,7,8,4],[1,11,10,1,4,11,1,0,4,7,11,4],[4,7,8,9,0,11,9,11,10,11,0,3],[4,7,11,4,11,9,9,11,10],[9,5,4],[9,5,4,0,8,3],[0,5,4,1,5,0],[8,5,4,8,3,5,3,1,5],[1,2,10,9,5,4],[3,0,8,1,2,10,4,9,5],[5,2,10,5,4,2,4,0,2],[2,10,5,3,2,5,3,5,4,3,4,8],[9,5,4,2,3,11],[0,11,2,0,8,11,4,9,5],[0,5,4,0,1,5,2,3,11],[2,1,5,2,5,8,2,8,11,4,8,5],[10,3,11,10,1,3,9,5,4],[4,9,5,0,8,1,8,10,1,8,11,10],[5,4,0,5,0,11,5,11,10,11,0,3],[5,4,8,5,8,10,10,8,11],[9,7,8,5,7,9],[9,3,0,9,5,3,5,7,3],[0,7,8,0,1,7,1,5,7],[1,5,3,3,5,7],[9,7,8,9,5,7,10,1,2],[10,1,2,9,5,0,5,3,0,5,7,3],[8,0,2,8,2,5,8,5,7,10,5,2],[2,10,5,2,5,3,3,5,7],[7,9,5,7,8,9,3,11,2],[9,5,7,9,7,2,9,2,0,2,7,11],[2,3,11,0,1,8,1,7,8,1,5,7],[11,2,1,11,1,7,7,1,5],[9,5,8,8,5,7,10,1,3,10,3,11],[5,7,0,5,0,9,7,11,0,1,0,10,11,10,0],[11,10,0,11,0,3,10,5,0,8,0,7,5,7,0],[11,10,5,7,11,5],[10,6,5],[0,8,3,5,10,6],[9,0,1,5,10,6],[1,8,3,1,9,8,5,10,6],[1,6,5,2,6,1],[1,6,5,1,2,6,3,0,8],[9,6,5,9,0,6,0,2,6],[5,9,8,5,8,2,5,2,6,3,2,8],[2,3,11,10,6,5],[11,0,8,11,2,0,10,6,5],[0,1,9,2,3,11,5,10,6],[5,10,6,1,9,2,9,11,2,9,8,11],[6,3,11,6,5,3,5,1,3],[0,8,11,0,11,5,0,5,1,5,11,6],[3,11,6,0,3,6,0,6,5,0,5,9],[6,5,9,6,9,11,11,9,8],[5,10,6,4,7,8],[4,3,0,4,7,3,6,5,10],[1,9,0,5,10,6,8,4,7],[10,6,5,1,9,7,1,7,3,7,9,4],[6,1,2,6,5,1,4,7,8],[1,2,5,5,2,6,3,0,4,3,4,7],[8,4,7,9,0,5,0,6,5,0,2,6],[7,3,9,7,9,4,3,2,9,5,9,6,2,6,9],[3,11,2,7,8,4,10,6,5],[5,10,6,4,7,2,4,2,0,2,7,11],[0,1,9,4,7,8,2,3,11,5,10,6],[9,2,1,9,11,2,9,4,11,7,11,4,5,10,6],[8,4,7,3,11,5,3,5,1,5,11,6],[5,1,11,5,11,6,1,0,11,7,11,4,0,4,11],[0,5,9,0,6,5,0,3,6,11,6,3,8,4,7],[6,5,9,6,9,11,4,7,9,7,11,9],[10,4,9,6,4,10],[4,10,6,4,9,10,0,8,3],[10,0,1,10,6,0,6,4,0],[8,3,1,8,1,6,8,6,4,6,1,10],[1,4,9,1,2,4,2,6,4],[3,0,8,1,2,9,2,4,9,2,6,4],[0,2,4,4,2,6],[8,3,2,8,2,4,4,2,6],[10,4,9,10,6,4,11,2,3],[0,8,2,2,8,11,4,9,10,4,10,6],[3,11,2,0,1,6,0,6,4,6,1,10],[6,4,1,6,1,10,4,8,1,2,1,11,8,11,1],[9,6,4,9,3,6,9,1,3,11,6,3],[8,11,1,8,1,0,11,6,1,9,1,4,6,4,1],[3,11,6,3,6,0,0,6,4],[6,4,8,11,6,8],[7,10,6,7,8,10,8,9,10],[0,7,3,0,10,7,0,9,10,6,7,10],[10,6,7,1,10,7,1,7,8,1,8,0],[10,6,7,10,7,1,1,7,3],[1,2,6,1,6,8,1,8,9,8,6,7],[2,6,9,2,9,1,6,7,9,0,9,3,7,3,9],[7,8,0,7,0,6,6,0,2],[7,3,2,6,7,2],[2,3,11,10,6,8,10,8,9,8,6,7],[2,0,7,2,7,11,0,9,7,6,7,10,9,10,7],[1,8,0,1,7,8,1,10,7,6,7,10,2,3,11],[11,2,1,11,1,7,10,6,1,6,7,1],[8,9,6,8,6,7,9,1,6,11,6,3,1,3,6],[0,9,1,11,6,7],[7,8,0,7,0,6,3,11,0,11,6,0],[7,11,6],[7,6,11],[3,0,8,11,7,6],[0,1,9,11,7,6],[8,1,9,8,3,1,11,7,6],[10,1,2,6,11,7],[1,2,10,3,0,8,6,11,7],[2,9,0,2,10,9,6,11,7],[6,11,7,2,10,3,10,8,3,10,9,8],[7,2,3,6,2,7],[7,0,8,7,6,0,6,2,0],[2,7,6,2,3,7,0,1,9],[1,6,2,1,8,6,1,9,8,8,7,6],[10,7,6,10,1,7,1,3,7],[10,7,6,1,7,10,1,8,7,1,0,8],[0,3,7,0,7,10,0,10,9,6,10,7],[7,6,10,7,10,8,8,10,9],[6,8,4,11,8,6],[3,6,11,3,0,6,0,4,6],[8,6,11,8,4,6,9,0,1],[9,4,6,9,6,3,9,3,1,11,3,6],[6,8,4,6,11,8,2,10,1],[1,2,10,3,0,11,0,6,11,0,4,6],[4,11,8,4,6,11,0,2,9,2,10,9],[10,9,3,10,3,2,9,4,3,11,3,6,4,6,3],[8,2,3,8,4,2,4,6,2],[0,4,2,4,6,2],[1,9,0,2,3,4,2,4,6,4,3,8],[1,9,4,1,4,2,2,4,6],[8,1,3,8,6,1,8,4,6,6,10,1],[10,1,0,10,0,6,6,0,4],[4,6,3,4,3,8,6,10,3,0,3,9,10,9,3],[10,9,4,6,10,4],[4,9,5,7,6,11],[0,8,3,4,9,5,11,7,6],[5,0,1,5,4,0,7,6,11],[11,7,6,8,3,4,3,5,4,3,1,5],[9,5,4,10,1,2,7,6,11],[6,11,7,1,2,10,0,8,3,4,9,5],[7,6,11,5,4,10,4,2,10,4,0,2],[3,4,8,3,5,4,3,2,5,10,5,2,11,7,6],[7,2,3,7,6,2,5,4,9],[9,5,4,0,8,6,0,6,2,6,8,7],[3,6,2,3,7,6,1,5,0,5,4,0],[6,2,8,6,8,7,2,1,8,4,8,5,1,5,8],[9,5,4,10,1,6,1,7,6,1,3,7],[1,6,10,1,7,6,1,0,7,8,7,0,9,5,4],[4,0,10,4,10,5,0,3,10,6,10,7,3,7,10],[7,6,10,7,10,8,5,4,10,4,8,10],[6,9,5,6,11,9,11,8,9],[3,6,11,0,6,3,0,5,6,0,9,5],[0,11,8,0,5,11,0,1,5,5,6,11],[6,11,3,6,3,5,5,3,1],[1,2,10,9,5,11,9,11,8,11,5,6],[0,11,3,0,6,11,0,9,6,5,6,9,1,2,10],[11,8,5,11,5,6,8,0,5,10,5,2,0,2,5],[6,11,3,6,3,5,2,10,3,10,5,3],[5,8,9,5,2,8,5,6,2,3,8,2],[9,5,6,9,6,0,0,6,2],[1,5,8,1,8,0,5,6,8,3,8,2,6,2,8],[1,5,6,2,1,6],[1,3,6,1,6,10,3,8,6,5,6,9,8,9,6],[10,1,0,10,0,6,9,5,0,5,6,0],[0,3,8,5,6,10],[10,5,6],[11,5,10,7,5,11],[11,5,10,11,7,5,8,3,0],[5,11,7,5,10,11,1,9,0],[10,7,5,10,11,7,9,8,1,8,3,1],[11,1,2,11,7,1,7,5,1],[0,8,3,1,2,7,1,7,5,7,2,11],[9,7,5,9,2,7,9,0,2,2,11,7],[7,5,2,7,2,11,5,9,2,3,2,8,9,8,2],[2,5,10,2,3,5,3,7,5],[8,2,0,8,5,2,8,7,5,10,2,5],[9,0,1,5,10,3,5,3,7,3,10,2],[9,8,2,9,2,1,8,7,2,10,2,5,7,5,2],[1,3,5,3,7,5],[0,8,7,0,7,1,1,7,5],[9,0,3,9,3,5,5,3,7],[9,8,7,5,9,7],[5,8,4,5,10,8,10,11,8],[5,0,4,5,11,0,5,10,11,11,3,0],[0,1,9,8,4,10,8,10,11,10,4,5],[10,11,4,10,4,5,11,3,4,9,4,1,3,1,4],[2,5,1,2,8,5,2,11,8,4,5,8],[0,4,11,0,11,3,4,5,11,2,11,1,5,1,11],[0,2,5,0,5,9,2,11,5,4,5,8,11,8,5],[9,4,5,2,11,3],[2,5,10,3,5,2,3,4,5,3,8,4],[5,10,2,5,2,4,4,2,0],[3,10,2,3,5,10,3,8,5,4,5,8,0,1,9],[5,10,2,5,2,4,1,9,2,9,4,2],[8,4,5,8,5,3,3,5,1],[0,4,5,1,0,5],[8,4,5,8,5,3,9,0,5,0,3,5],[9,4,5],[4,11,7,4,9,11,9,10,11],[0,8,3,4,9,7,9,11,7,9,10,11],[1,10,11,1,11,4,1,4,0,7,4,11],[3,1,4,3,4,8,1,10,4,7,4,11,10,11,4],[4,11,7,9,11,4,9,2,11,9,1,2],[9,7,4,9,11,7,9,1,11,2,11,1,0,8,3],[11,7,4,11,4,2,2,4,0],[11,7,4,11,4,2,8,3,4,3,2,4],[2,9,10,2,7,9,2,3,7,7,4,9],[9,10,7,9,7,4,10,2,7,8,7,0,2,0,7],[3,7,10,3,10,2,7,4,10,1,10,0,4,0,10],[1,10,2,8,7,4],[4,9,1,4,1,7,7,1,3],[4,9,1,4,1,7,0,8,1,8,7,1],[4,0,3,7,4,3],[4,8,7],[9,10,8,10,11,8],[3,0,9,3,9,11,11,9,10],[0,1,10,0,10,8,8,10,11],[3,1,10,11,3,10],[1,2,11,1,11,9,9,11,8],[3,0,9,3,9,11,1,2,9,2,11,9],[0,2,11,8,0,11],[3,2,11],[2,3,8,2,8,10,10,8,9],[9,10,2,0,9,2],[2,3,8,2,8,10,0,1,8,1,10,8],[1,10,2],[1,3,8,9,1,8],[0,9,1],[0,3,8],[]],ar=[[0,0,0],[1,0,0],[1,1,0],[0,1,0],[0,0,1],[1,0,1],[1,1,1],[0,1,1]],sr=[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[0,4],[1,5],[2,6],[3,7]],or=function(e,t,r,i,n,a){for(var s=e.colorField,o=e.materialField,l=e.distanceField,u=0,c=0,h=0,d=0,f=0,p=0,_=0,m=0,g=r[0],v=r[0]*r[1],y=0;y<8;++y){var b=ar[y],T=i+b[0]+b[1]*g+b[2]*v,k=3*T,M=l[T];t[y]=M,m|=M>0?1<<y:0,M!==1/0&&(_+=M=Math.min(1/Math.abs(M),1e15),u+=s[k]*M,c+=s[k+1]*M,h+=s[k+2]*M,d+=o[k]*M,f+=o[k+1]*M,p+=o[k+2]*M)}return 0!==ir[m]&&(_>0&&(_=1/_),n[0]=u*_,n[1]=c*_,n[2]=h*_,a[0]=d*_,a[1]=f*_,a[2]=p*_),m};rr.computeSurface=function(e){var t=e.dims,r=new Map,i=[],n=[],a=[],s=[],l=0,u=new Int32Array(3),c=new Float32Array(8),h=new Array(12),d=new Float32Array(3),f=new Float32Array(3),p=new Float32Array(3);for(u[2]=0;u[2]<t[2]-1;++u[2],l+=t[0])for(u[1]=0;u[1]<t[1]-1;++u[1],++l)for(u[0]=0;u[0]<t[0]-1;++u[0],++l){var _=or(e,c,t,l,f,p),m=ir[_];if(0!==m){for(var g=0;g<12;++g)if(m&1<<g){var v=sr[g],y=ar[v[0]],b=ar[v[1]],T=c[v[0]],k=T-c[v[1]],M=0;Math.abs(k)>1e-6&&(M=T/k);for(var x=0;x<3;++x)d[x]=u[x]+y[x]+M*(b[x]-y[x]);var S=d[0]+"+"+d[1]+"+"+d[2],A=r.get(S);A>=0?h[g]=A:(h[g]=i.length/3,r.set(S,h[g]),i.push(d[0],d[1],d[2]),n.push(f[0],f[1],f[2]),a.push(p[0],p[1],p[2]))}for(var E=nr[_],R=0;R<E.length;R+=3)s.push(h[E[R]],h[E[R+1]],h[E[R+2]],o.Z.TRI_INDEX)}}return{colors:new Float32Array(n),materials:new Float32Array(a),vertices:new Float32Array(i),faces:new Uint32Array(s)}};const lr=rr;var ur={RESOLUTION:150,BLOCK:!1,SMOOTHING:!0},cr=function(e,t){for(var r=t.min,i=t.step,n=t.dims,a=1/i,s=r[0],o=r[1],l=r[2],u=n[0],c=u*n[1],h=t.distanceField,d=t.crossedEdges,f=t.colorField,p=t.materialField,_=e.getTriangles(),m=e.getVertices(),g=e.getColors(),v=e.getMaterials(),y=e.getNbTriangles(),b=[0,0,0],T=[0,0,0],k=[0,0,0],M=[0,0,0],x=[0,0,0],S=[0,0,0],A=[0,0,0,0],E=[[1,0,0],[0,1,0],[0,0,1]],R=1/3,w=0;w<y;++w)for(var C=3*w,P=3*_[C],D=3*_[C+1],I=3*_[C+2],F=b[0]=m[P],O=b[1]=m[P+1],V=b[2]=m[P+2],L=T[0]=m[D],N=T[1]=m[D+1],B=T[2]=m[D+2],U=k[0]=m[I],Z=k[1]=m[I+1],z=k[2]=m[I+2],G=(g[P]+g[D]+g[I])*R,W=(g[P+1]+g[D+1]+g[I+1])*R,j=(g[P+2]+g[D+2]+g[I+2])*R,X=(v[P]+v[D]+v[I])*R,H=(v[P+1]+v[D+1]+v[I+1])*R,Y=(v[P+2]+v[D+2]+v[I+2])*R,K=F<L?F<U?F:U:L<U?L:U,q=F>L?F>U?F:U:L>U?L:U,J=O<N?O<Z?O:Z:N<Z?N:Z,Q=O>N?O>Z?O:Z:N>Z?N:Z,$=V<B?V<z?V:z:B<z?B:z,ee=V>B?V>z?V:z:B>z?B:z,te=M[0]=L-F,re=M[1]=N-O,ie=M[2]=B-V,ne=x[0]=U-F,ae=x[1]=Z-O,se=x[2]=z-V,oe=te*te+re*re+ie*ie,le=te*ne+re*ae+ie*se,ue=ne*ne+ae*ae+se*se,ce=Math.floor((K-s)*a),he=Math.floor((J-o)*a),de=Math.floor(($-l)*a),fe=Math.ceil((q-s)*a),pe=Math.ceil((Q-o)*a),_e=Math.ceil((ee-l)*a),me=de;me<=_e;++me)for(var ge=he;ge<=pe;++ge)for(var ve=ce;ve<=fe;++ve){var ye=s+ve*i,be=o+ge*i,Te=l+me*i,ke=ve+ge*u+me*c;S[0]=ye,S[1]=be,S[2]=Te;var Me=Se.Z.distance2PointTriangleEdges(S,M,x,b,oe,le,ue,A);if((Me=Math.sqrt(Me))<h[ke]){h[ke]=Me;var xe=3*ke;f[xe]=G,f[xe+1]=W,f[xe+2]=j,p[xe]=X,p[xe+1]=H,p[xe+2]=Y}if(!(Me>i))for(var Ae=0;Ae<3;++Ae){var Ee=A[Ae]-S[Ae];if(!(Ee<0||Ee>i)){var Re=3*ke+Ae;if(1!==d[Re]){var we=Se.Z.intersectionRayTriangleEdges(S,E[Ae],M,x,b);we<0||we>i||(d[Re]=1)}}}}},hr=function(e,t,r,i,n){var a=new Ct(e.getGL());return a.setID(e.getID()),a.setFaces(t),a.setVertices(r),i&&a.setColors(i),n&&a.setMaterials(n),a.setRenderData(e.getRenderData()),a.init(),a.initRender(),a};ur.remesh=function(e,t,r){console.time("remesh total"),console.time("1. prepareMeshes");var n=function(e){for(var t=[1/0,1/0,1/0,-1/0,-1/0,-1/0],r=[0,0,0],n=0,a=e.length;n<a;++n){var o=e[n];o.isUsingTexCoords()&&o.setShaderType(s.Z.Shader.MATCAP);for(var l=o.getMatrix(),u=(o=e[n]=Ht.createClosedMesh(o)).getVertices(),c=0,h=o.getNbVertices();c<h;++c){var d=3*c;r[0]=u[d],r[1]=u[d+1],r[2]=u[d+2],i.R3.transformMat4(r,r,l);var f=u[d]=r[0],p=u[d+1]=r[1],_=u[d+2]=r[2];f<t[0]&&(t[0]=f),p<t[1]&&(t[1]=p),_<t[2]&&(t[2]=_),f>t[3]&&(t[3]=f),p>t[4]&&(t[4]=p),_>t[5]&&(t[5]=_)}}return t}(e=e.slice());console.timeEnd("1. prepareMeshes"),console.time("2. voxelization");for(var a,l=function(e){for(var t=Math.max(e[3]-e[0],e[4]-e[1],e[5]-e[2])/ur.RESOLUTION,r=1.51*t,i=1.51*t,n=[e[0]-r,e[1]-r,e[2]-r],a=[e[3]+i,e[4]+i,e[5]+i],s=Math.ceil((a[0]-n[0])/t),l=Math.ceil((a[1]-n[1])/t),u=Math.ceil((a[2]-n[2])/t),c=s*l*u,h=o.Z.getMemory(31*c),d=new Float32Array(h,0,c),f=new Float32Array(h,4*c,3*c),p=new Float32Array(h,16*c,3*c),_=new Uint8Array(h,28*c,3*c),m=0;m<c;++m)d[m]=1/0;for(var g=0,v=3*c;g<v;++g)_[g]=0;for(var y=0,b=3*c;y<b;++y)f[y]=p[y]=-1;var T={};return T.dims=[s,l,u],T.step=t,T.min=n,T.max=a,T.crossedEdges=_,T.distanceField=d,T.colorField=f,T.materialField=p,T}(n),u=0,c=e.length;u<c;++u)cr(e[u],l);console.timeEnd("2. voxelization"),console.time("3. flood"),function(e){var t=e.step,r=e.dims,i=r[0],n=i*r[1],a=e.crossedEdges,s=e.distanceField,o=s.length,l=new Uint8Array(o),u=new Int32Array(o);u[0]=0;for(var c=1,h=[-1,1,-i,i,-n,n],d=[0,0,1,1,2,2],f=h.length,p=0,_=0;c>0;){var m=u[--c];if(s[m]<t)for(p=0;p<f;++p){var g=h[p];(_=m+g)>=o||_<0||1!==l[_]&&s[_]!==1/0&&0===a[3*(g>=0?m:_)+d[p]]&&(l[_]=1,u[c++]=_)}else for(p=0;p<f;++p)(_=m+h[p])>=o||_<0||1!==l[_]&&(l[_]=1,u[c++]=_)}for(var v=0;v<o;++v)0===s[v]&&console.log("hit"),0===l[v]&&(s[v]=-s[v])}(l),console.timeEnd("3. flood"),r?(console.time("4. marchingCubes"),lr.BLOCK=ur.BLOCK,a=lr.computeSurface(l),console.timeEnd("4. marchingCubes")):(console.time("4. surfaceNets"),tr.BLOCK=ur.BLOCK,a=tr.computeSurface(l),console.timeEnd("4. surfaceNets")),console.time("5. createMesh");var h=hr(t,a.faces,a.vertices,a.colors,a.materials);return console.timeEnd("5. createMesh"),function(e,t){var r=[t[0],t[1],t[2]],n=[t[3],t[4],t[5]],a=i.R3.dist(r,n),s=i.R3.add([],r,n);i.R3.scale(s,s,.5);var o=e.getLocalBound(),l=[o[0],o[1],o[2]],u=[o[3],o[4],o[5]],c=i.R3.dist(l,u),h=i.R3.add([],l,u);i.R3.scale(h,h,.5);var d=a/c,f=i.R3.scale([],s,1/d);i.R3.sub(f,f,h);var p=e.getMatrix();i._E.identity(p),i._E.scale(p,p,[d,d,d]),i._E.translate(p,p,f)}(h,n),r&&ur.SMOOTHING&&(console.time("6. tangential smoothing"),function(e){for(var t=e.getNbVertices(),r=new Uint32Array(t),i=0;i<t;++i)r[i]=i;var n=new Le;n.setToolMesh(e),n.smoothTangent(r,1),e.updateGeometry(),e.updateGeometryBuffers()}(h),console.timeEnd("6. tangential smoothing")),console.timeEnd("remesh total"),console.log("\n"),h},ur.mergeArrays=function(e,t){var r,n,a=0,s=0,l=0,u=0,c=e.length,h=0;for(r=0;r<c;++r)a+=e[r].getNbVertices(),s+=e[r].getNbFaces(),l+=e[r].getNbQuads(),u+=e[r].getNbTriangles();t.nbVertices=a,t.nbFaces=s,t.nbQuads=l,t.nbTriangles=u;var d=t.vertices=void 0!==t.vertices?new Float32Array(3*a):null,f=t.colors=void 0!==t.colors?new Float32Array(3*a):null,p=t.materials=void 0!==t.materials?new Float32Array(3*a):null,_=t.faces=void 0!==t.faces?new Uint32Array(4*s):null,m=t.triangles=void 0!==t.triangles?new Uint32Array(3*u):null,g=[0,0,0],v=0,y=0,b=0,T=0;for(r=0;r<c;++r){var k=e[r],M=k.getVertices(),x=k.getColors(),S=k.getMaterials(),A=k.getFaces(),E=k.getTriangles(),R=k.getNbVertices(),w=k.getNbFaces(),C=k.getNbTriangles(),P=k.getMatrix();for(n=0;n<R;++n)h=3*n,g[0]=M[h],g[1]=M[h+1],g[2]=M[h+2],i.R3.transformMat4(g,g,P),d[v+h]=g[0],d[v+h+1]=g[1],d[v+h+2]=g[2],f&&(f[v+h]=x[h],f[v+h+1]=x[h+1],f[v+h+2]=x[h+2]),p&&(p[v+h]=S[h],p[v+h+1]=S[h+1],p[v+h+2]=S[h+2]);if(v+=3*R,_)for(n=0;n<w;++n)_[y+(h=4*n)]=A[h]+T,_[y+h+1]=A[h+1]+T,_[y+h+2]=A[h+2]+T,_[y+h+3]=A[h+3]===o.Z.TRI_INDEX?o.Z.TRI_INDEX:A[h+3]+T;if(m)for(n=0;n<C;++n)m[b+(h=3*n)]=E[h]+T,m[b+h+1]=E[h+1]+T,m[b+h+2]=E[h+2]+T;T+=R,y+=4*w,b+=3*C}return t},ur.mergeMeshes=function(e,t){var r={vertices:null,colors:null,materials:null,faces:null};return ur.mergeArrays(e,r),hr(t,r.faces,r.vertices,r.colors,r.materials)};const dr=ur;var fr={},pr=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-.5,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-.5,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:1,u=new Float32Array(4);u[0]=0,u[1]=1,u[2]=2,u[3]=3;var c=new Float32Array(12);return c[0]=e,c[1]=t,c[2]=r,c[3]=e+i,c[4]=t+n,c[5]=r+a,c[6]=e+i+s,c[7]=t+n+o,c[8]=r+a+l,c[9]=e+s,c[10]=t+o,c[11]=r+l,{faces:u,vertices:c}},_r=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=new Float32Array(24);t[1]=t[2]=t[4]=t[6]=t[7]=t[9]=t[10]=t[11]=t[14]=t[18]=t[21]=t[23]=.5*-e,t[0]=t[3]=t[5]=t[8]=t[12]=t[13]=t[15]=t[16]=t[17]=t[19]=t[20]=t[22]=.5*e;var r=new Float32Array(28);r[0]=r[6]=r[8]=r[10]=r[11]=r[13]=r[16]=r[23]=r[25]=.5,r[1]=r[3]=1,r[2]=r[4]=r[9]=r[12]=r[14]=r[15]=r[18]=.25,r[5]=r[7]=r[21]=r[24]=r[26]=r[27]=.75,r[17]=r[19]=r[20]=r[22]=0;var i=new Uint32Array(24),n=new Uint32Array(24);return i[0]=i[8]=i[21]=n[0]=0,i[1]=i[11]=i[12]=n[1]=1,i[2]=i[15]=i[16]=n[2]=n[15]=n[16]=2,i[3]=i[19]=i[22]=n[3]=n[19]=n[22]=3,i[4]=i[9]=i[20]=n[4]=n[9]=4,i[7]=i[10]=i[13]=n[5]=n[18]=n[23]=5,i[6]=i[14]=i[17]=n[6]=n[14]=n[17]=6,i[5]=i[18]=i[23]=n[7]=n[10]=7,n[8]=8,n[11]=9,n[12]=10,n[13]=11,n[20]=12,n[21]=13,{vertices:t,uv:r,faces:i,facesUV:n}},mr=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:64,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:64,a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],l=a&&0===e,u=s&&0===t,c=.5*r,h=(n+1)*i,d=n*i;a&&(h+=1,d+=i),s&&(h+=1,d+=i),(l||u)&&(h-=i,d-=i);var f,p=new Float32Array(3*h),_=new Uint32Array(4*d),m=0,g=0,v=0,y=0,b=l?1:0,T=u?n-1:n;for(v=b;v<=T;v++){var k=v/n,M=k*(t-e)+e;for(y=0;y<i;y++){var x=2*Math.PI*y/i;p[g=3*m++]=M*Math.sin(x),p[g+1]=-k*r+c,p[g+2]=M*Math.cos(x)}}for(m=0,y=0;y<i;y++){var S=y===i-1?0:y+1;for(v=b;v<T;v++)_[g=4*m++]=i*v+y,_[g+1]=i*(v+1)+y,_[g+2]=i*(v+1)+S,_[g+3]=i*v+S}if(a)for(p[3*(f=(s?p.length-6:p.length-3)/3)+1]=c,y=0;y<i;y++)_[g=4*m++]=y,_[g+1]=y===i-1?0:y+1,_[g+2]=f,_[g+3]=o.Z.TRI_INDEX;if(s){p[3*(f=(p.length-3)/3)+1]=-c,l&&--v;var A=i*v;for(y=0;y<i;y++)_[g=4*m++]=y===i-1?A:A+y+1,_[g+1]=A+y,_[g+2]=f,_[g+3]=o.Z.TRI_INDEX}return{vertices:p,faces:_}},gr=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2*Math.PI,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:128,a=2*Math.PI-r<.01,s=i*n,l=s;a||(s+=2,l+=i);var u=a?n:n-1,c=new Float32Array(3*s),h=new Uint32Array(4*l),d=0,f=0,p=0,_=0;for(p=0;p<n;++p)for(_=0;_<i;++_){var m=p/u*r,g=_/i*Math.PI*2;c[f=3*d++]=(e+t*Math.cos(g))*Math.cos(m),c[f+1]=t*Math.sin(g),c[f+2]=(e+t*Math.cos(g))*Math.sin(m)}for(d=0,p=0;p<u;++p){var v=p===n-1?0:p+1;for(_=0;_<i;++_){h[f=4*d++]=i*p+_;var y=_===i-1?0:_+1;h[f+1]=i*p+y,h[f+2]=i*v+y,h[f+3]=i*v+_}}if(!a){var b=(c.length-6)/3;for(c[3*b]=e,_=0;_<i;_++)h[f=4*d++]=b,h[f+1]=_===i-1?0:_+1,h[f+2]=_,h[f+3]=o.Z.TRI_INDEX;c[3*++b]=e*Math.cos(r),c[3*b+2]=e*Math.sin(r);var T=i*p;for(_=0;_<i;_++)h[f=4*d++]=b,h[f+1]=T+_,h[f+2]=_===i-1?T:T+_+1,h[f+3]=o.Z.TRI_INDEX}return{vertices:c,faces:h}},vr=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-.5,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-.5,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:1,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:20,c=arguments.length>10&&void 0!==arguments[10]?arguments[10]:u;u+=2,c+=2;var h=new Float32Array(2*(u+c)*3),d=0,f=0,p=i/(u-1),_=n/(u-1),m=a/(u-1),g=e+i+s,v=t+n+o,y=r+a+l;for(d=0;d<u;++d)h[f=6*d]=e+p*d,h[f+1]=t+_*d,h[f+2]=r+m*d,h[f+3]=g-p*(u-d-1),h[f+4]=v-_*(u-d-1),h[f+5]=y-m*(u-d-1);for(p=s/(c-1),_=o/(c-1),m=l/(c-1),d=0;d<c;++d)h[f=6*(u+d)]=e+p*d,h[f+1]=t+_*d,h[f+2]=r+m*d,h[f+3]=g-p*(c-d-1),h[f+4]=v-_*(c-d-1),h[f+5]=y-m*(c-d-1);return{vertices:h}},yr=function(e,t){var r=new Ct(e);return r.setVertices(t.vertices),t.faces&&r.setFaces(t.faces),t.uv&&t.facesUV&&r.initTexCoordsDataFromOBJData(t.uv,t.facesUV),r.init(),e&&r.initRender(),r},br=Array.prototype.slice;fr.createGrid=function(e){var t=yr(e,vr.apply(this,br.call(arguments,1)));return e&&(t.setMode(e.LINES),t.setUseDrawArrays(!0),t.setAlreadyDrawArrays()),t},fr.createCube=function(e){return yr(e,_r.apply(this,br.call(arguments,1)))},fr.createCylinder=function(e){return yr(e,mr.apply(this,br.call(arguments,1)))},fr.createTorus=function(e){return yr(e,gr.apply(this,br.call(arguments,1)))},fr.createPlane=function(e){return yr(e,pr.apply(this,br.call(arguments,1)))},fr.createArrow=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.2,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:4,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,o=yr(null,mr(t,t,r,a,s)),l=yr(null,mr(0,t*i,r*n,a,s));l.getMatrix()[13]=.5*r;var u={vertices:null,faces:null};return dr.mergeArrays([o,l],u),yr(e,u)},fr.createLine2D=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=yr(e,{vertices:new Float32Array([t,r,0,i,n,0])});return e&&(a.setMode(e.LINES),a.setUseDrawArrays(!0),a.setAlreadyDrawArrays()),a};const Tr=fr;function kr(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Mr=i.R3.fromValues(.7,.2,.2),xr=i.R3.fromValues(.2,.7,.2),Sr=i.R3.fromValues(.2,.2,.7),Ar=i.R3.fromValues(.4,.4,.4),Er=i.R3.fromValues(.8,.4,.2),Rr=.02,wr=i.gf.create(),Cr=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return{_finalMatrix:i._E.create(),_baseMatrix:i._E.create(),_color:i.R3.create(),_colorSelect:i.R3.fromValues(1,1,0),_drawGeo:null,_pickGeo:null,_isSelected:!1,_type:e,_nbAxis:t,_lastInter:[0,0,0],updateMatrix:function(){i._E.copy(this._drawGeo.getMatrix(),this._finalMatrix),i._E.copy(this._pickGeo.getMatrix(),this._finalMatrix)},updateFinalMatrix:function(e){i._E.mul(this._finalMatrix,e,this._baseMatrix)}}},Pr=1024,Dr=2048,Ir=4096,Fr=8192,Or=15360;const Vr=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=t,this._gl=t._gl,this._activatedType=e.TRANS_XYZ|e.ROT_XYZ|e.PLANE_XYZ|e.SCALE_XYZW|e.ROT_W,this._transX=Cr(e.TRANS_X,0),this._transY=Cr(e.TRANS_Y,1),this._transZ=Cr(e.TRANS_Z,2),this._planeX=Cr(e.PLANE_X,0),this._planeY=Cr(e.PLANE_Y,1),this._planeZ=Cr(e.PLANE_Z,2),this._scaleX=Cr(e.SCALE_X,0),this._scaleY=Cr(e.SCALE_Y,1),this._scaleZ=Cr(e.SCALE_Z,2),this._scaleW=Cr(e.SCALE_W),this._rotX=Cr(e.ROT_X,0),this._rotY=Cr(e.ROT_Y,1),this._rotZ=Cr(e.ROT_Z,2),this._rotW=Cr(e.ROT_W),this._lineHelper=Tr.createLine2D(this._gl),this._lineHelper.setShaderType(s.Z.Shader.FLAT),this._lastDistToEye=0,this._isEditing=!1,this._selected=null,this._pickables=[],this._editLineOrigin=[0,0,0],this._editLineDirection=[0,0,0],this._editOffset=[0,0,0],this._rotStartVec=i.R3.create(),this._rotCurVec=i.R3.create(),this._rotAxisWorld=i.R3.create(),this._rotPlaneOrigin=i.R3.create(),this._editLocal=[],this._editTrans=i._E.create(),this._editScaleRot=[],this._editLocalInv=[],this._editTransInv=i._E.create(),this._editScaleRotInv=[],this._spaceMode=0,this._spaceMatrix=i._E.create(),this._spaceMatrixInv=i._E.create(),this._staticNormal=i.R3.create(),this._hasStaticNormal=!1,this._initTranslate(),this._initRotate(),this._initScale(),this._initPickables()}var t,r,n;return t=e,n=[{key:"TRANS_X",get:function(){return 1}},{key:"TRANS_Y",get:function(){return 2}},{key:"TRANS_Z",get:function(){return 4}},{key:"ROT_X",get:function(){return 8}},{key:"ROT_Y",get:function(){return 16}},{key:"ROT_Z",get:function(){return 32}},{key:"ROT_W",get:function(){return 64}},{key:"PLANE_X",get:function(){return 128}},{key:"PLANE_Y",get:function(){return 256}},{key:"PLANE_Z",get:function(){return 512}},{key:"SCALE_X",get:function(){return Pr}},{key:"SCALE_Y",get:function(){return Dr}},{key:"SCALE_Z",get:function(){return Ir}},{key:"SCALE_W",get:function(){return Fr}},{key:"TRANS_XYZ",get:function(){return 7}},{key:"ROT_XYZ",get:function(){return 56}},{key:"PLANE_XYZ",get:function(){return 896}},{key:"SCALE_XYZW",get:function(){return Or}},{key:"SPACE_WORLD",get:function(){return 0}},{key:"SPACE_LOCAL",get:function(){return 1}},{key:"SPACE_NORMAL",get:function(){return 2}}],(r=[{key:"setActivatedType",value:function(e){this._activatedType=e,this._initPickables()}},{key:"setSpaceMode",value:function(e){this._spaceMode=e,this._updateMatrices(),this._main.render()}},{key:"_setSpaceMatrixFromAxes",value:function(e,t,r){var n=this._spaceMatrix;i._E.identity(n),n[0]=e[0],n[1]=e[1],n[2]=e[2],n[4]=t[0],n[5]=t[1],n[6]=t[2],n[8]=r[0],n[9]=r[1],n[10]=r[2],i._E.invert(this._spaceMatrixInv,n)}},{key:"_setSpaceMatrixOrthonormalFromMatrix",value:function(e){var t,r=i.R3.fromValues(e[0],e[1],e[2]),n=i.R3.fromValues(e[4],e[5],e[6]);i.R3.normalize(r,r);var a=i.R3.create();i.R3.scale(a,r,i.R3.dot(n,r)),i.R3.sub(n,n,a),0===i.R3.len(n)&&(n=i.R3.fromValues(e[4],e[5],e[6])),i.R3.normalize(n,n),t=i.R3.cross(i.R3.create(),r,n),0===i.R3.len(t)&&(t=i.R3.fromValues(e[8],e[9],e[10])),i.R3.normalize(t,t),i.R3.cross(n,t,r),i.R3.normalize(n,n),this._setSpaceMatrixFromAxes(r,n,t)}},{key:"_updateSpaceMatrices",value:function(e){if(0===this._spaceMode)return i._E.identity(this._spaceMatrix),void i._E.identity(this._spaceMatrixInv);var t=this._main.getSelectedMeshes()[0]||this._main.getMesh();if(!t)return i._E.identity(this._spaceMatrix),void i._E.identity(this._spaceMatrixInv);if(1!==this._spaceMode){var r;if(this._isEditing&&this._hasStaticNormal)r=this._staticNormal;else{var n=this._main.getPicking();n.computePickedNormal(),r=n.getPickedNormal()}if(0!==i.R3.len(r)){var a=i.R3.fromValues(r[0],r[1],r[2]),s=i._E.clone(t.getMatrix());s[12]=s[13]=s[14]=0,i.R3.transformMat4(a,a,s),i.R3.normalize(a,a),p=t.getMatrix();var o=i.R3.fromValues(p[0],p[1],p[2]),l=i.R3.fromValues(p[4],p[5],p[6]);i.R3.normalize(o,o),i.R3.normalize(l,l);var u=Math.abs(i.R3.dot(o,a)),c=Math.abs(i.R3.dot(l,a)),h=u<c?o:l,d=i.R3.cross(i.R3.create(),h,a);0===i.R3.len(d)&&(h=u<c?l:o,d=i.R3.cross(d,h,a)),i.R3.normalize(d,d);var f=i.R3.cross(i.R3.create(),a,d);i.R3.normalize(f,f),this._setSpaceMatrixFromAxes(d,f,a)}else{var p=t.getMatrix();this._setSpaceMatrixOrthonormalFromMatrix(p)}}else{p=t.getMatrix();this._setSpaceMatrixOrthonormalFromMatrix(p)}}},{key:"_initPickables",value:function(){var e=this._pickables;e.length=0;var t=this._activatedType;1&t&&e.push(this._transX._pickGeo),2&t&&e.push(this._transY._pickGeo),4&t&&e.push(this._transZ._pickGeo),128&t&&e.push(this._planeX._pickGeo),256&t&&e.push(this._planeY._pickGeo),512&t&&e.push(this._planeZ._pickGeo),8&t&&e.push(this._rotX._pickGeo),16&t&&e.push(this._rotY._pickGeo),32&t&&e.push(this._rotZ._pickGeo),t&Pr&&e.push(this._scaleX._pickGeo),t&Dr&&e.push(this._scaleY._pickGeo),t&Ir&&e.push(this._scaleZ._pickGeo),t&Fr&&e.push(this._scaleW._pickGeo)}},{key:"_createArrow",value:function(e,t,r){var n=e._baseMatrix;i._E.rotate(n,n,.5*Math.PI,t),i._E.translate(n,n,[0,1.25,0]),i.R3.copy(e._color,r),e._pickGeo=Tr.createArrow(this._gl,.1,2.5,6*.4),e._pickGeo._gizmo=e,e._drawGeo=Tr.createArrow(this._gl,Rr,2.5,6,.25),e._drawGeo.setShaderType(s.Z.Shader.FLAT)}},{key:"_createPlane",value:function(e,t,r,n,a,o,l,u){i.R3.copy(e._color,t),e._pickGeo=Tr.createPlane(this._gl,0,0,0,r,n,a,o,l,u),e._pickGeo._gizmo=e,e._drawGeo=Tr.createPlane(this._gl,0,0,0,r,n,a,o,l,u),e._drawGeo.setShaderType(s.Z.Shader.FLAT)}},{key:"_initTranslate",value:function(){var e=[0,0,0];this._createArrow(this._transX,i.R3.set(e,0,0,-1),Mr),this._createArrow(this._transY,i.R3.set(e,0,1,0),xr),this._createArrow(this._transZ,i.R3.set(e,1,0,0),Sr);var t=.5;this._createPlane(this._planeX,Mr,0,t,0,0,0,t),this._createPlane(this._planeY,xr,t,0,0,0,0,t),this._createPlane(this._planeZ,Sr,t,0,0,0,t,0)}},{key:"_createCircle",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;i.R3.copy(e._color,r),e._pickGeo=Tr.createTorus(this._gl,n,.1*a,t,6,64),e._pickGeo._gizmo=e,e._drawGeo=Tr.createTorus(this._gl,n,Rr*a,t,6,64),e._drawGeo.setShaderType(s.Z.Shader.FLAT)}},{key:"_initRotate",value:function(){this._createCircle(this._rotX,Math.PI,Mr),this._createCircle(this._rotY,Math.PI,xr),this._createCircle(this._rotZ,Math.PI,Sr),this._createCircle(this._rotW,2*Math.PI,Ar),i._E.rotateZ(this._rotX._baseMatrix,this._rotX._baseMatrix,.5*-Math.PI),i._E.rotateX(this._rotZ._baseMatrix,this._rotZ._baseMatrix,.5*Math.PI)}},{key:"_createCube",value:function(e,t,r){var n=e._baseMatrix;i._E.rotate(n,n,.5*Math.PI,t),i._E.translate(n,n,[0,1.5,0]),i.R3.copy(e._color,r),e._pickGeo=Tr.createCube(this._gl,.42),e._pickGeo._gizmo=e,e._drawGeo=Tr.createCube(this._gl,.35),e._drawGeo.setShaderType(s.Z.Shader.FLAT)}},{key:"_initScale",value:function(){var e=[0,0,0];this._createCube(this._scaleX,i.R3.set(e,0,0,-1),Mr),this._createCube(this._scaleY,i.R3.set(e,0,1,0),xr),this._createCube(this._scaleZ,i.R3.set(e,1,0,0),Sr),this._createCircle(this._scaleW,2*Math.PI,Er,1.9500000000000002,2)}},{key:"_updateArcRotation",value:function(e){wr[0]=e[2],wr[1]=0,wr[2]=-e[0],wr[3]=1+e[1],i.gf.normalize(wr,wr),i._E.fromQuat(this._rotW._baseMatrix,wr),i._E.fromQuat(this._scaleW._baseMatrix,wr)}},{key:"_computeCenterGizmo",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],t=this._main.getSelectedMeshes(),r=[0,0,0],n=[0,0,0],a=0;a<t.length;++a){var s=t[a];i.R3.transformMat4(n,s.getCenter(),s.getEditMatrix()),i.R3.transformMat4(n,n,s.getMatrix()),i.R3.add(r,r,n)}return i.R3.scale(e,r,1/t.length),e}},{key:"_updateMatrices",value:function(){var e=this._main.getCamera(),t=this._computeCenterGizmo(),r=e.computePosition();this._updateSpaceMatrices(t),this._lastDistToEye=this._isEditing?this._lastDistToEye:i.R3.dist(r,t);var n=80*this._lastDistToEye/e.getConstantScreen(),a=i._E.create();if(i._E.translate(a,a,t),i._E.scale(a,a,[n,n,n]),0===this._spaceMode){if(!this._isEditing){var s=i.R3.sub(i.R3.create(),r,t);i.R3.normalize(s,s),i.R3.transformMat4(s,s,this._spaceMatrixInv),i.R3.normalize(s,s),this._updateArcRotation(s)}}else i._E.identity(this._rotW._baseMatrix),i._E.identity(this._scaleW._baseMatrix);var o=i._E.create();i._E.mul(o,a,this._spaceMatrix),this._transX.updateFinalMatrix(o),this._transY.updateFinalMatrix(o),this._transZ.updateFinalMatrix(o),this._planeX.updateFinalMatrix(o),this._planeY.updateFinalMatrix(o),this._planeZ.updateFinalMatrix(o),this._rotX.updateFinalMatrix(o),this._rotY.updateFinalMatrix(o),this._rotZ.updateFinalMatrix(o),this._rotW.updateFinalMatrix(o),this._scaleX.updateFinalMatrix(o),this._scaleY.updateFinalMatrix(o),this._scaleZ.updateFinalMatrix(o),this._scaleW.updateFinalMatrix(o)}},{key:"_drawGizmo",value:function(e){e.updateMatrix();var t=e._drawGeo;t.setFlatColor(e._isSelected?e._colorSelect:e._color),t.updateMatrices(this._main.getCamera()),t.render(this._main)}},{key:"_updateLineHelper",value:function(e,t,r,i){var n=this._lineHelper.getVertices(),a=this._main,s=a.getCanvasWidth(),o=a.getCanvasHeight();n[0]=e/s*2-1,n[1]=(o-t)/o*2-1,n[3]=r/s*2-1,n[4]=(o-i)/o*2-1,this._lineHelper.updateVertexBuffer()}},{key:"_saveEditMatrices",value:function(){var e=this._main.getSelectedMeshes(),t=this._computeCenterGizmo();i._E.translate(this._editTrans,i._E.identity(this._editTrans),t),i._E.invert(this._editTransInv,this._editTrans);for(var r=0;r<e.length;++r)this._editLocal[r]=i._E.create(),this._editScaleRot[r]=i._E.create(),this._editLocalInv[r]=i._E.create(),this._editScaleRotInv[r]=i._E.create(),i._E.copy(this._editLocal[r],e[r].getMatrix()),i._E.copy(this._editScaleRot[r],this._editLocal[r]),this._editScaleRot[r][12]=this._editScaleRot[r][13]=this._editScaleRot[r][14]=0,i._E.invert(this._editLocalInv[r],this._editLocal[r]),i._E.invert(this._editScaleRotInv[r],this._editScaleRot[r])}},{key:"_startRotateEdit",value:function(){var e=this._main,t=e.getCamera();this._computeCenterGizmo(this._rotPlaneOrigin);var r=this._selected._nbAxis;0===this._spaceMode?(i.R3.set(this._rotAxisWorld,0,0,0),this._rotAxisWorld[r]=1):(this._rotAxisWorld[0]=this._spaceMatrix[4*r],this._rotAxisWorld[1]=this._spaceMatrix[4*r+1],this._rotAxisWorld[2]=this._spaceMatrix[4*r+2],i.R3.normalize(this._rotAxisWorld,this._rotAxisWorld));var n=t.unproject(e._mouseX,e._mouseY,0),a=t.unproject(e._mouseX,e._mouseY,.1);Se.Z.intersectLinePlane(n,a,this._rotPlaneOrigin,this._rotAxisWorld,this._rotStartVec),i.R3.sub(this._rotStartVec,this._rotStartVec,this._rotPlaneOrigin),i.R3.scaleAndAdd(this._rotStartVec,this._rotStartVec,this._rotAxisWorld,-i.R3.dot(this._rotStartVec,this._rotAxisWorld)),0===i.R3.len(this._rotStartVec)&&i.R3.copy(this._rotStartVec,Se.Z.getPerpendicularVector(this._rotAxisWorld)),i.R3.normalize(this._rotStartVec,this._rotStartVec)}},{key:"_startTranslateEdit",value:function(){var e=this._main,t=e.getCamera(),r=this._editLineOrigin,n=this._editLineDirection;this._computeCenterGizmo(r);var a=this._selected._nbAxis;-1!==a&&(i.R3.set(n,0,0,0)[a]=1,i.R3.transformMat4(n,n,this._spaceMatrix)),i.R3.add(n,r,n),i.R3.copy(r,t.project(r)),i.R3.copy(n,t.project(n)),i.K4.normalize(n,i.K4.sub(n,n,r));var s=this._editOffset;s[0]=e._mouseX-r[0],s[1]=e._mouseY-r[1]}},{key:"_startPlaneEdit",value:function(){var e=this._main,t=e.getCamera(),r=this._editLineOrigin;this._computeCenterGizmo(r),i.R3.copy(r,t.project(r));var n=this._editOffset;n[0]=e._mouseX-r[0],n[1]=e._mouseY-r[1],i.K4.set(this._editLineOrigin,e._mouseX,e._mouseY)}},{key:"_startScaleEdit",value:function(){this._startTranslateEdit()}},{key:"_updateRotateEdit",value:function(){var e=this._main,t=e.getCamera(),r=t.unproject(e._mouseX,e._mouseY,0),n=t.unproject(e._mouseX,e._mouseY,.1);if(Se.Z.intersectLinePlane(r,n,this._rotPlaneOrigin,this._rotAxisWorld,this._rotCurVec),i.R3.sub(this._rotCurVec,this._rotCurVec,this._rotPlaneOrigin),i.R3.scaleAndAdd(this._rotCurVec,this._rotCurVec,this._rotAxisWorld,-i.R3.dot(this._rotCurVec,this._rotAxisWorld)),0!==i.R3.len(this._rotCurVec)){i.R3.normalize(this._rotCurVec,this._rotCurVec);var a=i.R3.cross(i.R3.create(),this._rotStartVec,this._rotCurVec),s=i.R3.dot(a,this._rotAxisWorld),o=i.R3.dot(this._rotStartVec,this._rotCurVec),l=Math.atan2(s,o),u=t.project(i.R3.add(i.R3.create(),this._rotPlaneOrigin,this._rotStartVec)),c=t.project(i.R3.add(i.R3.create(),this._rotPlaneOrigin,this._rotCurVec));this._updateLineHelper(u[0],u[1],c[0],c[1]);for(var h=this._main.getSelectedMeshes(),d=0;d<h.length;++d){var f=h[d].getEditMatrix();i._E.identity(f),i._E.fromRotation(f,-l,this._rotAxisWorld),this._scaleRotateEditMatrix(f,d)}e.render()}}},{key:"_updateTranslateEdit",value:function(){var e=this._main,t=e.getCamera(),r=this._editLineOrigin,n=this._editLineDirection,a=[e._mouseX,e._mouseY,0];i.K4.sub(a,a,r),i.K4.sub(a,a,this._editOffset),i.K4.scaleAndAdd(a,r,n,i.K4.dot(a,n)),this._updateLineHelper(r[0],r[1],a[0],a[1]);var s=t.unproject(a[0],a[1],0),o=t.unproject(a[0],a[1],.1);i.R3.transformMat4(s,s,this._editTransInv),i.R3.transformMat4(o,o,this._editTransInv),i.R3.transformMat4(s,s,this._spaceMatrixInv),i.R3.transformMat4(o,o,this._spaceMatrixInv),i.R3.normalize(a,i.R3.sub(a,o,s));var l=[0,0,0];l[this._selected._nbAxis]=1;var u=-i.R3.dot(a,l),c=i.R3.dot(s,a),h=Math.abs(1-u*u),d=-i.R3.dot(s,l);l[this._selected._nbAxis]=(u*c-d)/h,i.R3.transformMat4(l,l,this._spaceMatrix),this._updateMatrixTranslate(l),e.render()}},{key:"_updatePlaneEdit",value:function(){var e=this._main,t=e.getCamera(),r=[e._mouseX,e._mouseY,0];i.K4.sub(r,r,this._editOffset),this._updateLineHelper(this._editLineOrigin[0],this._editLineOrigin[1],e._mouseX,e._mouseY);var n=t.unproject(r[0],r[1],0),a=t.unproject(r[0],r[1],.1);i.R3.transformMat4(n,n,this._editTransInv),i.R3.transformMat4(a,a,this._editTransInv),i.R3.transformMat4(n,n,this._spaceMatrixInv),i.R3.transformMat4(a,a,this._spaceMatrixInv);var s=[0,0,0];s[this._selected._nbAxis]=1;var o=i.R3.dot(n,s),l=i.R3.dot(a,s);if(o===l)return!1;var u=-o/(l-o);s[0]=n[0]+(a[0]-n[0])*u,s[1]=n[1]+(a[1]-n[1])*u,s[2]=n[2]+(a[2]-n[2])*u,i.R3.transformMat4(s,s,this._spaceMatrix),this._updateMatrixTranslate(s),e.render()}},{key:"_updateMatrixTranslate",value:function(e){for(var t=[0,0,0],r=this._main.getSelectedMeshes(),n=0;n<r.length;++n){i.R3.transformMat4(t,e,this._editScaleRotInv[n]);var a=r[n].getEditMatrix();i._E.identity(a),i._E.translate(a,a,t)}}},{key:"_updateScaleEdit",value:function(){var e=this._main,t=(e.getMesh(),this._editLineOrigin),r=this._editLineDirection,n=this._selected._nbAxis,a=[e._mouseX,e._mouseY,0];-1!==n&&(i.K4.sub(a,a,t),i.K4.scaleAndAdd(a,t,r,i.K4.dot(a,r))),this._updateLineHelper(t[0],t[1],a[0],a[1]);var s=i.R3.len(this._editOffset),o=[1,1,1],l=Math.max(-.99,(i.K4.dist(t,a)-s)/s);-1===n?(o[0]+=l,o[1]+=l,o[2]+=l):o[n]+=l;for(var u=this._main.getSelectedMeshes(),c=0;c<u.length;++c){var h=u[c].getEditMatrix();i._E.identity(h),0!==this._spaceMode?(i._E.mul(h,this._spaceMatrix,h),i._E.scale(h,h,o),i._E.mul(h,h,this._spaceMatrixInv)):i._E.scale(h,h,o),this._scaleRotateEditMatrix(h,c)}e.render()}},{key:"_scaleRotateEditMatrix",value:function(e,t){i._E.mul(e,this._editTrans,e),i._E.mul(e,e,this._editTransInv),i._E.mul(e,this._editScaleRotInv[t],e),i._E.mul(e,e,this._editScaleRot[t])}},{key:"addGizmoToScene",value:function(e){return e.push(this._transX._drawGeo),e.push(this._transY._drawGeo),e.push(this._transZ._drawGeo),e.push(this._planeX._drawGeo),e.push(this._planeY._drawGeo),e.push(this._planeZ._drawGeo),e.push(this._rotX._drawGeo),e.push(this._rotY._drawGeo),e.push(this._rotZ._drawGeo),e.push(this._rotW._drawGeo),e.push(this._scaleX._drawGeo),e.push(this._scaleY._drawGeo),e.push(this._scaleZ._drawGeo),e.push(this._scaleW._drawGeo),e}},{key:"render",value:function(){this._isEditing||this._updateMatrices();var e=this._isEditing&&this._selected?this._selected._type:this._activatedType;64&e&&this._drawGizmo(this._rotW),1&e&&this._drawGizmo(this._transX),2&e&&this._drawGizmo(this._transY),4&e&&this._drawGizmo(this._transZ),128&e&&this._drawGizmo(this._planeX),256&e&&this._drawGizmo(this._planeY),512&e&&this._drawGizmo(this._planeZ),8&e&&this._drawGizmo(this._rotX),16&e&&this._drawGizmo(this._rotY),32&e&&this._drawGizmo(this._rotZ),e&Pr&&this._drawGizmo(this._scaleX),e&Dr&&this._drawGizmo(this._scaleY),e&Ir&&this._drawGizmo(this._scaleZ),e&Fr&&this._drawGizmo(this._scaleW),this._isEditing&&this._lineHelper.render(this._main)}},{key:"onMouseOver",value:function(){if(this._isEditing){var e=this._selected._type;return 56&e?this._updateRotateEdit():7&e?this._updateTranslateEdit():896&e?this._updatePlaneEdit():e&Or&&this._updateScaleEdit(),!0}var t=this._main,r=t.getPicking(),n=t._mouseX,a=t._mouseY,s=this._pickables;r.intersectionMouseMeshes(s,n,a),this._selected&&(this._selected._isSelected=!1);var o=r.getMesh();return o?(this._selected=o._gizmo,this._selected._isSelected=!0,i.R3.copy(this._selected._lastInter,r.getIntersectionPoint()),!0):(this._selected=null,!1)}},{key:"onMouseDown",value:function(){var e=this._selected;if(!e)return!1;if(this._isEditing=!0,2===this._spaceMode){var t=this._main.getPicking();t.computePickedNormal();var r=t.getPickedNormal();i.R3.copy(this._staticNormal,r),this._hasStaticNormal=0!==i.R3.len(this._staticNormal)}else this._hasStaticNormal=!1;var n=e._type;return this._saveEditMatrices(),56&n?this._startRotateEdit():7&n?this._startTranslateEdit():896&n?this._startPlaneEdit():n&Or&&this._startScaleEdit(),!0}},{key:"onMouseUp",value:function(){this._isEditing=!1,this._hasStaticNormal=!1}}])&&kr(t.prototype,r),n&&kr(t,n),e}();function Lr(e){return(Lr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Nr(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Br(e,t){return(Br=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ur(e,t){return!t||"object"!==Lr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Zr(e){return(Zr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var zr={TRANSLATE:0,ROTATE:1,SCALE:2},Gr={ALL:0,X:1,Y:2,Z:3},Wr={WORLD:0,LOCAL:1,NORMAL:2};const jr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Br(e,t)}(l,e);var t,r,n,a,s,o=(a=l,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Zr(a);if(s){var r=Zr(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return Ur(this,e)});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=o.call(this,e))._gizmo=new Vr(e),t._gizmoMode=zr.TRANSLATE,t._gizmoAxis=Gr.ALL,t._gizmoSpace=Wr.WORLD,t._updateGizmo(),t}return t=l,n=[{key:"Mode",get:function(){return zr}},{key:"Axis",get:function(){return Gr}},{key:"Space",get:function(){return Wr}}],(r=[{key:"isIdentity",value:function(e){return 1===e[0]&&1===e[5]&&1===e[10]&&1===e[15]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&0===e[11]&&0===e[12]&&0===e[13]&&0===e[14]}},{key:"preUpdate",value:function(){var e=this._main.getPicking(),t=e.getMesh();this._gizmo.onMouseOver(),e._mesh=t,this._main.setCanvasCursor("default")}},{key:"start",value:function(e){var t=this._main,r=this.getMesh(),i=t.getPicking();return r&&this._gizmo.onMouseDown()?(i._mesh=r,!0):!!i.intersectionMouseMeshes(t.getMeshes(),t._mouseX,t._mouseY)&&!!t.setOrUnsetMesh(i.getMesh(),e)&&(this._lastMouseX=t._mouseX,this._lastMouseY=t._mouseY,!1)}},{key:"end",value:function(){if(this._gizmo.onMouseUp(),this.getMesh()&&!this.isIdentity(this.getMesh().getEditMatrix())){for(var e=this._main.getSelectedMeshes(),t=0;t<e.length;++t){this._forceToolMesh=e[t],this.pushState(),t>0&&(this._main.getStateManager().getCurrentState().squash=!0);var r=this.getUnmaskedVertices();this._main.getStateManager().pushVertices(r),this.applyEditMatrix(r),0!==r.length&&this.updateMeshBuffers()}this._forceToolMesh=null}}},{key:"applyEditMatrix",value:function(e){for(var t=this.getMesh(),r=t.getEditMatrix(),n=r,a=t.getMaterials(),s=t.getVertices(),o=[0,0,0],l=0,u=e.length;l<u;++l){var c=3*e[l],h=a[c+2],d=o[0]=s[c],f=o[1]=s[c+1],p=o[2]=s[c+2];i.R3.transformMat4(o,o,n);var _=1-h;s[c]=d*_+o[0]*h,s[c+1]=f*_+o[1]*h,s[c+2]=p*_+o[2]*h}i.R3.transformMat4(t.getCenter(),t.getCenter(),n),i._E.identity(r),e.length===t.getNbVertices()?t.updateGeometry():t.updateGeometry(t.getFacesFromVertices(e),e)}},{key:"update",value:function(){}},{key:"_updateGizmo",value:function(){var e=0;switch(this._gizmoMode){case zr.TRANSLATE:this._gizmoAxis===Gr.ALL?e=Vr.TRANS_XYZ|Vr.PLANE_XYZ:this._gizmoAxis===Gr.X?e=Vr.TRANS_X:this._gizmoAxis===Gr.Y?e=Vr.TRANS_Y:this._gizmoAxis===Gr.Z&&(e=Vr.TRANS_Z);break;case zr.ROTATE:this._gizmoAxis===Gr.ALL?e=Vr.ROT_XYZ|Vr.ROT_W:this._gizmoAxis===Gr.X?e=Vr.ROT_X:this._gizmoAxis===Gr.Y?e=Vr.ROT_Y:this._gizmoAxis===Gr.Z&&(e=Vr.ROT_Z);break;case zr.SCALE:this._gizmoAxis===Gr.ALL?e=Vr.SCALE_XYZW:this._gizmoAxis===Gr.X?e=Vr.SCALE_X:this._gizmoAxis===Gr.Y?e=Vr.SCALE_Y:this._gizmoAxis===Gr.Z&&(e=Vr.SCALE_Z);break;default:e=Vr.TRANS_XYZ|Vr.PLANE_XYZ}this._gizmo.setActivatedType(e),this._gizmo.setSpaceMode(this._gizmoSpace)}},{key:"setGizmoMode",value:function(e){this._gizmoMode=e,this._updateGizmo(),this._main.render()}},{key:"setGizmoAxis",value:function(e){this._gizmoAxis=e,this._updateGizmo(),this._main.render()}},{key:"setGizmoSpace",value:function(e){this._gizmoSpace=e,this._updateGizmo(),this._main.render()}},{key:"postRender",value:function(){this.getMesh()&&this._gizmo.render()}},{key:"addSculptToScene",value:function(e){this.getMesh()&&this._gizmo.addGizmoToScene(e)}}])&&Nr(t.prototype,r),n&&Nr(t,n),l}(se);function Xr(e){return(Xr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Hr(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Yr(e,t){return(Yr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Kr(e,t){return!t||"object"!==Xr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function qr(e){return(qr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Jr=[0,0,0],Qr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Yr(e,t)}(s,e);var t,r,i,n,a=(i=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=qr(i);if(n){var r=qr(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return Kr(this,e)});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=a.call(this,e))._selectionMode=s.Mode.FACE,t._selectionAction=s.Action.REPLACE,t}return t=s,(r=[{key:"start",value:function(e){var t=this._main,r=t.getPicking();if(!r.intersectionMouseMeshes())return!1;var i=t.setOrUnsetMesh(r.getMesh(),e);return!!i&&-1!==r.getPickedFace()&&(this._main.getStateManager().pushStateColorAndMaterial(i),this.applySelection(i,r),this.updateRender(),this._lastMouseX=t._mouseX,this._lastMouseY=t._mouseY,!0)}},{key:"update",value:function(){}},{key:"updateMeshBuffers",value:function(){var e=this.getMesh();e&&(e.isDynamic?e.updateBuffers():(e.updateDuplicateColorsAndMaterials(),e.updateDrawArrays(),e.updateMaterialBuffer()))}},{key:"applySelection",value:function(e,t){var r=this.getSelectionVertices(e,t);if(r.length){var i=e.getMaterials(),n=e.getNbVertices();if(this._selectionAction===s.Action.REPLACE)for(var a=0;a<n;++a)i[3*a+2]=0;for(var o=this._selectionAction===s.Action.REMOVE?0:1,l=0,u=r.length;l<u;++l)i[3*r[l]+2]=o}}},{key:"getSelectionVertices",value:function(e,t){var r=t.getPickedFace(),i=e.getFaces(),n=4*r,a=i[n],l=i[n+1],u=i[n+2],c=i[n+3],h=[a,l,u];if(c!==o.Z.TRI_INDEX&&h.push(c),this._selectionMode===s.Mode.FACE)return h;var d=t.getIntersectionPoint();return Jr[0]=d[0],Jr[1]=d[1],Jr[2]=d[2],this._selectionMode===s.Mode.VERTEX?[this.getClosestVertex(e,h,Jr)]:this._selectionMode===s.Mode.EDGE?this.getClosestEdge(e,h,Jr):h}},{key:"getClosestVertex",value:function(e,t,r){for(var i=e.getVertices(),n=t[0],a=1/0,s=0,o=t.length;s<o;++s){var l=3*t[s],u=i[l]-r[0],c=i[l+1]-r[1],h=i[l+2]-r[2],d=u*u+c*c+h*h;d<a&&(a=d,n=t[s])}return n}},{key:"getClosestEdge",value:function(e,t,r){var i=[[t[0],t[1]],[t[1],t[2]],[t[2],t[0]]];4===t.length&&(i.push([t[2],t[3]]),i.push([t[3],t[0]]));for(var n=e.getVertices(),a=i[0],s=1/0,o=0,l=i.length;o<l;++o){var u=i[o],c=this.distanceToSegmentSquared(n,u[0],u[1],r);c<s&&(s=c,a=u)}return a}},{key:"distanceToSegmentSquared",value:function(e,t,r,i){var n=3*t,a=3*r,s=e[n],o=e[n+1],l=e[n+2],u=e[a]-s,c=e[a+1]-o,h=e[a+2]-l,d=i[0]-s,f=i[1]-o,p=i[2]-l,_=u*u+c*c+h*h;if(0===_)return d*d+f*f+p*p;var m=(d*u+f*c+p*h)/_;m<0?m=0:m>1&&(m=1);var g=s+u*m-i[0],v=o+c*m-i[1],y=l+h*m-i[2];return g*g+v*v+y*y}},{key:"selectAll",value:function(){var e=this.getMesh();if(e){this._main.getStateManager().pushStateColorAndMaterial(e);for(var t=e.getMaterials(),r=e.getNbVertices(),i=0;i<r;++i)t[3*i+2]=1;this.updateRender()}}},{key:"clearSelection",value:function(){var e=this.getMesh();if(e){this._main.getStateManager().pushStateColorAndMaterial(e);for(var t=e.getMaterials(),r=e.getNbVertices(),i=0;i<r;++i)t[3*i+2]=0;this.updateRender()}}},{key:"invertSelection",value:function(){var e=this.getMesh();if(e){this._main.getStateManager().pushStateColorAndMaterial(e);for(var t=e.getMaterials(),r=e.getNbVertices(),i=0;i<r;++i){var n=3*i+2;t[n]=t[n]>.5?0:1}this.updateRender()}}}])&&Hr(t.prototype,r),s}(se);Qr.Mode={VERTEX:0,EDGE:1,FACE:2},Qr.Action={REPLACE:0,ADD:1,REMOVE:2};const $r=Qr;var ei=[];ei[s.Z.Tools.BRUSH]=ve,ei[s.Z.Tools.INFLATE]=xe,ei[s.Z.Tools.TWIST]=Pe,ei[s.Z.Tools.SMOOTH]=Le,ei[s.Z.Tools.FLATTEN]=de,ei[s.Z.Tools.PINCH]=Ge,ei[s.Z.Tools.CREASE]=Ke,ei[s.Z.Tools.DRAG]=tt,ei[s.Z.Tools.PAINT]=lt,ei[s.Z.Tools.MOVE]=pt,ei[s.Z.Tools.MASKING]=Vt,ei[s.Z.Tools.LOCALSCALE]=zt,ei[s.Z.Tools.TRANSFORM]=jr,ei[s.Z.Tools.ELEMENTSELECT]=$r,ei[s.Z.Tools.BRUSH].uiName="sculptBrush",ei[s.Z.Tools.INFLATE].uiName="sculptInflate",ei[s.Z.Tools.TWIST].uiName="sculptTwist",ei[s.Z.Tools.SMOOTH].uiName="sculptSmooth",ei[s.Z.Tools.FLATTEN].uiName="sculptFlatten",ei[s.Z.Tools.PINCH].uiName="sculptPinch",ei[s.Z.Tools.CREASE].uiName="sculptCrease",ei[s.Z.Tools.DRAG].uiName="sculptDrag",ei[s.Z.Tools.PAINT].uiName="sculptPaint",ei[s.Z.Tools.MOVE].uiName="sculptMove",ei[s.Z.Tools.MASKING].uiName="sculptMasking",ei[s.Z.Tools.LOCALSCALE].uiName="sculptLocalScale",ei[s.Z.Tools.TRANSFORM].uiName="sculptTransform",ei[s.Z.Tools.ELEMENTSELECT].uiName="sculptElementSelect";const ti=ei;function ri(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}const ii=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=t,this._toolIndex=s.Z.Tools.BRUSH,this._tools=[],this._symmetry=!0,this._continuous=!1,this._sculptTimer=-1,this._selection=new ne(t._gl),this.init()}var t,r;return t=e,(r=[{key:"setToolIndex",value:function(e){this._toolIndex=e}},{key:"getToolIndex",value:function(){return this._toolIndex}},{key:"getCurrentTool",value:function(){return this._tools[this._toolIndex]}},{key:"getSymmetry",value:function(){return this._symmetry}},{key:"getTool",value:function(e){return this._tools[e]}},{key:"getSelection",value:function(){return this._selection}},{key:"init",value:function(){for(var e=this._main,t=this._tools,r=0,i=ti.length;r<i;++r)ti[r]&&(t[r]=new ti[r](e))}},{key:"canBeContinuous",value:function(){switch(this._toolIndex){case s.Z.Tools.TWIST:case s.Z.Tools.MOVE:case s.Z.Tools.DRAG:case s.Z.Tools.LOCALSCALE:case s.Z.Tools.TRANSFORM:case s.Z.Tools.ELEMENTSELECT:return!1;default:return!0}}},{key:"isUsingContinuous",value:function(){return this._continuous&&this.canBeContinuous()}},{key:"start",value:function(e){var t=this.getCurrentTool(),r=t.start(e);return this._main.getPicking().getMesh()&&this.isUsingContinuous()&&(this._sculptTimer=window.setInterval(t._cbContinuous,16.6)),r}},{key:"end",value:function(){this.getCurrentTool().end(),-1!==this._sculptTimer&&(clearInterval(this._sculptTimer),this._sculptTimer=-1)}},{key:"preUpdate",value:function(){this.getCurrentTool().preUpdate(this.canBeContinuous())}},{key:"update",value:function(){this.isUsingContinuous()||this.getCurrentTool().update()}},{key:"postRender",value:function(){this.getCurrentTool().postRender(this._selection)}},{key:"addSculptToScene",value:function(e){return this.getCurrentTool().addSculptToScene(e)}}])&&ri(t.prototype,r),e}();function ni(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var ai={LINEAR:!1},si=function(){function e(t,r,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._vArOut=r,this._cArOut=i,this._mArOut=n,this._vAr=t.getVertices(),this._cAr=t.getColors(),this._mAr=t.getMaterials(),this._eAr=t.getEdges(),this._nbVertices=t.getNbVertices(),this._tagEdges=new Int32Array(t.getNbEdges())}var t,r;return t=e,(r=[{key:"computeTriangleEdgeVertex",value:function(e,t,r,i){var n=this._vAr,a=this._cAr,s=this._mAr,o=this._eAr,l=this._vArOut,u=this._cArOut,c=this._mArOut,h=this._tagEdges,d=3*e,f=3*t,p=3*r,_=h[i]-1,m=-1===_?this._nbVertices++:_,g=3*m,v=o[i];if(1===v||v>=3||ai.LINEAR){if(-1!==_)return m;h[i]=m+1,l[g]=.5*(n[d]+n[f]),l[g+1]=.5*(n[d+1]+n[f+1]),l[g+2]=.5*(n[d+2]+n[f+2]),u[g]=.5*(a[d]+a[f]),u[g+1]=.5*(a[d+1]+a[f+1]),u[g+2]=.5*(a[d+2]+a[f+2]),c[g]=.5*(s[d]+s[f]),c[g+1]=.5*(s[d+1]+s[f+1]),c[g+2]=.5*(s[d+2]+s[f+2])}else-1===_?(h[i]=m+1,l[g]=.125*n[p]+.375*(n[d]+n[f]),l[g+1]=.125*n[p+1]+.375*(n[d+1]+n[f+1]),l[g+2]=.125*n[p+2]+.375*(n[d+2]+n[f+2]),u[g]=.125*a[p]+.375*(a[d]+a[f]),u[g+1]=.125*a[p+1]+.375*(a[d+1]+a[f+1]),u[g+2]=.125*a[p+2]+.375*(a[d+2]+a[f+2]),c[g]=.125*s[p]+.375*(s[d]+s[f]),c[g+1]=.125*s[p+1]+.375*(s[d+1]+s[f+1]),c[g+2]=.125*s[p+2]+.375*(s[d+2]+s[f+2])):(l[g]+=.125*n[p],l[g+1]+=.125*n[p+1],l[g+2]+=.125*n[p+2],u[g]+=.125*a[p],u[g+1]+=.125*a[p+1],u[g+2]+=.125*a[p+2],c[g]+=.125*s[p],c[g+1]+=.125*s[p+1],c[g+2]+=.125*s[p+2]);return m}},{key:"computeQuadEdgeVertex",value:function(e,t,r,i,n){var a=this._vAr,s=this._cAr,o=this._mAr,l=this._eAr,u=this._vArOut,c=this._cArOut,h=this._mArOut,d=this._tagEdges,f=3*e,p=3*t,_=3*r,m=3*i,g=d[n]-1,v=-1===g?this._nbVertices++:g,y=3*v,b=l[n];if(1===b||b>=3||ai.LINEAR){if(-1!==g)return v;d[n]=v+1,u[y]=.5*(a[f]+a[p]),u[y+1]=.5*(a[f+1]+a[p+1]),u[y+2]=.5*(a[f+2]+a[p+2]),c[y]=.5*(s[f]+s[p]),c[y+1]=.5*(s[f+1]+s[p+1]),c[y+2]=.5*(s[f+2]+s[p+2]),h[y]=.5*(o[f]+o[p]),h[y+1]=.5*(o[f+1]+o[p+1]),h[y+2]=.5*(o[f+2]+o[p+2])}else-1===g?(d[n]=v+1,u[y]=.0625*(a[_]+a[m])+.375*(a[f]+a[p]),u[y+1]=.0625*(a[_+1]+a[m+1])+.375*(a[f+1]+a[p+1]),u[y+2]=.0625*(a[_+2]+a[m+2])+.375*(a[f+2]+a[p+2]),c[y]=.0625*(s[_]+s[m])+.375*(s[f]+s[p]),c[y+1]=.0625*(s[_+1]+s[m+1])+.375*(s[f+1]+s[p+1]),c[y+2]=.0625*(s[_+2]+s[m+2])+.375*(s[f+2]+s[p+2]),h[y]=.0625*(o[_]+o[m])+.375*(o[f]+o[p]),h[y+1]=.0625*(o[_+1]+o[m+1])+.375*(o[f+1]+o[p+1]),h[y+2]=.0625*(o[_+2]+o[m+2])+.375*(o[f+2]+o[p+2])):(u[y]+=.0625*(a[_]+a[m]),u[y+1]+=.0625*(a[_+1]+a[m+1]),u[y+2]+=.0625*(a[_+2]+a[m+2]),c[y]+=.0625*(s[_]+s[m]),c[y+1]+=.0625*(s[_+1]+s[m+1]),c[y+2]+=.0625*(s[_+2]+s[m+2]),h[y]+=.0625*(o[_]+o[m]),h[y+1]+=.0625*(o[_+1]+o[m+1]),h[y+2]+=.0625*(o[_+2]+o[m+2]));return v}},{key:"computeFaceVertex",value:function(e,t,r,i){var n=3*e,a=3*t,s=3*r,o=3*i,l=this._vAr,u=this._cAr,c=this._mAr,h=this._vArOut,d=this._cArOut,f=this._mArOut,p=this._nbVertices++,_=3*p;return h[_]=.25*(l[n]+l[a]+l[s]+l[o]),h[_+1]=.25*(l[n+1]+l[a+1]+l[s+1]+l[o+1]),h[_+2]=.25*(l[n+2]+l[a+2]+l[s+2]+l[o+2]),d[_]=.25*(u[n]+u[a]+u[s]+u[o]),d[_+1]=.25*(u[n+1]+u[a+1]+u[s+1]+u[o+1]),d[_+2]=.25*(u[n+2]+u[a+2]+u[s+2]+u[o+2]),f[_]=.25*(c[n]+c[a]+c[s]+c[o]),f[_+1]=.25*(c[n+1]+c[a+1]+c[s+1]+c[o+1]),f[_+2]=.25*(c[n+2]+c[a+2]+c[s+2]+c[o+2]),p}}])&&ni(t.prototype,r),e}(),oi=function(e,t,r,i){var n=e.getNbVertices();r.set(e.getColors().subarray(0,3*n)),i.set(e.getMaterials().subarray(0,3*n));for(var a=e.getVertices(),s=e.getFaces(),l=e.getEdges(),u=e.getFaceEdges(),c=e.getVerticesOnEdge(),h=e.getVerticesRingVertStartCount(),d=e.getVerticesRingVert(),f=e.getVerticesRingFaceStartCount(),p=e.getVerticesRingFace(),_=e.hasOnlyTriangles(),m=0;m<n;++m){var g=3*m,v=0,y=0,b=0,T=0,k=0,M=0,x=0;if(c[m]||ai.LINEAR){var S=f[2*m],A=S+f[2*m+1];for(M=S;M<A;++M){var E=4*p[M],R=s[E],w=s[E+1],C=s[E+2],P=s[E+3],D=P===o.Z.TRI_INDEX;x=o.Z.TRI_INDEX,R===m?1===l[u[E]]?x=w:1===l[u[D?E+2:E+3]]&&(x=D?C:P):w===m?1===l[u[E]]?x=R:1===l[u[E+1]]&&(x=C):C===m?1===l[u[E+1]]?x=w:1===l[u[E+2]]&&(x=D?R:P):P===m&&(1===l[u[E+2]]?x=C:1===l[u[E+3]]&&(x=R)),x!==o.Z.TRI_INDEX&&(v+=a[x*=3],y+=a[x+1],b+=a[x+2],T++)}T<2?(t[g]=a[g],t[g+1]=a[g+1],t[g+2]=a[g+2]):(T=.25/T,k=.75,t[g]=a[g]*k+v*T,t[g+1]=a[g+1]*k+y*T,t[g+2]=a[g+2]*k+b*T)}else{var I=h[2*m],F=h[2*m+1],O=I+F;for(M=I;M<O;++M)v+=a[x=3*d[M]],y+=a[x+1],b+=a[x+2];if(_)6===F?(T=.0625,k=.625):3===F?(T=.1875,k=.4375):(T=.375/F,k=.625),t[g]=a[g]*k+v*T,t[g+1]=a[g+1]*k+y*T,t[g+2]=a[g+2]*k+b*T;else{var V=0,L=0,N=0,B=0,U=f[2*m],Z=U+f[2*m+1],z=0;for(M=U;M<Z;++M){var G=s[3+(x=4*p[M])];if(G!==o.Z.TRI_INDEX){z++;var W,j=s[x],X=s[x+1],H=s[x+2];V+=a[W=j===m?3*H:X===m?3*G:H===m?3*j:3*X],L+=a[W+1],N+=a[W+2]}}z!==Z-U?0!==z?(T=.5*(k=1/(1+.5*F+.25*z)),B=.25*k,t[g]=a[g]*k+v*T+V*B,t[g+1]=a[g+1]*k+y*T+L*B,t[g+2]=a[g+2]*k+b*T+N*B):(6===F?(T=.0625,k=.625):3===F?(T=.1875,k=.4375):(T=.375/F,k=.625),t[g]=a[g]*k+v*T,t[g+1]=a[g+1]*k+y*T,t[g+2]=a[g+2]*k+b*T):(4===F?(k=.5625,T=.09375,B=.015625):k=1-((T=1.5/(F*F))+(B=.25/(F*F)))*F,t[g]=a[g]*k+v*T+V*B,t[g+1]=a[g+1]*k+y*T+L*B,t[g+2]=a[g+2]*k+b*T+N*B)}}}},li=function(e,t,r,i,n){for(var a=e.getFaces(),s=e.getFaceEdges(),l=new si(e,t,r,i),u=0,c=e.getNbFaces();u<c;++u){var h,d,f,p,_,m=4*u,g=a[m],v=a[m+1],y=a[m+2],b=a[m+3],T=b!==o.Z.TRI_INDEX;T?(h=l.computeQuadEdgeVertex(g,v,y,b,s[m]),d=l.computeQuadEdgeVertex(v,y,b,g,s[m+1]),f=l.computeQuadEdgeVertex(y,b,g,v,s[m+2]),p=l.computeQuadEdgeVertex(b,g,v,y,s[m+3]),_=l.computeFaceVertex(g,v,y,b)):(h=l.computeTriangleEdgeVertex(g,v,y,s[m]),d=l.computeTriangleEdgeVertex(v,y,g,s[m+1]),f=l.computeTriangleEdgeVertex(y,g,v,s[m+2])),n&&(m*=4,T?(n[m+1]=n[m+4]=h,n[m+6]=n[m+9]=d,n[m+11]=n[m+14]=f,n[m+3]=n[m+12]=p,n[m+2]=n[m+7]=n[m+8]=n[m+13]=_,n[m]=g,n[m+5]=v,n[m+10]=y,n[m+15]=b):(n[m]=n[m+5]=n[m+8]=h,n[m+1]=n[m+10]=n[m+12]=d,n[m+2]=n[m+6]=n[m+14]=f,n[m+3]=n[m+7]=n[m+11]=n[m+15]=o.Z.TRI_INDEX,n[m+4]=g,n[m+9]=v,n[m+13]=y))}return l._tagEdges};ai.fullSubdivision=function(e,t){var r=e.getNbVertices()+e.getNbEdges()+e.getNbQuads();t.setVertices(new Float32Array(3*r)),t.setColors(new Float32Array(3*r)),t.setMaterials(new Float32Array(3*r)),t.setFaces(new Uint32Array(4*e.getNbFaces()*4)),oi(e,t.getVertices(),t.getColors(),t.getMaterials());var i=li(e,t.getVertices(),t.getColors(),t.getMaterials(),t.getFaces());e.hasUV()&&function(e,t,r){var i=t.getNbVertices(),n=new Uint32Array(2*i);n.set(e.getVerticesDuplicateStartCount());var a=e.getFaces(),s=e.getFacesTexCoord(),l=3*t.getNbFaces(),u=e.getTexCoords(),c=new Float32Array(o.Z.getMemory(4*l*2),0,2*l),h=0,d=e.getNbVertices(),f=i-d;for(h=0;h<d;++h){var p=n[2*h];p>0&&(n[2*h]=p+f)}c.set(u),c.set(u.subarray(2*d),2*(d+f));var _=f+e.getNbTexCoords(),m=e.getFaceEdges(),g=new Uint32Array(r.length),v=new Uint32Array(r.length);for(d=a.length,h=0;h<d;++h){var y=m[h];if(y!==o.Z.TRI_INDEX){var b=(h+1)%4==0?h-3:h+1,T=s[h],k=s[b];k===o.Z.TRI_INDEX&&(k=s[h-2]);var M=r[y]-1,x=v[y],S=T>k?T:k,A=T<k?T:k;0!==x?x===S&&g[y]===A||(c[2*_]=.5*(u[2*T]+u[2*k]),c[2*_+1]=.5*(u[2*T+1]+u[2*k+1]),n[2*M]=_++,n[2*M+1]=1):(c[2*M]=.5*(u[2*T]+u[2*k]),c[2*M+1]=.5*(u[2*T+1]+u[2*k+1]),g[y]=A,v[y]=S)}}var E=new Float32Array(2*_);E.set(c.subarray(0,2*_)),t.setTexCoords(E),t.setVerticesDuplicateStartCount(n),function(e,t,r){for(var i=e.getFacesTexCoord(),n=t.getFaces(),a=new Uint32Array(n.length),s=e.getFaceEdges(),l=e.getNbVertices(),u=t.getNbVertices()-l,c=t.getVerticesDuplicateStartCount(),h=t.getTexCoords(),d=0,f=e.getNbFaces();d<f;++d){var p=4*d,_=i[p],m=i[p+1],g=i[p+2],v=i[p+3];_>=l&&(_+=u),m>=l&&(m+=u),g>=l&&(g+=u),v!==o.Z.TRI_INDEX&&v>=l&&(v+=u);var y=s[p],b=r[y]-1;b<0?b=c[2*(-b-1)]:c[2*b]>0&&(r[y]=-b);var T=r[y=s[p+1]]-1;T<0?T=c[2*(-T-1)]:c[2*T]>0&&(r[y]=-T);var k=r[y=s[p+2]]-1;if(k<0?k=c[2*(-k-1)]:c[2*k]>0&&(r[y]=-k),p*=4,v!==o.Z.TRI_INDEX){var M=r[y=s[4*d+3]]-1;M<0?M=c[2*(-M-1)]:c[2*M]>0&&(r[y]=-M),a[p+1]=a[p+4]=b,a[p+6]=a[p+9]=T,a[p+11]=a[p+14]=k,a[p+3]=a[p+12]=M,a[p+2]=a[p+7]=a[p+8]=a[p+13]=n[p+2],a[p]=_,a[p+5]=m,a[p+10]=g,a[p+15]=v;var x=2*n[p+2];h[x]=.25*(h[2*_]+h[2*m]+h[2*g]+h[2*v]),h[x+1]=.25*(h[2*_+1]+h[2*m+1]+h[2*g+1]+h[2*v+1])}else a[p]=a[p+5]=a[p+8]=b,a[p+1]=a[p+10]=a[p+12]=T,a[p+2]=a[p+6]=a[p+14]=k,a[p+3]=a[p+7]=a[p+11]=a[p+15]=o.Z.TRI_INDEX,a[p+4]=_,a[p+9]=m,a[p+13]=g}t.setFacesTexCoord(a)}(e,t,r)}(e,t,i),t.allocateArrays()},ai.partialSubdivision=function(e,t,r,i){oi(e,t,r,i),li(e,t,r,i)};const ui=ai;var ci={importOBJ:function(e,t){for(var r=[],i=[],n=[],a=[],s=[],l=[],u=[],c=[],h=[],d=0,f=0,p=0,_=0,m=e.split("\n"),g=[],v=1/255,y=m.length,b=0;b<y;++b){var T=m[b].trim();if(0!==T.length){var k,M=T[0];if("v"===M)" "===(k=T[1])?(g=T.split(/\s+/),i.push(parseFloat(g[1]),parseFloat(g[2]),parseFloat(g[3])),g[4]&&n.push(parseFloat(g[4]),parseFloat(g[5]),parseFloat(g[6])),++p):"t"===k&&(g=T.split(/\s+/),u.push(parseFloat(g[1]),parseFloat(g[2])),++_);else if("f"===M){var x=(g=T.split(/\s+/)).length-1;if(x<3)continue;for(var S=Math.ceil(x/2)-1,A=0;A<S;++A){var E=A+1,R=A+2,w=x-E,C=x-A;w===R&&(w=C,C=o.Z.TRI_INDEX);var P,D=g[E].split("/"),I=g[R].split("/"),F=g[w].split("/"),O=C!==o.Z.TRI_INDEX;O&&(P=g[C].split("/"));var V=parseInt(D[0],10),L=parseInt(I[0],10),N=parseInt(F[0],10),B=O?parseInt(P[0],10):void 0;if((!O||B!==V&&B!==L&&B!==N)&&V!==L&&V!==N&&L!==N)if(V=(V<0?V+p:V-1)-d,L=(L<0?L+p:L-1)-d,N=(N<0?N+p:N-1)-d,O&&(B=(B<0?B+p:B-1)-d),c.push(V,L,N,O?B:o.Z.TRI_INDEX),D[1]){var U=parseInt(D[1],10),Z=parseInt(I[1],10),z=parseInt(F[1],10),G=O?parseInt(P[1],10):void 0;U=(U<0?U+_:U-1)-f,Z=(Z<0?Z+_:Z-1)-f,z=(z<0?z+_:z-1)-f,O&&(G=(G<0?G+_:G-1)-f),h.push(U,Z,z,O?G:o.Z.TRI_INDEX)}else h.length>0&&h.push(V,L,N,O?B:o.Z.TRI_INDEX)}}else if("#"===M){if("M"!==T[1])continue;if(T.startsWith("#MRGB "))for(var W=(g=T.split(/\s+/))[1],j=2,X=W.length;j<X;j+=8){var H=parseInt(W.substr(j,6),16);a.push((H>>16)*v,(H>>8&255)*v,(255&H)*v)}else if(T.startsWith("#MAT "))for(var Y=(g=T.split(/\s+/))[1],K=0,q=Y.length;K<q;K+=6){var J=parseInt(Y.substr(K,6),16);l.push((J>>16)*v,(J>>8&255)*v,(255&J)*v)}}else T.startsWith("o ")&&(r.length>0&&(ci.initMeshOBJ(r[r.length-1],i,c,n,s,u,h,a,l),d=p,f=_),r.push(new Ct(t)))}}return 0===r.length&&(r[0]=new Ct(t)),ci.initMeshOBJ(r[r.length-1],i,c,n,s,u,h,a,l),r},initMeshOBJ:function(e,t,r,i,n,a,s,o,l){e.setVertices(new Float32Array(t)),e.setFaces(new Uint32Array(r)),o.length===t.length?e.setColors(new Float32Array(o)):i.length===t.length&&e.setColors(new Float32Array(i)),l.length===t.length?e.setMaterials(new Float32Array(l)):n.length===t.length&&e.setMaterials(new Float32Array(n)),a.length>0&&s.length===r.length&&e.initTexCoordsDataFromOBJData(a,s),t.length=r.length=0,o.length=i.length=0,l.length=n.length=0,a.length=s.length=0}};const hi=ci;var di={VERSION:3,exportSGL:function(e,t){var r,i=e.length,n=4*(9+31*i),a=0;for(a=0;a<i;++a)n+=4*(r=e[a]).getNbVertices()*3,r.getColors()&&(n+=4*r.getNbVertices()*3),r.getMaterials()&&(n+=4*r.getNbVertices()*3),n+=4*r.getNbFaces()*4,r.hasUV()&&(n+=4*r.getNbTexCoords()*2,n+=4*r.getNbFaces()*4);var s=new ArrayBuffer(n),o=new Float32Array(s),l=new Uint32Array(s),u=0;l[u++]=di.VERSION,l[u++]=t._showGrid,l[u++]=g.showSymmetryLine,l[u++]=t._showContour;var c=t.getCamera();for(l[u++]=c.getProjectionType(),l[u++]=c.getMode(),o[u++]=c.getFov(),l[u++]=c.getUsePivot(),l[u++]=i,a=0;a<i;++a){r=e[a],l[u++]=r.getShaderType(),l[u++]=r.getMatcap(),l[u++]=r.getShowWireframe(),l[u++]=r.getFlatShading(),o[u++]=r.getOpacity(),o.set(r.getCenter(),u),u+=3,o.set(r.getMatrix(),u),u+=16,o[u++]=r.getScale();var h=r.getNbVertices();l[u++]=h,o.set(r.getVertices().subarray(0,3*h),u),u+=3*h;var d=r.getColors()?h:0;l[u++]=d,d>0&&o.set(r.getColors().subarray(0,3*h),u),u+=3*d;var f=r.getMaterials()?h:0;l[u++]=f,f>0&&o.set(r.getMaterials().subarray(0,3*h),u),u+=3*f;var p=r.getNbFaces();l[u++]=p,l.set(r.getFaces().subarray(0,4*p),u),u+=4*p;var _=r.hasUV(),m=r.getNbTexCoords();l[u++]=_?m:0,_&&(o.set(r.getTexCoords().subarray(0,2*m),u),u+=2*m),l[u++]=_?p:0,_&&(l.set(r.getFacesTexCoord().subarray(0,4*p),u),u+=4*p)}var v=new DataView(s,0,4*u);return new Blob([v])}};const fi=di;var pi={},_i=function(e){for(var t=new Uint32Array(e),r=t.length/4,i=0;i<r;++i){var n=4*i+3;e[n]<0&&(t[n]=o.Z.TRI_INDEX)}return t};pi.importSGL=function(e,t,r){var i=new Float32Array(e),n=new Uint32Array(e),a=new Int32Array(e),s=0,o=n[s++];if(o>fi.VERSION)return[];if(o>=2){r._showGrid=n[s++],g.showSymmetryLine=n[s++],r._showContour=n[s++];var l=r.getCamera();l.setProjectionType(n[s++]),l.setMode(n[s++]),l.setFov(i[s++]),l.setUsePivot(n[s++])}for(var u=n[s++],c=new Array(u),h=0;h<u;++h){var d=c[h]=new Ct(t);if(o>=2){var f=d.getRenderData();f._shaderType=n[s++],f._matcap=n[s++],f._showWireframe=n[s++],f._flatShading=n[s++],f._alpha=i[s++]}d.getCenter().set(i.subarray(s,s+3)),s+=3,d.getMatrix().set(i.subarray(s,s+16)),s+=16,s++;var p=n[s++];d.setVertices(i.subarray(s,s+3*p)),s+=3*p,(p=n[s++])>0&&d.setColors(i.subarray(s,s+3*p)),s+=3*p,(p=n[s++])>0&&d.setMaterials(i.subarray(s,s+3*p)),s+=3*p,p=n[s++],o<=2?d.setFaces(_i(a.subarray(s,s+4*p))):d.setFaces(n.subarray(s,s+4*p)),s+=4*p;var _=null;(p=n[s++])&&(_=i.subarray(s,s+2*p)),s+=2*p;var m=null;(p=n[s++])&&(m=o<=2?_i(a.subarray(s,s+4*p)):n.subarray(s,s+4*p)),s+=4*p,_&&m&&d.initTexCoordsDataFromOBJData(_,m)}return c};const mi=pi;var gi={},vi=function(e){switch(e){case"uchar":case"char":case"int8":case"uint8":return 1;case"ushort":case"short":case"int16":case"uint16":return 2;case"uint":case"int":case"float":case"int32":case"uint32":case"float32":return 4;case"double":case"float64":return 8;default:return 0}},yi=function(e,t){var r=t?1/255:1;switch(e){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return function(e){return parseInt(e,10)*r};case"float":case"double":case"float32":case"float64":return parseFloat;default:return function(e){return e}}},bi=function(e,t,r){var i=r?1/255:1,n=t.offsetOctet;switch(t.type){case"int8":case"char":return function(t){return e.getInt8(t+n)*i};case"uint8":case"uchar":return function(t){return e.getUint8(t+n)*i};case"int16":case"short":return function(t){return e.getInt16(t+n,!0)*i};case"uint16":case"ushort":return function(t){return e.getUint16(t+n,!0)*i};case"int32":case"int":return function(t){return e.getInt32(t+n,!0)*i};case"uint32":case"uint":return function(t){return e.getUint32(t+n,!0)*i};case"float32":case"float":return function(t){return e.getFloat32(t+n,!0)};case"float64":case"double":return function(t){return e.getFloat64(t+n,!0)}}},Ti=function(e,t){var r=e.properties,i=e.objProperties={};e.offsetOctet=0;for(var n=0,a=r.length;n<a;++n){var s=r[n],o=i[s.name]={};o.type=s.type,o.type2=s.type2,t.isBinary?(o.offsetOctet=e.offsetOctet,e.offsetOctet+=vi(s.type)):o.id=n}},ki=function(e,t){Ti(e,t);var r,i=t.vertices=new Float32Array(3*e.count),n=e.objProperties;(n.red||n.green||n.blue)&&(r=t.colors=new Float32Array(3*e.count)),t.isBinary?function(e,t,r,i){var n,a,s,o=e.count,l=e.objProperties,u=e.offsetOctet,c=u*o,h=new DataView(t.buffer,t.offsetOctet,c),d=bi(h,l.x,!0),f=bi(h,l.y,!0),p=bi(h,l.z,!0);l.red&&(n=bi(h,l.red,!0)),l.green&&(a=bi(h,l.green,!0)),l.blue&&(s=bi(h,l.blue,!0));for(var _=0;_<o;++_){var m=3*_,g=_*u;r[m]=d(g),r[m+1]=f(g),r[m+2]=p(g),n&&(i[m]=n(g)),a&&(i[m+1]=a(g)),s&&(i[m+2]=s(g))}t.offsetOctet+=c}(e,t,i,r):function(e,t,r,i){var n,a,s,o,l,u,c=e.count,h=t.lines,d=e.objProperties,f=t.offsetLine,p=yi(d.x.type,!0),_=yi(d.y.type,!0),m=yi(d.z.type,!0),g=d.x.id,v=d.y.id,y=d.z.id;d.red&&(n=yi(d.red.type,!0)),d.green&&(a=yi(d.green.type,!0)),d.blue&&(s=yi(d.blue.type,!0)),d.red&&(o=d.red.id),d.green&&(l=d.green.id),d.blue&&(u=d.blue.id);for(var b=0;b<c;++b){var T=3*b,k=h[f+b].trim().split(/\s+/);r[T]=p(k[g]),r[T+1]=_(k[v]),r[T+2]=m(k[y]),n&&(i[T]=n(k[o])),a&&(i[T+1]=a(k[l])),s&&(i[T+2]=s(k[u]))}t.offsetLine+=c}(e,t,i,r)},Mi=function(e,t,r,i){for(var n=e.count,a=e.objProperties,s=a&&(a.vertex_index||a.vertex_indices)||e.properties[0],l=new DataView(t.buffer,t.offsetOctet),u=bi(l,s),c=bi(l,{type:s.type2,offsetOctet:s.offsetOctet+vi(s.type)}),h=vi(s.type2),d=e.offsetOctet,f=0,p=0,_=0;_<n;++_){var m=u(f);3!==m&&4!==m||(r[p++]=c(f),r[p++]=c(f+h),r[p++]=c(f+2*h),r[p++]=3===m?o.Z.TRI_INDEX:c(f+3*h)),f+=m*h+d}i||(t.faces=r.subarray(0,p)),t.offsetOctet+=f},xi=function(e,t){Ti(e,t);var r=t.faces=new Uint32Array(4*e.count);t.isBinary?Mi(e,t,r):function(e,t,r){for(var i=e.count,n=t.lines,a=e.objProperties,s=t.offsetLine,l=a.vertex_index||a.vertex_indices,u=yi(l.type),c=yi(l.type2),h=l.id,d=0,f=0;f<i;++f){var p=n[s+f].trim().split(/\s+/),_=u(p[0]);3!==_&&4!==_||(r[d]=c(p[h+1]),r[d+1]=c(p[h+2]),r[d+2]=c(p[h+3]),r[d+3]=4===_?c(p[h+4]):o.Z.TRI_INDEX,d+=4)}t.offsetLine+=i}(e,t,r)},Si=function(e,t){var r=e.count;t.isBinary?Mi(e,t,[],!0):t.offsetLine+=r};gi.importPLY=function(e,t){for(var r=function(e){for(var t,r=o.Z.ab2str(e).split("\n"),i={isBinary:!1,start:0,elements:[],lines:r,buffer:e,vertices:null,faces:null,colors:null,offsetLine:0,offsetOctet:0},n=0;;){var a=r[n++];if(i.offsetOctet+=a.length+1,i.offsetLine=n,(a=a.trim()).startsWith("format binary"))i.isBinary=!0;else if(a.startsWith("element"))t=a.split(/\s+/),i.elements.push({name:t[1],count:parseInt(t[2],10),properties:[]});else if(a.startsWith("property")){var s="list"===(t=a.split(/\s+/))[1];i.elements[i.elements.length-1].properties.push({type:t[s?2:1],type2:s?t[3]:void 0,name:t[s?4:2]})}else if(a.startsWith("end_header"))break}return i}(e),i=r.elements,n=0,a=i.length;n<a;++n){var s=i[n];"vertex"===s.name?ki(s,r):"face"===s.name?xi(s,r):Si(s,r)}var l=new Ct(t);return l.setVertices(r.vertices),l.setFaces(r.faces),l.setColors(r.colors),[l]};const Ai=gi;var Ei={importSTL:function(e,t){var r,i=new Uint32Array(e,80,1)[0]||0,n=84+50*i===e.byteLength,a=n?Ei.importBinarySTL(e,i):Ei.importAsciiSTL(o.Z.ab2str(e));n&&(r=a[1],a=a[0]),i=a.length/9;for(var s=new Map,l=[0],u=new Uint32Array(4*i),c=0;c<i;++c){var h=4*c,d=9*c;u[h]=Ei.detectNewVertex(s,a,r,d,l),u[h+1]=Ei.detectNewVertex(s,a,r,d+3,l),u[h+2]=Ei.detectNewVertex(s,a,r,d+6,l),u[h+3]=o.Z.TRI_INDEX}var f=new Ct(t);return f.setVertices(a.subarray(0,3*l[0])),r&&f.setColors(r.subarray(0,3*l[0])),f.setFaces(u),[f]},detectNewVertex:function(e,t,r,i,n){var a=t[i],s=t[i+1],o=t[i+2],l=a+"+"+s+"+"+o,u=e.get(l);if(void 0===u){u=n[0],e.set(l,u);var c=3*u;t[c]=a,t[c+1]=s,t[c+2]=o,r&&(r[c]=r[i],r[c+1]=r[i+1],r[c+2]=r[i+2]),n[0]++}return u},importAsciiSTL:function(e){for(var t=e.split("\n"),r=t.length,i=new Float32Array(Math.ceil(9*r/7)),n=0,a=0;a<r;++a)if(t[a].trim().startsWith("facet")){var s=t[a+2].trim().split(/\s+/);i[n++]=parseFloat(s[1]),i[n++]=parseFloat(s[2]),i[n++]=parseFloat(s[3]),s=t[a+3].trim().split(/\s+/),i[n++]=parseFloat(s[1]),i[n++]=parseFloat(s[2]),i[n++]=parseFloat(s[3]),s=t[a+4].trim().split(/\s+/),i[n++]=parseFloat(s[1]),i[n++]=parseFloat(s[2]),i[n++]=parseFloat(s[3])}return i.subarray(0,n)},importBinarySTL:function(e,t){var r=new Uint8Array(e),i=r.subarray(0,80),n=-1!==String.fromCharCode.apply(null,i).indexOf("COLOR="),a=0,s=new Uint8Array(36*t),o=new Uint8Array(2*t),l=96,u=0,c=0;for(a=0;a<t;a++){for(var h=0;h<36;++h)s[u++]=r[l++];o[c++]=r[l++],o[c++]=r[l++],l+=12}var d=new Uint16Array(o.buffer);o=new Float32Array(9*t);var f=1/31;for(a=0;a<t;++a){u=9*a;var p=d[a],_=1,m=1,g=1,v=32768&p;n?v||(_=(31&p)*f,m=(p>>5&31)*f,g=(p>>10&31)*f):v&&(_=(p>>10&31)*f,m=(p>>5&31)*f,g=(31&p)*f),o[u]=o[u+3]=o[u+6]=_,o[u+1]=o[u+4]=o[u+7]=m,o[u+2]=o[u+5]=o[u+8]=g}return[new Float32Array(s.buffer),o]}};const Ri=Ei,wi={importOBJ:hi.importOBJ,importSGL:mi.importSGL,importPLY:Ai.importPLY,importSTL:Ri.importSTL};var Ci=r(88),Pi=r.n(Ci);function Di(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}const Ii=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=r._main,this._menu=null,this.init(t)}var t,r;return t=e,(r=[{key:"init",value:function(e){var t=this._menu=e.addMenu((0,x.Z)("backgroundTitle"));this._bg=this._main.getBackground(),t.addCombobox("Type",this._bg._type,this.onBackgroundType.bind(this),["Image","Environment","Ambient env"]),this._ctrlBlur=t.addSlider("Blur",this._bg._blur,this.onEnvBlur.bind(this),0,1,.01),this._ctrlBlur.setVisibility(1===this._bg._type),t.addTitle("Image"),t.addButton((0,x.Z)("backgroundReset"),this,"resetBackground"),t.addButton((0,x.Z)("backgroundImport"),this,"importBackground"),t.addCheckbox((0,x.Z)("backgroundFill"),this._main.getBackground()._fill,this.updateFill.bind(this))}},{key:"updateFill",value:function(e){this._bg._fill=e,this._main.onCanvasResize()}},{key:"resetBackground",value:function(){this._bg.deleteTexture(),this._main.render()}},{key:"onEnvBlur",value:function(e){this._bg._blur=e,this._main.render()}},{key:"onBackgroundType",value:function(e){this._bg.setType(e),this._main.onCanvasResize(),this._main.render(),this._ctrlBlur.setVisibility(1===e)}},{key:"importBackground",value:function(){document.getElementById("backgroundopen").click()}}])&&Di(t.prototype,r),e}();function Fi(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}const Oi=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=r._main,this._menu=null,this._camera=this._main.getCamera(),this._cameraTimer=-1,this._cbTranslation=this.cbOnTranslation.bind(this),this.init(t)}var t,r;return t=e,(r=[{key:"init",value:function(e){var t=this._camera,r=this._menu=e.addMenu((0,x.Z)("cameraTitle"));r.addTitle((0,x.Z)("cameraReset")),r.addDualButton((0,x.Z)("cameraCenter"),(0,x.Z)("cameraFront"),this.resetCamera.bind(this),this.resetFront.bind(this)),r.addDualButton((0,x.Z)("cameraLeft"),(0,x.Z)("cameraTop"),this.resetLeft.bind(this),this.resetTop.bind(this)),this._ctrlProjectionTitle=r.addTitle((0,x.Z)("cameraProjection"));var i=[];i[s.Z.Projection.PERSPECTIVE]=(0,x.Z)("cameraPerspective"),i[s.Z.Projection.ORTHOGRAPHIC]=(0,x.Z)("cameraOrthographic"),this._ctrlProjection=r.addCombobox("",t.getProjectionType(),this.onCameraTypeChange.bind(this),i),this._ctrlFov=r.addSlider((0,x.Z)("cameraFov"),t.getFov(),this.onFovChange.bind(this),10,90,1),this._ctrlFov.setVisibility(t.getProjectionType()===s.Z.Projection.PERSPECTIVE),r.addTitle((0,x.Z)("cameraMode"));var n=[];n[s.Z.CameraMode.ORBIT]=(0,x.Z)("cameraOrbit"),n[s.Z.CameraMode.SPHERICAL]=(0,x.Z)("cameraSpherical"),n[s.Z.CameraMode.PLANE]=(0,x.Z)("cameraPlane"),r.addCombobox("",t.getMode(),this.onCameraModeChange.bind(this),n),this._ctrlPivot=r.addCheckbox((0,x.Z)("cameraPivot"),t.getUsePivot(),this.onPivotChange.bind(this)),r.addSlider("speed",this._main,"_cameraSpeed",.05,1,.001)}},{key:"onCameraModeChange",value:function(e){this._camera.setMode(e),this._main.render()}},{key:"onCameraTypeChange",value:function(e){this._camera.setProjectionType(e),this._ctrlFov.setVisibility(e===s.Z.Projection.PERSPECTIVE),this._main.render()}},{key:"onFovChange",value:function(e){this._camera.setFov(e),this._main.render()}},{key:"onKeyDown",value:function(e){if(!0!==e.handled&&(e.stopPropagation(),!this._main._focusGui)){e.preventDefault();var t=this._main,r=t.getCamera();switch(e.handled=!0,e.shiftKey&&t._action===s.Z.Action.CAMERA_ROTATE&&(r.snapClosestRotation(),t.render()),l.Z.getShortKey(e.which)){case s.Z.KeyAction.STRIFE_LEFT:r._moveX=-1;break;case s.Z.KeyAction.STRIFE_RIGHT:r._moveX=1;break;case s.Z.KeyAction.STRIFE_UP:r._moveZ=-1;break;case s.Z.KeyAction.STRIFE_DOWN:r._moveZ=1;break;default:e.handled=!1}!0===e.handled&&-1===this._cameraTimer&&(this._cameraTimer=window.setInterval(this._cbTranslation,16.6))}}},{key:"cbOnTranslation",value:function(){var e=this._main;e.getCamera().updateTranslation(),e.render()}},{key:"onKeyUp",value:function(e){if(!0!==e.handled&&(e.stopPropagation(),!this._main._focusGui)){e.preventDefault(),e.handled=!0;var t=this._camera;switch(l.Z.getShortKey(e.which)){case s.Z.KeyAction.STRIFE_LEFT:case s.Z.KeyAction.STRIFE_RIGHT:t._moveX=0;break;case s.Z.KeyAction.STRIFE_UP:case s.Z.KeyAction.STRIFE_DOWN:t._moveZ=0;break;case s.Z.KeyAction.CAMERA_RESET:this.resetCamera();break;case s.Z.KeyAction.CAMERA_FRONT:this.resetFront();break;case s.Z.KeyAction.CAMERA_TOP:this.resetTop();break;case s.Z.KeyAction.CAMERA_LEFT:this.resetLeft();break;default:e.handled=!1}-1!==this._cameraTimer&&0===t._moveX&&0===t._moveZ&&(clearInterval(this._cameraTimer),this._cameraTimer=-1)}}},{key:"resetCamera",value:function(){this._camera.resetView(),this._main.render()}},{key:"resetFront",value:function(){this._camera.toggleViewFront(),this._main.render()}},{key:"resetLeft",value:function(){this._camera.toggleViewLeft(),this._main.render()}},{key:"resetTop",value:function(){this._camera.toggleViewTop(),this._main.render()}},{key:"onPivotChange",value:function(){this._camera.toggleUsePivot(),this._main.render()}}])&&Fi(t.prototype,r),e}();function Vi(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}const Li=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._ctrlGui=r,this._menu=null,this.init(t)}var t,r;return t=e,(r=[{key:"init",value:function(e){this._langs=Object.keys(x.Z.languages),this._menu=e.addMenu("Language"),this._menu.addCombobox("",this._langs.indexOf(x.Z.select),this.onLangChange.bind(this),this._langs)}},{key:"onLangChange",value:function(e){x.Z.select=this._langs[parseInt(e,10)],this._ctrlGui.initGui()}}])&&Vi(t.prototype,r),e}();var Ni=r(652),Bi=r(141),Ui={exportOBJ:function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i="s 0\n",n=[1,1],a=0,s=e.length;a<s;++a)i+="o mesh_"+a+"\n",i=Ui.addMesh(e[a],i,n,t,r);return new Blob([i])}},Zi=function(e,t,r){for(var i=0,n=t.length;i<n;i++)e[r++]=t.charCodeAt(i);return r};Ui.addMesh=function(e,t,r,n,a){var s=e.getVertices(),l=e.getColors(),u=e.getMaterials(),c=e.getFaces(),h=e.getNbVertices(),d=e.getNbFaces(),f=e.getNbTexCoords(),p=e.getMatrix(),_=0,m=0,g="",v=0;v=a?128*h:79*h,v+=45*f+66*d;var y=new Uint8Array(Math.max(1e3,v)),b=0,T=[0,0,0];for(_=0;_<h;++_)m=3*_,T[0]=s[m],T[1]=s[m+1],T[2]=s[m+2],i.R3.transformMat4(T,T,p),g="v "+T[0]+" "+T[1]+" "+T[2],g+=a?" "+l[m]+" "+l[m+1]+" "+l[m+2]+"\n":"\n",b=Zi(y,g,b);if(n){var k=Math.ceil(h/64);for(_=0;_<k;++_){g="#MRGB ",m=64*_;for(var M=_===k-1?h:m+64;m<M;++m){g+="ff";var x=3*m,S=Math.round(255*l[x]).toString(16),A=Math.round(255*l[x+1]).toString(16),E=Math.round(255*l[x+2]).toString(16);g+=1===S.length?"0"+S:S,g+=1===A.length?"0"+A:A,g+=1===E.length?"0"+E:E}b=Zi(y,g+="\n",b)}for(k=Math.ceil(h/46),_=0;_<k;++_){g="#MAT ",m=46*_;for(var R=_===k-1?h:m+46;m<R;++m){var w=3*m,C=Math.round(255*u[w]).toString(16),P=Math.round(255*u[w+1]).toString(16),D=Math.round(255*u[w+2]).toString(16);g+=1===C.length?"0"+C:C,g+=1===P.length?"0"+P:P,g+=1===D.length?"0"+D:D}b=Zi(y,g+="\n",b)}}var I=e.getFacesTexCoord(),F=e.getTexCoords(),O=e.hasUV();if(O)for(_=0;_<f;++_)g="vt "+F[m=2*_]+" "+F[m+1]+"\n",b=Zi(y,g,b);var V=r[0],L=r[1];for(r[0]+=h,r[1]+=f,_=0;_<d;++_){var N=c[3+(m=4*_)];O?(g="f "+(V+c[m])+"/"+(L+I[m]),g+=" "+(V+c[m+1])+"/"+(L+I[m+1]),g+=" "+(V+c[m+2])+"/"+(L+I[m+2]),g+=N!==o.Z.TRI_INDEX?" "+(V+N)+"/"+(L+I[m+3])+"\n":"\n"):(g="f "+(V+c[m]),g+=" "+(V+c[m+1]),g+=" "+(V+c[m+2]),g+=N!==o.Z.TRI_INDEX?" "+(V+N)+"\n":"\n"),b=Zi(y,g,b)}if(y=y.subarray(0,b),window.TextDecoder)return t+(new TextDecoder).decode(y);for(_=0;_<b;++_)t+=String.fromCharCode(y[_]);return t};const zi=Ui;var Gi={},Wi=function(e){return dr.mergeArrays(e,{vertices:null,colors:null,faces:null})};Gi.exportAsciiPLY=function(e){var t=Wi(e),r=t.nbVertices,i=t.nbFaces,n=t.vertices,a=t.colors,s=t.faces,l=0,u=0,c="ply\nformat ascii 1.0\ncomment created by SculptGL\n";for(c+="element vertex "+r+"\n",c+="property float x\nproperty float y\nproperty float z\n",c+="property uchar red\nproperty uchar green\nproperty uchar blue\n",c+="element face "+i+"\n",c+="property list uchar uint vertex_indices\nend_header\n",l=0;l<r;++l)c+=n[u=3*l]+" "+n[u+1]+" "+n[u+2]+" "+(255*a[u]|0)+" "+(255*a[u+1]|0)+" "+(255*a[u+2]|0)+"\n";for(l=0;l<i;++l){var h=s[3+(u=4*l)],d=h!==o.Z.TRI_INDEX;c+=(d?"4 ":"3 ")+s[u]+" "+s[u+1]+" "+s[u+2]+(d?" "+h+"\n":"\n")}return new Blob([c])},Gi.exportBinaryPLY=function(e,t){var r=Wi(e),i=r.nbVertices,n=r.nbFaces,a=r.nbQuads,s=r.nbTriangles,l=r.vertices,u=r.colors,c=r.faces,h=0,d=0,f=0;if(t&&t.swapXY)for(h=0;h<i;++h){var p=l[1+(f=3*h)];l[f+1]=-l[f+2],l[f+2]=p}var _="ply\nformat binary_"+(o.Z.littleEndian?"little":"big")+"_endian 1.0\ncomment created by SculptGL\n";_+="element vertex "+i+"\n",_+="property float x\nproperty float y\nproperty float z\n",_+="property uchar red\nproperty uchar green\nproperty uchar blue\n",_+="element face "+n+"\n",_+="property list uchar uint vertex_indices\nend_header\n";var m=4*l.length+u.length,g=4*(4*a+3*s)+n,v=_.length+m+2*g,y=new Uint8Array(v),b=new DataView(y.buffer);d=_.length;var T=0;for(T=0;T<d;++T)y[T]=_.charCodeAt(T);for(h=0;h<i;++h)d=3*h,b.setFloat32(T,l[d],!0),T+=4,b.setFloat32(T,l[d+1],!0),T+=4,b.setFloat32(T,l[d+2],!0),T+=4,b.setUint8(T,Math.round(255*u[d])),T+=1,b.setUint8(T,Math.round(255*u[d+1])),T+=1,b.setUint8(T,Math.round(255*u[d+2])),T+=1;for(h=0;h<n;++h){var k=c[3+(d=4*h)]!==o.Z.TRI_INDEX;b.setUint8(T,k?4:3),T+=1,b.setUint32(T,c[d],!0),T+=4,b.setUint32(T,c[d+1],!0),T+=4,b.setUint32(T,c[d+2],!0),T+=4,k&&(b.setUint32(T,c[d+3],!0),T+=4)}return new Blob([y])};const ji=Gi;var Xi={},Hi=function(e){for(var t=dr.mergeArrays(e,{vertices:null,colors:null,triangles:null}),r=t.vertices,n=t.triangles,a=i.R3.create(),s=i.R3.create(),o=i.R3.create(),l=t.faceNormals=new Float32Array(3*t.nbTriangles),u=0;u<t.nbTriangles;++u){var c=3*u,h=3*n[c],d=3*n[c+1],f=3*n[c+2];i.R3.set(a,r[h],r[h+1],r[h+2]),i.R3.set(s,r[d],r[d+1],r[d+2]),i.R3.set(o,r[f],r[f+1],r[f+2]),i.R3.sub(s,s,a),i.R3.sub(o,o,s),i.R3.cross(a,s,o),i.R3.normalize(a,a),l[c]=a[0],l[c+1]=a[1],l[c+2]=a[2]}return t};Xi.exportAsciiSTL=function(e){for(var t=Hi(e),r=t.nbTriangles,i=t.vertices,n=t.triangles,a=t.faceNormals,s="solid mesh\n",o=0;o<r;++o){var l=3*o;s+=" facet normal "+a[l]+" "+a[l+1]+" "+a[l+2]+"\n",s+="  outer loop\n";var u=3*n[l],c=3*n[l+1],h=3*n[l+2];s+="   vertex "+i[u]+" "+i[u+1]+" "+i[u+2]+"\n",s+="   vertex "+i[c]+" "+i[c+1]+" "+i[c+2]+"\n",s+="   vertex "+i[h]+" "+i[h+1]+" "+i[h+2]+"\n",s+="  endloop\n",s+=" endfacet\n"}return s+="endsolid mesh\n",new Blob([s])},Xi.exportBinarySTL=function(e,t){var r,i,n=Hi(e),a=n.nbTriangles,s=n.vertices,o=n.colors,l=n.triangles,u=n.faceNormals;if(t&&t.swapXY){var c=n.nbVertices;for(r=0;r<c;++r){var h=s[1+(i=3*r)];s[i+1]=-s[i+2],s[i+2]=h}}var d=new Uint8Array(84+50*a),f=t&&t.colorMagic;if(f){var p=[67,79,76,79,82,61,255,255,255,255];for(r=0;r<p.length;++r)d[r]=p[r]}new DataView(d.buffer).setUint32(80,a,!0);var _=new Uint8Array(s.buffer),m=new Uint8Array(u.buffer),g=84,v=0,y=f?0:32768,b=31/3;for(r=0;r<a;++r){for(i=12*r,v=0;v<12;++v)d[g++]=m[i++];var T=3*l[i=3*r],k=3*l[i+1],M=3*l[i+2],x=4*T;for(v=0;v<12;++v)d[g++]=_[x++];var S=4*k;for(v=0;v<12;++v)d[g++]=_[S++];var A=4*M;for(v=0;v<12;++v)d[g++]=_[A++];var E=Math.round((o[T]+o[k]+o[M])*b),R=Math.round((o[T+1]+o[k+1]+o[M+1])*b)<<5,w=Math.round((o[T+2]+o[k+2]+o[M+2])*b);f?w<<=10:E<<=10;var C=E+R+w+y;d[g++]=255&C,d[g++]=C>>8}return new Blob([d])};const Yi=Xi;var Ki=r(751),qi=r.n(Ki);function Ji(e){return(Ji="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var Qi={exportSketchfab:function(e,t){if(window.sketchfabOAuth2Config){var r=new XMLHttpRequest;return new(qi())(window.sketchfabOAuth2Config).connect().then((function(i){!function(e,t,r,i){e.open("POST","https://api.sketchfab.com/v2/models",!0),e.onprogress=function(e){if(e.lengthComputable&&e.total){var t=Math.round(100*e.loaded/e.total);i.setVisibility("Sketchfab upload: "+t+"%")}};var n=function(){i.setMessage("")};e.onerror=n,e.onabort=n,e.onload=function(){n();var t=JSON.parse(e.responseText),i=t.uid;i?(window.prompt((0,x.Z)("sketchfabUploadProcessing"),"https://sketchfab.com/models/"+i),function e(){var t=new XMLHttpRequest,n="https://api.sketchfab.com/v2/models/"+i+"/status";"object"===Ji(r)&&r.hasOwnProperty("token_type")&&"Bearer"===r.token_type?(t.open("GET",n,!0),t.setRequestHeader("Authorization","Bearer "+r.access_token)):t.open("GET",n+"?token="+r,!0),t.onload=function(){var r=JSON.parse(t.responseText);"FAILED"===r.processing?window.alert((0,x.Z)("sketchfabUploadError",r.warning.generic.join("\n"))):"SUCCEEDED"===r.processing?window.prompt((0,x.Z)("sketchfabUploadSuccess"),"https://sketchfab.com/models/"+i):window.setTimeout(e,5e3)},t.send()}()):window.alert((0,x.Z)("sketchfabUploadError",t.detail))},i.setMessage("Creating zip..."),Bi.zip.useWebWorkers=!0,Bi.zip.workerScriptsPath="worker/",Bi.zip.createWriter(new Bi.zip.BlobWriter("application/zip"),(function(n){var a=ji.exportBinaryPLY(t.getMeshes(),{swapXY:!0});n.add("yourMesh.ply",new Bi.zip.BlobReader(a),(function(){n.close(Qi.exportFileSketchfab.bind(this,r,e,i))}))}),onerror)}(r,e,i,t)})).catch((function(e){console.error(e)})),r}},exportFileSketchfab:function(e,t,r,i){if(!t.isAborted){var n=new FormData;n.append("modelFile",i,"sculptglModel.zip"),n.append("name","My model"),n.append("tags","sculptgl"),"object"===Ji(e)&&e.hasOwnProperty("token_type")&&"Bearer"===e.token_type?t.setRequestHeader("Authorization","Bearer "+e.access_token):n.append("token",e),r.setMessage("Sketchfab upload..."),t.send(n)}}};const $i=Qi;var en={exportSculpteo:function(e,t){var r=new XMLHttpRequest;r.open("POST","uploadSculpteo.php",!0),r.onprogress=function(e){if(e.lengthComputable&&e.total){var r=Math.round(100*e.loaded/e.total);t.setMessage("Sculpteo upload: "+r+"%")}};var i=function(){t.setMessage("")};r.onerror=i,r.onabort=i,r.onload=function(){if(i(),200===this.status){var e=r.responseText.match(/\/print\/(.+?)(?=")/);e&&window.open("https://www.sculpteo.com/en"+e[0],"_blank")}};var n=e.getMeshes(),a=e.computeBoundingBoxMeshes(n),s=e.computeRadiusFromBoundingBox(a),o=ji.exportBinaryPLY(n,{swapXY:!0});return t.setMessage("Creating zip..."),Bi.zip.useWebWorkers=!0,Bi.zip.workerScriptsPath="worker/",Bi.zip.createWriter(new Bi.zip.BlobWriter("application/zip"),(function(e){e.add("yourMesh.ply",new Bi.zip.BlobReader(o),(function(){e.close(en.exportFileSculpteo.bind(this,s,r,t))}))}),onerror),r},exportFileSculpteo:function(e,t,r,i){if(!t.isAborted){var n=new FormData;n.append("file",i),n.append("name","fromSculptgl"),n.append("scale",4/e),r.setMessage("Sculpteo upload..."),t.send(n)}}};const tn=en;var rn={exportMaterialise:function(e,t){var r=new XMLHttpRequest;r.open("POST","https://i.materialise.com/web-api/tool/20cc0fd6-3cef-4111-a201-0b87026d892c/model",!0),r.onprogress=function(e){if(e.lengthComputable&&e.total){var r=Math.round(100*e.loaded/e.total);t.setMessage("Materialise upload: "+r+"%")}};var i=function(){t.setMessage("")};r.onerror=i,r.onabort=i,r.onload=function(){if(i(),200===r.status){var e=JSON.parse(r.responseText);window.open("https://i.materialise.com/en/3dprint#modelId="+e.modelID,"_blank")}};var n=e.getMeshes(),a=e.computeBoundingBoxMeshes(n),s=e.computeRadiusFromBoundingBox(a),o=Yi.exportBinarySTL(n,{colorMagic:!0,swapXY:!0});return t.setMessage("Creating zip..."),Bi.zip.useWebWorkers=!0,Bi.zip.workerScriptsPath="worker/",Bi.zip.createWriter(new Bi.zip.BlobWriter("application/zip"),(function(e){e.add("yourMesh.stl",new Bi.zip.BlobReader(o),(function(){e.close(rn.exportFileMaterialise.bind(this,s,r,t))}))}),onerror),r},exportFileMaterialise:function(e,t,r,i){if(!t.isAborted){var n=new FormData;n.append("file",i,"yourMesh.zip"),r.setMessage("Materialise upload..."),t.send(n)}}};const nn=rn;var an={};an.exportOBJ=zi.exportOBJ,an.exportSGL=fi.exportSGL,an.exportAsciiPLY=ji.exportAsciiPLY,an.exportBinaryPLY=ji.exportBinaryPLY,an.exportAsciiSTL=Yi.exportAsciiSTL,an.exportBinarySTL=Yi.exportBinarySTL,an.exportSketchfab=$i.exportSketchfab,an.exportSculpteo=tn.exportSculpteo,an.exportMaterialise=nn.exportMaterialise;const sn=an;var on={_gl:null,_checkRTT:{},_webGLExtensions:{}};on.HALF_FLOAT=on.HALF_FLOAT_OES=36193,on.checkRTTSupport=function(e,t){var r=on._gl;if(void 0===r)return!1;var i=e+","+t;if(void 0!==on._checkRTT[i])return on._checkRTT[i];var n=r.createTexture();r.bindTexture(r.TEXTURE_2D,n),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,2,2,0,r.RGBA,e,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,t);var a=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,a),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,n,0);var s=on._checkRTT[i]=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.deleteTexture(n),r.deleteFramebuffer(a),r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),s},on.hasRTTLinearHalfFloat=function(){return on._webGLExtensions.OES_texture_half_float_linear&&on.checkRTTSupport(on.HALF_FLOAT,on._gl.LINEAR)},on.hasRTTLinearFloat=function(){return on._webGLExtensions.OES_texture_float_linear&&on.checkRTTSupport(on._gl.FLOAT,on._gl.LINEAR)},on.hasRTTHalfFloat=function(){return on._webGLExtensions.OES_texture_half_float&&on.checkRTTSupport(on.HALF_FLOAT,on._gl.NEAREST)},on.hasRTTFloat=function(){return on._webGLExtensions.OES_texture_float&&on.checkRTTSupport(on._gl.FLOAT,on._gl.NEAREST)},on.getWebGLExtension=function(e){return on._webGLExtensions[e]},on.getWebGLExtensions=function(){return on._webGLExtensions},on.initWebGLExtensions=function(e){on._gl=e;for(var t=e.getSupportedExtensions(),r=on._webGLExtensions,i=0,n=t.length;i<n;++i){var a=t[i];r[a]=e.getExtension(a)}};const ln=on;function un(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function cn(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var hn;const dn=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.createRenderbuffer(),n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];un(this,e),this._gl=t,this._texture=t.createTexture(),this._depth=i,this._framebuffer=t.createFramebuffer(),this._shaderType=r,this._invSize=new Float32Array(2),this._vertexBuffer=null,n&&ln.hasRTTHalfFloat()?this._type=ln.HALF_FLOAT_OES:n&&ln.hasRTTFloat()?this._type=t.FLOAT:this._type=t.UNSIGNED_BYTE,this.setWrapRepeat(!1),this.setFilterNearest(!1),this.init()}var t,r;return t=e,(r=[{key:"getGL",value:function(){return this._gl}},{key:"getVertexBuffer",value:function(){return this._vertexBuffer}},{key:"getFramebuffer",value:function(){return this._framebuffer}},{key:"getTexture",value:function(){return this._texture}},{key:"getDepth",value:function(){return this._depth}},{key:"getInverseSize",value:function(){return this._invSize}},{key:"init",value:function(){var e=this._gl;hn||(hn=new c(e,e.ARRAY_BUFFER,e.STATIC_DRAW)).update(new Float32Array([-1,-1,4,-1,-1,4])),this._vertexBuffer=hn}},{key:"setWrapRepeat",value:function(e){this._wrapRepeat=e}},{key:"setFilterNearest",value:function(e){this._filterNearest=e}},{key:"onResize",value:function(e,t){var r=this._gl;this._invSize[0]=1/e,this._invSize[1]=1/t,r.bindTexture(r.TEXTURE_2D,this._texture),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e,t,0,r.RGBA,this._type,null);var i=this._filterNearest?r.NEAREST:r.LINEAR;r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,i),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,i);var n=this._wrapRepeat?r.REPEAT:r.CLAMP_TO_EDGE;r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,n),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,n),this._depth&&(r.bindRenderbuffer(r.RENDERBUFFER,this._depth),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,e,t)),r.bindFramebuffer(r.FRAMEBUFFER,this._framebuffer),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,this._texture,0),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,this._depth),r.bindTexture(r.TEXTURE_2D,null)}},{key:"release",value:function(){this._texture&&this._gl.deleteTexture(this._texture),this.getVertexBuffer().release()}},{key:"render",value:function(e){J[this._shaderType].getOrCreate(this._gl).draw(this,e)}}])&&cn(t.prototype,r),e}();function fn(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}const pn=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=r._main,this._ctrlGui=r,this._menu=null,this._parent=t,this._exportAll=!0,this._objColorZbrush=!0,this._objColorAppended=!1,this.init(t)}var t,r;return t=e,(r=[{key:"init",value:function(e){var t=this._menu=e.addMenu((0,x.Z)("fileTitle"));t.addTitle((0,x.Z)("fileImportTitle")),t.addButton((0,x.Z)("fileAdd"),this,"addFile"),t.addCheckbox((0,x.Z)("fileAutoMatrix"),this._main,"_autoMatrix"),t.addCheckbox((0,x.Z)("fileVertexSRGB"),this._main,"_vertexSRGB"),t.addTitle((0,x.Z)("fileExportSceneTitle")),t.addCheckbox((0,x.Z)("fileExportAll"),this,"_exportAll"),t.addButton((0,x.Z)("fileExportSGL"),this,"saveFileAsSGL"),t.addButton((0,x.Z)("fileExportOBJ"),this,"saveFileAsOBJ"),t.addButton((0,x.Z)("fileExportPLY"),this,"saveFileAsPLY"),t.addButton((0,x.Z)("fileExportSTL"),this,"saveFileAsSTL"),t.addCheckbox("OBJ color zbrush",this,"_objColorZbrush"),t.addCheckbox("OBJ color append",this,"_objColorAppended"),t.addButton((0,x.Z)("sketchfabTitle"),this._ctrlGui,"exportSketchfab"),t.addTitle((0,x.Z)("fileExportTextureTitle")),this._guiTexSize=t.addSlider((0,x.Z)("fileExportTextureSize"),10,this.onTextureSize.bind(this),8,12,1),this._guiTexSize.setValue(10),t.addButton((0,x.Z)("fileExportColor"),this,"saveColor"),t.addButton((0,x.Z)("fileExportRoughness"),this,"saveRoughness"),t.addButton((0,x.Z)("fileExportMetalness"),this,"saveMetalness")}},{key:"addFile",value:function(){document.getElementById("fileopen").click()}},{key:"onTextureSize",value:function(e){this._texSize=1<<e,this._guiTexSize.domInputText.value=this._texSize}},{key:"_getExportMeshes",value:function(){if(this._exportAll)return this._main.getMeshes();var e=this._main.getSelectedMeshes();return e.length?e:void 0}},{key:"_extractTexture",value:function(e,t,r){var i=document.createElement("canvas");i.width=t,i.height=r;var n=new Uint8Array(4*t*r);if(e.checkFramebufferStatus(e.FRAMEBUFFER)!==e.FRAMEBUFFER_COMPLETE)return console.error("FRAMEBUFFER not complete"),i;e.flush(),e.finish(),e.readPixels(0,0,t,r,e.RGBA,e.UNSIGNED_BYTE,n);var a=i.getContext("2d"),s=a.getImageData(0,0,t,r);return s.data.set(n),a.putImageData(s,0,0),i}},{key:"_getRttPaint",value:function(e){return this._rttPaint||(this._rttPaint=new dn(e,s.Z.Shader.PAINTUV,null),this._rttPaint.setWrapRepeat(!0),this._rttPaint.setFilterNearest(!0),K.INPUT_TEXTURE=this._getRttPaint()),this._rttPaint}},{key:"_getRttBlur",value:function(e){return this._rttBlur||(this._rttBlur=new dn(e,s.Z.Shader.BLUR,null)),this._rttBlur}},{key:"_saveTexture",value:function(e){var t=this._main.getMesh();if(t)if(t.getTexCoords()){var r=t.getGL(),i=this._texSize,n=this._texSize,a=t.getShaderType();t.setShaderType(s.Z.Shader.PAINTUV);var o=this._getRttPaint(r);o.onResize(i,n),r.bindFramebuffer(r.FRAMEBUFFER,o.getFramebuffer()),r.clear(r.COLOR_BUFFER_BIT),r.viewport(0,0,i,n),t.render(),t.setShaderType(a),this._blurImage(r,i,n),this._extractTexture(r,i,n).toBlob(function(t){(0,Ni.saveAs)(t,e+".png")}.bind(this)),this._main.onCanvasResize()}else window.alert("The selected mesh has no UV!")}},{key:"_blurImage",value:function(e,t,r){var i=this._getRttBlur(e);i.onResize(t,r),e.bindFramebuffer(e.FRAMEBUFFER,i.getFramebuffer()),e.clear(e.COLOR_BUFFER_BIT),i.render(this._main)}},{key:"saveColor",value:function(){H.CHANNEL_VALUE=0,this._saveTexture("diffuse")}},{key:"saveRoughness",value:function(){H.CHANNEL_VALUE=1,this._saveTexture("roughness")}},{key:"saveMetalness",value:function(){H.CHANNEL_VALUE=2,this._saveTexture("metalness")}},{key:"saveFileAsSGL",value:function(){var e=this._getExportMeshes();e&&this._save(sn.exportSGL(e,this._main),"yourMesh.sgl")}},{key:"saveFileAsOBJ",value:function(){var e=this._getExportMeshes();e&&this._save(sn.exportOBJ(e,this._objColorZbrush,this._objColorAppended),"yourMesh.obj")}},{key:"saveFileAsPLY",value:function(){var e=this._getExportMeshes();e&&this._save(sn.exportBinaryPLY(e),"yourMesh.ply")}},{key:"saveFileAsSTL",value:function(){var e=this._getExportMeshes();e&&this._save(sn.exportBinarySTL(e),"yourMesh.stl")}},{key:"_save",value:function(e,t,r){if(!r)return(0,Ni.saveAs)(e,t);Bi.zip.useWebWorkers=!0,Bi.zip.workerScriptsPath="worker/",Bi.zip.createWriter(new Bi.zip.BlobWriter("application/zip"),(function(r){r.add(t,new Bi.zip.BlobReader(e),(function(){r.close((function(e){(0,Ni.saveAs)(e,"yourMesh.zip")}))}))}),onerror)}},{key:"onKeyDown",value:function(e){if(!0!==e.handled){e.stopPropagation(),this._main._focusGui||e.preventDefault();var t=e.which;e.ctrlKey&&e.altKey&&78===t?(this._main.clearScene(),e.handled=!0):!e.ctrlKey||79!==t&&73!==t?e.ctrlKey&&69===t&&(this.saveFileAsOBJ(),e.handled=!0):(this.addFile(),e.handled=!0)}}}])&&fn(t.prototype,r),e}();function _n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}const mn=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=r._main,this.domVerts=null,this.domFaces=null,this.domUl=null,this.init(t)}var t,r;return t=e,(r=[{key:"init",value:function(e){this.domVerts=document.createElement("ul"),this.domVerts.innerHTML=(0,x.Z)("meshNbVertices"),this.domFaces=document.createElement("ul"),this.domFaces.innerHTML=(0,x.Z)("meshNbFaces"),this.domUl=document.createElement("span"),this.domUl.appendChild(this.domVerts),this.domUl.appendChild(this.domFaces);var t=this.domUl.style;t.cursor="default",void 0===t.float?t.cssFloat="right":t.float="right",e.domTopbar.appendChild(this.domUl)}},{key:"updateMeshInfo",value:function(){var e=this._main.getMesh();this.domVerts.innerHTML=(0,x.Z)("meshNbVertices")+(e?e.getNbVertices():0),this.domFaces.innerHTML=(0,x.Z)("meshNbFaces")+(e?e.getNbFaces():0)}}])&&_n(t.prototype,r),e}();function gn(e){return(gn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function vn(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function yn(e,t){return(yn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function bn(e,t){return!t||"object"!==gn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Tn(e){return(Tn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}const kn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&yn(e,t)}(s,e);var t,r,i,n,a=(i=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Tn(i);if(n){var r=Tn(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return bn(this,e)});function s(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(r=a.call(this)).setID(e.getID()),r.setMeshData(t?e.getMeshData():{_nbVertices:0,_nbFaces:0,_nbTexCoords:0,_verticesXYZ:null,_normalsXYZ:null,_colorsRGB:null,_materialsPBR:null,_vertOnEdge:null,_vertRingFace:null,_vrfStartCount:null,_vrvStartCount:null,_vertRingVert:null,_vertTagFlags:null,_vertSculptFlags:null,_vertStateFlags:null,_vertProxy:null,_facesABCD:null,_faceEdges:null,_faceNormalsXYZ:null,_facesToTriangles:null,_trianglesABC:null,_facesTagFlags:null,_edges:null,_drawArraysWireframe:null,_drawElementsWireframe:null,_texCoordsST:null,_duplicateStartCount:null,_UVfacesABCD:null,_UVtrianglesABC:null,_DAverticesXYZ:null,_DAnormalsXYZ:null,_DAcolorsRGB:null,_DAmaterialsPBR:null,_DAtexCoordsST:null,_octree:null,_faceBoxes:null,_faceCentersXYZ:null,_facePosInLeaf:null,_faceLeaf:[],_leavesToUpdate:[],_worldBound:[1/0,1/0,1/0,-1/0,-1/0,-1/0]}),r.setRenderData(e.getRenderData()),r.setTransformData(e.getTransformData()),r._detailsXYZ=null,r._detailsRGB=null,r._detailsPBR=null,r._vertMapping=null,r._evenMapping=!1,r}return t=s,(r=[{key:"optimize",value:function(){}},{key:"getEvenMapping",value:function(){return this._evenMapping}},{key:"getVerticesMapping",value:function(){return this._vertMapping}},{key:"setVerticesMapping",value:function(e){this._vertMapping=e}},{key:"setEvenMapping",value:function(e){this._evenMapping=e}},{key:"higherSynthesis",value:function(e){e.computePartialSubdivision(this.getVertices(),this.getColors(),this.getMaterials(),this.getNbVertices()),this.applyDetails()}},{key:"lowerAnalysis",value:function(e){this.copyDataFromHigherRes(e);var t=e.getNbVertices(),r=new Float32Array(3*t),i=new Float32Array(3*t),n=new Float32Array(3*t);this.computePartialSubdivision(r,i,n,t),e.computeDetails(r,i,n,t)}},{key:"copyDataFromHigherRes",value:function(e){var t=this.getVertices(),r=this.getColors(),i=this.getMaterials(),n=this.getNbVertices(),a=e.getVertices(),s=e.getColors(),o=e.getMaterials();if(!1===this.getEvenMapping())t.set(a.subarray(0,3*n)),r.set(s.subarray(0,3*n)),i.set(o.subarray(0,3*n));else for(var l=this.getVerticesMapping(),u=0;u<n;++u){var c=3*u,h=3*l[u];t[c]=a[h],t[c+1]=a[h+1],t[c+2]=a[h+2],r[c]=s[h],r[c+1]=s[h+1],r[c+2]=s[h+2],i[c]=o[h],i[c+1]=o[h+1],i[c+2]=o[h+2]}}},{key:"computePartialSubdivision",value:function(e,t,r,i){var n=this.getVerticesMapping();if(n){var a=new Float32Array(3*i),s=new Float32Array(3*i),o=new Float32Array(3*i);ui.partialSubdivision(this,a,s,o);var l=!0===this.getEvenMapping()?0:this.getNbVertices();l>0&&(e.set(a.subarray(0,3*l)),t.set(s.subarray(0,3*l)),r.set(o.subarray(0,3*l)));for(var u=l;u<i;++u){var c=3*u,h=3*n[u];e[h]=a[c],e[h+1]=a[c+1],e[h+2]=a[c+2],t[h]=s[c],t[h+1]=s[c+1],t[h+2]=s[c+2],r[h]=o[c],r[h+1]=o[c+1],r[h+2]=o[c+2]}}else ui.partialSubdivision(this,e,t,r)}},{key:"applyDetails",value:function(){var e=this.getVerticesRingVertStartCount(),t=this.getVerticesRingVert(),r=this.getVertices(),i=this.getNormals(),n=this.getColors(),a=this.getMaterials(),s=this.getNbVertices(),l=new Float32Array(o.Z.getMemory(3*s*4),0,3*s);l.set(r.subarray(0,3*s));for(var u=this._detailsXYZ,c=this._detailsRGB,h=this._detailsPBR,d=Math.min,f=Math.max,p=0;p<s;++p){var _=3*p;n[_]=d(1,f(0,n[_]+c[_])),n[_+1]=d(1,f(0,n[_+1]+c[_+1])),n[_+2]=d(1,f(0,n[_+2]+c[_+2])),a[_]=d(1,f(0,a[_]+h[_])),a[_+1]=d(1,f(0,a[_+1]+h[_+1])),a[_+2]=d(1,f(0,a[_+2]+h[_+2]));var m=l[_],g=l[_+1],v=l[_+2],y=i[_],b=i[_+1],T=i[_+2],k=y*y+b*b+T*T;if(0!==k){y*=k=1/Math.sqrt(k),b*=k,T*=k;var M=3*t[e[2*p]],x=l[M]-m,S=l[M+1]-g,A=l[M+2]-v;if(0!=(k=(x-=y*(k=x*y+S*b+A*T))*x+(S-=b*k)*S+(A-=T*k)*A)){var E=b*(A*=k=1/Math.sqrt(k))-T*(S*=k),R=T*(x*=k)-y*A,w=y*S-b*x,C=u[_],P=u[_+1],D=u[_+2];r[_]=m+y*C+x*P+E*D,r[_+1]=g+b*C+S*P+R*D,r[_+2]=v+T*C+A*P+w*D}}}}},{key:"computeDetails",value:function(e,t,r,i){for(var n=this.getVerticesRingVertStartCount(),a=this.getVerticesRingVert(),s=this.getVertices(),o=this.getNormals(),l=this.getColors(),u=this.getMaterials(),c=this.getNbVertices(),h=this._detailsXYZ=new Float32Array(3*i),d=this._detailsRGB=new Float32Array(3*i),f=this._detailsPBR=new Float32Array(3*i),p=0;p<c;++p){var _=3*p;d[_]=l[_]-t[_],d[_+1]=l[_+1]-t[_+1],d[_+2]=l[_+2]-t[_+2],f[_]=u[_]-r[_],f[_+1]=u[_+1]-r[_+1],f[_+2]=u[_+2]-r[_+2];var m=o[_],g=o[_+1],v=o[_+2],y=m*m+g*g+v*v;if(0!==y){m*=y=1/Math.sqrt(y),g*=y,v*=y;var b=3*a[n[2*p]],T=e[b]-e[_],k=e[b+1]-e[_+1],M=e[b+2]-e[_+2];if(0!=(y=(T-=m*(y=T*m+k*g+M*v))*T+(k-=g*y)*k+(M-=v*y)*M)){var x=g*(M*=y=1/Math.sqrt(y))-v*(k*=y),S=v*(T*=y)-m*M,A=m*k-g*T,E=s[_]-e[_],R=s[_+1]-e[_+1],w=s[_+2]-e[_+2];h[_]=m*E+g*R+v*w,h[_+1]=T*E+k*R+M*w,h[_+2]=x*E+S*R+A*w}}}}}])&&vn(t.prototype,r),s}(kt);var Mn={},xn=function(e,t,r){var i=++o.Z.TAG_FLAG,n=e.getVerticesTagFlags(),a=e.getVerticesRingVertStartCount(),s=e.getVerticesRingVert(),l=e.getVerticesOnEdge(),u=function(e,t,r){var i=0,n=e.getNbVertices();for(i=0;i<n;++i)if(0===t[i]&&1===r[i])return i;var a=e.getVerticesOnEdge();for(i=0;i<n&&(0!==t[i]||1===a[i]);++i);if(i===n)return-1;for(i=0;i<n;++i)if(0===t[i])return i;return-1}(e,r,t);if(u<0)return!1;r[u]=1;var c=new Uint32Array(o.Z.getMemory(4*e.getNbVertices()),0,e.getNbVertices());c[0]=u;for(var h=1;h>0;){var d=c[--h],f=a[2*d],p=f+a[2*d+1],_=0,m=++i;for(_=f;_<p;++_){var g=s[_];if(n[g]=m,1===r[g])return o.Z.TAG_FLAG=i,!1;r[g]=-1,n[g]=m}for(m=++i,_=f;_<p;++_){var v=s[_];if(0!==t[v]&&!l[v])return o.Z.TAG_FLAG=i,!1;for(var y=a[2*v],b=y+a[2*v+1],T=y;T<b;++T){var k=s[T];if(k!==d&&!(n[k]>=m-1)&&(n[k]=m,0===r[k])){for(var M=a[2*k],x=M+a[2*k+1],S=0,A=M;A<x;++A)n[s[A]]===m-1&&S++;2===S?r[k]=-1:(r[k]=1,c[h++]=k)}}}}return o.Z.TAG_FLAG=i,!0};Mn.computeReverse=function(e,t){var r=e.getNbFaces();if(r%4!=0)return!1;var i=new Int8Array(e.getNbVertices());if(!function(e,t){for(var r=e.getNbVertices(),i=function(e){for(var t=e.getNbVertices(),r=e.getFaces(),i=e.getVerticesOnEdge(),n=e.getVerticesRingVertStartCount(),a=e.getVerticesRingFace(),s=e.getVerticesRingFaceStartCount(),l=new Int8Array(t),u=0;u<t;++u){for(var c=2*u,h=n[c+1],d=s[c],f=s[c+1],p=i[u],_=0,m=d,g=d+f;m<g;++m)_+=r[4*a[m]+3]===o.Z.TRI_INDEX?0:1;0===_?(!p&&6!==h||p&&4!==h)&&(l[u]=1):_===f?(!p&&4!==h||p&&3!==h)&&(l[u]=1):(p||5!==h)&&(l[u]=1)}return l}(e),n=!0;n;){if(!xn(e,i,t))return!1;n=!1;for(var a=0;a<r;++a)if(0===t[a]){n=!0;break}}return!0}(e,i))return!1;var n=new Int32Array(r/4);return!!function(e,t,r,i){var n=e.getFaceEdges(),a=e.getFaces(),s=new Int32Array(e.getNbEdges()),l=0,u=e.getNbFaces(),c=0,h=new Uint32Array(e.getNbVertices()),d=new Uint32Array(u);for(l=0;l<u;++l)d[l]=o.Z.TRI_INDEX;for(l=0;l<u;++l){var f=4*l,p=a[f],_=a[f+1],m=a[f+2],g=a[f+3],v=r[p],y=r[_],b=r[m];if(g!==o.Z.TRI_INDEX){var T=0,k=0,M=0;1===v?(T=p,k=m,M=s[n[f+1]]-1,s[n[f+2]]=p+1):1===y?(T=_,k=g,M=s[n[f+2]]-1,s[n[f+3]]=_+1):1===b?(T=m,k=p,M=s[n[f+3]]-1,s[n[f]]=m+1):(T=g,k=_,M=s[n[f]]-1,s[n[f+1]]=g+1);var x=h[k]-1;if(x<0)i[c]=-k-1,d[4*c+3]=T,h[k]=++c;else{var S=4*x;M<0?d[S+2]>=o.Z.TRI_INDEX-1?(d[S+2]=T,d[S]=o.Z.TRI_INDEX-1):d[S]===o.Z.TRI_INDEX?d[S+1]=T:(d[S+1]=d[S+2],d[S+2]=T):d[S+1]===M?d[S]=T:(d[S]=d[S+1],d[S+2]===M?d[S+1]=T:(d[S+1]=d[S+2],d[S+2]=T))}}else{if(v+y+b===-3){i[c++]=l;continue}1===v?s[n[f+1]]=p+1:1===y?s[n[f+2]]=_+1:1===b&&(s[n[f]]=m+1)}}for(u/=4,l=0;l<u;++l){var A=i[l],E=4*l;if(A<0){var R=o.Z.TRI_INDEX-1;if(d[E]>=R||d[E+1]>=o.Z.TRI_INDEX||d[E+2]>=o.Z.TRI_INDEX)return!1}else{var w=4*A;d[E]=s[n[w]]-1,d[E+1]=s[n[w+1]]-1,d[E+2]=s[n[w+2]]-1}}return t.setFaces(d),!0}(e,t,i,n)&&(function(e,t,r){var i=0,n=new Uint32Array(e.getNbVertices());t.setVerticesMapping(n);var a=t.getFaces(),s=new Int32Array(e.getNbVertices()),l=0,u=4*t.getNbFaces();for(l=0;l<u;++l){var c=a[l];if(c!==o.Z.TRI_INDEX){var h=s[c]-1;-1===h&&(h=i++,s[c]=h+1,n[h]=c),a[l]=h}}t.setVertices(new Float32Array(3*i));var d=e.getFaces(),f=e.getVerticesRingFace(),p=e.getVerticesRingFaceStartCount(),_=new Uint8Array(e.getNbVertices());for(u/=4,l=0;l<u;++l){var m,g,v,y,b,T,k,M,x,S,A=r[l];if(A>=0){var E=4*A;m=d[E+1],g=d[E+2],v=d[E],y=o.Z.TRI_INDEX,b=o.Z.TRI_INDEX}else{b=-A-1;for(var R=4*l,w=n[a[R]],C=n[a[R+1]],P=n[a[R+2]],D=n[a[R+3]],I=p[2*b],F=I+4,O=I;O<F;++O){var V=4*f[O],L=d[V],N=d[V+1],B=d[V+2],U=d[V+3];L===w?m=N:N===w?m=B:B===w?m=U:U===w&&(m=L),L===C?g=N:N===C?g=B:B===C?g=U:U===C&&(g=L),L===P?v=N:N===P?v=B:B===P?v=U:U===P&&(v=L),L===D?y=N:N===D?y=B:B===D?y=U:U===D&&(y=L)}}T=_[m],k=_[g],M=_[v],x=y!==o.Z.TRI_INDEX?_[y]:-1,S=b!==o.Z.TRI_INDEX?_[b]:-1,0===T&&(_[m]=1,n[i++]=m),0===k&&(_[g]=1,n[i++]=g),0===M&&(_[v]=1,n[i++]=v),0===x&&(_[y]=1,n[i++]=y),0===S&&(_[b]=1,n[i++]=b)}}(e,t,n),function(e,t){var r=e.getVertices(),i=e.getColors(),n=e.getMaterials(),a=t.getVertices(),s=new Float32Array(a.length),l=new Float32Array(a.length);t.setColors(s),t.setMaterials(l);var u=t.getVerticesMapping(),c=0,h=t.getNbVertices();for(c=0;c<h&&!(u[c]>=h);++c);if(c===h){var d=t.getFaces(),f=d.length;for(c=0;c<f;++c){var p=d[c];p!==o.Z.TRI_INDEX&&(d[c]=u[p])}for(c=0;c<h;++c)u[c]=c;a.set(r.subarray(0,3*h)),s.set(i.subarray(0,3*h)),l.set(n.subarray(0,3*h))}else for(t.setEvenMapping(!0),c=0;c<h;++c){var _=3*c,m=3*u[c];a[_]=r[m],a[_+1]=r[m+1],a[_+2]=r[m+2],s[_]=i[m],s[_+1]=i[m+1],s[_+2]=i[m+2],l[_]=n[m],l[_+1]=n[m+1],l[_+2]=n[m+2]}}(e,t),e.hasUV()&&function(e,t,r){for(var i=e.getVerticesDuplicateStartCount(),n=t.getNbVertices(),a=new Uint32Array(2*n),s=t.getVerticesMapping(),l=e.getTexCoords(),u=new Float32Array(o.Z.getMemory(4*e.getNbTexCoords()*2),0,2*e.getNbTexCoords()),c=new Uint32Array(n),h=n,d=0;d<n;++d){var f=s[d],p=i[2*f];if(u[2*d]=l[2*f],u[2*d+1]=l[2*f+1],0!==p){for(var _=c[d]=p-h,m=i[2*f+1],g=h,v=h+m;g<v;++g)u[2*g]=l[2*(_+g)],u[2*g+1]=l[2*(_+g)+1];a[2*d]=h,a[2*d+1]=m,h+=m}}t.setTexCoords(new Float32Array(u.subarray(0,2*h))),t.setVerticesDuplicateStartCount(a),function(e,t,r,i){for(var n=e.getFaces(),a=e.getFacesTexCoord(),s=e.getVerticesRingFaceStartCount(),l=e.getVerticesRingFace(),u=e.getVerticesDuplicateStartCount(),c=t.getFaces(),h=new Uint32Array(c),d=t.getVerticesMapping(),f=0,p=c.length;f<p;++f){var _=c[f];if(_!==o.Z.TRI_INDEX){var m=d[_];if(0!==u[2*m]){var g=f%4,v=r[(f-g)/4],y=o.Z.TRI_INDEX;if(v>=0){var b,T,k=4*v;0===g?(b=n[k+1],T=n[k]):1===g?(b=n[k+2],T=n[k+1]):(b=n[k],T=n[k+2]);for(var M=s[2*m],x=M+s[2*m+1],S=M;S<x;++S){var A=4*l[S],E=n[A],R=n[A+1],w=n[A+2];if(E===b?R===T&&(y=a[A+2]):R===b?w===T&&(y=a[A]):w===b&&E===T&&(y=a[A+1]),y!==o.Z.TRI_INDEX)break}}else for(var C=s[2*(v=-v-1)],P=C+4,D=C;D<P;++D){var I=4*l[D];if(n[I]===m?y=a[I]:n[I+1]===m?y=a[I+1]:n[I+2]===m?y=a[I+2]:n[I+3]===m&&(y=a[I+3]),y!==o.Z.TRI_INDEX)break}h[f]=y===m?y:y-i[_]}}}t.setFacesTexCoord(h)}(e,t,r,c)}(e,t,n),t.allocateArrays(),!0)};const Sn=Mn;function An(e){return(An="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function En(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Rn(e,t,r){return(Rn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Pn(e)););return e}(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(r):n.value}})(e,t,r||e)}function wn(e,t){return(wn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Cn(e,t){return!t||"object"!==An(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Pn(e){return(Pn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Dn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&wn(e,t)}(o,e);var t,r,i,n,a,s=(n=o,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Pn(n);if(a){var r=Pn(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return Cn(this,e)});function o(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=s.call(this)).setID(e.getID()),t.setRenderData(e.getRenderData()),t.setTransformData(e.getTransformData()),t._meshes=[new kn(e,!0)],t.setSelection(0);var r=e.getGL();return t._indexBuffer=new c(r,r.ELEMENT_ARRAY_BUFFER,r.STATIC_DRAW),t._wireframeBuffer=new c(r,r.ELEMENT_ARRAY_BUFFER,r.STATIC_DRAW),t}return t=o,i=[{key:"NONE",get:function(){return 0}},{key:"SCULPT",get:function(){return 1}},{key:"CAMERA",get:function(){return 2}},{key:"PICKING",get:function(){return 3}}],(r=[{key:"getCurrentMesh",value:function(){return this._meshes[this._sel]}},{key:"setSelection",value:function(e){this._sel=e,this.setMeshData(this.getCurrentMesh().getMeshData())}},{key:"addLevel",value:function(){if(this._meshes.length-1!==this._sel)return this.getCurrentMesh();var e=this.getCurrentMesh().getNbFaces(),t="addLevel : "+e+" -> "+4*e;console.time(t);var r=this.getCurrentMesh(),i=new kn(r);return r.setVerticesMapping(void 0),ui.fullSubdivision(r,i),i.initTopology(),this.pushMesh(i),this.initRender(),console.timeEnd(t),i}},{key:"computeReverse",value:function(){if(0!==this._sel)return this.getCurrentMesh();var e=this.getCurrentMesh(),t=new kn(e);return Sn.computeReverse(e,t)?(t.initTopology(),this.unshiftMesh(t),this.initRender(),t):void 0}},{key:"lowerLevel",value:function(){return 0===this._sel?this._meshes[0]:(this._meshes[this._sel-1].lowerAnalysis(this.getCurrentMesh()),this.setSelection(this._sel-1),this.updateResolution(),this.getCurrentMesh())}},{key:"higherLevel",value:function(){return this._sel===this._meshes.length-1||(this._meshes[this._sel+1].higherSynthesis(this.getCurrentMesh()),this.setSelection(this._sel+1),this.updateResolution()),this.getCurrentMesh()}},{key:"updateResolution",value:function(){this.updateGeometry(),this.updateDuplicateColorsAndMaterials(),this.updateBuffers();var e=this._meshes[this.getLowIndexRender()];this._indexBuffer.update(e.getTriangles()),this._wireframeBuffer.update(e.getWireframe())}},{key:"selectResolution",value:function(e){for(;this._sel>e;)this.lowerLevel();for(;this._sel<e;)this.higherLevel()}},{key:"findIndexFromMesh",value:function(e){for(var t=this._meshes,r=0,i=t.length;r<i;++r)if(e===t[r])return r}},{key:"selectMesh",value:function(e){var t=this.findIndexFromMesh(e);this.selectResolution(t)}},{key:"pushMesh",value:function(e){this._meshes.push(e),this.setSelection(this._meshes.length-1),this.updateResolution()}},{key:"unshiftMesh",value:function(e){this._meshes.unshift(e),this.setSelection(1),this.lowerLevel()}},{key:"popMesh",value:function(){this._meshes.pop(),this.setSelection(this._meshes.length-1),this.updateResolution()}},{key:"shiftMesh",value:function(){this._meshes.shift(),this.setSelection(0),this.updateResolution()}},{key:"deleteLower",value:function(){this._meshes.splice(0,this._sel),this.setSelection(0)}},{key:"deleteHigher",value:function(){this._meshes.splice(this._sel+1)}},{key:"getLowIndexRender",value:function(){for(var e=this._sel;e>=0;){var t=this._meshes[e];if(!0===t.getEvenMapping())return e===this._sel?e:e+1;if(t.getNbTriangles()<5e5)return e;--e}return 0}},{key:"_renderLow",value:function(e){var t=this.getRenderData(),r=this._sel,i=this.getIndexBuffer();this.setSelection(this.getLowIndexRender()),t._indexBuffer=this._indexBuffer,Rn(Pn(o.prototype),"render",this).call(this,e),t._indexBuffer=i,this.setSelection(r)}},{key:"_renderWireframeLow",value:function(e){var t=this.getRenderData(),r=this._sel,i=this.getWireframeBuffer();this.setSelection(this.getLowIndexRender()),t._wireframeBuffer=this._wireframeBuffer,Rn(Pn(o.prototype),"renderWireframe",this).call(this,e),t._wireframeBuffer=i,this.setSelection(r)}},{key:"_canUseLowRender",value:function(e){return!(this.isUsingTexCoords()||this.isUsingDrawArrays()||o.RENDER_HINT===o.PICKING||o.RENDER_HINT===o.NONE||e.getMesh()===this&&o.RENDER_HINT!==o.CAMERA||this.getLowIndexRender()===this._sel)}},{key:"render",value:function(e){return this._canUseLowRender(e)?this._renderLow(e):Rn(Pn(o.prototype),"render",this).call(this,e)}},{key:"renderWireframe",value:function(e){return this._canUseLowRender(e)?this._renderWireframeLow(e):Rn(Pn(o.prototype),"renderWireframe",this).call(this,e)}}])&&En(t.prototype,r),i&&En(t,i),o}(kt);Dn.RENDER_HINT=0;const In=Dn;var Fn,On,Vn,Ln,Nn,Bn={_mesh:null,_linear:!1,_verticesMap:new Map,_states:null,_center:[0,0,0],_radius2:0,_edgeMax2:0},Un=function(e,t,r,i,n){var a=Bn._mesh,s=a.getVerticesRingVert(),l=a.getVerticesRingFace(),u=a.getFacePosInLeaf(),c=a.getFaceLeaf(),h=a.getFacesStateFlags(),d=a.getFaces(),f=4*e;d[f]=t,d[f+1]=n,d[f+2]=i,d[f+3]=o.Z.TRI_INDEX;var p=c[e],_=p._iFaces;s[n].push(i),s[i].push(n);var m=a.getNbTriangles();l[n].push(e,m),d[f=4*m]=n,d[f+1]=r,d[f+2]=i,d[f+3]=o.Z.TRI_INDEX,h[m]=o.Z.STATE_FLAG,c[m]=p,u[m]=_.length,l[i].push(m),o.Z.replaceElement(l[r],e,m),_.push(m),a.addNbFace(1)},Zn=function(e){for(var t=Bn._mesh,r=t.getVerticesRingVert(),i=t.getFaces(),n=e.length,a=new Uint32Array(o.Z.getMemory(8*n),0,2*n),s=0,l=Bn._verticesMap,u=0;u<n;++u){var c=e[u],h=4*c,d=i[h],f=i[h+1],p=i[h+2],_=l.get(Math.min(d,f)+"+"+Math.max(d,f)),m=l.get(Math.min(f,p)+"+"+Math.max(f,p)),g=l.get(Math.min(d,p)+"+"+Math.max(d,p)),v=r[d].length,y=r[f].length,b=r[p].length,T=0;if(_?T=m?g?v<y&&v<b?2:y<b?3:1:v<b?2:1:g&&y<b?3:1:m?T=g&&y<v?3:2:g&&(T=3),1===T)Un(c,d,f,p,_);else if(2===T)Un(c,f,p,d,m);else{if(3!==T)continue;Un(c,p,d,f,g)}a[s++]=c,a[s++]=t.getNbTriangles()-1}return new Uint32Array(a.subarray(0,s))},zn=function(e,t,r,i){var n=Bn._mesh,a=n.getVertices(),s=n.getNormals(),l=n.getColors(),u=n.getMaterials(),c=n.getFaces(),h=n.getFacePosInLeaf(),d=n.getFaceLeaf(),f=n.getVerticesRingVert(),p=n.getVerticesRingFace(),_=n.getFacesStateFlags(),m=n.getVerticesStateFlags(),g=Bn._verticesMap,v=Math.min(t,r)+"+"+Math.max(t,r),y=!1,b=g.get(v);void 0===b&&(b=n.getNbVertices(),y=!0,g.set(v,b)),f[i].push(b);var T=4*e;c[T]=t,c[T+1]=b,c[T+2]=i,c[T+3]=o.Z.TRI_INDEX;var k=n.getNbTriangles();c[T=4*k]=b,c[T+1]=r,c[T+2]=i,c[T+3]=o.Z.TRI_INDEX,_[k]=o.Z.STATE_FLAG,p[i].push(k),o.Z.replaceElement(p[r],e,k);var M=d[e],x=M._iFaces;if(d[k]=M,h[k]=x.length,x.push(k),!y)return f[b].push(i),p[b].push(e,k),void n.addNbFace(1);var S=3*t,A=a[S],E=a[S+1],R=a[S+2],w=s[S],C=s[S+1],P=s[S+2],D=3*r,I=a[D],F=a[D+1],O=a[D+2],V=s[D],L=s[D+1],N=s[D+2],B=w+V,U=C+L,Z=P+N;if(s[T=3*b]=.5*B,s[T+1]=.5*U,s[T+2]=.5*Z,l[T]=.5*(l[S]+l[D]),l[T+1]=.5*(l[S+1]+l[D+1]),l[T+2]=.5*(l[S+2]+l[D+2]),u[T]=.5*(u[S]+u[D]),u[T+1]=.5*(u[S+1]+u[D+1]),u[T+2]=.5*(u[S+2]+u[D+2]),Bn._linear)a[T]=.5*(A+I),a[T+1]=.5*(E+F),a[T+2]=.5*(R+O);else{var z=w*w+C*C+P*P;0===z?w=1:(w*=z=1/Math.sqrt(z),C*=z,P*=z),0==(z=V*V+L*L+N*N)?V=1:(V*=z=1/Math.sqrt(z),L*=z,N*=z);var G=w*V+C*L+P*N,W=A-I,j=E-F,X=R-O,H=.12*(G<=-1?Math.PI:G>=1?0:Math.acos(G));H*=Math.sqrt(W*W+j*j+X*X),(z=B*B+U*U+Z*Z)>0&&(H/=Math.sqrt(z)),W*(w-V)+j*(C-L)+X*(P-N)<0&&(H=-H),a[T]=.5*(A+I)+B*H,a[T+1]=.5*(E+F)+U*H,a[T+2]=.5*(R+O)+Z*H}m[b]=o.Z.STATE_FLAG,f[b]=[t,r,i],p[b]=[e,k],o.Z.replaceElement(f[t],r,b),o.Z.replaceElement(f[r],t,b),n.addNbVertice(1),n.addNbFace(1)},Gn=(Fn=[0,0,0],On=[0,0,0],Vn=[0,0,0],Ln=Se.Z.triangleInsideSphere,Nn=Se.Z.pointInsideTriangle,function(e,t){var r=Bn._mesh,n=r.getVertices(),a=r.getFaces(),s=4*e,o=3*a[s],l=3*a[s+1],u=3*a[s+2];if(Fn[0]=n[o],Fn[1]=n[o+1],Fn[2]=n[o+2],On[0]=n[l],On[1]=n[l+1],On[2]=n[l+2],Vn[0]=n[u],Vn[1]=n[u+1],Vn[2]=n[u+2],t&&!Ln(Bn._center,Bn._radius2,Fn,On,Vn)&&!Nn(Bn._center,Fn,On,Vn))return 0;var c=r.getMaterials(),h=c[o+2],d=c[l+2],f=c[u+2],p=i.R3.sqrDist(Fn,On),_=i.R3.sqrDist(On,Vn),m=i.R3.sqrDist(Fn,Vn);return p>_&&p>m?.5*(h+d)*p>Bn._edgeMax2?1:0:_>m?.5*(d+f)*_>Bn._edgeMax2?2:0:.5*(h+f)*m>Bn._edgeMax2?3:0}),Wn=function(e){var t=Bn._mesh,r=t.getNbVertices(),i=t.getNbTriangles();Bn._verticesMap=new Map;var n=function(e){for(var t=e.length,r=o.Z.getMemory(5*t),i=new Uint32Array(r,0,t),n=new Uint8Array(r,4*t,t),a=0,s=0;s<t;++s){var l=e[s],u=Gn(l,!0);0!==u&&(n[a]=u,i[a++]=l)}return[new Uint32Array(i.subarray(0,a)),new Uint8Array(n.subarray(0,a))]}(e),a=n[0],s=n[1];a.length>5&&(a=t.expandsFaces(a,3),(s=new Uint8Array(a.length)).set(n[1])),Bn._states.pushVertices(t.getVerticesFromFaces(a)),Bn._states.pushFaces(a),t.reAllocateArrays(s.length),function(e,t){for(var r=Bn._mesh.getFaces(),i=e.length,n=0;n<i;++n){var a=e[n],s=t[n];0===s&&(s=Gn(a));var o=4*a;1===s?zn(a,r[o],r[o+1],r[o+2]):2===s?zn(a,r[o+1],r[o+2],r[o]):3===s&&zn(a,r[o+2],r[o],r[o+1])}}(a,s);var l=0,u=t.getNbTriangles()-i,c=new Uint32Array(u);for(l=0;l<u;++l)c[l]=i+l;a=(c=t.expandsFaces(c,1)).subarray(u),Bn._states.pushVertices(t.getVerticesFromFaces(a)),Bn._states.pushFaces(a);var h=e,d=e.length;(e=new Uint32Array(d+c.length)).set(h),e.set(c,d);var f=t.getFacesTagFlags(),p=e.length,_=new Uint32Array(o.Z.getMemory(4*p),0,p),m=0,g=++o.Z.TAG_FLAG;for(l=0;l<p;++l){var v=e[l];f[v]!==g&&(f[v]=g,_[m++]=v)}_=new Uint32Array(_.subarray(0,m));for(var y=t.getNbTriangles();c.length>0;)t.reAllocateArrays(c.length),c=Zn(c);for(u=t.getNbTriangles()-y,h=_,(_=new Uint32Array(m+u)).set(h),l=0;l<u;++l)_[m+l]=y+l;var b=t.getNbVertices()-r,T=new Uint32Array(b);for(l=0;l<b;++l)T[l]=r+l;if(T=t.expandsVertices(T,1),!Bn._linear){var k=T.subarray(b),M=new Le;M.setToolMesh(t),M.smoothTangent(k,1)}var x=t.getVertices(),S=t.getVerticesSculptFlags(),A=Bn._center,E=A[0],R=A[1],w=A[2],C=o.Z.SCULPT_FLAG;for(b=T.length,l=0;l<b;++l){var P=T[l],D=3*P,I=x[D]-E,F=x[D+1]-R,O=x[D+2]-w;S[P]=I*I+F*F+O*O<Bn._radius2?C:C-1}return _};const jn={subdivision:function(e,t,r,n,a,s,o){Bn._mesh=e,Bn._linear=o,i.R3.copy(Bn._center,r),Bn._radius2=n,Bn._edgeMax2=a,Bn._states=s;for(var l=0;l!==e.getNbTriangles();)l=e.getNbTriangles(),t=Wn(t);return t}};var Xn={_mesh:null,_states:null,_iTrisToDelete:[],_iVertsToDelete:[],_iVertsDecimated:[]},Hn=function(e,t){return e-t},Yn=function(e){var t=Xn._mesh,r=t.getVerticesRingFace(),i=t.getFacesTagFlags(),n=t.getFaces(),a=t.getFacePosInLeaf(),s=t.getFaceLeaf(),l=t.getFacesStateFlags(),u=a[e],c=s[e]._iFaces,h=c[c.length-1];e!==h&&(c[u]=h,a[h]=u),c.pop();var d=t.getNbTriangles()-1;if(d!==e){var f=4*d,p=n[f],_=n[f+1],m=n[f+2];Xn._states.pushVertices([p,_,m]),Xn._states.pushFaces([d]),o.Z.replaceElement(r[p],d,e),o.Z.replaceElement(r[_],d,e),o.Z.replaceElement(r[m],d,e);var g=s[d],v=a[d];g._iFaces[v]=e,s[e]=g,a[e]=v,i[e]=i[d],l[e]=l[d],n[e*=4]=p,n[e+1]=_,n[e+2]=m,n[e+3]=o.Z.TRI_INDEX,Xn._iVertsDecimated.push(p,_,m),t.addNbFace(-1)}else t.addNbFace(-1)},Kn=function(e){var t=Xn._mesh,r=t.getVerticesRingVert(),i=t.getVerticesRingFace(),n=t.getVertices(),a=t.getNormals(),s=t.getColors(),l=t.getMaterials(),u=t.getFaces(),c=t.getVerticesTagFlags(),h=t.getVerticesStateFlags(),d=t.getVerticesSculptFlags(),f=t.getNbVertices()-1;if(e!==f){var p=0,_=Xn._states;_.pushVertices([f]);var m=i[f],g=r[f],v=m.length,y=g.length,b=0;for(b=0;b<v;++b)p=m[b],_.pushFaces([p]),u[p*=4]===f?u[p]=e:u[p+1]===f?u[p+1]=e:u[p+2]=e;for(b=0;b<y;++b)p=g[b],_.pushVertices([p]),o.Z.replaceElement(r[p],f,e);r[e]=r[f].slice(),i[e]=i[f].slice(),c[e]=c[f],h[e]=h[f],d[e]=d[f];var T=3*f;n[p=3*e]=n[T],n[p+1]=n[T+1],n[p+2]=n[T+2],a[p]=a[T],a[p+1]=a[T+1],a[p+2]=a[T+2],s[p]=s[T],s[p+1]=s[T+1],s[p+2]=s[T+2],l[p]=l[T],l[p+1]=l[T+1],l[p+2]=l[T+2],t.addNbVertice(-1)}else t.addNbVertice(-1)},qn=function(e,t,r,i,n,a,s){var l=Xn._mesh,u=l.getVertices(),c=l.getNormals(),h=l.getColors(),d=l.getMaterials(),f=l.getFaces(),p=l.getVerticesTagFlags(),_=l.getFacesTagFlags(),m=l.getVerticesRingVert(),g=l.getVerticesRingFace(),v=m[r],y=m[i],b=g[r],T=g[i];if(v.length===b.length&&y.length===T.length){var k=m[n],M=m[a],x=g[n],S=g[a];if(k.length===x.length&&M.length===S.length){Xn._iVertsDecimated.push(r,i),Xn._states.pushVertices(v),Xn._states.pushVertices(y),Xn._states.pushFaces(b),Xn._states.pushFaces(T),v.sort(Hn),y.sort(Hn);var A=0;if(o.Z.intersectionArrays(v,y).length>=3)return o.Z.removeElement(b,t),o.Z.removeElement(T,e),x.push(t),S.push(e),f[A=4*e]===i?f[A]=a:f[A+1]===i?f[A+1]=a:f[A+2]=a,f[A=4*t]===r?f[A]=n:f[A+1]===r?f[A+1]=n:f[A+2]=n,l.computeRingVertices(r),l.computeRingVertices(i),l.computeRingVertices(n),void l.computeRingVertices(a);var E=3*i,R=c[A=3*r]+c[E],w=c[A+1]+c[E+1],C=c[A+2]+c[E+2],P=R*R+w*w+C*C;0===P?R=1:(R*=P=1/Math.sqrt(P),w*=P,C*=P),c[A]=R,c[A+1]=w,c[A+2]=C,h[A]=.5*(h[A]+h[E]),h[A+1]=.5*(h[A+1]+h[E+1]),h[A+2]=.5*(h[A+2]+h[E+2]),d[A]=.5*(d[A]+d[E]),d[A+1]=.5*(d[A+1]+d[E+1]),d[A+2]=.5*(d[A+2]+d[E+2]),o.Z.removeElement(b,e),o.Z.removeElement(b,t),o.Z.removeElement(T,e),o.Z.removeElement(T,t),o.Z.removeElement(x,e),o.Z.removeElement(S,t);var D=T.length,I=0;for(I=0;I<D;++I){var F=T[I];b.push(F);var O=4*F;f[O]===i?f[O]=r:f[O+1]===i?f[O+1]=r:f[O+2]=r}for(D=y.length,I=0;I<D;++I)v.push(y[I]);l.computeRingVertices(r);var V=0,L=0,N=0,B=v.length;for(I=0;I<B;++I){var U=v[I];l.computeRingVertices(U),V+=u[U*=3],L+=u[U+1],N+=u[U+2]}L/=B,N/=B;var Z=R*((V/=B)-u[A])+w*(L-u[A+1])+C*(N-u[A+2]);for(u[A]=V-R*Z,u[A+1]=L-w*Z,u[A+2]=N-C*Z,p[i]=_[e]=_[t]=-1,Xn._iVertsToDelete.push(i),Xn._iTrisToDelete.push(e,t),D=b.length,I=0;I<D;++I)s.push(b[I])}}},Jn=function(e,t,r){if(-1!==t){var i=Xn._mesh.getFaces(),n=4*e,a=i[n],s=i[n+1],o=i[n+2],l=i[n=4*t],u=i[n+1],c=i[n+2];a===l?s===c?qn(e,t,a,s,o,u,r):qn(e,t,a,o,s,c,r):a===u?s===l?qn(e,t,a,s,o,c,r):qn(e,t,a,o,s,l,r):a===c?s===u?qn(e,t,a,s,o,l,r):qn(e,t,a,o,s,u,r):qn(e,t,o,s,a,s===l?u:s===u?c:l,r)}},Qn=function(e,t,r){var i=Xn._mesh.getVerticesRingFace(),n=i[t],a=i[r];n.sort(Hn),a.sort(Hn);var s=o.Z.intersectionArrays(n,a);return 2!==s.length?-1:s[0]===e?s[1]:s[0]},$n={decimation:function(e,t,r,i,n,a){Xn._mesh=e,Xn._states=a,Xn._iVertsDecimated.length=0,Xn._iTrisToDelete.length=0,Xn._iVertsToDelete.length=0;var s=Math.sqrt(i),l=e.getFacesTagFlags(),u=e.getVertices(),c=e.getMaterials(),h=e.getFaces(),d=r[0],f=r[1],p=r[2],_=0,m=t.length,g=new Array(m);for(_=0;_<m;++_)g[_]=t[_];for(_=0;_<g.length;++_){var v=g[_];if(!(l[v]<0)){var y=4*v,b=h[y],T=h[y+1],k=h[y+2],M=3*b,x=3*T,S=3*k,A=u[M],E=u[M+1],R=u[M+2],w=u[x],C=u[x+1],P=u[x+2],D=u[S],I=u[S+1],F=u[S+2],O=(A+w+D)/3-d,V=(E+C+I)/3-f,L=(R+P+F)/3-p,N=O*O+V*V+L*L;if(N<i)N=1;else{if(!(N<2*i))continue;var B=(N=(Math.sqrt(N)-s)/(s*Math.SQRT2-s))*N;N=3*B*B-4*B*N+1}var U=(O=w-A)*O+(V=C-E)*V+(L=P-R)*L,Z=(O=w-D)*O+(V=C-I)*V+(L=P-F)*L,z=(O=A-D)*O+(V=E-I)*V+(L=R-F)*L,G=c[M+2],W=c[x+2],j=c[S+2];U<Z&&U<z?U<n*N*(G+W)*.5&&Jn(v,Qn(v,b,T),g):Z<z?Z<n*N*(W+j)*.5&&Jn(v,Qn(v,T,k),g):z<n*N*(G+j)*.5&&Jn(v,Qn(v,b,k),g)}}return function(){var e=Xn._iTrisToDelete;o.Z.tidy(e);var t=0;for(t=e.length-1;t>=0;--t)Yn(e[t]);var r=Xn._iVertsToDelete;for(o.Z.tidy(r),t=r.length-1;t>=0;--t)Kn(r[t])}(),function(e,t){var r=Xn._mesh,i=r.getFacesTagFlags(),n=r.getNbTriangles(),a=r.getFacesFromVertices(e),s=t,l=t.length;(t=new Uint32Array(l+a.length)).set(s),t.set(a,l);var u=++o.Z.TAG_FLAG;l=t.length;for(var c=new Uint32Array(o.Z.getMemory(4*l),0,l),h=0,d=0;d<l;++d){var f=t[d];f>=n||i[f]!==u&&(i[f]=u,c[h++]=f)}return new Uint32Array(c.subarray(0,h))}(function(){for(var e=Xn._mesh,t=e.getVerticesTagFlags(),r=e.getNbVertices(),i=++o.Z.TAG_FLAG,n=Xn._iVertsDecimated,a=n.length,s=new Uint32Array(o.Z.getMemory(4*a),0,a),l=0,u=0;u<a;++u){var c=n[u];c>=r||t[c]!==i&&(t[c]=i,s[l++]=c)}return new Uint32Array(s.subarray(0,l))}(),g)}};const ea=$n;function ta(e){return(ta="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ra(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ia(e,t,r){return(ia="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=sa(e)););return e}(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(r):n.value}})(e,t,r||e)}function na(e,t){return(na=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function aa(e,t){return!t||"object"!==ta(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function sa(e){return(sa=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var oa=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&na(e,t)}(l,e);var t,r,i,n,a=(i=l,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=sa(i);if(n){var r=sa(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return aa(this,e)});function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=a.call(this)).setID(e.getID()),t._meshData={_nbVertices:0,_nbFaces:0,_nbTexCoords:0,_verticesXYZ:null,_normalsXYZ:null,_colorsRGB:null,_materialsPBR:null,_vertOnEdge:null,_vertRingFace:null,_vrfStartCount:null,_vrvStartCount:null,_vertRingVert:null,_vertTagFlags:null,_vertSculptFlags:null,_vertStateFlags:null,_vertProxy:null,_facesABCD:null,_faceEdges:null,_faceNormalsXYZ:null,_facesToTriangles:null,_trianglesABC:null,_facesTagFlags:null,_edges:null,_drawArraysWireframe:null,_drawElementsWireframe:null,_texCoordsST:null,_duplicateStartCount:null,_UVfacesABCD:null,_UVtrianglesABC:null,_DAverticesXYZ:null,_DAnormalsXYZ:null,_DAcolorsRGB:null,_DAmaterialsPBR:null,_DAtexCoordsST:null,_octree:null,_faceBoxes:null,_faceCentersXYZ:null,_facePosInLeaf:null,_faceLeaf:[],_leavesToUpdate:[],_worldBound:[1/0,1/0,1/0,-1/0,-1/0,-1/0]},t.setRenderData(e.getRenderData()),t.setTransformData(e.getTransformData()),t._facesStateFlags=null,t._wireframe=null,t.initFromMesh(e),t.initRender(),t.isDynamic=!0,t}return t=l,(r=[{key:"subdivide",value:function(e,t,r,i,n){return jn.subdivision(this,e,t,r,i,n,l.LINEAR)}},{key:"decimate",value:function(e,t,r,i,n){return ea.decimation(this,e,t,r,i,n)}},{key:"getSubdivisionFactor",value:function(){return.01*l.SUBDIVISION_FACTOR}},{key:"getDecimationFactor",value:function(){return.01*l.DECIMATION_FACTOR}},{key:"getVerticesProxy",value:function(){return this.getVertices()}},{key:"addNbVertice",value:function(e){this._meshData._nbVertices+=e}},{key:"getNbTriangles",value:function(){return this.getNbFaces()}},{key:"addNbFace",value:function(e){this._meshData._nbFaces+=e}},{key:"getNbEdges",value:function(){return 3*this.getNbTriangles()}},{key:"getFacesStateFlags",value:function(){return this._facesStateFlags}},{key:"allocateArrays",value:function(){ia(sa(l.prototype),"allocateArrays",this).call(this),this._meshData._vertRingVert=[],this._meshData._vertRingFace=[],this._facesStateFlags=new Int32Array(this.getNbFaces())}},{key:"initFromMesh",value:function(e){var t=e.getNbVertices();this.setVertices(new Float32Array(e.getVertices().subarray(0,3*t))),this.setColors(new Float32Array(e.getColors().subarray(0,3*t))),this.setMaterials(new Float32Array(e.getMaterials().subarray(0,3*t))),this.setNbVertices(t),this.setFacesFromMesh(e),this.init(),e.isUsingTexCoords()&&this.setShaderType(s.Z.Shader.MATCAP)}},{key:"setFacesFromMesh",value:function(e){this.setFaces(new Uint32Array(4*e.getNbTriangles())),this.setNbFaces(e.getNbTriangles());var t=e.getTriangles(),r=this.getNbTriangles(),i=this.getFaces();this._meshData._trianglesABC=new Uint32Array(t.subarray(0,3*r));for(var n=0;n<r;++n){var a=3*n,s=4*n;i[s]=t[a],i[s+1]=t[a+1],i[s+2]=t[a+2],i[s+3]=o.Z.TRI_INDEX}}},{key:"updateTopology",value:function(e,t){this.updateRenderTriangles(e),this.updateVerticesOnEdge(t),this.getShowWireframe()&&this.updateWireframe(e),this.isUsingDrawArrays()&&this.updateDrawArrays(e)}},{key:"getWireframe",value:function(){return this._wireframe||(this._wireframe=new Uint32Array(2*this.getTriangles().length),this.updateWireframe()),this._wireframe}},{key:"setShowWireframe",value:function(e){this._wireframe=null,ia(sa(l.prototype),"setShowWireframe",this).call(this,e)}},{key:"updateWireframe",value:function(e){for(var t=this._wireframe,r=this.getTriangles(),i=void 0===e,n=this.isUsingDrawArrays(),a=i?this.getNbTriangles():e.length,s=0;s<a;++s){var o=i?s:e[s],l=6*o,u=3*o;n?(t[l]=t[l+5]=u,t[l+1]=t[l+2]=u+2,t[l+3]=t[l+4]=u+1):(t[l]=t[l+5]=r[u],t[l+1]=t[l+2]=r[u+1],t[l+3]=t[l+4]=r[u+2])}}},{key:"updateRenderTriangles",value:function(e){for(var t=this.getTriangles(),r=this.getFaces(),i=void 0===e,n=i?this.getNbFaces():e.length,a=0;a<n;++a){var s=i?a:e[a],o=3*s,l=4*s;t[o]=r[l],t[o+1]=r[l+1],t[o+2]=r[l+2]}}},{key:"updateVerticesOnEdge",value:function(e){for(var t=this.getVerticesOnEdge(),r=this.getVerticesRingVert(),i=this.getVerticesRingFace(),n=void 0===e,a=n?this.getNbVertices():e.length,s=0;s<a;++s){var o=n?s:e[s];t[o]=r[o].length!==i[o].length?1:0}}},{key:"resizeArray",value:function(e,t){if(!e)return null;if(e.length>=t)return e.subarray(0,2*t);var r=new e.constructor(2*t);return r.set(e),r}},{key:"reAllocateArrays",value:function(e){var t=this._meshData,r=this._facesStateFlags.length,i=this.getNbTriangles(),n=i+e;(r<n||r>4*n)&&(this._facesStateFlags=this.resizeArray(this._facesStateFlags,n),this.getShowWireframe()&&(this._wireframe=this.resizeArray(this._wireframe,6*n)),t._facesABCD=this.resizeArray(t._facesABCD,4*n),t._trianglesABC=this.resizeArray(t._trianglesABC,3*n),t._faceBoxes=this.resizeArray(t._faceBoxes,6*n),t._faceNormalsXYZ=this.resizeArray(t._faceNormalsXYZ,3*n),t._faceCentersXYZ=this.resizeArray(t._faceCentersXYZ,3*n),t._facesTagFlags=this.resizeArray(t._facesTagFlags,n),t._facePosInLeaf=this.resizeArray(t._facePosInLeaf,n)),((r=t._verticesXYZ.length/3)<(n=this.getNbVertices()+e)||r>4*n)&&(t._verticesXYZ=this.resizeArray(t._verticesXYZ,3*n),t._normalsXYZ=this.resizeArray(t._normalsXYZ,3*n),t._colorsRGB=this.resizeArray(t._colorsRGB,3*n),t._materialsPBR=this.resizeArray(t._materialsPBR,3*n),t._vertOnEdge=this.resizeArray(t._vertOnEdge,n),t._vertTagFlags=this.resizeArray(t._vertTagFlags,n),t._vertSculptFlags=this.resizeArray(t._vertSculptFlags,n),t._vertStateFlags=this.resizeArray(t._vertStateFlags,n)),this.isUsingDrawArrays()&&((r=t._verticesXYZ.length/9)<(n=i+10*e)||r>4*n)&&(t._verticesXYZ=this.resizeArray(t._verticesXYZ,9*n),t._normalsXYZ=this.resizeArray(t._normalsXYZ,9*n),t._colorsRGB=this.resizeArray(t._colorsRGB,9*n),t._materialsPBR=this.resizeArray(t._materialsPBR,9*n))}},{key:"initTopology",value:function(){var e=this.getVerticesRingVert(),t=this.getVerticesRingFace(),r=0,i=this.getNbVertices();for(e.length=t.length=i,r=0;r<i;++r)e[r]=[],t[r]=[];var n=this.getNbTriangles(),a=this.getTriangles();for(r=0;r<n;++r){var s=3*r;t[a[s]].push(r),t[a[s+1]].push(r),t[a[s+2]].push(r)}var o=this.getVerticesOnEdge();for(r=0;r<i;++r)this.computeRingVertices(r),o[r]=t[r].length!==e[r].length?1:0}},{key:"computeRingVertices",value:function(e){var t=++o.Z.TAG_FLAG,r=this.getFaces(),i=this.getVerticesTagFlags(),n=this._meshData._vertRingVert[e],a=this._meshData._vertRingFace[e];n.length=0;for(var s=a.length,l=0;l<s;++l){var u=4*a[l],c=r[u],h=r[u+1];c===e?c=r[u+2]:h===e&&(h=r[u+2]),i[c]!==t&&(i[c]=t,n.push(c)),i[h]!==t&&(i[h]=t,n.push(h))}}}])&&ra(t.prototype,r),l}(kt);oa.SUBDIVISION_FACTOR=75,oa.DECIMATION_FACTOR=0,oa.LINEAR=!1;const la=oa;function ua(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}const ca=function(){function e(t,r,i,n){switch(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=t,this._multimesh=r,this._mesh=r.getCurrentMesh(),this._type=i,i){case e.DELETE_LOWER:this._deletedMeshes=r._meshes.slice(0,r._sel);break;case e.DELETE_HIGHER:this._deletedMeshes=r._meshes.slice(r._sel+1),n||(this._vMappingState=this._mesh.getVerticesMapping());break;case e.SUBDIVISION:case e.REVERSION:n||(this._vArState=new Float32Array(this._mesh.getVertices()),this._cArState=new Float32Array(this._mesh.getColors()),this._mArState=new Float32Array(this._mesh.getMaterials()))}}var t,r,i;return t=e,i=[{key:"SUBDIVISION",get:function(){return 0}},{key:"REVERSION",get:function(){return 1}},{key:"SELECTION",get:function(){return 2}},{key:"DELETE_LOWER",get:function(){return 3}},{key:"DELETE_HIGHER",get:function(){return 4}}],(r=[{key:"isNoop",value:function(){return!1}},{key:"undo",value:function(){var t=this._multimesh;switch(this._type){case e.SELECTION:t.selectMesh(this._mesh);break;case e.DELETE_LOWER:Array.prototype.unshift.apply(t._meshes,this._deletedMeshes);break;case e.DELETE_HIGHER:Array.prototype.push.apply(t._meshes,this._deletedMeshes),this._mesh.setVerticesMapping(this._vMappingState);break;case e.SUBDIVISION:case e.REVERSION:var r=this._mesh.getNbVertices();this._mesh.setVertices(new Float32Array(this._vArState)),this._mesh.setColors(new Float32Array(this._cArState)),this._mesh.setMaterials(new Float32Array(this._mArState)),this._mesh.setNbVertices(r),this._type===e.SUBDIVISION?t.popMesh():t.shiftMesh()}t.setSelection(t.findIndexFromMesh(this._mesh)),this._main.setMesh(t)}},{key:"redo",value:function(){var t=this._multimesh;switch(this._type){case e.SELECTION:t.selectMesh(this._mesh);break;case e.DELETE_LOWER:t.deleteLower();break;case e.DELETE_HIGHER:t.deleteHigher();break;case e.SUBDIVISION:t.pushMesh(this._mesh);break;case e.REVERSION:t.unshiftMesh(this._mesh)}t.setSelection(t.findIndexFromMesh(this._mesh)),this._main.setMesh(t)}},{key:"createRedo",value:function(){return new e(this._main,this._multimesh,this._type,!0)}}])&&ua(t.prototype,r),i&&ua(t,i),e}();function ha(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}const da=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._ctrlGui=r,this._main=r._main,this._menu=null,this._ctrlResolution=null,this._ctrlDynamic=null,this.init(t)}var t,r;return t=e,(r=[{key:"init",value:function(e){var t=this._menu=e.addMenu((0,x.Z)("topologyTitle"));t.close(),t.addTitle((0,x.Z)("multiresTitle")),this._ctrlResolution=t.addSlider((0,x.Z)("multiresResolution"),1,this.onResolutionChanged.bind(this),1,1,1);var r=t.addDualButton((0,x.Z)("multiresReverse"),(0,x.Z)("multiresSubdivide"),this,this,"reverse","subdivide");this._ctrlReverse=r[0],this._ctrlSubdivide=r[1],r=this._dualButtonDel=t.addDualButton((0,x.Z)("multiresDelLower"),(0,x.Z)("multiresDelHigher"),this,this,"deleteLower","deleteHigher"),this._ctrlDelLower=r[0],this._ctrlDelHigher=r[1],this._ctrlDelLower.domButton.style.background=this._ctrlDelHigher.domButton.style.background="rgba(230,53,59,0.35)";var i=this.remeshResolution.bind(this);t.addTitle((0,x.Z)("remeshTitle")),this._ctrlRes1=t.addSlider((0,x.Z)("remeshResolution"),dr.RESOLUTION,i,8,400,1),t.addCheckbox((0,x.Z)("remeshBlock"),dr,"BLOCK"),t.addButton((0,x.Z)("remeshRemesh"),this,"remesh"),t.addTitle((0,x.Z)("remeshTitleMC")),this._ctrlRes2=t.addSlider((0,x.Z)("remeshResolution"),dr.RESOLUTION,i,8,400,1),t.addCheckbox((0,x.Z)("remeshSmoothingMC"),dr,"SMOOTHING"),t.addButton((0,x.Z)("remeshRemeshMC"),this,"remeshMC"),t.addTitle((0,x.Z)("dynamicTitle")),this._ctrlDynamic=t.addCheckbox((0,x.Z)("dynamicActivated"),!1,this.dynamicToggleActivate.bind(this)),this._ctrlDynSubd=t.addSlider((0,x.Z)("dynamicSubdivision"),la,"SUBDIVISION_FACTOR",0,100,1),this._ctrlDynDec=t.addSlider((0,x.Z)("dynamicDecimation"),la,"DECIMATION_FACTOR",0,100,1),this._ctrlDynLin=t.addCheckbox((0,x.Z)("dynamicLinear"),la,"LINEAR"),this.updateDynamicVisibility(!1)}},{key:"onKeyUp",value:function(e){if(!0!==e.handled){var t=l.Z.getShortKey(e.which);e.stopPropagation(),t===s.Z.KeyAction.REMESH&&this.remesh()}}},{key:"updateDynamicVisibility",value:function(e){this._ctrlDynSubd.setVisibility(e),this._ctrlDynDec.setVisibility(e),this._ctrlDynLin.setVisibility(e)}},{key:"dynamicToggleActivate",value:function(){var e=this._main,t=e.getMesh();if(t){var r=t.isDynamic?this.convertToStaticMesh(t):new la(t);this.updateDynamicVisibility(!t.isDynamic),e.getStateManager().pushStateAddRemove(r,t),e.replaceMesh(t,r)}}},{key:"remeshResolution",value:function(e){dr.RESOLUTION=e,this._ctrlRes1.setValue(e,!0),this._ctrlRes2.setValue(e,!0)}},{key:"remesh",value:function(e){var t=this._main,r=t.getMesh();if(r){for(var i=r.isDynamic,n=t.getMeshes(),a=t.getSelectedMeshes().slice(),s=0,o=a.length;s<o;++s){var l=a[s];n.splice(t.getIndexMesh(l),1),a[s]=this.convertToStaticMesh(l),l===r&&(r=a[s])}var u=dr.remesh(a,r,e);i&&(u=new la(u)),t.getStateManager().pushStateAddRemove(u,t.getSelectedMeshes().slice()),t.getMeshes().push(u),t.setMesh(u)}}},{key:"remeshMC",value:function(){this.remesh(!0)}},{key:"isMultimesh",value:function(e){return!(!e||!e._meshes)}},{key:"convertToStaticMesh",value:function(e){if(!e.isDynamic)return e;var t=new Ct(e.getGL());return t.setID(e.getID()),t.setTransformData(e.getTransformData()),t.setVertices(e.getVertices().subarray(0,3*e.getNbVertices())),t.setColors(e.getColors().subarray(0,3*e.getNbVertices())),t.setMaterials(e.getMaterials().subarray(0,3*e.getNbVertices())),t.setFaces(e.getFaces().subarray(0,4*e.getNbFaces())),kt.OPTIMIZE=!1,t.init(),kt.OPTIMIZE=!0,t.setRenderData(e.getRenderData()),t.initRender(),t}},{key:"convertToMultimesh",value:function(e){return this.isMultimesh(e)?e:new In(this.convertToStaticMesh(e))}},{key:"subdivide",value:function(){var e=this._main,t=e.getMesh();if(t){var r=this.convertToMultimesh(t);r._sel===r._meshes.length-1?r.getNbTriangles()>4e5&&!window.confirm((0,x.Z)("multiresWarnBigMesh",4*r.getNbFaces()))||(t!==r&&(e.replaceMesh(t,r),e.getStateManager().pushStateAddRemove(r,t,!0)),e.getStateManager().pushState(new ca(e,r,ca.SUBDIVISION)),r.addLevel(),e.setMesh(r),e.render()):window.alert((0,x.Z)("multiresSelectHighest"))}}},{key:"reverse",value:function(){var e=this._main,t=e.getMesh();if(t){var r=this.convertToMultimesh(t);if(0===r._sel){var i=new ca(e,r,ca.REVERSION);r.computeReverse()?(t!==r&&(e.replaceMesh(t,r),e.getStateManager().pushStateAddRemove(r,t,!0)),e.getStateManager().pushState(i),e.setMesh(r),e.render()):window.alert((0,x.Z)("multiresNotReversible"))}else window.alert((0,x.Z)("multiresSelectLowest"))}}},{key:"deleteLower",value:function(){var e=this._main,t=e._mesh;this.isMultimesh(t)&&0!==t._sel?(e.getStateManager().pushState(new ca(e,t,ca.DELETE_LOWER)),t.deleteLower(),this.updateMeshResolution()):window.alert((0,x.Z)("multiresNoLower"))}},{key:"deleteHigher",value:function(){var e=this._main,t=e.getMesh();this.isMultimesh(t)&&t._sel!==t._meshes.length-1?(e.getStateManager().pushState(new ca(e,t,ca.DELETE_HIGHER)),t.deleteHigher(),this.updateMeshResolution()):window.alert((0,x.Z)("multiresNoHigher"))}},{key:"onResolutionChanged",value:function(e){var t=e-1,r=this._main,i=r.getMesh();if(i){var n=this.isMultimesh(i),a=n&&i._meshes.length-1===t;this._ctrlReverse.setEnable(!n||0===t),this._ctrlSubdivide.setEnable(!n||a),this._ctrlDelLower.setEnable(n&&0!==t),this._ctrlDelHigher.setEnable(n&&!a),n&&i._sel!==t&&(r.getStateManager().pushState(new ca(r,i,ca.SELECTION)),i.selectResolution(t),this._ctrlGui.updateMeshInfo(),r.render())}}},{key:"updateMeshResolution",value:function(){var e=this._main.getMesh();if(!e||!this.isMultimesh(e))return this._ctrlResolution.setMax(1),void this._ctrlResolution.setValue(0);this._ctrlResolution.setMax(e._meshes.length),this._ctrlResolution.setValue(e._sel+1)}},{key:"updateMesh",value:function(){if(this._main.getMesh()){this._menu.setVisibility(!0),this.updateMeshResolution();var e=this._main.getMesh().isDynamic;this.updateDynamicVisibility(e),this._ctrlDynamic.setValue(e,!0)}else this._menu.setVisibility(!1)}}])&&ha(t.prototype,r),e}();function fa(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var pa=J[s.Z.Shader.MERGE],_a=J[s.Z.Shader.UV],ma=J[s.Z.Shader.PBR],ga=J[s.Z.Shader.MATCAP];const va=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=r._main,this._menu=null,this._ctrlFlatShadizfng=null,this._ctrlShowWireframe=null,this._ctrlShaders=null,this._ctrlMatcap=null,this._ctrlUV=null,this.init(t)}var t,r;return t=e,(r=[{key:"init",value:function(e){var t=this._menu=e.addMenu((0,x.Z)("renderingTitle"));t.close();var r=[];r[s.Z.Shader.MATCAP]=(0,x.Z)("renderingMatcap"),r[s.Z.Shader.PBR]=(0,x.Z)("renderingPBR"),r[s.Z.Shader.NORMAL]=(0,x.Z)("renderingNormal"),r[s.Z.Shader.UV]=(0,x.Z)("renderingUV"),t.addTitle((0,x.Z)("renderingShader")),this._ctrlShaders=t.addCombobox("",s.Z.Shader.MATCAP,this.onShaderChanged.bind(this),r),this._ctrlCurvature=t.addSlider((0,x.Z)("renderingCurvature"),20,this.onCurvatureChanged.bind(this),0,100,1),this._ctrlFilmic=t.addCheckbox((0,x.Z)("renderingFilmic"),pa.FILMIC,this.onFilmic.bind(this));for(var i={},n=0,a=ma.environments,o=a.length;n<o;++n)i[n]=a[n].name;this._ctrlEnvTitle=t.addTitle((0,x.Z)("renderingEnvironment")),this._ctrlEnv=t.addCombobox("",ma.idEnv,this.onEnvironmentChanged.bind(this),i);for(var l={},u=0,c=ga.matcaps,h=c.length;u<h;++u)l[u]=c[u].name;this._ctrlMatcapTitle=t.addTitle((0,x.Z)("renderingMaterial")),this._ctrlMatcap=t.addCombobox((0,x.Z)("renderingMatcap"),0,this.onMatcapChanged.bind(this),l),this._ctrlImportMatcap=t.addButton((0,x.Z)("renderingImportMatcap"),this,"importMatcap"),this._ctrlUV=t.addButton((0,x.Z)("renderingImportUV"),this,"importTexture"),this._ctrlExposure=t.addSlider((0,x.Z)("renderingExposure"),1,this.onExposureChanged.bind(this),0,5,.001),this.onUpdateCtrlExposure(),t.addTitle((0,x.Z)("renderingExtra")),this._ctrlTransparency=t.addSlider((0,x.Z)("renderingTransparency"),0,this.onTransparencyChanged.bind(this),0,100,1),this._ctrlFlatShading=t.addCheckbox((0,x.Z)("renderingFlat"),!1,this.onFlatShading.bind(this)),this._ctrlShowWireframe=t.addCheckbox((0,x.Z)("renderingWireframe"),!1,this.onShowWireframe.bind(this)),yt.ONLY_DRAW_ARRAYS&&this._ctrlShowWireframe.setVisibility(!1),this.addEvents()}},{key:"onFilmic",value:function(e){pa.FILMIC=e,this._main.render()}},{key:"onCurvatureChanged",value:function(e){this._main.getMesh()&&(this._main.getMesh().setCurvature(e/20),this._main.render())}},{key:"onEnvironmentChanged",value:function(e){ma.idEnv=e,this.onUpdateCtrlExposure(),this._main.render()}},{key:"onUpdateCtrlExposure",value:function(){this._ctrlExposure.setValue(ma.environments[ma.idEnv].exposure)}},{key:"onExposureChanged",value:function(e){ma.exposure=e,this._main.render()}},{key:"onTransparencyChanged",value:function(e){for(var t=this._main.getSelectedMeshes(),r=0,i=t.length;r<i;++r)t[r].setOpacity(1-e/100);this._main.render()}},{key:"onShaderChanged",value:function(e){for(var t=this._main,r=!1,i=this._main.getSelectedMeshes(),n=0,a=i.length;n<a;++n){var o=i[n];o&&(e!==s.Z.Shader.UV||o.hasUV()?(o.setShaderType(e),t.render()):(r||window.alert("No UV on the mesh."),r=!0),r&&this.updateMesh())}this.updateVisibility()}},{key:"onMatcapChanged",value:function(e){for(var t=this._main.getSelectedMeshes(),r=0,i=t.length;r<i;++r){var n=t[r];n.getShaderType()!==s.Z.Shader.MATCAP&&n.setShaderType(s.Z.Shader.MATCAP),n.setMatcap(e)}this._main.render()}},{key:"onFlatShading",value:function(e){for(var t=this._main.getSelectedMeshes(),r=0,i=t.length;r<i;++r)t[r].setFlatShading(e);this._main.render()}},{key:"onShowWireframe",value:function(e){for(var t=this._main.getSelectedMeshes(),r=0,i=t.length;r<i;++r)t[r].setShowWireframe(e);this._main.render()}},{key:"addEvents",value:function(){var e=this.loadTextureUV.bind(this),t=this.loadMatcap.bind(this);document.getElementById("textureopen").addEventListener("change",e,!1),document.getElementById("matcapopen").addEventListener("change",t,!1),this.removeCallback=function(){document.getElementById("textureopen").removeEventListener("change",e,!1),document.getElementById("matcapopen").removeEventListener("change",t,!1)}}},{key:"removeEvents",value:function(){this.removeCallback&&this.removeCallback()}},{key:"updateMesh",value:function(){var e=this._main.getMesh();e?(this._menu.setVisibility(!0),this._ctrlShaders.setValue(e.getShaderType(),!0),this._ctrlFlatShading.setValue(e.getFlatShading(),!0),this._ctrlShowWireframe.setValue(e.getShowWireframe(),!0),this._ctrlMatcap.setValue(e.getMatcap(),!0),this._ctrlTransparency.setValue(100-100*e.getOpacity(),!0),this._ctrlCurvature.setValue(20*e.getCurvature(),!0),this.updateVisibility()):this._menu.setVisibility(!1)}},{key:"updateVisibility",value:function(){var e=this._main.getMesh();if(e){var t=e.getShaderType();this._ctrlMatcapTitle.setVisibility(t===s.Z.Shader.MATCAP),this._ctrlMatcap.setVisibility(t===s.Z.Shader.MATCAP),this._ctrlImportMatcap.setVisibility(t===s.Z.Shader.MATCAP),this._ctrlExposure.setVisibility(t===s.Z.Shader.PBR),this._ctrlEnvTitle.setVisibility(t===s.Z.Shader.PBR),this._ctrlEnv.setVisibility(t===s.Z.Shader.PBR),this._ctrlUV.setVisibility(t===s.Z.Shader.UV)}}},{key:"getFlatShading",value:function(){return this._ctrlFlatShading.getValue()}},{key:"getWireframe",value:function(){return this._ctrlShowWireframe.getValue()}},{key:"getShaderName",value:function(){return this._ctrlShaders.getValue()}},{key:"importTexture",value:function(){document.getElementById("textureopen").click()}},{key:"loadTextureUV",value:function(e){if(0!==e.target.files.length){var t=e.target.files[0];if(t.type.match("image.*")){var r=new FileReader,i=this._main;r.onload=function(e){_a.texture0=void 0,_a.texPath=e.target.result,i.render()},document.getElementById("textureopen").value="",r.readAsDataURL(t)}}}},{key:"loadMatcap",value:function(e){if(0!==e.target.files.length){var t=e.target.files[0];if(t.type.match("image.*")){var r=new FileReader,i=this._main,n=this._ctrlMatcap;r.onload=function(e){var r=new Image;r.src=e.target.result,r.onload=function(){var e=ga.matcaps.length;ga.matcaps.push({name:t.name}),ga.createTexture(i._gl,r,e);var a={};a[e]=t.name,n.addOptions(a),n.setValue(e),i.render()}},document.getElementById("matcapopen").value="",r.readAsDataURL(t)}}}},{key:"importMatcap",value:function(){document.getElementById("matcapopen").click()}},{key:"onKeyUp",value:function(e){l.Z.getShortKey(e.which)!==s.Z.KeyAction.WIREFRAME||e.ctrlKey||this._ctrlShowWireframe.setValue(!this._ctrlShowWireframe.getValue())}}])&&fa(t.prototype,r),e}();function ya(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}const ba=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=r._main,this._menu=null,this.init(t)}var t,r;return t=e,(r=[{key:"init",value:function(e){var t=this._menu=e.addMenu((0,x.Z)("sceneTitle"));t.addButton((0,x.Z)("sceneReset"),this,"clearScene"),t.addButton((0,x.Z)("sceneAddSphere"),this._main,"addSphere"),t.addButton((0,x.Z)("sceneAddCube"),this._main,"addCube"),t.addButton((0,x.Z)("sceneAddCylinder"),this._main,"addCylinder"),t.addButton((0,x.Z)("sceneAddPlane"),this._main,"addPlane"),t.addButton((0,x.Z)("sceneAddTorus"),this._main,"addTorus"),t.addTitle((0,x.Z)("sceneSelection")),t.addButton((0,x.Z)("sceneSelectAll"),this,"selectAll"),t.addButton((0,x.Z)("sceneSelectInvert"),this,"invertSelection"),t.addButton((0,x.Z)("sceneSelectPrevious"),this,"selectPrevious"),t.addButton((0,x.Z)("sceneSelectNext"),this,"selectNext"),this._ctrlMultiSelect=t.addCheckbox((0,x.Z)("sceneSelectMulti"),this._main.isMultiSelectionEnabled(),this.onMultiSelect.bind(this)),this._ctrlIsolate=t.addCheckbox((0,x.Z)("renderingIsolate"),!1,this.showHide.bind(this)),this._ctrlIsolate.setVisibility(!1),this._ctrlMerge=t.addButton((0,x.Z)("sceneMerge"),this,"merge"),this._ctrlMerge.setVisibility(!1),t.addButton((0,x.Z)("sceneDuplicate"),this,"duplicateSelection"),t.addButton((0,x.Z)("sceneDelete"),this,"deleteSelection"),t.addTitle((0,x.Z)("renderingExtra")),t.addCheckbox((0,x.Z)("darkenUnselected"),g.darkenUnselected,this.onDarkenUnselected.bind(this)),t.addCheckbox((0,x.Z)("contourShow"),this._main._showContour,this.onShowContour.bind(this)),t.addCheckbox((0,x.Z)("renderingGrid"),this._main._showGrid,this.onShowGrid.bind(this)),t.addCheckbox((0,x.Z)("renderingSymmetryLine"),g.showSymmetryLine,this.onShowSymmetryLine.bind(this)),this._ctrlOffSym=t.addSlider("SymOffset",0,this.onOffsetSymmetry.bind(this),-1,1,.001)}},{key:"clearScene",value:function(){window.confirm((0,x.Z)("sceneResetConfirm"))&&this._main.clearScene()}},{key:"onOffsetSymmetry",value:function(e){var t=this._main.getMesh();t&&(t.setSymmetryOffset(e),this._main.render())}},{key:"duplicateSelection",value:function(){this._main.duplicateSelection()}},{key:"deleteSelection",value:function(){this._main.deleteCurrentSelection()}},{key:"selectAll",value:function(){this._main.selectAllMeshes()}},{key:"invertSelection",value:function(){this._main.invertSelectionMeshes()}},{key:"selectNext",value:function(){this._main.selectNextMesh()}},{key:"selectPrevious",value:function(){this._main.selectPreviousMesh()}},{key:"onMultiSelect",value:function(e){this._main.setMultiSelectionEnabled(e)}},{key:"validatePreview",value:function(){this._main._meshPreview||this._main.addTorus(!0),this._main._meshPreview.setShowWireframe(!1),this._main.addNewMesh(this._main._meshPreview),this._main._meshPreview=null,this.ctrlDiscard.setVisibility(!1),this.ctrlValidate.setVisibility(!1),this._main.render()}},{key:"discardPreview",value:function(){this._main._meshPreview=null,this.ctrlDiscard.setVisibility(!1),this.ctrlValidate.setVisibility(!1),this._main.render()}},{key:"updateTorusRadius",value:function(e){this._main._torusRadius=e,this.updateTorus()}},{key:"updateTorusRadial",value:function(e){this._main._torusRadial=e,this.updateTorus()}},{key:"updateTorusTubular",value:function(e){this._main._torusTubular=e,this.updateTorus()}},{key:"updateTorusWidth",value:function(e){this._main._torusWidth=e,this._main._torusLength<this._main._torusWidth?this.ctrlLE.setValue(e):this.updateTorus()}},{key:"updateTorusLength",value:function(e){this._main._torusLength=e,this._main._torusLength<this._main._torusWidth?this.ctrlWI.setValue(e):this.updateTorus()}},{key:"updateTorus",value:function(){this._main.addTorus(!0),this.ctrlDiscard.setVisibility(!0),this.ctrlValidate.setVisibility(!0),this._main.render()}},{key:"hasHiddenMeshes",value:function(){for(var e=this._main.getMeshes(),t=0;t<e.length;++t)if(!e[t].isVisible())return!0;return!1}},{key:"updateMesh",value:function(){var e=this._main.getMeshes().length,t=this._main.getSelectedMeshes().length;this._ctrlIsolate.setVisibility(this.hasHiddenMeshes()||e!==t&&t>=1),this._ctrlMerge.setVisibility(t>1);var r=this._main.getMesh();this._ctrlOffSym.setValue(r?r.getSymmetryOffset():0)}},{key:"merge",value:function(){var e=this._main,t=e.getSelectedMeshes();if(!(t.length<2)){var r=dr.mergeMeshes(t,e.getMesh()||t[0]);e.removeMeshes(t),e.getStateManager().pushStateAddRemove(r,t.slice()),e.getMeshes().push(r),e.setMesh(r)}}},{key:"toggleShowHide",value:function(e){this._ctrlIsolate.setValue(!this._ctrlIsolate.getValue(),!!e)}},{key:"showHide",value:function(e){e?this.isolate():this.showAll(),this.updateMesh()}},{key:"setMeshesVisible",value:function(e,t){for(var r=0;r<e.length;++r)e[r].setVisible(t);this._ctrlIsolate.setValue(!t,!0)}},{key:"pushSetMeshesVisible",value:function(e,t){this.setMeshesVisible(e,t);var r=this.setMeshesVisible.bind(this,e,!t),i=this.setMeshesVisible.bind(this,e,t);this._main.getStateManager().pushStateCustom(r,i)}},{key:"isolate",value:function(){var e=this._main,t=e.getSelectedMeshes(),r=e.getMeshes();if(r.length===t.length||r.length<2)this._ctrlIsolate.setValue(!1,!0);else{for(var i=[],n=0;n<r.length;++n)e.getIndexSelectMesh(r[n])<0&&i.push(r[n]);this.pushSetMeshesVisible(i,!1),e.render()}}},{key:"showAll",value:function(){for(var e=this._main,t=e.getMeshes(),r=[],i=0;i<t.length;++i)t[i].isVisible()||r.push(t[i]);this.pushSetMeshesVisible(r,!0),e.render()}},{key:"onDarkenUnselected",value:function(e){g.darkenUnselected=e,this._main.render()}},{key:"onShowSymmetryLine",value:function(e){g.showSymmetryLine=e,this._main.render()}},{key:"onShowGrid",value:function(e){var t=this._main;t._showGrid=e,t.render()}},{key:"onShowContour",value:function(e){var t=this._main;t._showContour=e,t.render()}},{key:"onKeyDown",value:function(e){!0!==e.handled&&(e.stopPropagation(),this._main._focusGui||e.preventDefault(),73===e.which?(this.toggleShowHide(),e.handled=!0):68===e.which&&e.ctrlKey&&(this._main.duplicateSelection(),e.handled=!0))}}])&&ya(t.prototype,r),e}();var Ta=r(358),ka={tools:[]},Ma=ka.tools;ka.initGuiTools=function(e,t,r){for(var i=0,n=ti.length;i<n;++i)if(ti[i]){var a=Ma[i];a||(console.error("No gui for tool index : "+i),ka[i]={_ctrls:[],init:function(){}}),a.init(e.getTool(i),t,r),ka.hide(i)}},ka.hide=function(e){for(var t=0,r=Ma[e]._ctrls,i=r.length;t<i;++t)r[t].setVisibility(!1)},ka.show=function(e){for(var t=0,r=Ma[e]._ctrls,i=r.length;t<i;++t)r[t].setVisibility(!0)};var xa=function(e,t,r){this[e]=t?r/t:r},Sa=function(e,t,r,i){var n=t.addSlider((0,x.Z)("sculptRadius"),e._radius,(function(t){xa.call(e,"_radius",1,t),i.getSculptManager().getSelection().setIsEditMode(!0),i.renderSelectOverRtt()}),5,500,1);return r._ctrlRadius=n,n},Aa=function(e,t,r){var i=t.addSlider((0,x.Z)("sculptIntensity"),100*e._intensity,xa.bind(e,"_intensity",100),0,100,1);return r._ctrlIntensity=i,i},Ea=function(e,t){return t.addSlider((0,x.Z)("sculptHardness"),100*e._hardness,xa.bind(e,"_hardness",100),0,100,1)},Ra=function(e,t){return t.addCheckbox((0,x.Z)("sculptCulling"),e,"_culling")},wa=function(e,t,r,i){var n=t.addCheckbox(i||(0,x.Z)("sculptNegative"),e,"_negative");return r.toggleNegative=function(){n.setValue(!n.getValue())},n},Ca=function(){document.getElementById("alphaopen").click()},Pa=function(e,t,r,i){e.push(t.addTitle((0,x.Z)("sculptAlphaTitle"))),void 0!==r._lockPosition&&e.push(t.addCheckbox((0,x.Z)("sculptLockPositon"),r,"_lockPosition")),i._ctrlAlpha=t.addCombobox((0,x.Z)("sculptAlphaTex"),r,"_idAlpha",Ta.Z.ALPHAS_NAMES),e.push(i._ctrlAlpha),e.push(t.addButton((0,x.Z)("sculptImportAlpha"),Ca))};Ma[s.Z.Tools.BRUSH]={_ctrls:[],init:function(e,t,r){this._ctrls.push(Sa(e,t,this,r)),this._ctrls.push(Aa(e,t,this)),this._ctrls.push(wa(e,t,this)),this._ctrls.push(t.addCheckbox((0,x.Z)("sculptClay"),e,"_clay")),this._ctrls.push(t.addCheckbox((0,x.Z)("sculptAccumulate"),e,"_accumulate")),this._ctrls.push(Ra(e,t)),Pa(this._ctrls,t,e,this)}},Ma[s.Z.Tools.CREASE]={_ctrls:[],init:function(e,t,r){this._ctrls.push(Sa(e,t,this,r)),this._ctrls.push(Aa(e,t,this)),this._ctrls.push(wa(e,t,this)),this._ctrls.push(Ra(e,t)),Pa(this._ctrls,t,e,this)}},Ma[s.Z.Tools.DRAG]={_ctrls:[],init:function(e,t,r){this._ctrls.push(Sa(e,t,this,r)),Pa(this._ctrls,t,e,this)}},Ma[s.Z.Tools.FLATTEN]={_ctrls:[],init:function(e,t,r){this._ctrls.push(Sa(e,t,this,r)),this._ctrls.push(Aa(e,t,this)),this._ctrls.push(wa(e,t,this)),this._ctrls.push(Ra(e,t)),Pa(this._ctrls,t,e,this)}},Ma[s.Z.Tools.INFLATE]={_ctrls:[],init:function(e,t,r){this._ctrls.push(Sa(e,t,this,r)),this._ctrls.push(Aa(e,t,this)),this._ctrls.push(wa(e,t,this)),this._ctrls.push(Ra(e,t)),Pa(this._ctrls,t,e,this)}},Ma[s.Z.Tools.PAINT]={_ctrls:[],onMaterialChanged:function(e,t,r){i.R3.copy(t._color,r[0].getValue()),t._material[0]=r[1].getValue()/100,t._material[1]=r[2].getValue()/100;var n=e.getMesh();n&&(t._writeAlbedo&&n.setAlbedo(t._color),t._writeRoughness&&n.setRoughness(t._material[0]),t._writeMetalness&&n.setMetallic(t._material[1]),e.render())},resetMaterialOverride:function(e,t){this._ctrlPicker.getValue()!==t._pickColor&&this._ctrlPicker.setValue(t._pickColor);var r=e.getMesh();r&&r.getAlbedo&&(r.getAlbedo()[0]=-1,r.setRoughness(-1),r.setMetallic(-1),e.render())},onPickedMaterial:function(e,t,r,n,a,s){r.setCanvasCursor(o.Z.cursors.dropper),e[0].setValue(n,!0),e[1].setValue(100*a,!0),e[2].setValue(100*s,!0),i.R3.copy(t._color,n),t._material[0]=a,t._material[1]=s},onColorPick:function(e,t,r){e._pickColor=r,t.setCanvasCursor(r?o.Z.cursors.dropper:"default"),t._action=r?s.Z.Action.SCULPT_EDIT:s.Z.Action.NOTHING,t.renderSelectOverRtt()},init:function(e,t,r){this._ctrls.push(Sa(e,t,this,r)),this._ctrls.push(Aa(e,t,this)),this._ctrls.push(Ea(e,t)),this._ctrls.push(Ra(e,t)),this._ctrls.push(t.addTitle((0,x.Z)("sculptPBRTitle"))),this._ctrls.push(t.addButton((0,x.Z)("sculptPaintAll"),e,"paintAll")),this._ctrlPicker=t.addCheckbox((0,x.Z)("sculptPickColor"),e._pickColor,this.onColorPick.bind(this,e,r)),this._ctrls.push(this._ctrlPicker);var i=[],n=this.onMaterialChanged.bind(this,r,e,i),a=t.addColor((0,x.Z)("sculptColor"),e._color,n),s=t.addSlider((0,x.Z)("sculptRoughness"),100*e._material[0],n,0,100,1),o=t.addSlider((0,x.Z)("sculptMetallic"),100*e._material[1],n,0,100,1);i.push(a,s,o),this._ctrls.push(a,s,o),e.setPickCallback(this.onPickedMaterial.bind(this,i,e,r)),this._ctrls.push(t.addTitle("Write channel")),this._ctrls.push(t.addCheckbox((0,x.Z)("sculptColor"),e,"_writeAlbedo")),this._ctrls.push(t.addCheckbox((0,x.Z)("sculptRoughness"),e,"_writeRoughness")),this._ctrls.push(t.addCheckbox((0,x.Z)("sculptMetallic"),e,"_writeMetalness")),window.addEventListener("keyup",this.resetMaterialOverride.bind(this,r,e)),window.addEventListener("mouseup",this.resetMaterialOverride.bind(this,r,e)),Pa(this._ctrls,t,e,this)}},Ma[s.Z.Tools.PINCH]={_ctrls:[],init:function(e,t,r){this._ctrls.push(Sa(e,t,this,r)),this._ctrls.push(Aa(e,t,this)),this._ctrls.push(wa(e,t,this)),this._ctrls.push(Ra(e,t)),Pa(this._ctrls,t,e,this)}},Ma[s.Z.Tools.TWIST]={_ctrls:[],init:function(e,t,r){this._ctrls.push(Sa(e,t,this,r)),this._ctrls.push(Ra(e,t)),Pa(this._ctrls,t,e,this)}},Ma[s.Z.Tools.LOCALSCALE]={_ctrls:[],init:function(e,t,r){this._ctrls.push(Sa(e,t,this,r)),this._ctrls.push(Ra(e,t)),Pa(this._ctrls,t,e,this)}},Ma[s.Z.Tools.MOVE]={_ctrls:[],init:function(e,t,r){this._ctrls.push(Sa(e,t,this,r)),this._ctrls.push(Aa(e,t,this)),this._ctrls.push(t.addCheckbox((0,x.Z)("sculptTopologicalCheck"),e,"_topoCheck")),this._ctrls.push(wa(e,t,this,(0,x.Z)("sculptMoveAlongNormal"))),Pa(this._ctrls,t,e,this)}},Ma[s.Z.Tools.SMOOTH]={_ctrls:[],init:function(e,t,r){this._ctrls.push(Sa(e,t,this,r)),this._ctrls.push(Aa(e,t,this)),this._ctrls.push(t.addCheckbox((0,x.Z)("sculptTangentialSmoothing"),e,"_tangent")),this._ctrls.push(Ra(e,t)),Pa(this._ctrls,t,e,this)}},Ma[s.Z.Tools.MASKING]={_ctrls:[],init:function(e,t,r){this._ctrls.push(Sa(e,t,this,r)),this._ctrls.push(Aa(e,t,this)),this._ctrls.push(Ea(e,t)),this._ctrls.push(wa(e,t,this)),this._ctrls.push(Ra(e,t)),this._main=r,this._tool=e;var i=t.addDualButton((0,x.Z)("sculptMaskingClear"),(0,x.Z)("sculptMaskingInvert"),e,e,"clear","invert"),n=t.addDualButton((0,x.Z)("sculptMaskingBlur"),(0,x.Z)("sculptMaskingSharpen"),e,e,"blur","sharpen");this._ctrls.push(i[0],i[1],n[0],n[1]),this._ctrls.push(t.addTitle((0,x.Z)("sculptExtractTitle"))),this._ctrls.push(t.addSlider((0,x.Z)("sculptExtractThickness"),e,"_thickness",-5,5,.001)),this._ctrls.push(t.addButton((0,x.Z)("sculptExtractAction"),e,"extract")),Pa(this._ctrls,t,e,this)}},Ma[s.Z.Tools.TRANSFORM]={_ctrls:[],init:function(e,t,r){var i=[];i[e.constructor.Mode.TRANSLATE]=(0,x.Z)("sculptTransformTranslate"),i[e.constructor.Mode.ROTATE]=(0,x.Z)("sculptTransformRotate"),i[e.constructor.Mode.SCALE]=(0,x.Z)("sculptTransformScale");var n=[];n[e.constructor.Axis.ALL]=(0,x.Z)("sculptTransformAxisAll"),n[e.constructor.Axis.X]=(0,x.Z)("sculptTransformAxisX"),n[e.constructor.Axis.Y]=(0,x.Z)("sculptTransformAxisY"),n[e.constructor.Axis.Z]=(0,x.Z)("sculptTransformAxisZ");var a=[];a[e.constructor.Space.WORLD]=(0,x.Z)("sculptTransformSpaceWorld"),a[e.constructor.Space.LOCAL]=(0,x.Z)("sculptTransformSpaceLocal"),a[e.constructor.Space.NORMAL]=(0,x.Z)("sculptTransformSpaceNormal"),this._ctrls.push(t.addCombobox((0,x.Z)("sculptTransformMode"),e._gizmoMode,(function(t){e.setGizmoMode(t),r.render()}),i)),this._ctrls.push(t.addCombobox((0,x.Z)("sculptTransformAxis"),e._gizmoAxis,(function(t){e.setGizmoAxis(t),r.render()}),n)),this._ctrls.push(t.addCombobox((0,x.Z)("sculptTransformSpace"),e._gizmoSpace,(function(t){e.setGizmoSpace(t),r.render()}),a))}},Ma[s.Z.Tools.ELEMENTSELECT]={_ctrls:[],init:function(e,t){var r=[];r[e.constructor.Mode.VERTEX]=(0,x.Z)("sculptElementSelectVertex"),r[e.constructor.Mode.EDGE]=(0,x.Z)("sculptElementSelectEdge"),r[e.constructor.Mode.FACE]=(0,x.Z)("sculptElementSelectFace");var i=[];i[e.constructor.Action.REPLACE]=(0,x.Z)("sculptElementSelectReplace"),i[e.constructor.Action.ADD]=(0,x.Z)("sculptElementSelectAdd"),i[e.constructor.Action.REMOVE]=(0,x.Z)("sculptElementSelectRemove"),this._ctrls.push(t.addCombobox((0,x.Z)("sculptElementSelectMode"),e._selectionMode,(function(t){e._selectionMode=t}),r)),this._ctrls.push(t.addCombobox((0,x.Z)("sculptElementSelectAction"),e._selectionAction,(function(t){e._selectionAction=t}),i)),this._ctrls.push(t.addButton((0,x.Z)("sculptElementSelectAll"),e,"selectAll")),this._ctrls.push(t.addButton((0,x.Z)("sculptElementSelectClear"),e,"clearSelection")),this._ctrls.push(t.addButton((0,x.Z)("sculptElementSelectInvert"),e,"invertSelection"))}};const Da=ka;function Ia(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Fa=Da.tools;const Oa=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=r._main,this._ctrlGui=r,this._sculptManager=r._main.getSculptManager(),this._toolOnRelease=-1,this._invertSign=!1,this._modalBrushRadius=!1,this._modalBrushIntensity=!1,this._lastPageX=0,this._lastPageY=0,this._refX=0,this._refY=0,this._menu=null,this._ctrlSculpt=null,this._ctrlSymmetry=null,this._ctrlContinuous=null,this._ctrlTitleCommon=null,this.init(t)}var t,r;return t=e,(r=[{key:"init",value:function(e){var t=this._menu=e.addMenu((0,x.Z)("sculptTitle"));t.open(),t.addTitle((0,x.Z)("sculptTool"));for(var r=[],i=0,n=ti.length;i<n;++i)ti[i]&&(r[i]=(0,x.Z)(ti[i].uiName));this._ctrlSculpt=t.addCombobox((0,x.Z)("sculptTool"),this._sculptManager.getToolIndex(),this.onChangeTool.bind(this),r),Da.initGuiTools(this._sculptManager,this._menu,this._main),this._ctrlTitleCommon=t.addTitle((0,x.Z)("sculptCommon")),this._ctrlSymmetry=t.addCheckbox((0,x.Z)("sculptSymmetry"),this._sculptManager._symmetry,this.onSymmetryChange.bind(this)),this._ctrlContinuous=t.addCheckbox((0,x.Z)("sculptContinuous"),this._sculptManager,"_continuous"),Da.show(this._sculptManager.getToolIndex()),this.addEvents(),this.onChangeTool(this._sculptManager.getToolIndex())}},{key:"onSymmetryChange",value:function(e){this._sculptManager._symmetry=e,this._main.render()}},{key:"addEvents",value:function(){var e=this.loadAlpha.bind(this);document.getElementById("alphaopen").addEventListener("change",e,!1),this.removeCallback=function(){document.getElementById("alphaopen").removeEventListener("change",e,!1)}}},{key:"removeEvents",value:function(){this.removeCallback&&this.removeCallback()}},{key:"getSelectedTool",value:function(){return this._ctrlSculpt.getValue()}},{key:"releaseInvertSign",value:function(){if(this._invertSign){this._invertSign=!1;var e=Fa[this.getSelectedTool()];e.toggleNegative&&e.toggleNegative()}}},{key:"onChangeTool",value:function(e){Da.hide(this._sculptManager.getToolIndex()),this._sculptManager.setToolIndex(e),Da.show(e);var t=!0===this._sculptManager.canBeContinuous();this._ctrlContinuous.setVisibility(t);var r=e!==s.Z.Tools.TRANSFORM;this._ctrlSymmetry.setVisibility(r),this._ctrlTitleCommon.setVisibility(t||r),this._main.getPicking().updateLocalAndWorldRadius2()}},{key:"loadAlpha",value:function(e){if(0!==e.target.files.length){var t=e.target.files[0];if(t.type.match("image.*")){var r=new FileReader,i=this._main,n=Fa[this._sculptManager.getToolIndex()];r.onload=function(e){var r=new Image;r.src=e.target.result,r.onload=i.onLoadAlphaImage.bind(i,r,t.name||"new alpha",n)},document.getElementById("alphaopen").value="",r.readAsDataURL(t)}}}},{key:"addAlphaOptions",value:function(e){for(var t=0,r=Fa.length;t<r;++t){var i=Fa[t];i&&i._ctrlAlpha&&i._ctrlAlpha.addOptions(e)}}},{key:"updateMesh",value:function(){this._menu.setVisibility(!!this._main.getMesh())}},{key:"_startModalBrushRadius",value:function(e,t){this._refX=e,this._refY=t;var r=Fa[this.getSelectedTool()];if(r._ctrlRadius){var i=r._ctrlRadius.getValue();this._refX-=i,this._main.getSculptManager().getSelection().setOffsetX(-i*this._main.getPixelRatio()),this._main.renderSelectOverRtt()}}},{key:"_checkModifierKey",value:function(e){var t=this.getSelectedTool();if(this._main._action===s.Z.Action.NOTHING&&(!e.shiftKey||e.altKey||e.ctrlKey||t!==s.Z.Tools.SMOOTH&&(this._toolOnRelease=t,this._ctrlSculpt.setValue(s.Z.Tools.SMOOTH)),!e.ctrlKey||e.shiftKey||e.altKey||t!==s.Z.Tools.MASKING&&(this._toolOnRelease=t,this._ctrlSculpt.setValue(s.Z.Tools.MASKING))),e.altKey){if(this._invertSign||e.shiftKey)return!0;this._invertSign=!0;var r=Fa[t];return r.toggleNegative&&r.toggleNegative(),!0}return!1}},{key:"onKeyDown",value:function(e){if(!0!==e.handled){var t=this._main,r=l.Z.getShortKey(e.which);if(e.stopPropagation(),t._focusGui&&r!==s.Z.KeyAction.RADIUS&&r!==s.Z.KeyAction.INTENSITY||e.preventDefault(),e.handled=!0,!this._checkModifierKey(e)&&t._action===s.Z.Action.NOTHING){if(void 0!==r&&ti[r])return this._ctrlSculpt.setValue(r);var i=Fa[this.getSelectedTool()];switch(r){case s.Z.KeyAction.DELETE:t.deleteCurrentSelection();break;case s.Z.KeyAction.INTENSITY:this._modalBrushIntensity=t._focusGui=!0;break;case s.Z.KeyAction.RADIUS:this._modalBrushRadius||this._startModalBrushRadius(this._lastPageX,this._lastPageY),this._modalBrushRadius=t._focusGui=!0;break;case s.Z.KeyAction.NEGATIVE:i.toggleNegative&&i.toggleNegative();break;case s.Z.KeyAction.PICKER:var n=i._ctrlPicker;n&&!n.getValue()&&n.setValue(!0);break;default:e.handled=!1}}}}},{key:"onKeyUp",value:function(e){var t=this._main._action===s.Z.Action.NOTHING&&-1!==this._toolOnRelease&&!e.ctrlKey&&!e.shiftKey;e.altKey&&!t||this.releaseInvertSign(),t&&(this._ctrlSculpt.setValue(this._toolOnRelease),this._toolOnRelease=-1);var r=this._main;switch(l.Z.getShortKey(e.which)){case s.Z.KeyAction.RADIUS:this._modalBrushRadius=r._focusGui=!1,this._main.getSculptManager().getSelection().setOffsetX(0),e.pageX=this._lastPageX,e.pageY=this._lastPageY,r.setMousePosition(e),r.getPicking().intersectionMouseMeshes(),r.renderSelectOverRtt();break;case s.Z.KeyAction.PICKER:var i=Fa[this.getSelectedTool()]._ctrlPicker;i&&i.getValue()&&i.setValue(!1);break;case s.Z.KeyAction.INTENSITY:this._modalBrushIntensity=r._focusGui=!1}}},{key:"onMouseUp",value:function(e){-1===this._toolOnRelease||e.ctrlKey||e.shiftKey||(this.releaseInvertSign(),this._ctrlSculpt.setValue(this._toolOnRelease),this._toolOnRelease=-1)}},{key:"onMouseMove",value:function(e){var t=Fa[this.getSelectedTool()];if(this._modalBrushRadius&&t._ctrlRadius){var r=e.pageX-this._refX,i=e.pageY-this._refY;t._ctrlRadius.setValue(Math.sqrt(r*r+i*i)),this._main.renderSelectOverRtt()}this._modalBrushIntensity&&t._ctrlIntensity&&t._ctrlIntensity.setValue(t._ctrlIntensity.getValue()+e.pageX-this._lastPageX),this._lastPageX=e.pageX,this._lastPageY=e.pageY}},{key:"onMouseOver",value:function(e){this._modalBrushRadius&&this._startModalBrushRadius(e.pageX,e.pageY)}}])&&Ia(t.prototype,r),e}();function Va(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}const La=function(){function e(t,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=t,this._addedMeshes=void 0!==r.length?r:[r],this._removedMeshes=void 0!==i.length?i:[i],this._selectMeshes=t.getSelectedMeshes().slice()}var t,r;return t=e,(r=[{key:"isNoop",value:function(){return 0===this._addedMeshes.length&&0===this._removedMeshes.length}},{key:"undo",value:function(){var e,t,r=this._main,i=r.getMeshes(),n=this._addedMeshes;for(e=0,t=n.length;e<t;++e)i.splice(r.getIndexMesh(n[e]),1);var a=this._removedMeshes;for(e=0,t=a.length;e<t;++e)i.push(a[e]);for(e=0,t=i.length;e<t;++e)i[e].initRender();var s=this._selectMeshes;r.setMesh(s[0]?s[0]:null);var o=r.getSelectedMeshes();for(o.length=0,e=0,t=s.length;e<t;++e)o.push(s[e])}},{key:"redo",value:function(){this.undo()}},{key:"createRedo",value:function(){return new e(this._main,this._removedMeshes,this._addedMeshes)}}])&&Va(t.prototype,r),e}();function Na(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}const Ba=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=t,this._mesh=r,this._idVertState=[],this._cArState=[],this._mArState=[]}var t,r;return t=e,(r=[{key:"isNoop",value:function(){return 0===this._idVertState.length}},{key:"undo",value:function(){this.pullVertices();var e=this._mesh;e.updateDuplicateColorsAndMaterials(),e.updateDrawArrays(),e.updateColorBuffer(),e.updateMaterialBuffer(),this._main.setMesh(e)}},{key:"redo",value:function(){this.undo()}},{key:"createRedo",value:function(){var t=new e(this._main,this._mesh);return this.pushRedoVertices(t),t}},{key:"pushVertices",value:function(e){for(var t=this._idVertState,r=this._cArState,i=this._mArState,n=this._mesh,a=n.getColors(),s=n.getMaterials(),l=n.getVerticesStateFlags(),u=o.Z.STATE_FLAG,c=e.length,h=0;h<c;++h){var d=e[h];l[d]!==u&&(l[d]=u,t.push(d),d*=3,r.push(a[d],a[d+1],a[d+2]),i.push(s[d],s[d+1],s[d+2]))}}},{key:"pushRedoVertices",value:function(e){for(var t=e._mesh,r=t.getColors(),i=t.getMaterials(),n=this._idVertState,a=n.length,s=e._cArState=new Float32Array(3*a),o=e._mArState=new Float32Array(3*a),l=e._idVertState=new Uint32Array(a),u=0;u<a;++u){var c=l[u]=n[u];c*=3;var h=3*u;s[h]=r[c],s[h+1]=r[c+1],s[h+2]=r[c+2],o[h]=i[c],o[h+1]=i[c+1],o[h+2]=i[c+2]}}},{key:"pullVertices",value:function(){for(var e=this._cArState,t=this._mArState,r=this._idVertState,i=r.length,n=this._mesh,a=n.getColors(),s=n.getMaterials(),o=0;o<i;++o){var l=3*r[o],u=3*o;a[l]=e[u],a[l+1]=e[u+1],a[l+2]=e[u+2],s[l]=t[u],s[l+1]=t[u+1],s[l+2]=t[u+2]}}}])&&Na(t.prototype,r),e}();function Ua(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}const Za=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=t,this._mesh=r,this._center=i.R3.copy([0,0,0],r.getCenter()),this._idVertState=[],this._vArState=[]}var t,r;return t=e,(r=[{key:"isNoop",value:function(){return 0===this._idVertState.length}},{key:"undo",value:function(){this.pullVertices();var e=this._mesh;e.updateGeometry(e.getFacesFromVertices(this._idVertState),this._idVertState),e.updateGeometryBuffers(),i.R3.copy(e.getCenter(),this._center),this._main.setMesh(e)}},{key:"redo",value:function(){this.undo()}},{key:"createRedo",value:function(){var t=new e(this._main,this._mesh);return this.pushRedoVertices(t),t}},{key:"pushVertices",value:function(e){for(var t=this._idVertState,r=this._vArState,i=this._mesh,n=i.getVertices(),a=i.getVerticesStateFlags(),s=o.Z.STATE_FLAG,l=e.length,u=0;u<l;++u){var c=e[u];a[c]!==s&&(a[c]=s,t.push(c),c*=3,r.push(n[c],n[c+1],n[c+2]))}}},{key:"pushRedoVertices",value:function(e){for(var t=e._mesh.getVertices(),r=this._idVertState,i=r.length,n=e._vArState=new Float32Array(3*i),a=e._idVertState=new Uint32Array(i),s=0;s<i;++s){var o=a[s]=r[s];o*=3;var l=3*s;n[l]=t[o],n[l+1]=t[o+1],n[l+2]=t[o+2]}}},{key:"pullVertices",value:function(){for(var e=this._vArState,t=this._idVertState,r=t.length,i=this._mesh.getVertices(),n=0;n<r;++n){var a=3*t[n],s=3*n;i[a]=e[s],i[a+1]=e[s+1],i[a+2]=e[s+2]}}}])&&Ua(t.prototype,r),e}();function za(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}const Ga=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=t,this._mesh=r,this._center=i.R3.copy([0,0,0],r.getCenter()),this._nbFacesState=r.getNbFaces(),this._nbVerticesState=r.getNbVertices(),this._idVertState=[],this._fRingState=[],this._vRingState=[],this._vArState=[],this._cArState=[],this._mArState=[],this._idFaceState=[],this._fArState=[]}var t,r;return t=e,(r=[{key:"isNoop",value:function(){return 0===this._idVertState.length&&0===this._idFaceState.length}},{key:"undo",value:function(){this.pullVertices(),this.pullFaces();var e=this._mesh;e.setNbVertices(this._nbVerticesState),e.setNbFaces(this._nbFacesState),e.updateTopology(),e.updateGeometry(),e.updateDuplicateColorsAndMaterials(),e.updateDrawArrays(),e.updateColorBuffer(),e.updateMaterialBuffer(),e.updateBuffers(),i.R3.copy(e.getCenter(),this._center),this._main.setMesh(e)}},{key:"redo",value:function(){this.undo()}},{key:"createRedo",value:function(){var t=new e(this._main,this._mesh);return this.pushRedoVertices(t),this.pushRedoFaces(t),t}},{key:"pushVertices",value:function(e){for(var t=this._idVertState,r=this._fRingState,i=this._vRingState,n=this._vArState,a=this._cArState,s=this._mArState,l=this._mesh,u=l.getVerticesRingFace(),c=l.getVerticesRingVert(),h=l.getVertices(),d=l.getColors(),f=l.getMaterials(),p=l.getVerticesStateFlags(),_=o.Z.STATE_FLAG,m=e.length,g=0;g<m;++g){var v=e[g];p[v]!==_&&(p[v]=_,r.push(u[v].slice()),i.push(c[v].slice()),t.push(v),v*=3,n.push(h[v],h[v+1],h[v+2]),a.push(d[v],d[v+1],d[v+2]),s.push(f[v],f[v+1],f[v+2]))}}},{key:"pushFaces",value:function(e){for(var t=this._idFaceState,r=this._fArState,i=this._mesh,n=i.getFaces(),a=i.getFacesStateFlags(),s=o.Z.STATE_FLAG,l=e.length,u=0;u<l;++u){var c=e[u];a[c]!==s&&(a[c]=s,t.push(c),c*=4,r.push(n[c],n[c+1],n[c+2],n[c+3]))}}},{key:"pushRedoVertices",value:function(e){var t=e._mesh,r=t.getNbVertices(),i=t.getVerticesRingFace(),n=t.getVerticesRingVert(),a=t.getVertices(),s=t.getColors(),l=t.getMaterials(),u=0,c=0,h=0,d=this._idVertState,f=d.length,p=this._nbVerticesState,_=Math.min(p,r),m=new Uint32Array(o.Z.getMemory(4*r),0,r);for(u=0;u<f;++u)(c=d[u])<_&&(m[h++]=c);for(u=p;u<r;++u)m[h++]=u;f=h,m=e._idVertState=new Uint32Array(m.subarray(0,f));var g=e._fRingState=new Array(f),v=e._vRingState=new Array(f),y=e._vArState=new Float32Array(3*f),b=e._cArState=new Float32Array(3*f),T=e._mArState=new Float32Array(3*f);for(u=0;u<f;++u){c=m[u],g[u]=i[c].slice(),v[u]=n[c].slice(),c*=3;var k=3*u;y[k]=a[c],y[k+1]=a[c+1],y[k+2]=a[c+2],b[k]=s[c],b[k+1]=s[c+1],b[k+2]=s[c+2],T[k]=l[c],T[k+1]=l[c+1],T[k+2]=l[c+2]}}},{key:"pushRedoFaces",value:function(e){var t=e._mesh,r=t.getNbFaces(),i=t.getFaces(),n=0,a=0,s=0,l=this._idFaceState,u=l.length,c=this._nbFacesState,h=Math.min(c,r),d=new Uint32Array(o.Z.getMemory(4*r),0,r);for(n=0;n<u;++n)(a=l[n])<h&&(d[s++]=a);for(n=c;n<r;++n)d[s++]=n;u=s,d=e._idFaceState=new Uint32Array(d.subarray(0,u));var f=e._fArState=new Int32Array(4*u);for(n=0;n<u;++n){a=d[n],a*=4;var p=4*n;f[p]=i[a],f[p+1]=i[a+1],f[p+2]=i[a+2],f[p+3]=i[a+3]}}},{key:"pullVertices",value:function(){for(var e=this._nbVerticesState,t=this._fRingState,r=this._vRingState,i=this._vArState,n=this._cArState,a=this._mArState,s=this._idVertState,o=s.length,l=this._mesh,u=l.getVerticesRingFace(),c=l.getVerticesRingVert(),h=l.getVertices(),d=l.getColors(),f=l.getMaterials(),p=0;p<o;++p){var _=s[p];if(!(_>=e)){u[_]=t[p].slice(),c[_]=r[p].slice();var m=3*p;h[_*=3]=i[m],h[_+1]=i[m+1],h[_+2]=i[m+2],d[_]=n[m],d[_+1]=n[m+1],d[_+2]=n[m+2],f[_]=a[m],f[_+1]=a[m+1],f[_+2]=a[m+2]}}}},{key:"pullFaces",value:function(){for(var e=this._nbFacesState,t=this._fArState,r=this._idFaceState,i=r.length,n=this._mesh.getFaces(),a=0;a<i;++a){var s=r[a];if(!(s>=e)){var o=4*a;n[s*=4]=t[o],n[s+1]=t[o+1],n[s+2]=t[o+2],n[s+3]=t[o+3]}}}}])&&za(t.prototype,r),e}();function Wa(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}const ja=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._undocb=t,this._redocb=r||t}var t,r;return t=e,(r=[{key:"isNoop",value:function(){return!this._undocb}},{key:"undo",value:function(){this._undocb()}},{key:"redo",value:function(){this._redocb()}},{key:"createRedo",value:function(){return new e(this._undocb,this._redocb)}}])&&Wa(t.prototype,r),e}();function Xa(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Ha=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=t,this._undos=[],this._redos=[],this._curUndoIndex=-1}var t,r;return t=e,(r=[{key:"pushStateCustom",value:function(e,t,r){var i=new ja(e,t);i.squash=r,this.pushState(i)}},{key:"pushStateAddRemove",value:function(e,t,r){var i=new La(this._main,e,t);i.squash=r,this.pushState(i)}},{key:"pushStateRemove",value:function(e){this.pushState(new La(this._main,[],e))}},{key:"pushStateAdd",value:function(e){this.pushState(new La(this._main,e,[]))}},{key:"pushStateColorAndMaterial",value:function(e){e.isDynamic?this.pushState(new Ga(this._main,e)):this.pushState(new Ba(this._main,e))}},{key:"pushStateGeometry",value:function(e){e.isDynamic?this.pushState(new Ga(this._main,e)):this.pushState(new Za(this._main,e))}},{key:"pushStateMultiresolution",value:function(e,t){this.pushState(new ca(this._main,e,t))}},{key:"setNewMaxStack",value:function(t){e.STACK_LENGTH=t;for(var r=this._undos,i=this._redos;this._curUndoIndex>=t;)r.shift(),--this._curUndoIndex;for(;r.length>t;)r.pop(),i.shift()}},{key:"pushState",value:function(t){++o.Z.STATE_FLAG;var r=this._undos;-1===this._curUndoIndex?r.length=0:r.length>=e.STACK_LENGTH&&(r.shift(),--this._curUndoIndex),this._redos.length=0,++this._curUndoIndex,r.length>0&&(r.length=this._curUndoIndex),r.push(t)}},{key:"getCurrentState",value:function(){return this._undos[this._curUndoIndex]}},{key:"pushVertices",value:function(e){e&&e.length>0&&this.getCurrentState().pushVertices(e)}},{key:"pushFaces",value:function(e){e&&e.length>0&&this.getCurrentState().pushFaces(e)}},{key:"undo",value:function(){if(this._undos.length&&!(this._curUndoIndex<0)){var e=this.getCurrentState(),t=e.createRedo();t.squash=e.squash,this._redos.push(t),e.undo(),this._curUndoIndex--,!0===e.squash&&this.undo()}}},{key:"redo",value:function(){this._redos.length&&(this._redos[this._redos.length-1].redo(),this._curUndoIndex++,this._redos.pop(),this._redos.length&&!0===this._redos[this._redos.length-1].squash&&this.redo())}},{key:"reset",value:function(){this._undos.length=0,this._redos.length=0,this._curUndoIndex=-1}},{key:"cleanNoop",value:function(){for(;this._curUndoIndex>=0&&this.getCurrentState().isNoop();)this._undos.length--,this._curUndoIndex--,this._redos.length=0}}])&&Xa(t.prototype,r),e}();Ha.STACK_LENGTH=15;const Ya=Ha;function Ka(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}const qa=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._ctrlGui=r,this._main=r._main,this._menu=null,this.init(t)}var t,r;return t=e,(r=[{key:"init",value:function(e){var t=this._menu=e.addMenu((0,x.Z)("stateTitle"));t.addButton((0,x.Z)("stateUndo"),this,"onUndo","CTRL+Z"),t.addButton((0,x.Z)("stateRedo"),this,"onRedo","CTRL+Y"),t.addTitle((0,x.Z)("stateMaxStack"));var r=this._main.getStateManager();t.addSlider("",Ya.STACK_LENGTH,r.setNewMaxStack.bind(r),3,50,1)}},{key:"onUndo",value:function(){this._main._action=s.Z.Action.NOTHING,this._main.getSculptManager().end(),this._main.getStateManager().undo(),this._main.render(),this._ctrlGui.updateMesh()}},{key:"onRedo",value:function(){this._main.getStateManager().redo(),this._main.render(),this._ctrlGui.updateMesh()}},{key:"onKeyDown",value:function(e){if(!0!==e.handled){e.stopPropagation(),this._main._focusGui||e.preventDefault();var t=e.which;e.ctrlKey&&90===t?(this.onUndo(),e.handled=!0):e.ctrlKey&&89===t&&(this.onRedo(),e.handled=!0)}}}])&&Ka(t.prototype,r),e}();function Ja(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}const Qa=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._menu=null,this.init(t)}var t,r;return t=e,(r=[{key:"init",value:function(e){var t=this._menu=e.addMenu((0,x.Z)("pressureTitle"));t.addTitle((0,x.Z)("pressureRadius")),t.addSlider("",a.Z,"radiusFactor",0,1,.01),t.addTitle((0,x.Z)("pressureIntensity")),t.addSlider("",a.Z,"intensityFactor",0,1,.01)}}])&&Ja(t.prototype,r),e}();function $a(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}const es=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=t,this._guiMain=null,this._sidebar=null,this._topbar=null,this._ctrlTablet=null,this._ctrlFiles=null,this._ctrlScene=null,this._ctrlStates=null,this._ctrlCamera=null,this._ctrlBackground=null,this._ctrlSculpting=null,this._ctrlTopology=null,this._ctrlRendering=null,this._ctrlNotification=null,this._ctrls=[],this._notifications={},this._xhrs={}}var t,r;return t=e,(r=[{key:"initGui",value:function(){this.deleteGui(),this._guiMain=new(Pi().GuiMain)(this._main.getViewport(),this._main.onCanvasResize.bind(this._main));var e=this._ctrls;e.length=0;var t=0;this._topbar=this._guiMain.addTopbar(),e[t++]=this._ctrlFiles=new pn(this._topbar,this),e[t++]=this._ctrlScene=new ba(this._topbar,this),e[t++]=this._ctrlStates=new qa(this._topbar,this),e[t++]=this._ctrlBackground=new Ii(this._topbar,this),e[t++]=this._ctrlCamera=new Oi(this._topbar,this),e[t++]=this._ctrlTablet=new Qa(this._topbar,this),e[t++]=this._ctrlConfig=new Li(this._topbar,this),e[t++]=this._ctrlMesh=new mn(this._topbar,this),this._sidebar=this._guiMain.addRightSidebar(),e[t++]=this._ctrlRendering=new va(this._sidebar,this),e[t++]=this._ctrlTopology=new da(this._sidebar,this),e[t++]=this._ctrlSculpting=new Oa(this._sidebar,this);var r=this._topbar.addExtra();r.addTitle((0,x.Z)("contour")),r.addColor((0,x.Z)("contourColor"),j.color,this.onContourColor.bind(this)),r.addTitle((0,x.Z)("resolution")),r.addSlider("",this._main._pixelRatio,this.onPixelRatio.bind(this),.5,2,.02),this.addAboutButton(),this.updateMesh(),this.setVisibility(!0),window.postprocessGui&&window.postprocessGui()}},{key:"getNotification",value:function(e){var t=this._notifications[e];return t?this._xhrs[e]&&t.isVisible()?void(window.confirm("Abort "+e+" previous upload?")&&(this._xhrs[e].abort(),this._xhrs[e].isAborted=!0,t.setMessage(null))):t:((t=this._topbar.addMenu()).isVisible=function(){return!this.domContainer.hidden},t.setMessage=function(e){this.domContainer.innerHTML=e,this.setVisibility(!!e)},t.domContainer.style.color="red",t.setMessage(""),this._notifications[e]=t,t)}},{key:"initPrint",value:function(e){e.addMenu("Print it!").addButton("Go to Materialise!",this,"exportMaterialise")}},{key:"exportSculpteo",value:function(){this._export("sculpteo")}},{key:"exportMaterialise",value:function(){window.confirm("A new webpage will be opened. Start upload?")&&this._export("materialise")}},{key:"exportSketchfab",value:function(){this._export("sketchfab")}},{key:"_export",value:function(e){if(this._main.getMesh()){var t=this.getNotification(e);if(t){var r="export"+e.charAt(0).toUpperCase()+e.slice(1);this._xhrs[e]=sn[r](this._main,t)}}}},{key:"onPixelRatio",value:function(e){this._main._pixelRatio=e,this._main.onCanvasResize()}},{key:"onContourColor",value:function(e){j.color[0]=e[0],j.color[1]=e[1],j.color[2]=e[2],j.color[3]=e[3],this._main.render()}},{key:"addAboutButton",value:function(){var e=this._topbar.addMenu();e.domContainer.innerHTML=(0,x.Z)("about"),e.domContainer.addEventListener("mousedown",(function(){window.open("http://stephaneginier.com","_blank")}))}},{key:"updateMesh",value:function(){this._ctrlRendering.updateMesh(),this._ctrlTopology.updateMesh(),this._ctrlSculpting.updateMesh(),this._ctrlScene.updateMesh(),this.updateMeshInfo()}},{key:"updateMeshInfo",value:function(){this._ctrlMesh.updateMeshInfo()}},{key:"getFlatShading",value:function(){return this._ctrlRendering.getFlatShading()}},{key:"getWireframe",value:function(){return this._ctrlRendering.getWireframe()}},{key:"getShaderType",value:function(){return this._ctrlRendering.getShaderType()}},{key:"addAlphaOptions",value:function(e){this._ctrlSculpting.addAlphaOptions(e)}},{key:"deleteGui",value:function(){this._guiMain&&this._guiMain.domMain.parentNode&&(this.callFunc("removeEvents"),this.setVisibility(!1),this._guiMain.domMain.parentNode.removeChild(this._guiMain.domMain))}},{key:"setVisibility",value:function(e){this._guiMain.setVisibility(e)}},{key:"callFunc",value:function(e,t){for(var r=0,i=this._ctrls,n=i.length;r<n;++r){var a=i[r];a&&a[e]&&a[e](t)}}}])&&$a(t.prototype,r),e}();var ts=r(498),rs=i.R3.fromValues(0,1,0),is=i.R3.fromValues(0,0,1);function ns(){var e=((0,l.Z)().up||"").toString().toLowerCase();return"z"===e||"blender"===e||"zup"===e}function as(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.R3.create();return i.R3.copy(e,ns()?is:rs),e}function ss(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}new ts.Pa4(0,1,0),new ts.Pa4(0,0,1);var os=200,ls=200,us=[0,0],cs=[0,0,0],hs=[0,0,0],ds=[0,0,0,1],fs=i._E.create(),ps=Math.SQRT1_2,_s=.5,ms=[i.gf.fromValues(1,0,0,0),i.gf.fromValues(0,1,0,0),i.gf.fromValues(0,0,1,0),i.gf.fromValues(0,0,0,1),i.gf.fromValues(ps,ps,0,0),i.gf.fromValues(ps,-ps,0,0),i.gf.fromValues(ps,0,ps,0),i.gf.fromValues(ps,0,-ps,0),i.gf.fromValues(ps,0,0,ps),i.gf.fromValues(ps,0,0,-ps),i.gf.fromValues(0,ps,ps,0),i.gf.fromValues(0,ps,-ps,0),i.gf.fromValues(0,ps,0,ps),i.gf.fromValues(0,ps,0,-ps),i.gf.fromValues(0,0,ps,ps),i.gf.fromValues(0,0,ps,-ps),i.gf.fromValues(_s,_s,_s,_s),i.gf.fromValues(_s,_s,_s,-_s),i.gf.fromValues(_s,_s,-_s,_s),i.gf.fromValues(_s,_s,-_s,-_s),i.gf.fromValues(_s,-_s,_s,_s),i.gf.fromValues(_s,-_s,_s,-_s),i.gf.fromValues(_s,-_s,-_s,_s),i.gf.fromValues(-_s,_s,_s,_s)];const gs=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=t;var r=(0,l.Z)();this._mode=r.cameramode||s.Z.CameraMode.ORBIT,this._projectionType=r.projection||s.Z.Projection.PERSPECTIVE,this._quatRot=[0,0,0,1],this._view=i._E.create(),this._proj=i._E.create(),this._viewport=i._E.create(),this._lastNormalizedMouseXY=[0,0],this._width=0,this._height=0,this._speed=0,this._fov=Math.min(r.fov,150),this._trans=[0,0,30],this._moveX=0,this._moveZ=0,this._usePivot=r.pivot,this._center=[0,0,0],this._offset=[0,0,0],this._rotX=0,this._rotY=0,this._near=.05,this._far=5e3,this._timers={},this._up=as(i.R3.create()),this.resetView()}var t,r;return t=e,(r=[{key:"setProjectionType",value:function(e){this._projectionType=e,this.updateProjection(),this.updateView()}},{key:"setMode",value:function(e){this._mode=e,e===s.Z.CameraMode.ORBIT&&this.resetViewFront()}},{key:"setFov",value:function(e){this._fov=e,this.updateView(),this.optimizeNearFar()}},{key:"setUsePivot",value:function(e){this._usePivot=e}},{key:"toggleUsePivot",value:function(){this._usePivot=!this._usePivot}},{key:"getView",value:function(){return this._view}},{key:"getProjection",value:function(){return this._proj}},{key:"getProjectionType",value:function(){return this._projectionType}},{key:"isOrthographic",value:function(){return this._projectionType===s.Z.Projection.ORTHOGRAPHIC}},{key:"getMode",value:function(){return this._mode}},{key:"getFov",value:function(){return this._fov}},{key:"getUsePivot",value:function(){return this._usePivot}},{key:"getConstantScreen",value:function(){var e=this._main.getCanvas().clientWidth;return this._projectionType===s.Z.Projection.ORTHOGRAPHIC?e/this.getOrthoZoom():e*this._proj[0]}},{key:"start",value:function(e,t){if(this._lastNormalizedMouseXY=Se.Z.normalizedMouse(e,t,this._width,this._height),this._usePivot){var r=this._main,n=r.getPicking();n.intersectionMouseMeshes(r.getMeshes(),e,t),n.getMesh()&&(i.R3.transformMat4(cs,n.getIntersectionPoint(),n.getMesh().getMatrix()),this.setPivot(cs))}}},{key:"setPivot",value:function(e){if(i.R3.transformQuat(this._offset,this._offset,i.gf.invert(ds,this._quatRot)),i.R3.sub(this._offset,this._offset,this._center),i.R3.copy(this._center,e),i.R3.add(this._offset,this._offset,this._center),i.R3.transformQuat(this._offset,this._offset,this._quatRot),this._projectionType===s.Z.Projection.PERSPECTIVE){var t=this.getTransZ();this._trans[2]=i.R3.dist(this.computePosition(),this._center)*this._fov/45,this._offset[2]+=this.getTransZ()-t}else this._offset[2]=0}},{key:"rotate",value:function(e,t){var r=cs,n=us,a=Se.Z.normalizedMouse(e,t,this._width,this._height);if(this._mode===s.Z.CameraMode.ORBIT)i.K4.sub(n,a,this._lastNormalizedMouseXY),this.setOrbit(this._rotX-2*n[1],this._rotY+2*n[0]),this.rotateDelay([6*-n[1],6*n[0]],-1);else if(this._mode===s.Z.CameraMode.PLANE){var o=i.K4.dist(this._lastNormalizedMouseXY,a);i.K4.sub(n,a,this._lastNormalizedMouseXY),i.R3.normalize(r,i.R3.set(r,-n[1],n[0],0)),i.gf.mul(this._quatRot,i.gf.setAxisAngle(ds,r,2*o),this._quatRot),this.rotateDelay([r[0],r[1],r[2],6*o],-1)}else if(this._mode===s.Z.CameraMode.SPHERICAL){var l=Se.Z.mouseOnUnitSphere(this._lastNormalizedMouseXY),u=Se.Z.mouseOnUnitSphere(a),c=Math.acos(Math.min(1,i.R3.dot(l,u)));i.R3.normalize(r,i.R3.cross(r,l,u)),i.gf.mul(this._quatRot,i.gf.setAxisAngle(ds,r,2*c),this._quatRot),this.rotateDelay([r[0],r[1],r[2],6*c],-1)}this._lastNormalizedMouseXY=a,this.updateView()}},{key:"setOrbit",value:function(e,t){var r=.49*Math.PI;this._rotX=Math.max(Math.min(e,r),-r),this._rotY=t;var n=this._quatRot;i.gf.identity(n),i.gf.rotateX(n,n,this._rotX),i.gf.rotateY(n,n,this._rotY)}},{key:"getTransZ",value:function(){return this._projectionType===s.Z.Projection.PERSPECTIVE?45*this._trans[2]/this._fov:1e3}},{key:"updateView",value:function(){var e=cs,t=this._view,r=this._trans[0],n=this._trans[1],a=this._offset;i.R3.set(hs,r-a[0],n-a[1],this.getTransZ()-a[2]),i.R3.set(e,r-a[0],n-a[1],-a[2]),as(this._up),i._E.lookAt(t,hs,e,this._up),i._E.mul(t,t,i._E.fromQuat(fs,this._quatRot)),i._E.translate(t,t,i.R3.negate(cs,this._center))}},{key:"optimizeNearFar",value:function(e){if(e||(e=this._lastBBox),e){this._lastBBox=e;var t=this.computePosition(hs),r=i.R3.set(cs,.5*(e[0]+e[3]),.5*(e[1]+e[4]),.5*(e[2]+e[5])),n=i.R3.dist(t,r),a=.5*i.R3.dist(e,i.R3.set(cs,e[3],e[4],e[5]));this._near=Math.max(.01,n-a),this._far=a+n,this.updateProjection()}}},{key:"updateProjection",value:function(){this._projectionType===s.Z.Projection.PERSPECTIVE?(i._E.perspective(this._proj,this._fov*Math.PI/180,this._width/this._height,this._near,this._far),this._proj[10]=-1,this._proj[14]=-2*this._near):this.updateOrtho()}},{key:"updateTranslation",value:function(){var e=this._trans;e[0]+=this._moveX*this._speed*e[2]/50/400,e[2]=Math.max(1e-5,e[2]+this._moveZ*this._speed/400),this._projectionType===s.Z.Projection.ORTHOGRAPHIC&&this.updateOrtho(),this.updateView()}},{key:"translate",value:function(e,t){var r=this._speed*this._trans[2]/54,n=[-e*r,t*r,0];this.setTrans(i.R3.add(this._trans,this._trans,n)),i.R3.scale(n,n,5),this.translateDelay(n,-1)}},{key:"zoom",value:function(e){var t=[0,0,0];i.R3.sub(t,this._offset,this._trans),i.R3.scale(t,t,e*this._speed/54),e<0&&(t[0]=t[1]=0),this.setTrans(i.R3.add(this._trans,this._trans,t)),i.R3.scale(t,t,5),this.translateDelay(t,-1)}},{key:"setAndFocusOnPivot",value:function(e,t){this.setPivot(e),this.moveToDelay(this._offset[0],this._offset[1],this._offset[2]+t)}},{key:"moveToDelay",value:function(e,t,r){var n=[e,t,r];this.translateDelay(i.R3.sub(n,n,this._trans),ls)}},{key:"setTrans",value:function(e){i.R3.copy(this._trans,e),this._projectionType===s.Z.Projection.ORTHOGRAPHIC&&this.updateOrtho(),this.updateView()}},{key:"getOrthoZoom",value:function(){return 55e-5*Math.abs(this._trans[2])}},{key:"updateOrtho",value:function(){var e=this.getOrthoZoom(),t=this._width*e,r=this._height*e;i._E.ortho(this._proj,-t,t,-r,r,-this._near,this._far)}},{key:"computePosition",value:function(e){e=e||[0,0,0];var t=this._view;return i.R3.set(e,-t[12],-t[13],-t[14]),i.wO.fromMat4(fs,t),i.wO.transpose(fs,fs),i.R3.transformMat3(e,e,fs)}},{key:"resetView",value:function(){this._speed=1.5*o.Z.SCALE,this.centerDelay([0,0,0],ls),this.offsetDelay([0,0,0],ls);var e=[0,0,30+this._speed/3];i.R3.sub(e,e,this._trans),this.translateDelay(e,ls),this.quatDelay([0,0,0,1],ls)}},{key:"resetViewFront",value:function(){this.quatDelay([0,0,0,1],os)}},{key:"resetViewBack",value:function(){this.quatDelay([0,1,0,0],os)}},{key:"resetViewTop",value:function(){this.quatDelay([Math.SQRT1_2,0,0,Math.SQRT1_2],os)}},{key:"resetViewBottom",value:function(){this.quatDelay([-Math.SQRT1_2,0,0,Math.SQRT1_2],os)}},{key:"resetViewLeft",value:function(){this.quatDelay([0,-Math.SQRT1_2,0,Math.SQRT1_2],os)}},{key:"resetViewRight",value:function(){this.quatDelay([0,Math.SQRT1_2,0,Math.SQRT1_2],os)}},{key:"toggleViewFront",value:function(){Math.abs(this._quatRot[3])>.99?this.resetViewBack():this.resetViewFront()}},{key:"toggleViewTop",value:function(){var e=this._quatRot[0]*Math.SQRT1_2+this._quatRot[3]*Math.SQRT1_2;e*e>.99?this.resetViewBottom():this.resetViewTop()}},{key:"toggleViewLeft",value:function(){var e=-this._quatRot[1]*Math.SQRT1_2+this._quatRot[3]*Math.SQRT1_2;e*e>.99?this.resetViewRight():this.resetViewLeft()}},{key:"computeWorldToScreenMatrix",value:function(e){return e=e||i._E.create(),i._E.mul(e,i._E.mul(e,this._viewport,this._proj),this._view)}},{key:"unproject",value:function(e,t,r){var n=[0,0,0];return i._E.invert(fs,this.computeWorldToScreenMatrix(fs)),i.R3.transformMat4(n,i.R3.set(n,e,this._height-t,r),fs)}},{key:"project",value:function(e){var t=[0,0,0];return i.R3.transformMat4(t,e,this.computeWorldToScreenMatrix(fs)),t[1]=this._height-t[1],t}},{key:"onResize",value:function(e,t){this._width=e,this._height=t;var r=this._viewport;i._E.identity(r),i._E.scale(r,r,i.R3.set(cs,.5*e,.5*t,.5)),i._E.translate(r,r,i.R3.set(cs,1,1,1)),this.updateProjection()}},{key:"snapClosestRotation",value:function(){for(var e=this._quatRot,t=1/0,r=0,n=ms.length,a=0;a<n;++a){var s=i.gf.dot(e,ms[a]);t<(s=1-s*s)||(t=s,r=a)}this.quatDelay(ms[r],os)}},{key:"clearTimerN",value:function(e){window.clearInterval(this._timers[e]),this._timers[e]=0}},{key:"delay",value:function(e,t,r){var i=r||"default";if(this._timers[i]&&this.clearTimerN(i),0===t)return e(1);if(!(t<0)){var n=0,a=(new Date).getTime();this._timers[i]=window.setInterval(function(){var r=((new Date).getTime()-a)/t;r=function(e){return-((e=Math.min(1,e)-1)*e*e*e-1)}(r),e(r-n,r),n=r,r>=1&&this.clearTimerN(i)}.bind(this),16.6)}}},{key:"_translateDelta",value:function(e,t){var r=this._trans;i.R3.scaleAndAdd(r,r,e,t),this.setTrans(r),this._main.render()}},{key:"translateDelay",value:function(e,t){var r=this._translateDelta.bind(this,e);this.delay(r,t,"translate")}},{key:"_rotDelta",value:function(e,t){if(this._mode===s.Z.CameraMode.ORBIT){var r=this._rotX+e[0]*t,n=this._rotY+e[1]*t;this.setOrbit(r,n)}else i.gf.mul(this._quatRot,i.gf.setAxisAngle(ds,e,e[3]*t),this._quatRot);this.updateView(),this._main.render()}},{key:"rotateDelay",value:function(e,t){var r=this._rotDelta.bind(this,e);this.delay(r,t,"rotate")}},{key:"_quatDelta",value:function(e,t){i.gf.identity(ds),i.gf.slerp(ds,ds,e,t);var r=this._quatRot;if(i.gf.mul(this._quatRot,this._quatRot,ds),this._mode===s.Z.CameraMode.ORBIT){var n=r[0],a=r[1],o=r[2],l=r[3];this._rotY=Math.atan2(2*(l*a+o*n),1-2*(a*a+o*o)),this._rotX=Math.atan2(2*(l*n+a*o),1-2*(o*o+n*n))}this.updateView(),this._main.render()}},{key:"quatDelay",value:function(e,t){var r=[0,0,0,0];i.gf.conjugate(r,this._quatRot),i.gf.mul(r,r,e),i.gf.normalize(r,r);var n=this._quatDelta.bind(this,r);this.delay(n,t,"quat")}},{key:"_centerDelta",value:function(e,t){i.R3.scaleAndAdd(this._center,this._center,e,t),this.updateView(),this._main.render()}},{key:"centerDelay",value:function(e,t){var r=[0,0,0];i.R3.sub(r,e,this._center);var n=this._centerDelta.bind(this,r);this.delay(n,t,"center")}},{key:"_offsetDelta",value:function(e,t){i.R3.scaleAndAdd(this._offset,this._offset,e,t),this.updateView(),this._main.render()}},{key:"offsetDelay",value:function(e,t){var r=[0,0,0];i.R3.sub(r,e,this._offset);var n=this._offsetDelta.bind(this,r);this.delay(n,t,"offset")}},{key:"computeFrustumFit",value:function(){var e,t=this._near;if(this._projectionType===s.Z.Projection.ORTHOGRAPHIC)return e=Math.min(this._width,this._height)/t*.5,Math.sqrt(1+e*e)/e;var r=this._proj,i=t*(r[8]-1)/r[0],n=t*(1+r[8])/r[0],a=t*(1+r[9])/r[5],o=t*(r[9]-1)/r[5],l=Math.abs(n-i),u=Math.abs(a-o);return e=Math.min(u,l)/t*.5,this._fov/45*Math.sqrt(1+e*e)/e}}])&&ss(t.prototype,r),e}();function vs(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}const ys=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=r,this._gl=t,this._vertexBuffer=new c(t,t.ARRAY_BUFFER,t.STATIC_DRAW),this._texCoordBuffer=new c(t,t.ARRAY_BUFFER,t.STATIC_DRAW),this._fill=!0,this._monoTex=null,this._texture=null,this._texWidth=1,this._texHeight=1,this._type=0,this._blur=0,this.init()}var t,r;return t=e,(r=[{key:"init",value:function(){this.getTexCoordBuffer().update(new Float32Array([0,0,1,0,0,1,1,1])),this._monoTex=this.createOnePixelTexture(50,50,50,255),document.getElementById("backgroundopen").addEventListener("change",this.loadBackground.bind(this),!1)}},{key:"loadBackground",value:function(e){if(0!==e.target.files.length){var t=e.target.files[0];if(t.type.match("image.*")){var r=this,i=new FileReader;i.onload=function(e){var t=new Image;t.src=e.target.result,t.onload=function(){var e=r._main.getCanvas();r.loadBackgroundTexture(t),r.onResize(e.width,e.height),r._main.render()}},document.getElementById("backgroundopen").value="",i.readAsDataURL(t)}}}},{key:"getGL",value:function(){return this._gl}},{key:"getBlur",value:function(){return this._blur}},{key:"getVertexBuffer",value:function(){return this._vertexBuffer}},{key:"getTexCoordBuffer",value:function(){return this._texCoordBuffer}},{key:"release",value:function(){this.deleteTexture(),this.getVertexBuffer().release(),this.getTexCoordBuffer().release()}},{key:"getType",value:function(){return this._type}},{key:"setType",value:function(e){this._type=e}},{key:"onResize",value:function(e,t){var r=e/t/(this._texWidth/this._texHeight),i=this._fill||0!==this._type?1/r:r,n=i<1?1:1/r,a=i<1?r:1;this.getVertexBuffer().update(new Float32Array([-n,-a,n,-a,-n,a,n,a]))}},{key:"getTexture",value:function(){return this._texture?this._texture:this._monoTex}},{key:"createOnePixelTexture",value:function(e,t,r,i){var n=this._gl,a=n.createTexture();return n.bindTexture(n.TEXTURE_2D,a),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,new Uint8Array([e,t,r,i])),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.bindTexture(n.TEXTURE_2D,null),a}},{key:"loadBackgroundTexture",value:function(e){var t=this._gl;this.deleteTexture(),this._texWidth=e.width,this._texHeight=e.height,this._texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this._texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindTexture(t.TEXTURE_2D,null)}},{key:"deleteTexture",value:function(){this._texture&&(this._texWidth=this._texHeight=1,this._gl.deleteTexture(this._texture),this._texture=null)}},{key:"render",value:function(){J[s.Z.Shader.BACKGROUND].getOrCreate(this._gl).draw(this)}}])&&vs(t.prototype,r),e}();function bs(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}const Ts=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._main=t,this._canvas=document.getElementById("viewgizmo"),this._ctx=this._canvas?this._canvas.getContext("2d"):null,this._size=90}var t,r;return t=e,(r=[{key:"onResize",value:function(){if(this._canvas){var e=window.devicePixelRatio||1,t=this._size;this._canvas.style.width=t+"px",this._canvas.style.height=t+"px",this._canvas.width=Math.floor(t*e),this._canvas.height=Math.floor(t*e),this._ctx&&this._ctx.setTransform(e,0,0,e,0,0)}}},{key:"render",value:function(){var e=this._ctx,t=this._canvas;if(e&&t){var r=this._main.getCamera().getView(),i=this._size,n=.5*i,a=.5*i,s=.32*i;e.clearRect(0,0,i,i),e.globalAlpha=.9,e.lineWidth=2;for(var o=ns()?[{v:[1,0,0],c:"rgb(230,70,70)",label:"X"},{v:[0,0,1],c:"rgb(70,230,70)",label:"Y"},{v:[0,1,0],c:"rgb(70,70,230)",label:"Z"}]:[{v:[1,0,0],c:"rgb(230,70,70)",label:"X"},{v:[0,1,0],c:"rgb(70,230,70)",label:"Y"},{v:[0,0,1],c:"rgb(70,70,230)",label:"Z"}],l=0;l<o.length;++l){var u=o[l],c=u.v[0],h=u.v[1],d=u.v[2],f=r[0]*c+r[4]*h+r[8]*d,p=r[1]*c+r[5]*h+r[9]*d;e.strokeStyle=u.c,e.beginPath(),e.moveTo(n,a),e.lineTo(n+f*s,a-p*s),e.stroke(),e.fillStyle=u.c,e.font="bold 12px Arial",e.fillText(u.label,n+f*(s+6),a-p*(s+6))}e.fillStyle="rgba(255,255,255,0.6)",e.beginPath(),e.arc(n,a,2.2,0,2*Math.PI),e.fill()}}}])&&bs(t.prototype,r),e}();function ks(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Ms(e){return(Ms="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function xs(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Ss(e,t){return(Ss=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function As(e,t){return!t||"object"!==Ms(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Es(e){return(Es=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}const Rs=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ss(e,t)}(h,e);var t,r,l,u,c=(l=h,u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Es(l);if(u){var r=Es(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return As(this,e)});function h(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h),(e=c.call(this))._mouseX=0,e._mouseY=0,e._lastMouseX=0,e._lastMouseY=0,e._lastScale=0,e._action=s.Z.Action.NOTHING,e._lastNbPointers=0,e._isWheelingIn=!1,e._maskX=0,e._maskY=0,e._hammer=new n.Manager(e._canvas),e._eventProxy={},e.initHammer(),e.addEvents(),e}return t=h,(r=[{key:"addEvents",value:function(){var e=this._canvas,t=this.onMouseWheel.bind(this),r=this.onPointer.bind(this);e.addEventListener("pointerdown",r,!1),e.addEventListener("pointermove",r,!1),e.addEventListener("mousedown",this.onMouseDown.bind(this),!1),e.addEventListener("mouseup",this.onMouseUp.bind(this),!1),e.addEventListener("mouseout",this.onMouseOut.bind(this),!1),e.addEventListener("mouseover",this.onMouseOver.bind(this),!1),e.addEventListener("mousemove",o.Z.throttle(this.onMouseMove.bind(this),16.66),!1),e.addEventListener("mousewheel",t,!1),e.addEventListener("DOMMouseScroll",t,!1),window.addEventListener("keydown",this.onKeyDown.bind(this),!1),window.addEventListener("keyup",this.onKeyUp.bind(this),!1);var i=this.loadFiles.bind(this),n=this.stopAndPrevent.bind(this);e.addEventListener("webglcontextlost",this.onContextLost.bind(this),!1),e.addEventListener("webglcontextrestored",this.onContextRestored.bind(this),!1),window.addEventListener("dragenter",n,!1),window.addEventListener("dragover",n,!1),window.addEventListener("drop",i,!1),document.getElementById("fileopen").addEventListener("change",i,!1)}},{key:"onPointer",value:function(e){a.Z.pressure=e.pressure}},{key:"initHammer",value:function(){this._hammer.options.enable=!0,this._initHammerRecognizers(),this._initHammerEvents()}},{key:"_initHammerRecognizers",value:function(){var e=this._hammer;e.add(new n.Tap({event:"doubletap",pointers:1,taps:2,time:250,interval:450,threshold:5,posThreshold:50})),e.add(new n.Tap({event:"doubletap2fingers",pointers:2,taps:2,time:250,interval:450,threshold:5,posThreshold:50})),e.add(new n.Pan({event:"pan",pointers:0,threshold:0})),e.add(new n.Pinch({event:"pinch",pointers:2,threshold:.1})),e.get("pinch").recognizeWith(e.get("pan"))}},{key:"_initHammerEvents",value:function(){var e=this._hammer;e.on("panstart",this.onPanStart.bind(this)),e.on("panmove",this.onPanMove.bind(this)),e.on("panend pancancel",this.onPanEnd.bind(this)),e.on("doubletap",this.onDoubleTap.bind(this)),e.on("doubletap2fingers",this.onDoubleTap2Fingers.bind(this)),e.on("pinchstart",this.onPinchStart.bind(this)),e.on("pinchin pinchout",this.onPinchInOut.bind(this))}},{key:"stopAndPrevent",value:function(e){e.stopPropagation(),e.preventDefault()}},{key:"onContextLost",value:function(){window.alert("Oops... WebGL context lost.")}},{key:"onContextRestored",value:function(){window.alert("Wow... Context is restored.")}},{key:"onKeyDown",value:function(e){this._gui.callFunc("onKeyDown",e)}},{key:"onKeyUp",value:function(e){this._gui.callFunc("onKeyUp",e)}},{key:"onPanStart",value:function(e){if("mouse"!==e.pointerType){this._focusGui=!1;var t=this._eventProxy;t.pageX=e.center.x,t.pageY=e.center.y,this.onPanUpdateNbPointers(Math.min(3,e.pointers.length))}}},{key:"onPanMove",value:function(e){if("mouse"!==e.pointerType){var t=this._eventProxy;t.pageX=e.center.x,t.pageY=e.center.y;var r=Math.min(3,e.pointers.length);r!==this._lastNbPointers&&(this.onDeviceUp(),this.onPanUpdateNbPointers(r)),this.onDeviceMove(t),this._isIOS()&&(window.clearTimeout(this._timerResetPointer),this._timerResetPointer=window.setTimeout(function(){this._lastNbPointers=0}.bind(this),60))}}},{key:"_isIOS",value:function(){return void 0!==this._isIOS||(this._isIOS=/iPad|iPhone|iPod/.test(navigator.userAgent)),this._isIOS}},{key:"onPanUpdateNbPointers",value:function(e){var t=this._eventProxy;t.which=1===e&&this._lastNbPointers>=1?3:e,this._lastNbPointers=e,this.onDeviceDown(t)}},{key:"onPanEnd",value:function(e){"mouse"!==e.pointerType&&(this.onDeviceUp(),window.setTimeout(function(){e.pointers.length||(this._lastNbPointers=0)}.bind(this),60))}},{key:"onDoubleTap",value:function(e){if(!this._focusGui){var t=this._eventProxy;t.pageX=e.center.x,t.pageY=e.center.y,this.setMousePosition(t);var r=this._picking,n=r.intersectionMouseMeshes(),a=this._camera,s=[0,0,0];if(!n)return this.resetCameraMeshes();i.R3.transformMat4(s,r.getIntersectionPoint(),r.getMesh().getMatrix());var o=a._trans[2];a.isOrthographic()||(o=Math.min(o,i.R3.dist(s,a.computePosition()))),a.setAndFocusOnPivot(s,o),this.render()}}},{key:"onDoubleTap2Fingers",value:function(){this._focusGui||this.resetCameraMeshes()}},{key:"onPinchStart",value:function(e){this._focusGui=!1,this._lastScale=e.scale}},{key:"onPinchInOut",value:function(e){var t=25*(e.scale-this._lastScale);this._lastScale=e.scale,this.onDeviceWheel(t)}},{key:"resetCameraMeshes",value:function(e){if(e||(e=this._meshes),e.length>0){var t=[0,0,0],r=this.computeBoundingBoxMeshes(e),n=.8*this.computeRadiusFromBoundingBox(r);n*=this._camera.computeFrustumFit(),i.R3.set(t,.5*(r[0]+r[3]),.5*(r[1]+r[4]),.5*(r[2]+r[5])),this._camera.setAndFocusOnPivot(t,n)}else this._camera.resetView();this.render()}},{key:"getFileType",value:function(e){var t=e.toLowerCase();return t.endsWith(".obj")?"obj":t.endsWith(".sgl")?"sgl":t.endsWith(".stl")?"stl":t.endsWith(".ply")?"ply":void 0}},{key:"loadFiles",value:function(e){e.stopPropagation(),e.preventDefault();for(var t=e.dataTransfer?e.dataTransfer.files:e.target.files,r=0,i=t.length;r<i;++r){var n=t[r],a=this.getFileType(n.name);this.readFile(n,a)}}},{key:"readFile",value:function(e,t){var r=t||this.getFileType(e.name);if(r){var i=new FileReader,n=this;i.onload=function(e){n.loadScene(e.target.result,r),document.getElementById("fileopen").value=""},"obj"===r?i.readAsText(e):i.readAsArrayBuffer(e)}}},{key:"onMouseDown",value:function(e){e.stopPropagation(),e.preventDefault(),this._gui.callFunc("onMouseDown",e),this.onDeviceDown(e)}},{key:"onMouseMove",value:function(e){e.stopPropagation(),e.preventDefault(),this._gui.callFunc("onMouseMove",e),this.onDeviceMove(e)}},{key:"onMouseOver",value:function(e){this._focusGui=!1,this._gui.callFunc("onMouseOver",e)}},{key:"onMouseOut",value:function(e){this._focusGui=!0,this._gui.callFunc("onMouseOut",e),this.onMouseUp(e)}},{key:"onMouseUp",value:function(e){e.preventDefault(),this._gui.callFunc("onMouseUp",e),this.onDeviceUp()}},{key:"onMouseWheel",value:function(e){e.stopPropagation(),e.preventDefault(),this._gui.callFunc("onMouseWheel",e);var t=void 0===e.wheelDelta?-e.detail:e.wheelDelta;this.onDeviceWheel(t>0?1:-1)}},{key:"onDeviceUp",value:function(){this.setCanvasCursor("default"),In.RENDER_HINT=In.NONE,this._sculptManager.end(),this._action===s.Z.Action.MASK_EDIT&&this._mesh&&(this._lastMouseX===this._maskX&&this._lastMouseY===this._maskY?this.getSculptManager().getTool(s.Z.Tools.MASKING).invert():this.getSculptManager().getTool(s.Z.Tools.MASKING).clear()),this._action=s.Z.Action.NOTHING,this.render(),this._stateManager.cleanNoop()}},{key:"onDeviceWheel",value:function(e){e>0&&!this._isWheelingIn&&(this._isWheelingIn=!0,this._camera.start(this._mouseX,this._mouseY)),this._camera.zoom(.02*e),In.RENDER_HINT=In.CAMERA,this.render(),this._timerEndWheel&&window.clearTimeout(this._timerEndWheel),this._timerEndWheel=window.setTimeout(this._endWheel.bind(this),300)}},{key:"_endWheel",value:function(){In.RENDER_HINT=In.NONE,this._isWheelingIn=!1,this.render()}},{key:"setMousePosition",value:function(e){this._mouseX=this._pixelRatio*(e.pageX-this._canvasOffsetLeft),this._mouseY=this._pixelRatio*(e.pageY-this._canvasOffsetTop)}},{key:"onDeviceDown",value:function(e){if(!this._focusGui){this.setMousePosition(e);var t=this._mouseX,r=this._mouseY,i=e.which,n=!1;1===i&&(n=this._sculptManager.start(e.shiftKey||this._multiSelection)),1===i&&n&&this.setCanvasCursor("none"),3===i&&e.ctrlKey?this._action=s.Z.Action.CAMERA_ZOOM:2===i?this._action=s.Z.Action.CAMERA_PAN:!n&&e.ctrlKey?(this._maskX=t,this._maskY=r,this._action=s.Z.Action.MASK_EDIT):n&&3!==i||!e.altKey?this._action=3===i||1===i&&!n?s.Z.Action.CAMERA_ROTATE:s.Z.Action.SCULPT_EDIT:this._action=s.Z.Action.CAMERA_PAN_ZOOM_ALT,this._action!==s.Z.Action.CAMERA_ROTATE&&this._action!==s.Z.Action.CAMERA_ZOOM||this._camera.start(t,r),this._lastMouseX=t,this._lastMouseY=r}}},{key:"getSpeedFactor",value:function(){return this._cameraSpeed/(this._canvasHeight*this.getPixelRatio())}},{key:"onDeviceMove",value:function(e){if(!this._focusGui){this.setMousePosition(e);var t=this._mouseX,r=this._mouseY,i=this._action,n=this.getSpeedFactor();i===s.Z.Action.CAMERA_ZOOM||i===s.Z.Action.CAMERA_PAN_ZOOM_ALT&&!e.altKey?(In.RENDER_HINT=In.CAMERA,this._camera.zoom((t-this._lastMouseX+r-this._lastMouseY)*n),this.render()):i===s.Z.Action.CAMERA_PAN_ZOOM_ALT||i===s.Z.Action.CAMERA_PAN?(In.RENDER_HINT=In.CAMERA,this._camera.translate((t-this._lastMouseX)*n,(r-this._lastMouseY)*n),this.render()):i===s.Z.Action.CAMERA_ROTATE?(In.RENDER_HINT=In.CAMERA,e.shiftKey||this._camera.rotate(t,r),this.render()):(In.RENDER_HINT=In.PICKING,this._sculptManager.preUpdate(),i===s.Z.Action.SCULPT_EDIT&&(In.RENDER_HINT=In.SCULPT,this._sculptManager.update(this),this.getMesh().isDynamic&&this._gui.updateMeshInfo())),this._lastMouseX=t,this._lastMouseY=r,this.renderSelectOverRtt()}}}])&&xs(t.prototype,r),h}(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._gl=null,this._cameraSpeed=.25,this._pixelRatio=1,this._viewport=document.getElementById("viewport"),this._canvas=document.getElementById("canvas"),this._canvasWidth=0,this._canvasHeight=0,this._canvasOffsetLeft=0,this._canvasOffsetTop=0,this._stateManager=new Ya(this),this._sculptManager=null,this._camera=new gs(this),this._picking=new Ta.Z(this),this._pickingSym=new Ta.Z(this,!0),this._meshPreview=null,this._torusLength=.5,this._torusWidth=.1,this._torusRadius=2*Math.PI,this._torusRadial=32,this._torusTubular=128;var t=(0,l.Z)();this._showContour=t.outline,this._showGrid=t.grid,this._grid=null,this._background=null,this._viewGizmo2D=null,this._meshes=[],this._selectMeshes=[],this._mesh=null,this._multiSelection=!1,this._rttContour=null,this._rttMerge=null,this._rttOpaque=null,this._rttTransparent=null,this._focusGui=!1,this._gui=new es(this),this._preventRender=!1,this._drawFullScene=!1,this._autoMatrix=t.scalecenter,this._vertexSRGB=!0}var t,r;return t=e,(r=[{key:"start",value:function(){if(this.initWebGL(),this._gl){this._sculptManager=new ii(this),this._background=new ys(this._gl,this),this._rttContour=new dn(this._gl,s.Z.Shader.CONTOUR,null),this._rttMerge=new dn(this._gl,s.Z.Shader.MERGE,null),this._rttOpaque=new dn(this._gl,s.Z.Shader.FXAA),this._rttTransparent=new dn(this._gl,null,this._rttOpaque.getDepth(),!0),this._grid=Tr.createGrid(this._gl),this.initGrid(),this.loadTextures(),this._gui.initGui(),this.onCanvasResize(),this._viewGizmo2D=new Ts(this),this._viewGizmo2D.onResize();var e=(0,l.Z)().modelurl;e?this.addModelURL(e):this.addSphere()}}},{key:"addModelURL",value:function(e){var t=this.getFileType(e);if(t){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="obj"===t?"text":"arraybuffer",r.onload=function(){200===r.status&&this.loadScene(r.response,t)}.bind(this),r.send(null)}}},{key:"getBackground",value:function(){return this._background}},{key:"getViewport",value:function(){return this._viewport}},{key:"getCanvas",value:function(){return this._canvas}},{key:"getPixelRatio",value:function(){return this._pixelRatio}},{key:"getCanvasWidth",value:function(){return this._canvasWidth}},{key:"getCanvasHeight",value:function(){return this._canvasHeight}},{key:"getCamera",value:function(){return this._camera}},{key:"getGui",value:function(){return this._gui}},{key:"getMeshes",value:function(){return this._meshes}},{key:"getMesh",value:function(){return this._mesh}},{key:"getSelectedMeshes",value:function(){return this._selectMeshes}},{key:"getPicking",value:function(){return this._picking}},{key:"getPickingSymmetry",value:function(){return this._pickingSym}},{key:"getSculptManager",value:function(){return this._sculptManager}},{key:"getStateManager",value:function(){return this._stateManager}},{key:"setMesh",value:function(e){return this.setOrUnsetMesh(e)}},{key:"isMultiSelectionEnabled",value:function(){return this._multiSelection}},{key:"setMultiSelectionEnabled",value:function(e){this._multiSelection=!!e}},{key:"setCanvasCursor",value:function(e){this._canvas.style.cursor=e}},{key:"initGrid",value:function(){var e=this._grid;e.normalizeSize();var t=e.getMatrix();ns()?i._E.translate(t,t,[0,0,-.45]):i._E.translate(t,t,[0,-.45,0]),i._E.scale(t,t,[2.5,2.5,2.5]),this._grid.setShaderType(s.Z.Shader.FLAT),e.setFlatColor([.04,.04,.04])}},{key:"setOrUnsetMesh",value:function(e,t){if(e)if(t){var r=this.getIndexSelectMesh(e);r>=0?this._selectMeshes.length>1&&(this._selectMeshes.splice(r,1),e=this._selectMeshes[0]):this._selectMeshes.push(e)}else this._selectMeshes.length=0,this._selectMeshes.push(e);else this._selectMeshes.length=0;return this._mesh=e,this.getGui().updateMesh(),this.render(),e}},{key:"setSelectionMeshes",value:function(e,t){this._selectMeshes.length=0;for(var r=0,i=e.length;r<i;++r)this._selectMeshes.push(e[r]);var n=null;t&&this.getIndexMesh(t,!0)>=0?n=t:this._selectMeshes.length>0&&(n=this._selectMeshes[0]),this._mesh=n,this.getGui().updateMesh(),this.render()}},{key:"selectAllMeshes",value:function(){0!==this._meshes.length&&this.setSelectionMeshes(this._meshes,this._mesh)}},{key:"invertSelectionMeshes",value:function(){var e=this._meshes;if(0!==e.length){for(var t={},r=0,i=this._selectMeshes.length;r<i;++r)t[this._selectMeshes[r].getID()]=!0;for(var n=[],a=0,s=e.length;a<s;++a){var o=e[a];t[o.getID()]||n.push(o)}this.setSelectionMeshes(n,this._mesh)}}},{key:"selectNextMesh",value:function(){var e=this._meshes;if(0!==e.length){var t=this._mesh?this.getIndexMesh(this._mesh):-1;t=t<0?0:(t+1)%e.length,this.setMesh(e[t])}}},{key:"selectPreviousMesh",value:function(){var e=this._meshes;if(0!==e.length){var t=this._mesh?this.getIndexMesh(this._mesh):-1;t=t<0?e.length-1:(t-1+e.length)%e.length,this.setMesh(e[t])}}},{key:"renderSelectOverRtt",value:function(){this._requestRender()&&(this._drawFullScene=!1)}},{key:"_requestRender",value:function(){return!0!==this._preventRender&&(window.requestAnimationFrame(this.applyRender.bind(this)),this._preventRender=!0,!0)}},{key:"render",value:function(){this._drawFullScene=!0,this._requestRender()}},{key:"applyRender",value:function(){this._preventRender=!1,this.updateMatricesAndSort();var e=this._gl;e&&(this._drawFullScene&&this._drawScene(),e.disable(e.DEPTH_TEST),e.bindFramebuffer(e.FRAMEBUFFER,this._rttMerge.getFramebuffer()),this._rttMerge.render(this),e.bindFramebuffer(e.FRAMEBUFFER,null),this._rttOpaque.render(this),e.enable(e.DEPTH_TEST),this._sculptManager.postRender(),this._viewGizmo2D&&this._viewGizmo2D.render())}},{key:"_drawScene",value:function(){var e=this._gl,t=0,r=this._meshes,i=r.length;e.disable(e.DEPTH_TEST);var n=this._selectMeshes.length>0&&this._showContour&&J[s.Z.Shader.CONTOUR].color[3]>0;if(n){e.bindFramebuffer(e.FRAMEBUFFER,this._rttContour.getFramebuffer()),e.clear(e.COLOR_BUFFER_BIT);for(var a=0,o=this._selectMeshes,l=o.length;a<l;++a)o[a].renderFlatColor(this)}for(e.enable(e.DEPTH_TEST),e.bindFramebuffer(e.FRAMEBUFFER,this._rttOpaque.getFramebuffer()),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),this._showGrid&&this._grid.render(this),t=0;t<i&&!r[t].isTransparent();++t)r[t].render(this);var u=t;for(this._meshPreview&&this._meshPreview.render(this),this._background.render(),e.bindFramebuffer(e.FRAMEBUFFER,this._rttTransparent.getFramebuffer()),e.clear(e.COLOR_BUFFER_BIT),e.enable(e.BLEND),e.depthFunc(e.LESS),t=0;t<i;++t)r[t].getShowWireframe()&&r[t].renderWireframe(this);for(e.depthFunc(e.LEQUAL),e.depthMask(!1),e.enable(e.CULL_FACE),t=u;t<i;++t)e.cullFace(e.FRONT),r[t].render(this),e.cullFace(e.BACK),r[t].render(this);e.disable(e.CULL_FACE),n&&this._rttContour.render(this),e.depthMask(!0),e.disable(e.BLEND)}},{key:"updateMatricesAndSort",value:function(){var e=this._meshes,t=this._camera;e.length>0&&t.optimizeNearFar(this.computeBoundingBoxScene());for(var r=0,i=e.length;r<i;++r)e[r].updateMatrices(t);e.sort(kt.sortFunction),this._meshPreview&&this._meshPreview.updateMatrices(t),this._grid&&this._grid.updateMatrices(t)}},{key:"initWebGL",value:function(){var e={antialias:!1,stencil:!0},t=document.getElementById("canvas"),r=this._gl=t.getContext("webgl",e)||t.getContext("experimental-webgl",e);r?(ln.initWebGLExtensions(r),ln.getWebGLExtension("OES_element_index_uint")||(yt.ONLY_DRAW_ARRAYS=!0),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!0),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,r.NONE),r.disable(r.CULL_FACE),r.frontFace(r.CCW),r.cullFace(r.BACK),r.disable(r.BLEND),r.blendFunc(r.ONE,r.ONE_MINUS_SRC_ALPHA),r.disable(r.DEPTH_TEST),r.depthFunc(r.LEQUAL),r.depthMask(!0),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT)):window.alert("Could not initialise WebGL. No WebGL, no SculptGL. Sorry.")}},{key:"loadTextures",value:function(){for(var e=this,t=this._gl,r=J[s.Z.Shader.MATCAP],i=function(i,n){var a=new Image;a.src=i,a.onload=function(){r.createTexture(t,a,n),e.render()}},n=0,a=r.matcaps,o=a.length;n<o;++n)i(a[n].path,n);this.initAlphaTextures()}},{key:"initAlphaTextures",value:function(){for(var e=Ta.Z.INIT_ALPHAS_PATHS,t=Ta.Z.INIT_ALPHAS_NAMES,r=0,i=e.length;r<i;++r){var n=new Image;n.src="resources/alpha/"+e[r],n.onload=this.onLoadAlphaImage.bind(this,n,t[r])}}},{key:"onCanvasResize",value:function(){var e=this._viewport,t=e.clientWidth*this._pixelRatio,r=e.clientHeight*this._pixelRatio;this._canvasOffsetLeft=e.offsetLeft,this._canvasOffsetTop=e.offsetTop,this._canvasWidth=t,this._canvasHeight=r,this._canvas.width=t,this._canvas.height=r,this._gl.viewport(0,0,t,r),this._camera.onResize(t,r),this._background.onResize(t,r),this._rttContour.onResize(t,r),this._rttMerge.onResize(t,r),this._rttOpaque.onResize(t,r),this._rttTransparent.onResize(t,r),this._viewGizmo2D&&this._viewGizmo2D.onResize(),this.render()}},{key:"computeRadiusFromBoundingBox",value:function(e){var t=e[3]-e[0],r=e[4]-e[1],i=e[5]-e[2];return.5*Math.sqrt(t*t+r*r+i*i)}},{key:"computeBoundingBoxMeshes",value:function(e){for(var t=[1/0,1/0,1/0,-1/0,-1/0,-1/0],r=0,i=e.length;r<i;++r)if(e[r].isVisible()){var n=e[r].computeWorldBound();n[0]<t[0]&&(t[0]=n[0]),n[1]<t[1]&&(t[1]=n[1]),n[2]<t[2]&&(t[2]=n[2]),n[3]>t[3]&&(t[3]=n[3]),n[4]>t[4]&&(t[4]=n[4]),n[5]>t[5]&&(t[5]=n[5])}return t}},{key:"computeBoundingBoxScene",value:function(){var e=this._meshes.slice();return e.push(this._grid),this._sculptManager.addSculptToScene(e),this.computeBoundingBoxMeshes(e)}},{key:"normalizeAndCenterMeshes",value:function(e){var t=this.computeBoundingBoxMeshes(e),r=o.Z.SCALE/i.R3.dist([t[0],t[1],t[2]],[t[3],t[4],t[5]]),n=i._E.create();i._E.scale(n,n,[r,r,r]),i._E.translate(n,n,[.5*-(t[0]+t[3]),.5*-(t[1]+t[4]),.5*-(t[2]+t[5])]);for(var a=0,s=e.length;a<s;++a){var l=e[a].getMatrix();i._E.mul(l,n,l)}}},{key:"addSphere",value:function(){var e=new In(Tr.createCube(this._gl));return e.normalizeSize(),this.subdivideClamp(e),this.addNewMesh(e)}},{key:"addCube",value:function(){var e=new In(Tr.createCube(this._gl));return e.normalizeSize(),i._E.scale(e.getMatrix(),e.getMatrix(),[.7,.7,.7]),this.subdivideClamp(e,!0),this.addNewMesh(e)}},{key:"addCylinder",value:function(){var e=new In(Tr.createCylinder(this._gl));return e.normalizeSize(),i._E.scale(e.getMatrix(),e.getMatrix(),[.7,.7,.7]),this.subdivideClamp(e),this.addNewMesh(e)}},{key:"addPlane",value:function(){var e=new In(Tr.createPlane(this._gl));return e.normalizeSize(),i._E.scale(e.getMatrix(),e.getMatrix(),[.7,.7,.7]),this.subdivideClamp(e,!0),this.addNewMesh(e)}},{key:"addTorus",value:function(e){var t=new In(Tr.createTorus(this._gl,this._torusLength,this._torusWidth,this._torusRadius,this._torusRadial,this._torusTubular));if(e){t.setShowWireframe(!0);var r=.3*o.Z.SCALE;return i._E.scale(t.getMatrix(),t.getMatrix(),[r,r,r]),void(this._meshPreview=t)}t.normalizeSize(),this.subdivideClamp(t),this.addNewMesh(t)}},{key:"subdivideClamp",value:function(e,t){for(ui.LINEAR=!!t;e.getNbFaces()<5e4;)e.addLevel();e._meshes.splice(0,Math.min(e._meshes.length-4,4)),e._sel=e._meshes.length-1,ui.LINEAR=!1}},{key:"addNewMesh",value:function(e){return this._meshes.push(e),this._stateManager.pushStateAdd(e),this.setMesh(e),e}},{key:"loadScene",value:function(e,t){var r;"obj"===t?r=wi.importOBJ(e,this._gl):"sgl"===t?r=wi.importSGL(e,this._gl,this):"stl"===t?r=wi.importSTL(e,this._gl):"ply"===t&&(r=wi.importPLY(e,this._gl));var i=r.length;if(0!==i){for(var n=this._meshes,a=0;a<i;++a){var s=r[a]=new In(r[a]);!this._vertexSRGB&&s.getColors()&&o.Z.convertArrayVec3toSRGB(s.getColors()),s.init(),s.initRender(),n.push(s)}return this._autoMatrix&&this.normalizeAndCenterMeshes(r),this._stateManager.pushStateAdd(r),this.setMesh(n[n.length-1]),this.resetCameraMeshes(r),r}}},{key:"clearScene",value:function(){this.getStateManager().reset(),this.getMeshes().length=0,this.getCamera().resetView(),this.setMesh(null),this._action=s.Z.Action.NOTHING}},{key:"deleteCurrentSelection",value:function(){this._mesh&&(this.removeMeshes(this._selectMeshes),this._stateManager.pushStateRemove(this._selectMeshes.slice()),this._selectMeshes.length=0,this.setMesh(null))}},{key:"removeMeshes",value:function(e){for(var t=this._meshes,r=0;r<e.length;++r)t.splice(this.getIndexMesh(e[r]),1)}},{key:"getIndexMesh",value:function(e,t){for(var r=t?this._selectMeshes:this._meshes,i=e.getID(),n=0,a=r.length;n<a;++n){var s=r[n];if(s===e||s.getID()===i)return n}return-1}},{key:"getIndexSelectMesh",value:function(e){return this.getIndexMesh(e,!0)}},{key:"replaceMesh",value:function(e,t){var r=this.getIndexMesh(e);r>=0&&(this._meshes[r]=t),this._mesh===e&&this.setMesh(t)}},{key:"duplicateSelection",value:function(){for(var e=this._selectMeshes.slice(),t=null,r=0;r<e.length;++r){t=e[r];var i=new Ct(t.getGL());i.copyData(t),this.addNewMesh(i)}this.setMesh(t)}},{key:"onLoadAlphaImage",value:function(e,t,r){var i=document.createElement("canvas");i.width=e.width,i.height=e.height;var n=i.getContext("2d");n.drawImage(e,0,0);for(var a=n.getImageData(0,0,e.width,e.height).data,s=a.subarray(0,a.length/4),o=0,l=0,u=s.length;o<u;++o,l+=4)s[o]=Math.round((a[l]+a[l+1]+a[l+2])/3);var c={};c[t=Ta.Z.addAlpha(s,e.width,e.height,t)._name]=t,this.getGui().addAlphaOptions(c),r&&r._ctrlAlpha&&r._ctrlAlpha.setValue(t)}}])&&ks(t.prototype,r),e}());window.SculptGL=Rs},652:function(e,t,r){var i,n;function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}void 0===(n="function"==typeof(i=function(){"use strict";function t(e,t,r){var i=new XMLHttpRequest;i.open("GET",e),i.responseType="blob",i.onload=function(){l(i.response,t,r)},i.onerror=function(){console.error("could not download file")},i.send()}function i(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function n(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(r){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var s="object"==("undefined"==typeof window?"undefined":a(window))&&window.window===window?window:"object"==("undefined"==typeof self?"undefined":a(self))&&self.self===self?self:"object"==(void 0===r.g?"undefined":a(r.g))&&r.g.global===r.g?r.g:void 0,o=s.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),l=s.saveAs||("object"!=("undefined"==typeof window?"undefined":a(window))||window!==s?function(){}:"download"in HTMLAnchorElement.prototype&&!o?function(e,r,a){var o=s.URL||s.webkitURL,l=document.createElement("a");r=r||e.name||"download",l.download=r,l.rel="noopener","string"==typeof e?(l.href=e,l.origin===location.origin?n(l):i(l.href)?t(e,r,a):n(l,l.target="_blank")):(l.href=o.createObjectURL(e),setTimeout((function(){o.revokeObjectURL(l.href)}),4e4),setTimeout((function(){n(l)}),0))}:"msSaveOrOpenBlob"in navigator?function(e,r,s){if(r=r||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(function(e,t){return void 0===t?t={autoBom:!1}:"object"!=a(t)&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}(e,s),r);else if(i(e))t(e,r,s);else{var o=document.createElement("a");o.href=e,o.target="_blank",setTimeout((function(){n(o)}))}}:function(e,r,i,n){if((n=n||open("","_blank"))&&(n.document.title=n.document.body.innerText="downloading..."),"string"==typeof e)return t(e,r,i);var a="application/octet-stream"===e.type,l=/constructor/i.test(s.HTMLElement)||s.safari,u=/CriOS\/[\d]+/.test(navigator.userAgent);if((u||a&&l||o)&&"undefined"!=typeof FileReader){var c=new FileReader;c.onloadend=function(){var e=c.result;e=u?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),n?n.location.href=e:location=e,n=null},c.readAsDataURL(e)}else{var h=s.URL||s.webkitURL,d=h.createObjectURL(e);n?n.location=d:location.href=d,n=null,setTimeout((function(){h.revokeObjectURL(d)}),4e4)}});s.saveAs=l.saveAs=l,e.exports=l})?i.apply(t,[]):i)||(e.exports=n)},297:(e,t,r)=>{var i;function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(a,s,o,l){"use strict";var u,c=["","webkit","Moz","MS","ms","o"],h=s.createElement("div"),d=Math.round,f=Math.abs,p=Date.now;function _(e,t,r){return setTimeout(k(e,r),t)}function m(e,t,r){return!!Array.isArray(e)&&(g(e,r[t],r),!0)}function g(e,t,r){var i;if(e)if(e.forEach)e.forEach(t,r);else if(e.length!==l)for(i=0;i<e.length;)t.call(r,e[i],i,e),i++;else for(i in e)e.hasOwnProperty(i)&&t.call(r,e[i],i,e)}function v(e,t,r){var i="DEPRECATED METHOD: "+t+"\n"+r+" AT \n";return function(){var t=new Error("get-stack-trace"),r=t&&t.stack?t.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",n=a.console&&(a.console.warn||a.console.log);return n&&n.call(a.console,i,r),e.apply(this,arguments)}}u="function"!=typeof Object.assign?function(e){if(e===l||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),r=1;r<arguments.length;r++){var i=arguments[r];if(i!==l&&null!==i)for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])}return t}:Object.assign;var y=v((function(e,t,r){for(var i=Object.keys(t),n=0;n<i.length;)(!r||r&&e[i[n]]===l)&&(e[i[n]]=t[i[n]]),n++;return e}),"extend","Use `assign`."),b=v((function(e,t){return y(e,t,!0)}),"merge","Use `assign`.");function T(e,t,r){var i,n=t.prototype;(i=e.prototype=Object.create(n)).constructor=e,i._super=n,r&&u(i,r)}function k(e,t){return function(){return e.apply(t,arguments)}}function M(e,t){return"function"==n(e)?e.apply(t&&t[0]||l,t):e}function x(e,t){return e===l?t:e}function S(e,t,r){g(w(t),(function(t){e.addEventListener(t,r,!1)}))}function A(e,t,r){g(w(t),(function(t){e.removeEventListener(t,r,!1)}))}function E(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function R(e,t){return e.indexOf(t)>-1}function w(e){return e.trim().split(/\s+/g)}function C(e,t,r){if(e.indexOf&&!r)return e.indexOf(t);for(var i=0;i<e.length;){if(r&&e[i][r]==t||!r&&e[i]===t)return i;i++}return-1}function P(e){return Array.prototype.slice.call(e,0)}function D(e,t,r){for(var i=[],n=[],a=0;a<e.length;){var s=t?e[a][t]:e[a];C(n,s)<0&&i.push(e[a]),n[a]=s,a++}return r&&(i=t?i.sort((function(e,r){return e[t]>r[t]})):i.sort()),i}function I(e,t){for(var r,i,n=t[0].toUpperCase()+t.slice(1),a=0;a<c.length;){if((i=(r=c[a])?r+n:t)in e)return i;a++}return l}var F=1;function O(e){var t=e.ownerDocument||e;return t.defaultView||t.parentWindow||a}var V="ontouchstart"in a,L=I(a,"PointerEvent")!==l,N=V&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),B="touch",U="mouse",Z=["x","y"],z=["clientX","clientY"];function G(e,t){var r=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){M(e.options.enable,[e])&&r.handler(t)},this.init()}function W(e,t,r){var i=r.pointers.length,n=r.changedPointers.length,a=1&t&&i-n==0,s=12&t&&i-n==0;r.isFirst=!!a,r.isFinal=!!s,a&&(e.session={}),r.eventType=t,function(e,t){var r=e.session,i=t.pointers,n=i.length;r.firstInput||(r.firstInput=j(t)),n>1&&!r.firstMultiple?r.firstMultiple=j(t):1===n&&(r.firstMultiple=!1);var a=r.firstInput,s=r.firstMultiple,o=s?s.center:a.center,u=t.center=X(i);t.timeStamp=p(),t.deltaTime=t.timeStamp-a.timeStamp,t.angle=q(o,u),t.distance=K(o,u),function(e,t){var r=t.center,i=e.offsetDelta||{},n=e.prevDelta||{},a=e.prevInput||{};1!==t.eventType&&4!==a.eventType||(n=e.prevDelta={x:a.deltaX||0,y:a.deltaY||0},i=e.offsetDelta={x:r.x,y:r.y}),t.deltaX=n.x+(r.x-i.x),t.deltaY=n.y+(r.y-i.y)}(r,t),t.offsetDirection=Y(t.deltaX,t.deltaY);var c,h,d=H(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=d.x,t.overallVelocityY=d.y,t.overallVelocity=f(d.x)>f(d.y)?d.x:d.y,t.scale=s?(c=s.pointers,K((h=i)[0],h[1],z)/K(c[0],c[1],z)):1,t.rotation=s?function(e,t){return q(t[1],t[0],z)+q(e[1],e[0],z)}(s.pointers,i):0,t.maxPointers=r.prevInput?t.pointers.length>r.prevInput.maxPointers?t.pointers.length:r.prevInput.maxPointers:t.pointers.length,function(e,t){var r,i,n,a,s=e.lastInterval||t,o=t.timeStamp-s.timeStamp;if(8!=t.eventType&&(o>25||s.velocity===l)){var u=t.deltaX-s.deltaX,c=t.deltaY-s.deltaY,h=H(o,u,c);i=h.x,n=h.y,r=f(h.x)>f(h.y)?h.x:h.y,a=Y(u,c),e.lastInterval=t}else r=s.velocity,i=s.velocityX,n=s.velocityY,a=s.direction;t.velocity=r,t.velocityX=i,t.velocityY=n,t.direction=a}(r,t);var _=e.element;E(t.srcEvent.target,_)&&(_=t.srcEvent.target),t.target=_}(e,r),e.emit("hammer.input",r),e.recognize(r),e.session.prevInput=r}function j(e){for(var t=[],r=0;r<e.pointers.length;)t[r]={clientX:d(e.pointers[r].clientX),clientY:d(e.pointers[r].clientY)},r++;return{timeStamp:p(),pointers:t,center:X(t),deltaX:e.deltaX,deltaY:e.deltaY}}function X(e){var t=e.length;if(1===t)return{x:d(e[0].clientX),y:d(e[0].clientY)};for(var r=0,i=0,n=0;n<t;)r+=e[n].clientX,i+=e[n].clientY,n++;return{x:d(r/t),y:d(i/t)}}function H(e,t,r){return{x:t/e||0,y:r/e||0}}function Y(e,t){return e===t?1:f(e)>=f(t)?e<0?2:4:t<0?8:16}function K(e,t,r){r||(r=Z);var i=t[r[0]]-e[r[0]],n=t[r[1]]-e[r[1]];return Math.sqrt(i*i+n*n)}function q(e,t,r){r||(r=Z);var i=t[r[0]]-e[r[0]],n=t[r[1]]-e[r[1]];return 180*Math.atan2(n,i)/Math.PI}G.prototype={handler:function(){},init:function(){this.evEl&&S(this.element,this.evEl,this.domHandler),this.evTarget&&S(this.target,this.evTarget,this.domHandler),this.evWin&&S(O(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&A(this.element,this.evEl,this.domHandler),this.evTarget&&A(this.target,this.evTarget,this.domHandler),this.evWin&&A(O(this.element),this.evWin,this.domHandler)}};var J={mousedown:1,mousemove:2,mouseup:4},Q="mousedown",$="mousemove mouseup";function ee(){this.evEl=Q,this.evWin=$,this.pressed=!1,G.apply(this,arguments)}T(ee,G,{handler:function(e){var t=J[e.type];1&t&&0===e.button&&(this.pressed=!0),2&t&&1!==e.which&&(t=4),this.pressed&&(4&t&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:U,srcEvent:e}))}});var te={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},re={2:B,3:"pen",4:U,5:"kinect"},ie="pointerdown",ne="pointermove pointerup pointercancel";function ae(){this.evEl=ie,this.evWin=ne,G.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}a.MSPointerEvent&&!a.PointerEvent&&(ie="MSPointerDown",ne="MSPointerMove MSPointerUp MSPointerCancel"),T(ae,G,{handler:function(e){var t=this.store,r=!1,i=e.type.toLowerCase().replace("ms",""),n=te[i],a=re[e.pointerType]||e.pointerType,s=a==B,o=C(t,e.pointerId,"pointerId");1&n&&(0===e.button||s)?o<0&&(t.push(e),o=t.length-1):12&n&&(r=!0),o<0||(t[o]=e,this.callback(this.manager,n,{pointers:t,changedPointers:[e],pointerType:a,srcEvent:e}),r&&t.splice(o,1))}});var se={touchstart:1,touchmove:2,touchend:4,touchcancel:8},oe="touchstart",le="touchstart touchmove touchend touchcancel";function ue(){this.evTarget=oe,this.evWin=le,this.started=!1,G.apply(this,arguments)}function ce(e,t){var r=P(e.touches),i=P(e.changedTouches);return 12&t&&(r=D(r.concat(i),"identifier",!0)),[r,i]}T(ue,G,{handler:function(e){var t=se[e.type];if(1===t&&(this.started=!0),this.started){var r=ce.call(this,e,t);12&t&&r[0].length-r[1].length==0&&(this.started=!1),this.callback(this.manager,t,{pointers:r[0],changedPointers:r[1],pointerType:B,srcEvent:e})}}});var he={touchstart:1,touchmove:2,touchend:4,touchcancel:8},de="touchstart touchmove touchend touchcancel";function fe(){this.evTarget=de,this.targetIds={},G.apply(this,arguments)}function pe(e,t){var r=P(e.touches),i=this.targetIds;if(3&t&&1===r.length)return i[r[0].identifier]=!0,[r,r];var n,a,s=P(e.changedTouches),o=[],l=this.target;if(a=r.filter((function(e){return E(e.target,l)})),1===t)for(n=0;n<a.length;)i[a[n].identifier]=!0,n++;for(n=0;n<s.length;)i[s[n].identifier]&&o.push(s[n]),12&t&&delete i[s[n].identifier],n++;return o.length?[D(a.concat(o),"identifier",!0),o]:void 0}function _e(){G.apply(this,arguments);var e=k(this.handler,this);this.touch=new fe(this.manager,e),this.mouse=new ee(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function me(e,t){1&e?(this.primaryTouch=t.changedPointers[0].identifier,ge.call(this,t)):12&e&&ge.call(this,t)}function ge(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var r={x:t.clientX,y:t.clientY};this.lastTouches.push(r);var i=this.lastTouches;setTimeout((function(){var e=i.indexOf(r);e>-1&&i.splice(e,1)}),2500)}}function ve(e){for(var t=e.srcEvent.clientX,r=e.srcEvent.clientY,i=0;i<this.lastTouches.length;i++){var n=this.lastTouches[i],a=Math.abs(t-n.x),s=Math.abs(r-n.y);if(a<=25&&s<=25)return!0}return!1}T(fe,G,{handler:function(e){var t=he[e.type],r=pe.call(this,e,t);r&&this.callback(this.manager,t,{pointers:r[0],changedPointers:r[1],pointerType:B,srcEvent:e})}}),T(_e,G,{handler:function(e,t,r){var i=r.pointerType==B,n=r.pointerType==U;if(!(n&&r.sourceCapabilities&&r.sourceCapabilities.firesTouchEvents)){if(i)me.call(this,t,r);else if(n&&ve.call(this,r))return;this.callback(e,t,r)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var ye=I(h.style,"touchAction"),be=ye!==l,Te="compute",ke="auto",Me="manipulation",xe="none",Se="pan-x",Ae="pan-y",Ee=function(){if(!be)return!1;var e={},t=a.CSS&&a.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(r){e[r]=!t||a.CSS.supports("touch-action",r)})),e}();function Re(e,t){this.manager=e,this.set(t)}Re.prototype={set:function(e){e==Te&&(e=this.compute()),be&&this.manager.element.style&&Ee[e]&&(this.manager.element.style[ye]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return g(this.manager.recognizers,(function(t){M(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))})),function(e){if(R(e,xe))return xe;var t=R(e,Se),r=R(e,Ae);return t&&r?xe:t||r?t?Se:Ae:R(e,Me)?Me:ke}(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent,r=e.offsetDirection;if(this.manager.session.prevented)t.preventDefault();else{var i=this.actions,n=R(i,xe)&&!Ee.none,a=R(i,Ae)&&!Ee["pan-y"],s=R(i,Se)&&!Ee["pan-x"];if(n){var o=1===e.pointers.length,l=e.distance<2,u=e.deltaTime<250;if(o&&l&&u)return}if(!s||!a)return n||a&&6&r||s&&24&r?this.preventSrc(t):void 0}},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};var we=32;function Ce(e){this.options=u({},this.defaults,e||{}),this.id=F++,this.manager=null,this.options.enable=x(this.options.enable,!0),this.state=1,this.simultaneous={},this.requireFail=[]}function Pe(e){return 16&e?"cancel":8&e?"end":4&e?"move":2&e?"start":""}function De(e){return 16==e?"down":8==e?"up":2==e?"left":4==e?"right":""}function Ie(e,t){var r=t.manager;return r?r.get(e):e}function Fe(){Ce.apply(this,arguments)}function Oe(){Fe.apply(this,arguments),this.pX=null,this.pY=null}function Ve(){Fe.apply(this,arguments)}function Le(){Ce.apply(this,arguments),this._timer=null,this._input=null}function Ne(){Fe.apply(this,arguments)}function Be(){Fe.apply(this,arguments)}function Ue(){Ce.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Ze(e,t){return(t=t||{}).recognizers=x(t.recognizers,Ze.defaults.preset),new ze(e,t)}function ze(e,t){this.options=u({},Ze.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new(this.options.inputClass||(L?ae:N?fe:V?_e:ee))(this,W),this.touchAction=new Re(this,this.options.touchAction),Ge(this,!0),g(this.options.recognizers,(function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])}),this)}function Ge(e,t){var r,i=e.element;i.style&&(g(e.options.cssProps,(function(n,a){r=I(i.style,a),t?(e.oldCssProps[r]=i.style[r],i.style[r]=n):i.style[r]=e.oldCssProps[r]||""})),t||(e.oldCssProps={}))}Ce.prototype={defaults:{},set:function(e){return u(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(m(e,"recognizeWith",this))return this;var t=this.simultaneous;return t[(e=Ie(e,this)).id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return m(e,"dropRecognizeWith",this)||(e=Ie(e,this),delete this.simultaneous[e.id]),this},requireFailure:function(e){if(m(e,"requireFailure",this))return this;var t=this.requireFail;return-1===C(t,e=Ie(e,this))&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(m(e,"dropRequireFailure",this))return this;e=Ie(e,this);var t=C(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){var t=this,r=this.state;function i(r){t.manager.emit(r,e)}r<8&&i(t.options.event+Pe(r)),i(t.options.event),e.additionalEvent&&i(e.additionalEvent),r>=8&&i(t.options.event+Pe(r))},tryEmit:function(e){if(this.canEmit())return this.emit(e);this.state=we},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(33&this.requireFail[e].state))return!1;e++}return!0},recognize:function(e){var t=u({},e);if(!M(this.options.enable,[this,t]))return this.reset(),void(this.state=we);56&this.state&&(this.state=1),this.state=this.process(t),30&this.state&&this.tryEmit(t)},process:function(e){},getTouchAction:function(){},reset:function(){}},T(Fe,Ce,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,r=e.eventType,i=6&t,n=this.attrTest(e);return i&&(8&r||!n)?16|t:i||n?4&r?8|t:2&t?4|t:2:we}}),T(Oe,Fe,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var e=this.options.direction,t=[];return 6&e&&t.push(Ae),24&e&&t.push(Se),t},directionTest:function(e){var t=this.options,r=!0,i=e.distance,n=e.direction,a=e.deltaX,s=e.deltaY;return n&t.direction||(6&t.direction?(n=0===a?1:a<0?2:4,r=a!=this.pX,i=Math.abs(e.deltaX)):(n=0===s?1:s<0?8:16,r=s!=this.pY,i=Math.abs(e.deltaY))),e.direction=n,r&&i>t.threshold&&n&t.direction},attrTest:function(e){return Fe.prototype.attrTest.call(this,e)&&(2&this.state||!(2&this.state)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=De(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),T(Ve,Fe,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[xe]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||2&this.state)},emit:function(e){if(1!==e.scale){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}}),T(Le,Ce,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[ke]},process:function(e){var t=this.options,r=e.pointers.length===t.pointers,i=e.distance<t.threshold,n=e.deltaTime>t.time;if(this._input=e,!i||!r||12&e.eventType&&!n)this.reset();else if(1&e.eventType)this.reset(),this._timer=_((function(){this.state=8,this.tryEmit()}),t.time,this);else if(4&e.eventType)return 8;return we},reset:function(){clearTimeout(this._timer)},emit:function(e){8===this.state&&(e&&4&e.eventType?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=p(),this.manager.emit(this.options.event,this._input)))}}),T(Ne,Fe,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[xe]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||2&this.state)}}),T(Be,Fe,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:30,pointers:1},getTouchAction:function(){return Oe.prototype.getTouchAction.call(this)},attrTest:function(e){var t,r=this.options.direction;return 30&r?t=e.overallVelocity:6&r?t=e.overallVelocityX:24&r&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&r&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&f(t)>this.options.velocity&&4&e.eventType},emit:function(e){var t=De(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),T(Ue,Ce,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Me]},process:function(e){var t=this.options,r=e.pointers.length===t.pointers,i=e.distance<t.threshold,n=e.deltaTime<t.time;if(this.reset(),1&e.eventType&&0===this.count)return this.failTimeout();if(i&&n&&r){if(4!=e.eventType)return this.failTimeout();var a=!this.pTime||e.timeStamp-this.pTime<t.interval,s=!this.pCenter||K(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,s&&a?this.count+=1:this.count=1,this._input=e,0==this.count%t.taps)return this.hasRequireFailures()?(this._timer=_((function(){this.state=8,this.tryEmit()}),t.interval,this),2):8}return we},failTimeout:function(){return this._timer=_((function(){this.state=we}),this.options.interval,this),we},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Ze.VERSION="2.0.7",Ze.defaults={domEvents:!1,touchAction:Te,enable:!0,inputTarget:null,inputClass:null,preset:[[Ne,{enable:!1}],[Ve,{enable:!1},["rotate"]],[Be,{direction:6}],[Oe,{direction:6},["swipe"]],[Ue],[Ue,{event:"doubletap",taps:2},["tap"]],[Le]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},ze.prototype={set:function(e){return u(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session;if(!t.stopped){var r;this.touchAction.preventDefaults(e);var i=this.recognizers,n=t.curRecognizer;(!n||n&&8&n.state)&&(n=t.curRecognizer=null);for(var a=0;a<i.length;)r=i[a],2===t.stopped||n&&r!=n&&!r.canRecognizeWith(n)?r.reset():r.recognize(e),!n&&14&r.state&&(n=t.curRecognizer=r),a++}},get:function(e){if(e instanceof Ce)return e;for(var t=this.recognizers,r=0;r<t.length;r++)if(t[r].options.event==e)return t[r];return null},add:function(e){if(m(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(m(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,r=C(t,e);-1!==r&&(t.splice(r,1),this.touchAction.update())}return this},on:function(e,t){if(e!==l&&t!==l){var r=this.handlers;return g(w(e),(function(e){r[e]=r[e]||[],r[e].push(t)})),this}},off:function(e,t){if(e!==l){var r=this.handlers;return g(w(e),(function(e){t?r[e]&&r[e].splice(C(r[e],t),1):delete r[e]})),this}},emit:function(e,t){this.options.domEvents&&function(e,t){var r=s.createEvent("Event");r.initEvent(e,!0,!0),r.gesture=t,t.target.dispatchEvent(r)}(e,t);var r=this.handlers[e]&&this.handlers[e].slice();if(r&&r.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var i=0;i<r.length;)r[i](t),i++}},destroy:function(){this.element&&Ge(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},u(Ze,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:we,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:24,DIRECTION_ALL:30,Manager:ze,Input:G,TouchAction:Re,TouchInput:fe,MouseInput:ee,PointerEventInput:ae,TouchMouseInput:_e,SingleTouchInput:ue,Recognizer:Ce,AttrRecognizer:Fe,Tap:Ue,Pan:Oe,Swipe:Be,Pinch:Ve,Rotate:Ne,Press:Le,on:S,off:A,each:g,merge:b,extend:y,assign:u,inherit:T,bindFn:k,prefixed:I}),(void 0!==a?a:"undefined"!=typeof self?self:{}).Hammer=Ze,(i=function(){return Ze}.call(t,r,t,e))===l||(e.exports=i)}(window,document)},498:(e,t,r)=>{"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach((function(t){_(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){var t=f();return function(){var r,i=p(e);if(t){var n=p(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return h(this,r)}}function h(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?d(e):t}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function v(e,t,r){return t&&g(e.prototype,t),r&&g(e,r),e}r.d(t,{Vkp:()=>j,yGw:()=>oe,_fP:()=>Z,FM8:()=>U,Pa4:()=>z});var y=1001,b=2300,T=2301,k=2302,M="srgb",x="srgb-linear",S="linear",A="srgb",E=2e3,R=2001;function w(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;var C={};function P(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var i,n="THREE."+t.shift();(i=console).warn.apply(i,[n].concat(t))}function D(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var i,n="THREE."+t.shift();(i=console).error.apply(i,[n].concat(t))}function I(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var i=t.join(" ");i in C||(C[i]=!0,P.apply(void 0,t))}var F=function(){function e(){m(this,e)}return v(e,[{key:"addEventListener",value:function(e,t){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)}},{key:"hasEventListener",value:function(e,t){var r=this._listeners;return void 0!==r&&void 0!==r[e]&&-1!==r[e].indexOf(t)}},{key:"removeEventListener",value:function(e,t){var r=this._listeners;if(void 0!==r){var i=r[e];if(void 0!==i){var n=i.indexOf(t);-1!==n&&i.splice(n,1)}}}},{key:"dispatchEvent",value:function(e){var t=this._listeners;if(void 0!==t){var r=t[e.type];if(void 0!==r){e.target=this;for(var i=r.slice(0),n=0,a=i.length;n<a;n++)i[n].call(this,e);e.target=null}}}}]),e}(),O=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function V(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(O[255&e]+O[e>>8&255]+O[e>>16&255]+O[e>>24&255]+"-"+O[255&t]+O[t>>8&255]+"-"+O[t>>16&15|64]+O[t>>24&255]+"-"+O[63&r|128]+O[r>>8&255]+"-"+O[r>>16&255]+O[r>>24&255]+O[255&i]+O[i>>8&255]+O[i>>16&255]+O[i>>24&255]).toLowerCase()}function L(e,t,r){return Math.max(t,Math.min(r,e))}function N(e,t){return(e%t+t)%t}function B(e,t,r){return(1-r)*e+r*t}Math.PI,Math.PI;var U=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;m(this,e),e.prototype.isVector2=!0,this.x=t,this.y=r}return v(e,[{key:"width",get:function(){return this.x},set:function(e){this.x=e}},{key:"height",get:function(){return this.y},set:function(e){this.y=e}},{key:"set",value:function(e,t){return this.x=e,this.y=t,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"applyMatrix3",value:function(e){var t=this.x,r=this.y,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6],this.y=i[1]*t+i[4]*r+i[7],this}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}},{key:"clamp",value:function(e,t){return this.x=L(this.x,e.x,t.x),this.y=L(this.y,e.y,t.y),this}},{key:"clampScalar",value:function(e,t){return this.x=L(this.x,e,t),this.y=L(this.y,e,t),this}},{key:"clampLength",value:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(L(r,e,t))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"roundToZero",value:function(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"cross",value:function(e){return this.x*e.y-this.y*e.x}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"angle",value:function(){return Math.atan2(-this.y,-this.x)+Math.PI}},{key:"angleTo",value:function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;var r=this.dot(e)/t;return Math.acos(L(r,-1,1))}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,r=this.y-e.y;return t*t+r*r}},{key:"manhattanDistanceTo",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}},{key:"lerpVectors",value:function(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}},{key:"fromBufferAttribute",value:function(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}},{key:"rotateAround",value:function(e,t){var r=Math.cos(t),i=Math.sin(t),n=this.x-e.x,a=this.y-e.y;return this.x=n*r-a*i+e.x,this.y=n*i+a*r+e.y,this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this}},{key:Symbol.iterator,value:regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.x;case 2:return e.next=4,this.y;case 4:case"end":return e.stop()}}),e,this)}))}]),e}(),Z=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;m(this,e),this.isQuaternion=!0,this._x=t,this._y=r,this._z=i,this._w=n}return v(e,[{key:"x",get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},{key:"w",get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}},{key:"set",value:function(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._w=i,this._onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._w)}},{key:"copy",value:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}},{key:"setFromEuler",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=e._x,i=e._y,n=e._z,a=e._order,s=Math.cos,o=Math.sin,l=s(r/2),u=s(i/2),c=s(n/2),h=o(r/2),d=o(i/2),f=o(n/2);switch(a){case"XYZ":this._x=h*u*c+l*d*f,this._y=l*d*c-h*u*f,this._z=l*u*f+h*d*c,this._w=l*u*c-h*d*f;break;case"YXZ":this._x=h*u*c+l*d*f,this._y=l*d*c-h*u*f,this._z=l*u*f-h*d*c,this._w=l*u*c+h*d*f;break;case"ZXY":this._x=h*u*c-l*d*f,this._y=l*d*c+h*u*f,this._z=l*u*f+h*d*c,this._w=l*u*c-h*d*f;break;case"ZYX":this._x=h*u*c-l*d*f,this._y=l*d*c+h*u*f,this._z=l*u*f-h*d*c,this._w=l*u*c+h*d*f;break;case"YZX":this._x=h*u*c+l*d*f,this._y=l*d*c+h*u*f,this._z=l*u*f-h*d*c,this._w=l*u*c-h*d*f;break;case"XZY":this._x=h*u*c-l*d*f,this._y=l*d*c-h*u*f,this._z=l*u*f+h*d*c,this._w=l*u*c+h*d*f;break;default:P("Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!0===t&&this._onChangeCallback(),this}},{key:"setFromAxisAngle",value:function(e,t){var r=t/2,i=Math.sin(r);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(r),this._onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t=e.elements,r=t[0],i=t[4],n=t[8],a=t[1],s=t[5],o=t[9],l=t[2],u=t[6],c=t[10],h=r+s+c;if(h>0){var d=.5/Math.sqrt(h+1);this._w=.25/d,this._x=(u-o)*d,this._y=(n-l)*d,this._z=(a-i)*d}else if(r>s&&r>c){var f=2*Math.sqrt(1+r-s-c);this._w=(u-o)/f,this._x=.25*f,this._y=(i+a)/f,this._z=(n+l)/f}else if(s>c){var p=2*Math.sqrt(1+s-r-c);this._w=(n-l)/p,this._x=(i+a)/p,this._y=.25*p,this._z=(o+u)/p}else{var _=2*Math.sqrt(1+c-r-s);this._w=(a-i)/_,this._x=(n+l)/_,this._y=(o+u)/_,this._z=.25*_}return this._onChangeCallback(),this}},{key:"setFromUnitVectors",value:function(e,t){var r=e.dot(t)+1;return r<1e-8?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=r),this.normalize()}},{key:"angleTo",value:function(e){return 2*Math.acos(Math.abs(L(this.dot(e),-1,1)))}},{key:"rotateTowards",value:function(e,t){var r=this.angleTo(e);if(0===r)return this;var i=Math.min(1,t/r);return this.slerp(e,i),this}},{key:"identity",value:function(){return this.set(0,0,0,1)}},{key:"invert",value:function(){return this.conjugate()}},{key:"conjugate",value:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}},{key:"dot",value:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}},{key:"lengthSq",value:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}},{key:"length",value:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}},{key:"normalize",value:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}},{key:"multiply",value:function(e){return this.multiplyQuaternions(this,e)}},{key:"premultiply",value:function(e){return this.multiplyQuaternions(e,this)}},{key:"multiplyQuaternions",value:function(e,t){var r=e._x,i=e._y,n=e._z,a=e._w,s=t._x,o=t._y,l=t._z,u=t._w;return this._x=r*u+a*s+i*l-n*o,this._y=i*u+a*o+n*s-r*l,this._z=n*u+a*l+r*o-i*s,this._w=a*u-r*s-i*o-n*l,this._onChangeCallback(),this}},{key:"slerp",value:function(e,t){if(t<=0)return this;if(t>=1)return this.copy(e);var r=e._x,i=e._y,n=e._z,a=e._w,s=this.dot(e);s<0&&(r=-r,i=-i,n=-n,a=-a,s=-s);var o=1-t;if(s<.9995){var l=Math.acos(s),u=Math.sin(l);o=Math.sin(o*l)/u,t=Math.sin(t*l)/u,this._x=this._x*o+r*t,this._y=this._y*o+i*t,this._z=this._z*o+n*t,this._w=this._w*o+a*t,this._onChangeCallback()}else this._x=this._x*o+r*t,this._y=this._y*o+i*t,this._z=this._z*o+n*t,this._w=this._w*o+a*t,this.normalize();return this}},{key:"slerpQuaternions",value:function(e,t,r){return this.copy(e).slerp(t,r)}},{key:"random",value:function(){var e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),r=Math.random(),i=Math.sqrt(1-r),n=Math.sqrt(r);return this.set(i*Math.sin(e),i*Math.cos(e),n*Math.sin(t),n*Math.cos(t))}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}},{key:"fromBufferAttribute",value:function(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}},{key:"toJSON",value:function(){return this.toArray()}},{key:"_onChange",value:function(e){return this._onChangeCallback=e,this}},{key:"_onChangeCallback",value:function(){}},{key:Symbol.iterator,value:regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._x;case 2:return e.next=4,this._y;case 4:return e.next=6,this._z;case 6:return e.next=8,this._w;case 8:case"end":return e.stop()}}),e,this)}))}],[{key:"slerpFlat",value:function(e,t,r,i,n,a,s){var o=r[i+0],l=r[i+1],u=r[i+2],c=r[i+3],h=n[a+0],d=n[a+1],f=n[a+2],p=n[a+3];if(s<=0)return e[t+0]=o,e[t+1]=l,e[t+2]=u,void(e[t+3]=c);if(s>=1)return e[t+0]=h,e[t+1]=d,e[t+2]=f,void(e[t+3]=p);if(c!==p||o!==h||l!==d||u!==f){var _=o*h+l*d+u*f+c*p;_<0&&(h=-h,d=-d,f=-f,p=-p,_=-_);var m=1-s;if(_<.9995){var g=Math.acos(_),v=Math.sin(g);o=o*(m=Math.sin(m*g)/v)+h*(s=Math.sin(s*g)/v),l=l*m+d*s,u=u*m+f*s,c=c*m+p*s}else{o=o*m+h*s,l=l*m+d*s,u=u*m+f*s,c=c*m+p*s;var y=1/Math.sqrt(o*o+l*l+u*u+c*c);o*=y,l*=y,u*=y,c*=y}}e[t]=o,e[t+1]=l,e[t+2]=u,e[t+3]=c}},{key:"multiplyQuaternionsFlat",value:function(e,t,r,i,n,a){var s=r[i],o=r[i+1],l=r[i+2],u=r[i+3],c=n[a],h=n[a+1],d=n[a+2],f=n[a+3];return e[t]=s*f+u*c+o*d-l*h,e[t+1]=o*f+u*h+l*c-s*d,e[t+2]=l*f+u*d+s*h-o*c,e[t+3]=u*f-s*c-o*h-l*d,e}}]),e}(),z=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;m(this,e),e.prototype.isVector3=!0,this.x=t,this.y=r,this.z=i}return v(e,[{key:"set",value:function(e,t,r){return void 0===r&&(r=this.z),this.x=e,this.y=t,this.z=r,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:"applyEuler",value:function(e){return this.applyQuaternion(W.setFromEuler(e))}},{key:"applyAxisAngle",value:function(e,t){return this.applyQuaternion(W.setFromAxisAngle(e,t))}},{key:"applyMatrix3",value:function(e){var t=this.x,r=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[3]*r+n[6]*i,this.y=n[1]*t+n[4]*r+n[7]*i,this.z=n[2]*t+n[5]*r+n[8]*i,this}},{key:"applyNormalMatrix",value:function(e){return this.applyMatrix3(e).normalize()}},{key:"applyMatrix4",value:function(e){var t=this.x,r=this.y,i=this.z,n=e.elements,a=1/(n[3]*t+n[7]*r+n[11]*i+n[15]);return this.x=(n[0]*t+n[4]*r+n[8]*i+n[12])*a,this.y=(n[1]*t+n[5]*r+n[9]*i+n[13])*a,this.z=(n[2]*t+n[6]*r+n[10]*i+n[14])*a,this}},{key:"applyQuaternion",value:function(e){var t=this.x,r=this.y,i=this.z,n=e.x,a=e.y,s=e.z,o=e.w,l=2*(a*i-s*r),u=2*(s*t-n*i),c=2*(n*r-a*t);return this.x=t+o*l+a*c-s*u,this.y=r+o*u+s*l-n*c,this.z=i+o*c+n*u-a*l,this}},{key:"project",value:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}},{key:"unproject",value:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}},{key:"transformDirection",value:function(e){var t=this.x,r=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[4]*r+n[8]*i,this.y=n[1]*t+n[5]*r+n[9]*i,this.z=n[2]*t+n[6]*r+n[10]*i,this.normalize()}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}},{key:"clamp",value:function(e,t){return this.x=L(this.x,e.x,t.x),this.y=L(this.y,e.y,t.y),this.z=L(this.z,e.z,t.z),this}},{key:"clampScalar",value:function(e,t){return this.x=L(this.x,e,t),this.y=L(this.y,e,t),this.z=L(this.z,e,t),this}},{key:"clampLength",value:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(L(r,e,t))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"lerpVectors",value:function(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this}},{key:"cross",value:function(e){return this.crossVectors(this,e)}},{key:"crossVectors",value:function(e,t){var r=e.x,i=e.y,n=e.z,a=t.x,s=t.y,o=t.z;return this.x=i*o-n*s,this.y=n*a-r*o,this.z=r*s-i*a,this}},{key:"projectOnVector",value:function(e){var t=e.lengthSq();if(0===t)return this.set(0,0,0);var r=e.dot(this)/t;return this.copy(e).multiplyScalar(r)}},{key:"projectOnPlane",value:function(e){return G.copy(this).projectOnVector(e),this.sub(G)}},{key:"reflect",value:function(e){return this.sub(G.copy(e).multiplyScalar(2*this.dot(e)))}},{key:"angleTo",value:function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;var r=this.dot(e)/t;return Math.acos(L(r,-1,1))}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return t*t+r*r+i*i}},{key:"manhattanDistanceTo",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}},{key:"setFromSpherical",value:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}},{key:"setFromSphericalCoords",value:function(e,t,r){var i=Math.sin(t)*e;return this.x=i*Math.sin(r),this.y=Math.cos(t)*e,this.z=i*Math.cos(r),this}},{key:"setFromCylindrical",value:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}},{key:"setFromCylindricalCoords",value:function(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this}},{key:"setFromMatrixPosition",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:"setFromMatrixScale",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=i,this}},{key:"setFromMatrixColumn",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:"setFromMatrix3Column",value:function(e,t){return this.fromArray(e.elements,3*t)}},{key:"setFromEuler",value:function(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}},{key:"setFromColor",value:function(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:"fromBufferAttribute",value:function(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}},{key:"randomDirection",value:function(){var e=Math.random()*Math.PI*2,t=2*Math.random()-1,r=Math.sqrt(1-t*t);return this.x=r*Math.cos(e),this.y=t,this.z=r*Math.sin(e),this}},{key:Symbol.iterator,value:regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.x;case 2:return e.next=4,this.y;case 4:return e.next=6,this.z;case 6:case"end":return e.stop()}}),e,this)}))}]),e}(),G=new z,W=new Z,j=function(){function e(t,r,i,n,a,s,o,l,u){m(this,e),e.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==t&&this.set(t,r,i,n,a,s,o,l,u)}return v(e,[{key:"set",value:function(e,t,r,i,n,a,s,o,l){var u=this.elements;return u[0]=e,u[1]=i,u[2]=s,u[3]=t,u[4]=n,u[5]=o,u[6]=r,u[7]=a,u[8]=l,this}},{key:"identity",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:"copy",value:function(e){var t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this}},{key:"extractBasis",value:function(e,t,r){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}},{key:"setFromMatrix4",value:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}},{key:"multiply",value:function(e){return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function(e,t){var r=e.elements,i=t.elements,n=this.elements,a=r[0],s=r[3],o=r[6],l=r[1],u=r[4],c=r[7],h=r[2],d=r[5],f=r[8],p=i[0],_=i[3],m=i[6],g=i[1],v=i[4],y=i[7],b=i[2],T=i[5],k=i[8];return n[0]=a*p+s*g+o*b,n[3]=a*_+s*v+o*T,n[6]=a*m+s*y+o*k,n[1]=l*p+u*g+c*b,n[4]=l*_+u*v+c*T,n[7]=l*m+u*y+c*k,n[2]=h*p+d*g+f*b,n[5]=h*_+d*v+f*T,n[8]=h*m+d*y+f*k,this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],s=e[5],o=e[6],l=e[7],u=e[8];return t*a*u-t*s*l-r*n*u+r*s*o+i*n*l-i*a*o}},{key:"invert",value:function(){var e=this.elements,t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],s=e[5],o=e[6],l=e[7],u=e[8],c=u*a-s*l,h=s*o-u*n,d=l*n-a*o,f=t*c+r*h+i*d;if(0===f)return this.set(0,0,0,0,0,0,0,0,0);var p=1/f;return e[0]=c*p,e[1]=(i*l-u*r)*p,e[2]=(s*r-i*a)*p,e[3]=h*p,e[4]=(u*t-i*o)*p,e[5]=(i*n-s*t)*p,e[6]=d*p,e[7]=(r*o-l*t)*p,e[8]=(a*t-r*n)*p,this}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}},{key:"getNormalMatrix",value:function(e){return this.setFromMatrix4(e).invert().transpose()}},{key:"transposeIntoArray",value:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}},{key:"setUvTransform",value:function(e,t,r,i,n,a,s){var o=Math.cos(n),l=Math.sin(n);return this.set(r*o,r*l,-r*(o*a+l*s)+a+e,-i*l,i*o,-i*(-l*a+o*s)+s+t,0,0,1),this}},{key:"scale",value:function(e,t){return this.premultiply(X.makeScale(e,t)),this}},{key:"rotate",value:function(e){return this.premultiply(X.makeRotation(-e)),this}},{key:"translate",value:function(e,t){return this.premultiply(X.makeTranslation(e,t)),this}},{key:"makeTranslation",value:function(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}},{key:"makeRotation",value:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,r,t,0,0,0,1),this}},{key:"makeScale",value:function(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}},{key:"equals",value:function(e){for(var t=this.elements,r=e.elements,i=0;i<9;i++)if(t[i]!==r[i])return!1;return!0}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0;r<9;r++)this.elements[r]=e[r+t];return this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}},{key:"clone",value:function(){return(new this.constructor).fromArray(this.elements)}}]),e}(),X=new j,H=(new j).set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),Y=(new j).set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function K(){var e,t={enabled:!0,workingColorSpace:x,spaces:{},convert:function(e,t,r){return!1!==this.enabled&&t!==r&&t&&r?(this.spaces[t].transfer===A&&(e.r=Q(e.r),e.g=Q(e.g),e.b=Q(e.b)),this.spaces[t].primaries!==this.spaces[r].primaries&&(e.applyMatrix3(this.spaces[t].toXYZ),e.applyMatrix3(this.spaces[r].fromXYZ)),this.spaces[r].transfer===A&&(e.r=$(e.r),e.g=$(e.g),e.b=$(e.b)),e):e},workingToColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},colorSpaceToWorking:function(e,t){return this.convert(e,t,this.workingColorSpace)},getPrimaries:function(e){return this.spaces[e].primaries},getTransfer:function(e){return""===e?S:this.spaces[e].transfer},getToneMappingMode:function(e){return this.spaces[e].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.workingColorSpace;return e.fromArray(this.spaces[t].luminanceCoefficients)},define:function(e){Object.assign(this.spaces,e)},_getMatrix:function(e,t,r){return e.copy(this.spaces[t].toXYZ).multiply(this.spaces[r].fromXYZ)},_getDrawingBufferColorSpace:function(e){return this.spaces[e].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.workingColorSpace;return this.spaces[e].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(e,r){return I("ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),t.workingToColorSpace(e,r)},toWorkingColorSpace:function(e,r){return I("ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),t.colorSpaceToWorking(e,r)}},r=[.64,.33,.3,.6,.15,.06],i=[.2126,.7152,.0722],n=[.3127,.329];return t.define((_(e={},x,{primaries:r,whitePoint:n,transfer:S,toXYZ:H,fromXYZ:Y,luminanceCoefficients:i,workingColorSpaceConfig:{unpackColorSpace:M},outputColorSpaceConfig:{drawingBufferColorSpace:M}}),_(e,M,{primaries:r,whitePoint:n,transfer:A,toXYZ:H,fromXYZ:Y,luminanceCoefficients:i,outputColorSpaceConfig:{drawingBufferColorSpace:M}}),e)),t}var q,J=K();function Q(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function $(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}var ee=function(){function e(){m(this,e)}return v(e,null,[{key:"getDataURL",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/png";if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;if(e instanceof HTMLCanvasElement)t=e;else{void 0===q&&(q=w("canvas")),q.width=e.width,q.height=e.height;var i=q.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=q}return t.toDataURL(r)}},{key:"sRGBToLinear",value:function(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){var t=w("canvas");t.width=e.width,t.height=e.height;var r=t.getContext("2d");r.drawImage(e,0,0,e.width,e.height);for(var i=r.getImageData(0,0,e.width,e.height),n=i.data,a=0;a<n.length;a++)n[a]=255*Q(n[a]/255);return r.putImageData(i,0,0),t}if(e.data){for(var s=e.data.slice(0),o=0;o<s.length;o++)s instanceof Uint8Array||s instanceof Uint8ClampedArray?s[o]=Math.floor(255*Q(s[o]/255)):s[o]=Q(s[o]);return{data:s,width:e.width,height:e.height}}return P("ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}]),e}(),te=0,re=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;m(this,e),this.isSource=!0,Object.defineProperty(this,"id",{value:te++}),this.uuid=V(),this.data=t,this.dataReady=!0,this.version=0}return v(e,[{key:"getSize",value:function(e){var t=this.data;return"undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement?e.set(t.videoWidth,t.videoHeight,0):"undefined"!=typeof VideoFrame&&t instanceof VideoFrame?e.set(t.displayHeight,t.displayWidth,0):null!==t?e.set(t.width,t.height,t.depth||0):e.set(0,0,0),e}},{key:"needsUpdate",set:function(e){!0===e&&this.version++}},{key:"toJSON",value:function(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];var r={uuid:this.uuid,url:""},i=this.data;if(null!==i){var n;if(Array.isArray(i)){n=[];for(var a=0,s=i.length;a<s;a++)i[a].isDataTexture?n.push(ie(i[a].image)):n.push(ie(i[a]))}else n=ie(i);r.url=n}return t||(e.images[this.uuid]=r),r}}]),e}();function ie(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?ee.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(P("Texture: Unable to serialize Texture."),{})}var ne=0,ae=new z,se=function(e){l(r,e);var t=c(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.DEFAULT_IMAGE,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.DEFAULT_MAPPING,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:y,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:y,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1006,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1008,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1023,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1009,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:r.DEFAULT_ANISOTROPY,f=arguments.length>9&&void 0!==arguments[9]?arguments[9]:"";return m(this,r),(e=t.call(this)).isTexture=!0,Object.defineProperty(d(e),"id",{value:ne++}),e.uuid=V(),e.name="",e.source=new re(i),e.mipmaps=[],e.mapping=n,e.channel=0,e.wrapS=a,e.wrapT=s,e.magFilter=o,e.minFilter=l,e.anisotropy=h,e.format=u,e.internalFormat=null,e.type=c,e.offset=new U(0,0),e.repeat=new U(1,1),e.center=new U(0,0),e.rotation=0,e.matrixAutoUpdate=!0,e.matrix=new j,e.generateMipmaps=!0,e.premultiplyAlpha=!1,e.flipY=!0,e.unpackAlignment=4,e.colorSpace=f,e.userData={},e.updateRanges=[],e.version=0,e.onUpdate=null,e.renderTarget=null,e.isRenderTargetTexture=!1,e.isArrayTexture=!!(i&&i.depth&&i.depth>1),e.pmremVersion=0,e}return v(r,[{key:"width",get:function(){return this.source.getSize(ae).x}},{key:"height",get:function(){return this.source.getSize(ae).y}},{key:"depth",get:function(){return this.source.getSize(ae).z}},{key:"image",get:function(){return this.source.data},set:function(e){void 0===e&&(e=null),this.source.data=e}},{key:"updateMatrix",value:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}},{key:"addUpdateRange",value:function(e,t){this.updateRanges.push({start:e,count:t})}},{key:"clearUpdateRanges",value:function(){this.updateRanges.length=0}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}},{key:"setValues",value:function(e){for(var t in e){var r=e[t];if(void 0!==r){var i=this[t];void 0!==i?i&&r&&i.isVector2&&r.isVector2||i&&r&&i.isVector3&&r.isVector3||i&&r&&i.isMatrix3&&r.isMatrix3?i.copy(r):this[t]=r:P("Texture.setValues(): property '".concat(t,"' does not exist."))}else P("Texture.setValues(): parameter '".concat(t,"' has value of undefined."))}}},{key:"toJSON",value:function(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var r={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),t||(e.textures[this.uuid]=r),r}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}},{key:"transformUv",value:function(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case 1e3:e.x=e.x-Math.floor(e.x);break;case y:e.x=e.x<0?0:1;break;case 1002:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case 1e3:e.y=e.y-Math.floor(e.y);break;case y:e.y=e.y<0?0:1;break;case 1002:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}},{key:"needsUpdate",set:function(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}},{key:"needsPMREMUpdate",set:function(e){!0===e&&this.pmremVersion++}}]),r}(F);se.DEFAULT_IMAGE=null,se.DEFAULT_MAPPING=300,se.DEFAULT_ANISOTROPY=1;var oe=function(){function e(t,r,i,n,a,s,o,l,u,c,h,d,f,p,_,g){m(this,e),e.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==t&&this.set(t,r,i,n,a,s,o,l,u,c,h,d,f,p,_,g)}return v(e,[{key:"set",value:function(e,t,r,i,n,a,s,o,l,u,c,h,d,f,p,_){var m=this.elements;return m[0]=e,m[4]=t,m[8]=r,m[12]=i,m[1]=n,m[5]=a,m[9]=s,m[13]=o,m[2]=l,m[6]=u,m[10]=c,m[14]=h,m[3]=d,m[7]=f,m[11]=p,m[15]=_,this}},{key:"identity",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:"clone",value:function(){return(new e).fromArray(this.elements)}},{key:"copy",value:function(e){var t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this}},{key:"copyPosition",value:function(e){var t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this}},{key:"setFromMatrix3",value:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}},{key:"extractBasis",value:function(e,t,r){return 0===this.determinant()?(e.set(1,0,0),t.set(0,1,0),r.set(0,0,1),this):(e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this)}},{key:"makeBasis",value:function(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this}},{key:"extractRotation",value:function(e){if(0===e.determinant())return this.identity();var t=this.elements,r=e.elements,i=1/le.setFromMatrixColumn(e,0).length(),n=1/le.setFromMatrixColumn(e,1).length(),a=1/le.setFromMatrixColumn(e,2).length();return t[0]=r[0]*i,t[1]=r[1]*i,t[2]=r[2]*i,t[3]=0,t[4]=r[4]*n,t[5]=r[5]*n,t[6]=r[6]*n,t[7]=0,t[8]=r[8]*a,t[9]=r[9]*a,t[10]=r[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"makeRotationFromEuler",value:function(e){var t=this.elements,r=e.x,i=e.y,n=e.z,a=Math.cos(r),s=Math.sin(r),o=Math.cos(i),l=Math.sin(i),u=Math.cos(n),c=Math.sin(n);if("XYZ"===e.order){var h=a*u,d=a*c,f=s*u,p=s*c;t[0]=o*u,t[4]=-o*c,t[8]=l,t[1]=d+f*l,t[5]=h-p*l,t[9]=-s*o,t[2]=p-h*l,t[6]=f+d*l,t[10]=a*o}else if("YXZ"===e.order){var _=o*u,m=o*c,g=l*u,v=l*c;t[0]=_+v*s,t[4]=g*s-m,t[8]=a*l,t[1]=a*c,t[5]=a*u,t[9]=-s,t[2]=m*s-g,t[6]=v+_*s,t[10]=a*o}else if("ZXY"===e.order){var y=o*u,b=o*c,T=l*u,k=l*c;t[0]=y-k*s,t[4]=-a*c,t[8]=T+b*s,t[1]=b+T*s,t[5]=a*u,t[9]=k-y*s,t[2]=-a*l,t[6]=s,t[10]=a*o}else if("ZYX"===e.order){var M=a*u,x=a*c,S=s*u,A=s*c;t[0]=o*u,t[4]=S*l-x,t[8]=M*l+A,t[1]=o*c,t[5]=A*l+M,t[9]=x*l-S,t[2]=-l,t[6]=s*o,t[10]=a*o}else if("YZX"===e.order){var E=a*o,R=a*l,w=s*o,C=s*l;t[0]=o*u,t[4]=C-E*c,t[8]=w*c+R,t[1]=c,t[5]=a*u,t[9]=-s*u,t[2]=-l*u,t[6]=R*c+w,t[10]=E-C*c}else if("XZY"===e.order){var P=a*o,D=a*l,I=s*o,F=s*l;t[0]=o*u,t[4]=-c,t[8]=l*u,t[1]=P*c+F,t[5]=a*u,t[9]=D*c-I,t[2]=I*c-D,t[6]=s*u,t[10]=F*c+P}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"makeRotationFromQuaternion",value:function(e){return this.compose(ce,e,he)}},{key:"lookAt",value:function(e,t,r){var i=this.elements;return pe.subVectors(e,t),0===pe.lengthSq()&&(pe.z=1),pe.normalize(),de.crossVectors(r,pe),0===de.lengthSq()&&(1===Math.abs(r.z)?pe.x+=1e-4:pe.z+=1e-4,pe.normalize(),de.crossVectors(r,pe)),de.normalize(),fe.crossVectors(pe,de),i[0]=de.x,i[4]=fe.x,i[8]=pe.x,i[1]=de.y,i[5]=fe.y,i[9]=pe.y,i[2]=de.z,i[6]=fe.z,i[10]=pe.z,this}},{key:"multiply",value:function(e){return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function(e,t){var r=e.elements,i=t.elements,n=this.elements,a=r[0],s=r[4],o=r[8],l=r[12],u=r[1],c=r[5],h=r[9],d=r[13],f=r[2],p=r[6],_=r[10],m=r[14],g=r[3],v=r[7],y=r[11],b=r[15],T=i[0],k=i[4],M=i[8],x=i[12],S=i[1],A=i[5],E=i[9],R=i[13],w=i[2],C=i[6],P=i[10],D=i[14],I=i[3],F=i[7],O=i[11],V=i[15];return n[0]=a*T+s*S+o*w+l*I,n[4]=a*k+s*A+o*C+l*F,n[8]=a*M+s*E+o*P+l*O,n[12]=a*x+s*R+o*D+l*V,n[1]=u*T+c*S+h*w+d*I,n[5]=u*k+c*A+h*C+d*F,n[9]=u*M+c*E+h*P+d*O,n[13]=u*x+c*R+h*D+d*V,n[2]=f*T+p*S+_*w+m*I,n[6]=f*k+p*A+_*C+m*F,n[10]=f*M+p*E+_*P+m*O,n[14]=f*x+p*R+_*D+m*V,n[3]=g*T+v*S+y*w+b*I,n[7]=g*k+v*A+y*C+b*F,n[11]=g*M+v*E+y*P+b*O,n[15]=g*x+v*R+y*D+b*V,this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],r=e[4],i=e[8],n=e[12],a=e[1],s=e[5],o=e[9],l=e[13],u=e[2],c=e[6],h=e[10],d=e[14],f=e[3],p=e[7],_=e[11],m=e[15],g=o*d-l*h,v=s*d-l*c,y=s*h-o*c,b=a*d-l*u,T=a*h-o*u,k=a*c-s*u;return t*(p*g-_*v+m*y)-r*(f*g-_*b+m*T)+i*(f*v-p*b+m*k)-n*(f*y-p*T+_*k)}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}},{key:"setPosition",value:function(e,t,r){var i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=r),this}},{key:"invert",value:function(){var e=this.elements,t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],s=e[5],o=e[6],l=e[7],u=e[8],c=e[9],h=e[10],d=e[11],f=e[12],p=e[13],_=e[14],m=e[15],g=c*_*l-p*h*l+p*o*d-s*_*d-c*o*m+s*h*m,v=f*h*l-u*_*l-f*o*d+a*_*d+u*o*m-a*h*m,y=u*p*l-f*c*l+f*s*d-a*p*d-u*s*m+a*c*m,b=f*c*o-u*p*o-f*s*h+a*p*h+u*s*_-a*c*_,T=t*g+r*v+i*y+n*b;if(0===T)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var k=1/T;return e[0]=g*k,e[1]=(p*h*n-c*_*n-p*i*d+r*_*d+c*i*m-r*h*m)*k,e[2]=(s*_*n-p*o*n+p*i*l-r*_*l-s*i*m+r*o*m)*k,e[3]=(c*o*n-s*h*n-c*i*l+r*h*l+s*i*d-r*o*d)*k,e[4]=v*k,e[5]=(u*_*n-f*h*n+f*i*d-t*_*d-u*i*m+t*h*m)*k,e[6]=(f*o*n-a*_*n-f*i*l+t*_*l+a*i*m-t*o*m)*k,e[7]=(a*h*n-u*o*n+u*i*l-t*h*l-a*i*d+t*o*d)*k,e[8]=y*k,e[9]=(f*c*n-u*p*n-f*r*d+t*p*d+u*r*m-t*c*m)*k,e[10]=(a*p*n-f*s*n+f*r*l-t*p*l-a*r*m+t*s*m)*k,e[11]=(u*s*n-a*c*n-u*r*l+t*c*l+a*r*d-t*s*d)*k,e[12]=b*k,e[13]=(u*p*i-f*c*i+f*r*h-t*p*h-u*r*_+t*c*_)*k,e[14]=(f*s*i-a*p*i-f*r*o+t*p*o+a*r*_-t*s*_)*k,e[15]=(a*c*i-u*s*i+u*r*o-t*c*o-a*r*h+t*s*h)*k,this}},{key:"scale",value:function(e){var t=this.elements,r=e.x,i=e.y,n=e.z;return t[0]*=r,t[4]*=i,t[8]*=n,t[1]*=r,t[5]*=i,t[9]*=n,t[2]*=r,t[6]*=i,t[10]*=n,t[3]*=r,t[7]*=i,t[11]*=n,this}},{key:"getMaxScaleOnAxis",value:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,i))}},{key:"makeTranslation",value:function(e,t,r){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this}},{key:"makeRotationX",value:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this}},{key:"makeRotationY",value:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this}},{key:"makeRotationZ",value:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this}},{key:"makeRotationAxis",value:function(e,t){var r=Math.cos(t),i=Math.sin(t),n=1-r,a=e.x,s=e.y,o=e.z,l=n*a,u=n*s;return this.set(l*a+r,l*s-i*o,l*o+i*s,0,l*s+i*o,u*s+r,u*o-i*a,0,l*o-i*s,u*o+i*a,n*o*o+r,0,0,0,0,1),this}},{key:"makeScale",value:function(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this}},{key:"makeShear",value:function(e,t,r,i,n,a){return this.set(1,r,n,0,e,1,a,0,t,i,1,0,0,0,0,1),this}},{key:"compose",value:function(e,t,r){var i=this.elements,n=t._x,a=t._y,s=t._z,o=t._w,l=n+n,u=a+a,c=s+s,h=n*l,d=n*u,f=n*c,p=a*u,_=a*c,m=s*c,g=o*l,v=o*u,y=o*c,b=r.x,T=r.y,k=r.z;return i[0]=(1-(p+m))*b,i[1]=(d+y)*b,i[2]=(f-v)*b,i[3]=0,i[4]=(d-y)*T,i[5]=(1-(h+m))*T,i[6]=(_+g)*T,i[7]=0,i[8]=(f+v)*k,i[9]=(_-g)*k,i[10]=(1-(h+p))*k,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}},{key:"decompose",value:function(e,t,r){var i=this.elements;if(e.x=i[12],e.y=i[13],e.z=i[14],0===this.determinant())return r.set(1,1,1),t.identity(),this;var n=le.set(i[0],i[1],i[2]).length(),a=le.set(i[4],i[5],i[6]).length(),s=le.set(i[8],i[9],i[10]).length();this.determinant()<0&&(n=-n),ue.copy(this);var o=1/n,l=1/a,u=1/s;return ue.elements[0]*=o,ue.elements[1]*=o,ue.elements[2]*=o,ue.elements[4]*=l,ue.elements[5]*=l,ue.elements[6]*=l,ue.elements[8]*=u,ue.elements[9]*=u,ue.elements[10]*=u,t.setFromRotationMatrix(ue),r.x=n,r.y=a,r.z=s,this}},{key:"makePerspective",value:function(e,t,r,i,n,a){var s,o,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:E,u=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=this.elements,h=2*n/(t-e),d=2*n/(r-i),f=(t+e)/(t-e),p=(r+i)/(r-i);if(u)s=n/(a-n),o=a*n/(a-n);else if(l===E)s=-(a+n)/(a-n),o=-2*a*n/(a-n);else{if(l!==R)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+l);s=-a/(a-n),o=-a*n/(a-n)}return c[0]=h,c[4]=0,c[8]=f,c[12]=0,c[1]=0,c[5]=d,c[9]=p,c[13]=0,c[2]=0,c[6]=0,c[10]=s,c[14]=o,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}},{key:"makeOrthographic",value:function(e,t,r,i,n,a){var s,o,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:E,u=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=this.elements,h=2/(t-e),d=2/(r-i),f=-(t+e)/(t-e),p=-(r+i)/(r-i);if(u)s=1/(a-n),o=a/(a-n);else if(l===E)s=-2/(a-n),o=-(a+n)/(a-n);else{if(l!==R)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+l);s=-1/(a-n),o=-n/(a-n)}return c[0]=h,c[4]=0,c[8]=0,c[12]=f,c[1]=0,c[5]=d,c[9]=0,c[13]=p,c[2]=0,c[6]=0,c[10]=s,c[14]=o,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}},{key:"equals",value:function(e){for(var t=this.elements,r=e.elements,i=0;i<16;i++)if(t[i]!==r[i])return!1;return!0}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0;r<16;r++)this.elements[r]=e[r+t];return this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}]),e}(),le=new z,ue=new oe,ce=new z(0,0,0),he=new z(1,1,1),de=new z,fe=new z,pe=new z,_e=new oe,me=new Z,ge=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.DEFAULT_ORDER;m(this,e),this.isEuler=!0,this._x=t,this._y=r,this._z=i,this._order=n}return v(e,[{key:"x",get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},{key:"order",get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}},{key:"set",value:function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._order;return this._x=e,this._y=t,this._z=r,this._order=i,this._onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._order)}},{key:"copy",value:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=e.elements,n=i[0],a=i[4],s=i[8],o=i[1],l=i[5],u=i[9],c=i[2],h=i[6],d=i[10];switch(t){case"XYZ":this._y=Math.asin(L(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-u,d),this._z=Math.atan2(-a,n)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-L(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(s,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-c,n),this._z=0);break;case"ZXY":this._x=Math.asin(L(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-c,d),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(o,n));break;case"ZYX":this._y=Math.asin(-L(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(o,n)):(this._x=0,this._z=Math.atan2(-a,l));break;case"YZX":this._z=Math.asin(L(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-c,n)):(this._x=0,this._y=Math.atan2(s,d));break;case"XZY":this._z=Math.asin(-L(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(s,n)):(this._x=Math.atan2(-u,d),this._y=0);break;default:P("Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===r&&this._onChangeCallback(),this}},{key:"setFromQuaternion",value:function(e,t,r){return _e.makeRotationFromQuaternion(e),this.setFromRotationMatrix(_e,t,r)}},{key:"setFromVector3",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order;return this.set(e.x,e.y,e.z,t)}},{key:"reorder",value:function(e){return me.setFromEuler(this),this.setFromQuaternion(me,e)}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}},{key:"fromArray",value:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}},{key:"_onChange",value:function(e){return this._onChangeCallback=e,this}},{key:"_onChangeCallback",value:function(){}},{key:Symbol.iterator,value:regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._x;case 2:return e.next=4,this._y;case 4:return e.next=6,this._z;case 6:return e.next=8,this._order;case 8:case"end":return e.stop()}}),e,this)}))}]),e}();ge.DEFAULT_ORDER="XYZ";var ve=function(){function e(){m(this,e),this.mask=1}return v(e,[{key:"set",value:function(e){this.mask=(1<<e|0)>>>0}},{key:"enable",value:function(e){this.mask|=1<<e|0}},{key:"enableAll",value:function(){this.mask=-1}},{key:"toggle",value:function(e){this.mask^=1<<e|0}},{key:"disable",value:function(e){this.mask&=~(1<<e|0)}},{key:"disableAll",value:function(){this.mask=0}},{key:"test",value:function(e){return 0!=(this.mask&e.mask)}},{key:"isEnabled",value:function(e){return 0!=(this.mask&(1<<e|0))}}]),e}(),ye=0,be=new z,Te=new Z,ke=new oe,Me=new z,xe=new z,Se=new z,Ae=new Z,Ee=new z(1,0,0),Re=new z(0,1,0),we=new z(0,0,1),Ce={type:"added"},Pe={type:"removed"},De={type:"childadded",child:null},Ie={type:"childremoved",child:null},Fe=function(e){l(r,e);var t=c(r);function r(){var e;m(this,r),(e=t.call(this)).isObject3D=!0,Object.defineProperty(d(e),"id",{value:ye++}),e.uuid=V(),e.name="",e.type="Object3D",e.parent=null,e.children=[],e.up=r.DEFAULT_UP.clone();var i=new z,n=new ge,a=new Z,s=new z(1,1,1);return n._onChange((function(){a.setFromEuler(n,!1)})),a._onChange((function(){n.setFromQuaternion(a,void 0,!1)})),Object.defineProperties(d(e),{position:{configurable:!0,enumerable:!0,value:i},rotation:{configurable:!0,enumerable:!0,value:n},quaternion:{configurable:!0,enumerable:!0,value:a},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new oe},normalMatrix:{value:new j}}),e.matrix=new oe,e.matrixWorld=new oe,e.matrixAutoUpdate=r.DEFAULT_MATRIX_AUTO_UPDATE,e.matrixWorldAutoUpdate=r.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,e.matrixWorldNeedsUpdate=!1,e.layers=new ve,e.visible=!0,e.castShadow=!1,e.receiveShadow=!1,e.frustumCulled=!0,e.renderOrder=0,e.animations=[],e.customDepthMaterial=void 0,e.customDistanceMaterial=void 0,e.userData={},e}return v(r,[{key:"onBeforeShadow",value:function(){}},{key:"onAfterShadow",value:function(){}},{key:"onBeforeRender",value:function(){}},{key:"onAfterRender",value:function(){}},{key:"applyMatrix4",value:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}},{key:"applyQuaternion",value:function(e){return this.quaternion.premultiply(e),this}},{key:"setRotationFromAxisAngle",value:function(e,t){this.quaternion.setFromAxisAngle(e,t)}},{key:"setRotationFromEuler",value:function(e){this.quaternion.setFromEuler(e,!0)}},{key:"setRotationFromMatrix",value:function(e){this.quaternion.setFromRotationMatrix(e)}},{key:"setRotationFromQuaternion",value:function(e){this.quaternion.copy(e)}},{key:"rotateOnAxis",value:function(e,t){return Te.setFromAxisAngle(e,t),this.quaternion.multiply(Te),this}},{key:"rotateOnWorldAxis",value:function(e,t){return Te.setFromAxisAngle(e,t),this.quaternion.premultiply(Te),this}},{key:"rotateX",value:function(e){return this.rotateOnAxis(Ee,e)}},{key:"rotateY",value:function(e){return this.rotateOnAxis(Re,e)}},{key:"rotateZ",value:function(e){return this.rotateOnAxis(we,e)}},{key:"translateOnAxis",value:function(e,t){return be.copy(e).applyQuaternion(this.quaternion),this.position.add(be.multiplyScalar(t)),this}},{key:"translateX",value:function(e){return this.translateOnAxis(Ee,e)}},{key:"translateY",value:function(e){return this.translateOnAxis(Re,e)}},{key:"translateZ",value:function(e){return this.translateOnAxis(we,e)}},{key:"localToWorld",value:function(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}},{key:"worldToLocal",value:function(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(ke.copy(this.matrixWorld).invert())}},{key:"lookAt",value:function(e,t,r){e.isVector3?Me.copy(e):Me.set(e,t,r);var i=this.parent;this.updateWorldMatrix(!0,!1),xe.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ke.lookAt(xe,Me,this.up):ke.lookAt(Me,xe,this.up),this.quaternion.setFromRotationMatrix(ke),i&&(ke.extractRotation(i.matrixWorld),Te.setFromRotationMatrix(ke),this.quaternion.premultiply(Te.invert()))}},{key:"add",value:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(D("Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(Ce),De.child=e,this.dispatchEvent(De),De.child=null):D("Object3D.add: object not an instance of THREE.Object3D.",e),this)}},{key:"remove",value:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var r=this.children.indexOf(e);return-1!==r&&(e.parent=null,this.children.splice(r,1),e.dispatchEvent(Pe),Ie.child=e,this.dispatchEvent(Ie),Ie.child=null),this}},{key:"removeFromParent",value:function(){var e=this.parent;return null!==e&&e.remove(this),this}},{key:"clear",value:function(){return this.remove.apply(this,s(this.children))}},{key:"attach",value:function(e){return this.updateWorldMatrix(!0,!1),ke.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),ke.multiply(e.parent.matrixWorld)),e.applyMatrix4(ke),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(Ce),De.child=e,this.dispatchEvent(De),De.child=null,this}},{key:"getObjectById",value:function(e){return this.getObjectByProperty("id",e)}},{key:"getObjectByName",value:function(e){return this.getObjectByProperty("name",e)}},{key:"getObjectByProperty",value:function(e,t){if(this[e]===t)return this;for(var r=0,i=this.children.length;r<i;r++){var n=this.children[r].getObjectByProperty(e,t);if(void 0!==n)return n}}},{key:"getObjectsByProperty",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];this[e]===t&&r.push(this);for(var i=this.children,n=0,a=i.length;n<a;n++)i[n].getObjectsByProperty(e,t,r);return r}},{key:"getWorldPosition",value:function(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}},{key:"getWorldQuaternion",value:function(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(xe,e,Se),e}},{key:"getWorldScale",value:function(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(xe,Ae,e),e}},{key:"getWorldDirection",value:function(e){this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}},{key:"raycast",value:function(){}},{key:"traverse",value:function(e){e(this);for(var t=this.children,r=0,i=t.length;r<i;r++)t[r].traverse(e)}},{key:"traverseVisible",value:function(e){if(!1!==this.visible){e(this);for(var t=this.children,r=0,i=t.length;r<i;r++)t[r].traverseVisible(e)}}},{key:"traverseAncestors",value:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}},{key:"updateMatrix",value:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}},{key:"updateMatrixWorld",value:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,r=0,i=t.length;r<i;r++)t[r].updateMatrixWorld(e)}},{key:"updateWorldMatrix",value:function(e,t){var r=this.parent;if(!0===e&&null!==r&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===t)for(var i=this.children,n=0,a=i.length;n<a;n++)i[n].updateWorldMatrix(!1,!0)}},{key:"toJSON",value:function(e){var t=void 0===e||"string"==typeof e,r={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});var i={};function n(t,r){return void 0===t[r.uuid]&&(t[r.uuid]=r.toJSON(e)),r.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.geometryInfo=this._geometryInfo.map((function(e){return a(a({},e),{},{boundingBox:e.boundingBox?e.boundingBox.toJSON():void 0,boundingSphere:e.boundingSphere?e.boundingSphere.toJSON():void 0})})),i.instanceInfo=this._instanceInfo.map((function(e){return a({},e)})),i.availableInstanceIds=this._availableInstanceIds.slice(),i.availableGeometryIds=this._availableGeometryIds.slice(),i.nextIndexStart=this._nextIndexStart,i.nextVertexStart=this._nextVertexStart,i.geometryCount=this._geometryCount,i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.matricesTexture=this._matricesTexture.toJSON(e),i.indirectTexture=this._indirectTexture.toJSON(e),null!==this._colorsTexture&&(i.colorsTexture=this._colorsTexture.toJSON(e)),null!==this.boundingSphere&&(i.boundingSphere=this.boundingSphere.toJSON()),null!==this.boundingBox&&(i.boundingBox=this.boundingBox.toJSON())),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=n(e.geometries,this.geometry);var s=this.geometry.parameters;if(void 0!==s&&void 0!==s.shapes){var o=s.shapes;if(Array.isArray(o))for(var l=0,u=o.length;l<u;l++){var c=o[l];n(e.shapes,c)}else n(e.shapes,o)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(n(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){for(var h=[],d=0,f=this.material.length;d<f;d++)h.push(n(e.materials,this.material[d]));i.material=h}else i.material=n(e.materials,this.material);if(this.children.length>0){i.children=[];for(var p=0;p<this.children.length;p++)i.children.push(this.children[p].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(var _=0;_<this.animations.length;_++){var m=this.animations[_];i.animations.push(n(e.animations,m))}}if(t){var g=S(e.geometries),v=S(e.materials),y=S(e.textures),b=S(e.images),T=S(e.shapes),k=S(e.skeletons),M=S(e.animations),x=S(e.nodes);g.length>0&&(r.geometries=g),v.length>0&&(r.materials=v),y.length>0&&(r.textures=y),b.length>0&&(r.images=b),T.length>0&&(r.shapes=T),k.length>0&&(r.skeletons=k),M.length>0&&(r.animations=M),x.length>0&&(r.nodes=x)}return r.object=i,r;function S(e){var t=[];for(var r in e){var i=e[r];delete i.metadata,t.push(i)}return t}}},{key:"clone",value:function(e){return(new this.constructor).copy(this,e)}},{key:"copy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var r=0;r<e.children.length;r++){var i=e.children[r];this.add(i.clone())}return this}}]),r}(F);Fe.DEFAULT_UP=new z(0,1,0),Fe.DEFAULT_MATRIX_AUTO_UPDATE=!0,Fe.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;var Oe={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ve={h:0,s:0,l:0},Le={h:0,s:0,l:0};function Ne(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+6*(t-e)*(2/3-r):e}var Be=function(){function e(t,r,i){return m(this,e),this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,r,i)}return v(e,[{key:"set",value:function(e,t,r){if(void 0===t&&void 0===r){var i=e;i&&i.isColor?this.copy(i):"number"==typeof i?this.setHex(i):"string"==typeof i&&this.setStyle(i)}else this.setRGB(e,t,r);return this}},{key:"setScalar",value:function(e){return this.r=e,this.g=e,this.b=e,this}},{key:"setHex",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:M;return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,J.colorSpaceToWorking(this,t),this}},{key:"setRGB",value:function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:J.workingColorSpace;return this.r=e,this.g=t,this.b=r,J.colorSpaceToWorking(this,i),this}},{key:"setHSL",value:function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:J.workingColorSpace;if(e=N(e,1),t=L(t,0,1),r=L(r,0,1),0===t)this.r=this.g=this.b=r;else{var n=r<=.5?r*(1+t):r+t-r*t,a=2*r-n;this.r=Ne(a,n,e+1/3),this.g=Ne(a,n,e),this.b=Ne(a,n,e-1/3)}return J.colorSpaceToWorking(this,i),this}},{key:"setStyle",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:M;function i(t){void 0!==t&&parseFloat(t)<1&&P("Color: Alpha component of "+e+" will be ignored.")}if(t=/^(\w+)\(([^\)]*)\)/.exec(e)){var n,a=t[1],s=t[2];switch(a){case"rgb":case"rgba":if(n=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return i(n[4]),this.setRGB(Math.min(255,parseInt(n[1],10))/255,Math.min(255,parseInt(n[2],10))/255,Math.min(255,parseInt(n[3],10))/255,r);if(n=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return i(n[4]),this.setRGB(Math.min(100,parseInt(n[1],10))/100,Math.min(100,parseInt(n[2],10))/100,Math.min(100,parseInt(n[3],10))/100,r);break;case"hsl":case"hsla":if(n=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return i(n[4]),this.setHSL(parseFloat(n[1])/360,parseFloat(n[2])/100,parseFloat(n[3])/100,r);break;default:P("Color: Unknown color model "+e)}}else if(t=/^\#([A-Fa-f\d]+)$/.exec(e)){var o=t[1],l=o.length;if(3===l)return this.setRGB(parseInt(o.charAt(0),16)/15,parseInt(o.charAt(1),16)/15,parseInt(o.charAt(2),16)/15,r);if(6===l)return this.setHex(parseInt(o,16),r);P("Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,r);return this}},{key:"setColorName",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:M,r=Oe[e.toLowerCase()];return void 0!==r?this.setHex(r,t):P("Color: Unknown color "+e),this}},{key:"clone",value:function(){return new this.constructor(this.r,this.g,this.b)}},{key:"copy",value:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}},{key:"copySRGBToLinear",value:function(e){return this.r=Q(e.r),this.g=Q(e.g),this.b=Q(e.b),this}},{key:"copyLinearToSRGB",value:function(e){return this.r=$(e.r),this.g=$(e.g),this.b=$(e.b),this}},{key:"convertSRGBToLinear",value:function(){return this.copySRGBToLinear(this),this}},{key:"convertLinearToSRGB",value:function(){return this.copyLinearToSRGB(this),this}},{key:"getHex",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M;return J.workingToColorSpace(Ue.copy(this),e),65536*Math.round(L(255*Ue.r,0,255))+256*Math.round(L(255*Ue.g,0,255))+Math.round(L(255*Ue.b,0,255))}},{key:"getHexString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M;return("000000"+this.getHex(e).toString(16)).slice(-6)}},{key:"getHSL",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:J.workingColorSpace;J.workingToColorSpace(Ue.copy(this),t);var r,i,n=Ue.r,a=Ue.g,s=Ue.b,o=Math.max(n,a,s),l=Math.min(n,a,s),u=(l+o)/2;if(l===o)r=0,i=0;else{var c=o-l;switch(i=u<=.5?c/(o+l):c/(2-o-l),o){case n:r=(a-s)/c+(a<s?6:0);break;case a:r=(s-n)/c+2;break;case s:r=(n-a)/c+4}r/=6}return e.h=r,e.s=i,e.l=u,e}},{key:"getRGB",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:J.workingColorSpace;return J.workingToColorSpace(Ue.copy(this),t),e.r=Ue.r,e.g=Ue.g,e.b=Ue.b,e}},{key:"getStyle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M;J.workingToColorSpace(Ue.copy(this),e);var t=Ue.r,r=Ue.g,i=Ue.b;return e!==M?"color(".concat(e," ").concat(t.toFixed(3)," ").concat(r.toFixed(3)," ").concat(i.toFixed(3),")"):"rgb(".concat(Math.round(255*t),",").concat(Math.round(255*r),",").concat(Math.round(255*i),")")}},{key:"offsetHSL",value:function(e,t,r){return this.getHSL(Ve),this.setHSL(Ve.h+e,Ve.s+t,Ve.l+r)}},{key:"add",value:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}},{key:"addColors",value:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}},{key:"addScalar",value:function(e){return this.r+=e,this.g+=e,this.b+=e,this}},{key:"sub",value:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}},{key:"multiply",value:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}},{key:"multiplyScalar",value:function(e){return this.r*=e,this.g*=e,this.b*=e,this}},{key:"lerp",value:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}},{key:"lerpColors",value:function(e,t,r){return this.r=e.r+(t.r-e.r)*r,this.g=e.g+(t.g-e.g)*r,this.b=e.b+(t.b-e.b)*r,this}},{key:"lerpHSL",value:function(e,t){this.getHSL(Ve),e.getHSL(Le);var r=B(Ve.h,Le.h,t),i=B(Ve.s,Le.s,t),n=B(Ve.l,Le.l,t);return this.setHSL(r,i,n),this}},{key:"setFromVector3",value:function(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}},{key:"applyMatrix3",value:function(e){var t=this.r,r=this.g,i=this.b,n=e.elements;return this.r=n[0]*t+n[3]*r+n[6]*i,this.g=n[1]*t+n[4]*r+n[7]*i,this.b=n[2]*t+n[5]*r+n[8]*i,this}},{key:"equals",value:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}},{key:"fromBufferAttribute",value:function(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}},{key:"toJSON",value:function(){return this.getHex()}},{key:Symbol.iterator,value:regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.r;case 2:return e.next=4,this.g;case 4:return e.next=6,this.b;case 6:case"end":return e.stop()}}),e,this)}))}]),e}(),Ue=new Be;function Ze(e,t){return e&&e.constructor!==t?"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e):e}Be.NAMES=Oe;var ze=function(){function e(t,r,i,n){m(this,e),this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new r.constructor(i),this.sampleValues=r,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}return v(e,[{key:"evaluate",value:function(e){var t=this.parameterPositions,r=this._cachedIndex,i=t[r],n=t[r-1];e:{t:{var a;r:{i:if(!(e<i)){for(var s=r+2;;){if(void 0===i){if(e<n)break i;return r=t.length,this._cachedIndex=r,this.copySampleValue_(r-1)}if(r===s)break;if(n=i,e<(i=t[++r]))break t}a=t.length;break r}if(e>=n)break e;var o=t[1];e<o&&(r=2,n=o);for(var l=r-2;;){if(void 0===n)return this._cachedIndex=0,this.copySampleValue_(0);if(r===l)break;if(i=n,e>=(n=t[--r-1]))break t}a=r,r=0}for(;r<a;){var u=r+a>>>1;e<t[u]?a=u:r=u+1}if(i=t[r],void 0===(n=t[r-1]))return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===i)return r=t.length,this._cachedIndex=r,this.copySampleValue_(r-1)}this._cachedIndex=r,this.intervalChanged_(r,n,i)}return this.interpolate_(r,n,e,i)}},{key:"getSettings_",value:function(){return this.settings||this.DefaultSettings_}},{key:"copySampleValue_",value:function(e){for(var t=this.resultBuffer,r=this.sampleValues,i=this.valueSize,n=e*i,a=0;a!==i;++a)t[a]=r[n+a];return t}},{key:"interpolate_",value:function(){throw new Error("call to abstract method")}},{key:"intervalChanged_",value:function(){}}]),e}(),Ge=function(e){l(r,e);var t=c(r);function r(e,i,n,a){var s;return m(this,r),(s=t.call(this,e,i,n,a))._weightPrev=-0,s._offsetPrev=-0,s._weightNext=-0,s._offsetNext=-0,s.DefaultSettings_={endingStart:2400,endingEnd:2400},s}return v(r,[{key:"intervalChanged_",value:function(e,t,r){var i=this.parameterPositions,n=e-2,a=e+1,s=i[n],o=i[a];if(void 0===s)switch(this.getSettings_().endingStart){case 2401:n=e,s=2*t-r;break;case 2402:s=t+i[n=i.length-2]-i[n+1];break;default:n=e,s=r}if(void 0===o)switch(this.getSettings_().endingEnd){case 2401:a=e,o=2*r-t;break;case 2402:a=1,o=r+i[1]-i[0];break;default:a=e-1,o=t}var l=.5*(r-t),u=this.valueSize;this._weightPrev=l/(t-s),this._weightNext=l/(o-r),this._offsetPrev=n*u,this._offsetNext=a*u}},{key:"interpolate_",value:function(e,t,r,i){for(var n=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=e*s,l=o-s,u=this._offsetPrev,c=this._offsetNext,h=this._weightPrev,d=this._weightNext,f=(r-t)/(i-t),p=f*f,_=p*f,m=-h*_+2*h*p-h*f,g=(1+h)*_+(-1.5-2*h)*p+(-.5+h)*f+1,v=(-1-d)*_+(1.5+d)*p+.5*f,y=d*_-d*p,b=0;b!==s;++b)n[b]=m*a[u+b]+g*a[l+b]+v*a[o+b]+y*a[c+b];return n}}]),r}(ze),We=function(e){l(r,e);var t=c(r);function r(e,i,n,a){return m(this,r),t.call(this,e,i,n,a)}return v(r,[{key:"interpolate_",value:function(e,t,r,i){for(var n=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=e*s,l=o-s,u=(r-t)/(i-t),c=1-u,h=0;h!==s;++h)n[h]=a[l+h]*c+a[o+h]*u;return n}}]),r}(ze),je=function(e){l(r,e);var t=c(r);function r(e,i,n,a){return m(this,r),t.call(this,e,i,n,a)}return v(r,[{key:"interpolate_",value:function(e){return this.copySampleValue_(e-1)}}]),r}(ze),Xe=function(){function e(t,r,i,n){if(m(this,e),void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===r||0===r.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Ze(r,this.TimeBufferType),this.values=Ze(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}return v(e,[{key:"InterpolantFactoryMethodDiscrete",value:function(e){return new je(this.times,this.values,this.getValueSize(),e)}},{key:"InterpolantFactoryMethodLinear",value:function(e){return new We(this.times,this.values,this.getValueSize(),e)}},{key:"InterpolantFactoryMethodSmooth",value:function(e){return new Ge(this.times,this.values,this.getValueSize(),e)}},{key:"setInterpolation",value:function(e){var t;switch(e){case b:t=this.InterpolantFactoryMethodDiscrete;break;case T:t=this.InterpolantFactoryMethodLinear;break;case k:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(r);this.setInterpolation(this.DefaultInterpolation)}return P("KeyframeTrack:",r),this}return this.createInterpolant=t,this}},{key:"getInterpolation",value:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return b;case this.InterpolantFactoryMethodLinear:return T;case this.InterpolantFactoryMethodSmooth:return k}}},{key:"getValueSize",value:function(){return this.values.length/this.times.length}},{key:"shift",value:function(e){if(0!==e)for(var t=this.times,r=0,i=t.length;r!==i;++r)t[r]+=e;return this}},{key:"scale",value:function(e){if(1!==e)for(var t=this.times,r=0,i=t.length;r!==i;++r)t[r]*=e;return this}},{key:"trim",value:function(e,t){for(var r=this.times,i=r.length,n=0,a=i-1;n!==i&&r[n]<e;)++n;for(;-1!==a&&r[a]>t;)--a;if(++a,0!==n||a!==i){n>=a&&(n=(a=Math.max(a,1))-1);var s=this.getValueSize();this.times=r.slice(n,a),this.values=this.values.slice(n*s,a*s)}return this}},{key:"validate",value:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(D("KeyframeTrack: Invalid value size in track.",this),e=!1);var r,i=this.times,n=this.values,a=i.length;0===a&&(D("KeyframeTrack: Track is empty.",this),e=!1);for(var s=null,o=0;o!==a;o++){var l=i[o];if("number"==typeof l&&isNaN(l)){D("KeyframeTrack: Time is not a valid number.",this,o,l),e=!1;break}if(null!==s&&s>l){D("KeyframeTrack: Out of order keys.",this,o,l,s),e=!1;break}s=l}if(void 0!==n&&(r=n,ArrayBuffer.isView(r)&&!(r instanceof DataView)))for(var u=0,c=n.length;u!==c;++u){var h=n[u];if(isNaN(h)){D("KeyframeTrack: Value is not a valid number.",this,u,h),e=!1;break}}return e}},{key:"optimize",value:function(){for(var e=this.times.slice(),t=this.values.slice(),r=this.getValueSize(),i=this.getInterpolation()===k,n=e.length-1,a=1,s=1;s<n;++s){var o=!1,l=e[s];if(l!==e[s+1]&&(1!==s||l!==e[0]))if(i)o=!0;else for(var u=s*r,c=u-r,h=u+r,d=0;d!==r;++d){var f=t[u+d];if(f!==t[c+d]||f!==t[h+d]){o=!0;break}}if(o){if(s!==a){e[a]=e[s];for(var p=s*r,_=a*r,m=0;m!==r;++m)t[_+m]=t[p+m]}++a}}if(n>0){e[a]=e[n];for(var g=n*r,v=a*r,y=0;y!==r;++y)t[v+y]=t[g+y];++a}return a!==e.length?(this.times=e.slice(0,a),this.values=t.slice(0,a*r)):(this.times=e,this.values=t),this}},{key:"clone",value:function(){var e=this.times.slice(),t=this.values.slice(),r=new(0,this.constructor)(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}}],[{key:"toJSON",value:function(e){var t,r=e.constructor;if(r.toJSON!==this.toJSON)t=r.toJSON(e);else{t={name:e.name,times:Ze(e.times,Array),values:Ze(e.values,Array)};var i=e.getInterpolation();i!==e.DefaultInterpolation&&(t.interpolation=i)}return t.type=e.ValueTypeName,t}}]),e}();Xe.prototype.ValueTypeName="",Xe.prototype.TimeBufferType=Float32Array,Xe.prototype.ValueBufferType=Float32Array,Xe.prototype.DefaultInterpolation=T;var He=function(e){l(r,e);var t=c(r);function r(e,i,n){return m(this,r),t.call(this,e,i,n)}return r}(Xe);He.prototype.ValueTypeName="bool",He.prototype.ValueBufferType=Array,He.prototype.DefaultInterpolation=b,He.prototype.InterpolantFactoryMethodLinear=void 0,He.prototype.InterpolantFactoryMethodSmooth=void 0,function(e){l(r,e);var t=c(r);function r(e,i,n,a){return m(this,r),t.call(this,e,i,n,a)}return r}(Xe).prototype.ValueTypeName="color",function(e){l(r,e);var t=c(r);function r(e,i,n,a){return m(this,r),t.call(this,e,i,n,a)}return r}(Xe).prototype.ValueTypeName="number";var Ye=function(e){l(r,e);var t=c(r);function r(e,i,n,a){return m(this,r),t.call(this,e,i,n,a)}return v(r,[{key:"interpolate_",value:function(e,t,r,i){for(var n=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=(r-t)/(i-t),l=e*s,u=l+s;l!==u;l+=4)Z.slerpFlat(n,0,a,l-s,a,l,o);return n}}]),r}(ze),Ke=function(e){l(r,e);var t=c(r);function r(e,i,n,a){return m(this,r),t.call(this,e,i,n,a)}return v(r,[{key:"InterpolantFactoryMethodLinear",value:function(e){return new Ye(this.times,this.values,this.getValueSize(),e)}}]),r}(Xe);Ke.prototype.ValueTypeName="quaternion",Ke.prototype.InterpolantFactoryMethodSmooth=void 0;var qe=function(e){l(r,e);var t=c(r);function r(e,i,n){return m(this,r),t.call(this,e,i,n)}return r}(Xe);qe.prototype.ValueTypeName="string",qe.prototype.ValueBufferType=Array,qe.prototype.DefaultInterpolation=b,qe.prototype.InterpolantFactoryMethodLinear=void 0,qe.prototype.InterpolantFactoryMethodSmooth=void 0,function(e){l(r,e);var t=c(r);function r(e,i,n,a){return m(this,r),t.call(this,e,i,n,a)}return r}(Xe).prototype.ValueTypeName="vector";var Je=new(function(){function e(t,r,i){m(this,e);var n=this,a=!1,s=0,o=0,l=void 0,u=[];this.onStart=void 0,this.onLoad=t,this.onProgress=r,this.onError=i,this._abortController=null,this.itemStart=function(e){o++,!1===a&&void 0!==n.onStart&&n.onStart(e,s,o),a=!0},this.itemEnd=function(e){s++,void 0!==n.onProgress&&n.onProgress(e,s,o),s===o&&(a=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(e){void 0!==n.onError&&n.onError(e)},this.resolveURL=function(e){return l?l(e):e},this.setURLModifier=function(e){return l=e,this},this.addHandler=function(e,t){return u.push(e,t),this},this.removeHandler=function(e){var t=u.indexOf(e);return-1!==t&&u.splice(t,2),this},this.getHandler=function(e){for(var t=0,r=u.length;t<r;t+=2){var i=u[t],n=u[t+1];if(i.global&&(i.lastIndex=0),i.test(e))return n}return null},this.abort=function(){return this.abortController.abort(),this._abortController=null,this}}return v(e,[{key:"abortController",get:function(){return this._abortController||(this._abortController=new AbortController),this._abortController}}]),e}());(function(){function e(t){m(this,e),this.manager=void 0!==t?t:Je,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}return v(e,[{key:"load",value:function(){}},{key:"loadAsync",value:function(e,t){var r=this;return new Promise((function(i,n){r.load(e,i,t,n)}))}},{key:"parse",value:function(){}},{key:"setCrossOrigin",value:function(e){return this.crossOrigin=e,this}},{key:"setWithCredentials",value:function(e){return this.withCredentials=e,this}},{key:"setPath",value:function(e){return this.path=e,this}},{key:"setResourcePath",value:function(e){return this.resourcePath=e,this}},{key:"setRequestHeader",value:function(e){return this.requestHeader=e,this}},{key:"abort",value:function(){return this}}]),e}()).DEFAULT_MATERIAL_NAME="__DEFAULT",Error,new WeakMap,new WeakMap;var Qe=new RegExp("[\\[\\]\\.:\\/]","g"),$e="[^\\[\\]\\.:\\/]",et="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",tt=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",$e)+/(WCOD+)?/.source.replace("WCOD",et)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",$e)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",$e)+"$"),rt=["material","materials","bones","map"],it=function(){function e(t,r,i){m(this,e);var n=i||nt.parseTrackName(r);this._targetGroup=t,this._bindings=t.subscribe_(r,n)}return v(e,[{key:"getValue",value:function(e,t){this.bind();var r=this._targetGroup.nCachedObjects_,i=this._bindings[r];void 0!==i&&i.getValue(e,t)}},{key:"setValue",value:function(e,t){for(var r=this._bindings,i=this._targetGroup.nCachedObjects_,n=r.length;i!==n;++i)r[i].setValue(e,t)}},{key:"bind",value:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].bind()}},{key:"unbind",value:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].unbind()}}]),e}(),nt=function(){function e(t,r,i){m(this,e),this.path=r,this.parsedPath=i||e.parseTrackName(r),this.node=e.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}return v(e,[{key:"_getValue_unavailable",value:function(){}},{key:"_setValue_unavailable",value:function(){}},{key:"_getValue_direct",value:function(e,t){e[t]=this.targetObject[this.propertyName]}},{key:"_getValue_array",value:function(e,t){for(var r=this.resolvedProperty,i=0,n=r.length;i!==n;++i)e[t++]=r[i]}},{key:"_getValue_arrayElement",value:function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}},{key:"_getValue_toArray",value:function(e,t){this.resolvedProperty.toArray(e,t)}},{key:"_setValue_direct",value:function(e,t){this.targetObject[this.propertyName]=e[t]}},{key:"_setValue_direct_setNeedsUpdate",value:function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}},{key:"_setValue_direct_setMatrixWorldNeedsUpdate",value:function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_array",value:function(e,t){for(var r=this.resolvedProperty,i=0,n=r.length;i!==n;++i)r[i]=e[t++]}},{key:"_setValue_array_setNeedsUpdate",value:function(e,t){for(var r=this.resolvedProperty,i=0,n=r.length;i!==n;++i)r[i]=e[t++];this.targetObject.needsUpdate=!0}},{key:"_setValue_array_setMatrixWorldNeedsUpdate",value:function(e,t){for(var r=this.resolvedProperty,i=0,n=r.length;i!==n;++i)r[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_arrayElement",value:function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}},{key:"_setValue_arrayElement_setNeedsUpdate",value:function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}},{key:"_setValue_arrayElement_setMatrixWorldNeedsUpdate",value:function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_fromArray",value:function(e,t){this.resolvedProperty.fromArray(e,t)}},{key:"_setValue_fromArray_setNeedsUpdate",value:function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}},{key:"_setValue_fromArray_setMatrixWorldNeedsUpdate",value:function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_getValue_unbound",value:function(e,t){this.bind(),this.getValue(e,t)}},{key:"_setValue_unbound",value:function(e,t){this.bind(),this.setValue(e,t)}},{key:"bind",value:function(){var t=this.node,r=this.parsedPath,i=r.objectName,n=r.propertyName,a=r.propertyIndex;if(t||(t=e.findNode(this.rootNode,r.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,t){if(i){var s=r.objectIndex;switch(i){case"materials":if(!t.material)return void D("PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void D("PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void D("PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(var o=0;o<t.length;o++)if(t[o].name===s){s=o;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material)return void D("PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.map)return void D("PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);t=t.material.map;break;default:if(void 0===t[i])return void D("PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[i]}if(void 0!==s){if(void 0===t[s])return void D("PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[s]}}var l=t[n];if(void 0!==l){var u=this.Versioning.None;this.targetObject=t,!0===t.isMaterial?u=this.Versioning.NeedsUpdate:!0===t.isObject3D&&(u=this.Versioning.MatrixWorldNeedsUpdate);var c=this.BindingType.Direct;if(void 0!==a){if("morphTargetInfluences"===n){if(!t.geometry)return void D("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void D("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[a]&&(a=t.morphTargetDictionary[a])}c=this.BindingType.ArrayElement,this.resolvedProperty=l,this.propertyIndex=a}else void 0!==l.fromArray&&void 0!==l.toArray?(c=this.BindingType.HasFromToArray,this.resolvedProperty=l):Array.isArray(l)?(c=this.BindingType.EntireArray,this.resolvedProperty=l):this.propertyName=n;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][u]}else D("PropertyBinding: Trying to update property for track: "+r.nodeName+"."+n+" but it wasn't found.",t)}else P("PropertyBinding: No target node found for track: "+this.path+".")}},{key:"unbind",value:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}],[{key:"create",value:function(t,r,i){return t&&t.isAnimationObjectGroup?new e.Composite(t,r,i):new e(t,r,i)}},{key:"sanitizeNodeName",value:function(e){return e.replace(/\s/g,"_").replace(Qe,"")}},{key:"parseTrackName",value:function(e){var t=tt.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var r={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){var n=r.nodeName.substring(i+1);-1!==rt.indexOf(n)&&(r.nodeName=r.nodeName.substring(0,i),r.objectName=n)}if(null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r}},{key:"findNode",value:function(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var r=e.skeleton.getBoneByName(t);if(void 0!==r)return r}if(e.children){var i=function e(r){for(var i=0;i<r.length;i++){var n=r[i];if(n.name===t||n.uuid===t)return n;var a=e(n.children);if(a)return a}return null}(e.children);if(i)return i}return null}}]),e}();nt.Composite=it,nt.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},nt.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},nt.prototype.GetterByBindingType=[nt.prototype._getValue_direct,nt.prototype._getValue_array,nt.prototype._getValue_arrayElement,nt.prototype._getValue_toArray],nt.prototype.SetterByBindingTypeAndVersioning=[[nt.prototype._setValue_direct,nt.prototype._setValue_direct_setNeedsUpdate,nt.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[nt.prototype._setValue_array,nt.prototype._setValue_array_setNeedsUpdate,nt.prototype._setValue_array_setMatrixWorldNeedsUpdate],[nt.prototype._setValue_arrayElement,nt.prototype._setValue_arrayElement_setNeedsUpdate,nt.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[nt.prototype._setValue_fromArray,nt.prototype._setValue_fromArray_setNeedsUpdate,nt.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]],new Float32Array(1),"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"182"}})),"undefined"!=typeof window&&(window.__THREE__?P("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="182")},88:(module,exports,__webpack_require__)=>{var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__,factory;function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}module=__webpack_require__.nmd(module),window,factory=function(){return function(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===_typeof(e)&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s="./src/yagui.js")}({"./src/GuiMain.js":function srcGuiMainJs(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var containers_Sidebar__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! containers/Sidebar */ \"./src/containers/Sidebar.js\");\n/* harmony import */ var containers_Topbar__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! containers/Topbar */ \"./src/containers/Topbar.js\");\n\n\n\nclass GuiMain {\n\n  constructor(viewport, callbackResize) {\n    this.domMain = document.createElement('div');\n    this.viewport = viewport;\n\n    this.callbackResize = callbackResize;\n    if (this.viewport) {\n      this.viewport.style.width = document.documentElement.clientWidth + 'px';\n      this.viewport.style.height = document.documentElement.clientHeight + 'px';\n    }\n    this.cbResize_ = this._onWindowResize.bind(this);\n\n    document.body.appendChild(this.domMain);\n    this.leftSidebar = undefined;\n    this.rightSidebar = undefined;\n    this.topbar = undefined;\n\n    window.addEventListener('resize', this._onWindowResize.bind(this), false);\n  }\n\n  _onWindowResize() {\n    if (this.viewport) {\n      this.viewport.style.width = document.documentElement.clientWidth + 'px';\n      this.viewport.style.height = document.documentElement.clientHeight + 'px';\n      this.viewport.style.left = '0px';\n      this.viewport.style.top = '0px';\n      if (this.leftSidebar)\n        this.leftSidebar._updateViewportPosition(this.viewport);\n      if (this.rightSidebar)\n        this.rightSidebar._updateViewportPosition(this.viewport);\n      if (this.topbar)\n        this.topbar._updateViewportPosition(this.viewport);\n    }\n    this._updateSidebarsPosition();\n    if (this.callbackResize)\n      this.callbackResize();\n  }\n\n  _updateSidebarsPosition() {\n    if (!this.topbar) return;\n    var off = this.topbar.domTopbar.offsetHeight;\n    if (this.leftSidebar)\n      this.leftSidebar._setTop(off);\n    if (this.rightSidebar)\n      this.rightSidebar._setTop(off);\n  }\n\n  addLeftSidebar() {\n    this.leftSidebar = new containers_Sidebar__WEBPACK_IMPORTED_MODULE_0__[\"default\"](this.cbResize_);\n    var domSide = this.leftSidebar.domSidebar;\n    this.domMain.appendChild(domSide);\n    this.domMain.appendChild(this.leftSidebar.domResize);\n\n    this._updateSidebarsPosition();\n    this.leftSidebar._updateViewportPosition(this.viewport);\n    return this.leftSidebar;\n  }\n\n  addRightSidebar() {\n    this.rightSidebar = new containers_Sidebar__WEBPACK_IMPORTED_MODULE_0__[\"default\"](this.cbResize_);\n    var domSide = this.rightSidebar.domSidebar;\n    this.domMain.appendChild(domSide);\n    this.domMain.appendChild(this.rightSidebar.domResize);\n\n    this.rightSidebar._onTheRight();\n    this._updateSidebarsPosition();\n    this.rightSidebar._updateViewportPosition(this.viewport);\n    return this.rightSidebar;\n  }\n\n  addTopbar() {\n    this.topbar = new containers_Topbar__WEBPACK_IMPORTED_MODULE_1__[\"default\"](this.cbResize_);\n    this.domMain.appendChild(this.topbar.domTopbar);\n\n    this._updateSidebarsPosition();\n    this.topbar._updateViewportPosition(this.viewport);\n    return this.topbar;\n  }\n\n  setVisibility(visible) {\n    this.domMain.hidden = !visible;\n    this._onWindowResize();\n  }\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (GuiMain);\n\n\n//# sourceURL=webpack://yagui/./src/GuiMain.js?")},"./src/containers/BaseContainer.js":function srcContainersBaseContainerJs(module,__webpack_exports__,__webpack_require__){"use strict";eval('__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var widgets_Button__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! widgets/Button */ "./src/widgets/Button.js");\n/* harmony import */ var widgets_Checkbox__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! widgets/Checkbox */ "./src/widgets/Checkbox.js");\n/* harmony import */ var widgets_Color__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! widgets/Color */ "./src/widgets/Color.js");\n/* harmony import */ var widgets_Combobox__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! widgets/Combobox */ "./src/widgets/Combobox.js");\n/* harmony import */ var widgets_Slider__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! widgets/Slider */ "./src/widgets/Slider.js");\n/* harmony import */ var widgets_Title__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! widgets/Title */ "./src/widgets/Title.js");\n\n\n\n\n\n\n\n// label : 36%\n// slider : bar 52% + margin 2% + input 10%\n// combobox : 64%\n// color : 64%\nclass BaseContainer {\n\n  constructor() {}\n\n  _addLine(name) {\n    var domLine = document.createElement(\'li\');\n    domLine.innerHTML = name || \'\';\n    this.domUl.appendChild(domLine);\n    return domLine;\n  }\n\n  _createLabel(name) {\n    var domLabel = document.createElement(\'label\');\n    domLabel.className = \'gui-label-side\';\n    domLabel.innerHTML = name || \'\';\n    return domLabel;\n  }\n\n  _setDomContainer(container) {\n    this.domContainer = container;\n  }\n\n  addTitle(name) {\n    var widget = new widgets_Title__WEBPACK_IMPORTED_MODULE_5__["default"](name);\n    this.domUl.appendChild(widget.domText);\n    return widget;\n  }\n\n  addCheckbox(name, valOrObject, callbackOrKey) {\n    var widget = new widgets_Checkbox__WEBPACK_IMPORTED_MODULE_1__["default"](valOrObject, callbackOrKey);\n    var domLine = this._addLine();\n    domLine.className += \' gui-pointerOnHover gui-glowOnHover\';\n    var domLabel = this._createLabel(name);\n    domLabel.style.overflow = \'visible\';\n    domLabel.className += \' gui-pointerOnHover\';\n    domLine.appendChild(domLabel);\n    domLine.appendChild(widget.domCheckbox);\n    domLine.appendChild(widget.domLabelCheckbox);\n    domLine.addEventListener(\'mousedown\', widget._onMouseDown.bind(widget));\n    widget._setDomContainer(domLine);\n    return widget;\n  }\n\n  addCombobox(name, valOrObject, callbackOrKey, options) {\n    var widget = new widgets_Combobox__WEBPACK_IMPORTED_MODULE_3__["default"](valOrObject, callbackOrKey, options);\n    var domLine = this._addLine();\n    if (name) domLine.appendChild(this._createLabel(name));\n    else widget.domSelect.style.width = \'100%\';\n    domLine.appendChild(widget.domSelect);\n    widget._setDomContainer(domLine);\n    return widget;\n  }\n\n  addSlider(name, valOrObject, callbackOrKey, min, max, step) {\n    var widget = new widgets_Slider__WEBPACK_IMPORTED_MODULE_4__["default"](valOrObject, callbackOrKey, min, max, step);\n    var domLine = this._addLine();\n    if (name) domLine.appendChild(this._createLabel(name));\n    domLine.appendChild(widget.domInputText);\n    domLine.appendChild(widget.domSlider);\n    widget._setDomContainer(domLine);\n    return widget;\n  }\n\n  addColor(name, valOrObject, callbackOrKey) {\n    var widget = new widgets_Color__WEBPACK_IMPORTED_MODULE_2__["default"](valOrObject, callbackOrKey);\n    var domLine = this._addLine();\n    if (name) domLine.appendChild(this._createLabel(name));\n    else widget.domColor.style.width = \'100%\';\n    domLine.appendChild(widget.domColor);\n    widget._setDomContainer(domLine);\n    return widget;\n  }\n\n  addButton(name, callbackOrObject, key) {\n    var widget = new widgets_Button__WEBPACK_IMPORTED_MODULE_0__["default"](name, callbackOrObject, key);\n    var domLine = this._addLine();\n    domLine.appendChild(widget.domButton);\n    widget._setDomContainer(domLine);\n    return widget;\n  }\n\n  addDualButton(name1, name2, callbackOrObject1, callbackOrObject2, key1, key2) {\n    var widget1 = new widgets_Button__WEBPACK_IMPORTED_MODULE_0__["default"](name1, callbackOrObject1, key1);\n    var widget2 = new widgets_Button__WEBPACK_IMPORTED_MODULE_0__["default"](name2, callbackOrObject2, key2);\n    var domLine = this._addLine();\n    domLine.appendChild(widget2.domButton);\n    domLine.appendChild(widget1.domButton);\n    var style1 = widget1.domButton.style;\n    var style2 = widget2.domButton.style;\n    style1.width = style2.width = \'49%\';\n    style1.marginRight = style2.marginLeft = \'1%\';\n    widget1._setDomContainer(domLine);\n    widget2._setDomContainer(domLine);\n    return [widget1, widget2];\n  }\n\n  setVisibility(visible) {\n    if (!this.domContainer) return;\n    this.domContainer.hidden = !visible;\n  }\n}\n\n/* harmony default export */ __webpack_exports__["default"] = (BaseContainer);\n\n\n//# sourceURL=webpack://yagui/./src/containers/BaseContainer.js?')},"./src/containers/Folder.js":function srcContainersFolderJs(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var containers_BaseContainer__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! containers/BaseContainer */ \"./src/containers/BaseContainer.js\");\n\n\nclass Folder extends containers_BaseContainer__WEBPACK_IMPORTED_MODULE_0__[\"default\"] {\n\n  constructor(name) {\n    super();\n\n    this.domUl = document.createElement('ul');\n    this.domUl.setAttribute('opened', true);\n\n    var domTitle = document.createElement('label');\n    domTitle.innerHTML = name || '';\n\n    domTitle.addEventListener('mousedown', this._onMouseDown.bind(this));\n\n    this.domUl.appendChild(domTitle);\n    this.isOpen = true;\n  }\n\n  _onMouseDown() {\n    this.isOpen = !this.isOpen;\n    this.domUl.setAttribute('opened', this.isOpen);\n  }\n\n  open() {\n    this.isOpen = true;\n    this.domUl.setAttribute('opened', true);\n  }\n\n  close() {\n    this.isOpen = false;\n    this.domUl.setAttribute('opened', false);\n  }\n\n  setVisibility(visible) {\n    if (!visible) this.domUl.setAttribute('opened', false);\n    else if (this.isOpen) this.domUl.setAttribute('opened', true);\n    this.domUl.style.height = visible ? 'auto' : '0px';\n  }\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Folder);\n\n\n//# sourceURL=webpack://yagui/./src/containers/Folder.js?")},"./src/containers/Menu.js":function srcContainersMenuJs(module,__webpack_exports__,__webpack_require__){"use strict";eval('__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var containers_BaseContainer__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! containers/BaseContainer */ "./src/containers/BaseContainer.js");\n/* harmony import */ var widgets_MenuButton__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! widgets/MenuButton */ "./src/widgets/MenuButton.js");\n\n\n\nclass Menu extends containers_BaseContainer__WEBPACK_IMPORTED_MODULE_0__["default"] {\n\n  constructor() {\n    super();\n\n    this.domUl = document.createElement(\'ul\');\n  }\n\n  addButton(name, callbackOrObject, shortcutOrKey, shortcut) {\n    var widget = new widgets_MenuButton__WEBPACK_IMPORTED_MODULE_1__["default"](callbackOrObject, shortcutOrKey, shortcut);\n    var domLine = this._addLine(name);\n    domLine.appendChild(widget.domSpan);\n    widget._setDomContainer(domLine);\n    return widget;\n  }\n\n  addSlider(name, valOrObject, callbackOrKey, min, max, step) {\n    var wid = super.addSlider(name, valOrObject, callbackOrKey, min, max, step);\n    // label 36% + slider ?% + 2% + input 18%\n    wid.domInputText.style.width = \'18%\';\n    wid.domSlider.style.width = name ? \'44%\' : \'80%\';\n    return wid;\n  }\n}\n\n/* harmony default export */ __webpack_exports__["default"] = (Menu);\n\n\n//# sourceURL=webpack://yagui/./src/containers/Menu.js?')},"./src/containers/Sidebar.js":function srcContainersSidebarJs(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var containers_Folder__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! containers/Folder */ \"./src/containers/Folder.js\");\n\n\nclass Sidebar {\n\n  constructor(callbackResize) {\n    this.domSidebar = document.createElement('div');\n    this.domSidebar.className = 'gui-sidebar';\n\n    this.domResize = document.createElement('div');\n    this.domResize.className = 'gui-resize';\n\n    this.isDragging = false;\n    this.mouseX = 0;\n    this.domResize.addEventListener('mousedown', this._onMouseDown.bind(this));\n    window.addEventListener('mousemove', this._onMouseMove.bind(this));\n    window.addEventListener('mouseup', this._onMouseUp.bind(this));\n\n    this.callbackResize = callbackResize;\n    this.isOnTheRight = false;\n  }\n\n  _setTop(nb) {\n    this.domSidebar.style.top = this.domResize.style.top = nb + 'px';\n  }\n\n  _onTheRight() {\n    this.isOnTheRight = true;\n    this.domSidebar.style.right = 0;\n    this.domSidebar.style.borderRight = 0;\n    this.domSidebar.style.borderLeft = 'double';\n    this.domSidebar.style.borderColor = 'rgba(255,255,255,0.3)';\n    this.domResize.style.left = 'auto';\n    this.domResize.style.right = this.domSidebar.offsetWidth + 'px';\n    this.domResize.style.marginRight = '-3px';\n  }\n\n  _onMouseDown(ev) {\n    this.isDragging = true;\n    this.mouseX = ev.clientX;\n  }\n\n  _updateViewportPosition(viewport) {\n    var w = this.domSidebar.hidden ? 0 : this.domSidebar.offsetWidth;\n    if (this.isOnTheRight) {\n      viewport.style.width = (viewport.clientWidth - w) + 'px';\n    } else {\n      viewport.style.left = (this.domSidebar.offsetLeft + w) + 'px';\n      viewport.style.width = (viewport.clientWidth - w) + 'px';\n    }\n  }\n\n  _onMouseMove(ev) {\n    if (this.isDragging === false) return;\n    var mouseX = ev.clientX;\n    var delta = mouseX - this.mouseX;\n    if (this.isOnTheRight) delta = -delta;\n    var widthBar = Math.max(50, this.domSidebar.offsetWidth + delta);\n\n    var val = widthBar + 'px';\n    this.domSidebar.style.width = val;\n    if (this.isOnTheRight) this.domResize.style.right = this.domSidebar.offsetWidth + 'px';\n    else this.domResize.style.left = val;\n\n    this.mouseX = mouseX;\n    this.callbackResize();\n  }\n\n  _onMouseUp() {\n    this.isDragging = false;\n  }\n\n  addMenu(name) {\n    var folder = new containers_Folder__WEBPACK_IMPORTED_MODULE_0__[\"default\"](name);\n    this.domSidebar.appendChild(folder.domUl);\n    return folder;\n  }\n\n  setVisibility(visible) {\n    this.domSidebar.hidden = !visible;\n    this.domResize.hidden = !visible;\n    this.callbackResize();\n  }\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Sidebar);\n\n\n//# sourceURL=webpack://yagui/./src/containers/Sidebar.js?")},"./src/containers/Topbar.js":function srcContainersTopbarJs(module,__webpack_exports__,__webpack_require__){"use strict";eval('__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var containers_Menu__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! containers/Menu */ "./src/containers/Menu.js");\n/* harmony import */ var utils_EditStyle__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! utils/EditStyle */ "./src/utils/EditStyle.js");\n\n\n\nclass Topbar {\n\n  constructor(callbackResize) {\n    this.domTopbar = document.createElement(\'div\');\n    this.domTopbar.className = \'gui-topbar\';\n\n    this.domUl = document.createElement(\'ul\');\n    this.domTopbar.appendChild(this.domUl);\n\n    this.callbackResize = callbackResize;\n    this.uiExtra = {};\n  }\n\n  _updateViewportPosition(viewport) {\n    var h = this.domTopbar.hidden ? 0 : this.domTopbar.offsetHeight;\n    viewport.style.top = h + \'px\';\n    viewport.style.height = (viewport.clientHeight - h) + \'px\';\n  }\n\n  _onChangeColor(callback, color) {\n    callback(color);\n    this.uiExtra.overallColor.setValue(utils_EditStyle__WEBPACK_IMPORTED_MODULE_1__["default"]._curWidgetColor, true);\n    this.uiExtra.widgetColor.setValue(utils_EditStyle__WEBPACK_IMPORTED_MODULE_1__["default"]._curWidgetColor, true);\n    this.uiExtra.backColor.setValue(utils_EditStyle__WEBPACK_IMPORTED_MODULE_1__["default"]._curBackgroundColor, true);\n    this.uiExtra.textColor.setValue(utils_EditStyle__WEBPACK_IMPORTED_MODULE_1__["default"]._curTextColor, true);\n  }\n\n  addMenu(name) {\n    var menu = new containers_Menu__WEBPACK_IMPORTED_MODULE_0__["default"]();\n    var li = document.createElement(\'li\');\n    li.setAttribute(\'onclick\', \'void(0)\'); // iOS trick to trigger click on hover\n    li.innerHTML = name || \'\';\n    this.domUl.appendChild(li);\n    li.appendChild(menu.domUl);\n    menu._setDomContainer(li);\n    return menu;\n  }\n\n  addExtra() {\n    var cb = this._onChangeColor;\n    var menu = this.addMenu(\'Extra UI\');\n    var ext = this.uiExtra;\n    menu.addTitle(\'Overall\');\n    ext.overallColor = menu.addColor(\'\', utils_EditStyle__WEBPACK_IMPORTED_MODULE_1__["default"]._curWidgetColor, cb.bind(this, utils_EditStyle__WEBPACK_IMPORTED_MODULE_1__["default"].changeOverallColor));\n\n    menu.addTitle(\'Advanced\');\n    ext.widgetColor = menu.addColor(\'Widget\', utils_EditStyle__WEBPACK_IMPORTED_MODULE_1__["default"]._curWidgetColor, cb.bind(this, utils_EditStyle__WEBPACK_IMPORTED_MODULE_1__["default"].changeWidgetsColor));\n    ext.backColor = menu.addColor(\'Back\', utils_EditStyle__WEBPACK_IMPORTED_MODULE_1__["default"]._curBackgroundColor, cb.bind(this, utils_EditStyle__WEBPACK_IMPORTED_MODULE_1__["default"].changeBackgroundColor));\n    ext.textColor = menu.addColor(\'Text\', utils_EditStyle__WEBPACK_IMPORTED_MODULE_1__["default"]._curTextColor, cb.bind(this, utils_EditStyle__WEBPACK_IMPORTED_MODULE_1__["default"].changeTextColor));\n    ext.showBorder = menu.addCheckbox(\'Border\', utils_EditStyle__WEBPACK_IMPORTED_MODULE_1__["default"]._curShowBorder, utils_EditStyle__WEBPACK_IMPORTED_MODULE_1__["default"].changeDisplayBoorder);\n    return menu;\n  }\n\n  setVisibility(visible) {\n    this.domTopbar.hidden = !visible;\n    this.callbackResize();\n  }\n}\n\n/* harmony default export */ __webpack_exports__["default"] = (Topbar);\n\n\n//# sourceURL=webpack://yagui/./src/containers/Topbar.js?')},"./src/utils/EditStyle.js":function srcUtilsEditStyleJs(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! utils/GuiUtils */ \"./src/utils/GuiUtils.js\");\n\n\nvar EditStyle = {};\n\nEditStyle.refRules = {};\n\nvar yaguiSheet;\nvar findSheet = function () {\n  if (yaguiSheet) return yaguiSheet;\n  var sheets = document.styleSheets;\n  for (var i = 0, nb = sheets.length; i < nb; ++i) {\n    var href = sheets[i].href;\n    if (href && href.indexOf('yagui.css') !== -1) {\n      yaguiSheet = sheets[i];\n      return yaguiSheet;\n    }\n  }\n  return;\n};\n\nvar editStyle = function (selector, key, value) {\n  var sheet = findSheet();\n  if (!sheet)\n    return;\n  var rules = sheet.cssRules || sheet.rules;\n  var rule = EditStyle.refRules[selector];\n  if (!rule) {\n    var i = 0;\n    var len = rules.length;\n    for (i = 0; i < len; ++i) {\n      if (rules[i].selectorText === selector) break;\n    }\n    if (i === len) return false;\n    rule = EditStyle.refRules[selector] = rules[i];\n  }\n  if (rule)\n    rule.style[key] = value;\n};\n\nEditStyle.changeWidgetsColor = function (color) {\n  var str = utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getStrColor(color);\n  // button\n  editStyle('.gui-button', 'background', str);\n  // select\n  editStyle('.gui-select', 'background', str);\n  // slider\n  editStyle('.gui-slider > div', 'background', str);\n  EditStyle._curWidgetColor = color;\n};\n\nEditStyle.changeDisplayBoorder = function (bool) {\n  var str = bool ? '1px solid #000' : '0';\n  editStyle('.gui-button', 'border', str);\n  // select\n  editStyle('.gui-select', 'border', str);\n  // slider\n  editStyle('.gui-slider', 'border', str);\n  editStyle('.gui-input-number', 'border', str);\n  // folder\n  editStyle('.gui-sidebar > ul > label', 'borderTop', str);\n  editStyle('.gui-sidebar > ul > label', 'borderBottom', str);\n  // side bar\n  editStyle('.gui-sidebar', 'borderLeft', str);\n  editStyle('.gui-sidebar', 'borderRight', str);\n  // top bar\n  editStyle('.gui-topbar', 'borderBottom', str);\n  EditStyle._curShowBorder = bool;\n};\n\nEditStyle.changeBackgroundColor = function (color) {\n  // side bar\n  editStyle('.gui-sidebar', 'background', utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getStrColor(color));\n  // top bar\n  var colTop = utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getStrColor(utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getColorMult(color, 0.5));\n  editStyle('.gui-topbar', 'background', colTop);\n  editStyle('.gui-topbar ul > li > ul', 'background', colTop);\n  EditStyle._curBackgroundColor = color;\n};\n\nEditStyle.changeTextColor = function (color) {\n  var strColor = utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getStrColor(color);\n  editStyle('*', 'color', strColor);\n  editStyle('.gui-sidebar > ul > label', 'color', strColor);\n  EditStyle._curTextColor = color;\n};\n\nEditStyle.changeOverallColor = function (color) {\n  EditStyle.changeWidgetsColor(color);\n  var bgCol = utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getColorMult(color, 0.5);\n  bgCol.length = 3;\n  EditStyle.changeBackgroundColor(bgCol);\n\n  var texCol = utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getColorAdd(color, 0.5);\n  for (var i = 0; i < 3; ++i) texCol[i] = Math.min(0.8, texCol[i]);\n  EditStyle.changeTextColor(texCol);\n\n  EditStyle._curWidgetColor = color;\n  EditStyle._curBackgroundColor = bgCol;\n  EditStyle._curTextColor = texCol;\n};\n\n// init value\nEditStyle._curTextColor = [0.73, 0.73, 0.73, 1.0];\nEditStyle._curWidgetColor = [0.32, 0.37, 0.39, 1.0];\nEditStyle._curBackgroundColor = [0.24, 0.24, 0.24];\nEditStyle._curShowBorder = false;\n\nEditStyle.changeOverallColor([0.3, 0.34, 0.4, 1.0]);\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (EditStyle);\n\n\n//# sourceURL=webpack://yagui/./src/utils/EditStyle.js?")},"./src/utils/GuiUtils.js":function srcUtilsGuiUtilsJs(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\nvar GuiUtils = {};\n\nGuiUtils.rgbToHsv = function (rgb) {\n  var r = rgb[0];\n  var g = rgb[1];\n  var b = rgb[2];\n  var maxRGB = Math.max(r, g, b);\n  var minRGB = Math.min(r, g, b);\n  if (minRGB === maxRGB) return [0, 0, minRGB];\n  var d = (r === minRGB) ? g - b : ((b === minRGB) ? r - g : b - r);\n  var h = (r === minRGB) ? 3 : ((b === minRGB) ? 1 : 5);\n  return [(h - d / (maxRGB - minRGB)) / 6, (maxRGB - minRGB) / maxRGB, maxRGB];\n};\n\nGuiUtils.hsvToRgb = function (hsv) {\n  var h = hsv[0] * 6;\n  var s = hsv[1];\n  var v = hsv[2];\n  var i = Math.floor(h);\n  var f = h - i;\n  var p = v * (1.0 - s);\n  var q = v * (1.0 - f * s);\n  var t = v * (1.0 - (1.0 - f) * s);\n  var mod = i % 6;\n  if (mod === 0) return [v, t, p];\n  else if (mod === 1) return [q, v, p];\n  else if (mod === 2) return [p, v, t];\n  else if (mod === 3) return [p, q, v];\n  else if (mod === 4) return [t, p, v];\n  else return [v, p, q];\n};\n\nGuiUtils.getValidColor = function (color) {\n  for (var i = 0, len = color.length; i < len; ++i) color[i] = Math.max(0.0, Math.min(1.0, color[i]));\n  return color;\n};\n\nGuiUtils.getStrColor = function (color) {\n  if (color.length === 3) return GuiUtils.rgbToHex(color);\n  return 'rgba(' + Math.round(color[0] * 255) + ',' + Math.round(color[1] * 255) + ',' + Math.round(color[2] * 255) + ',' + color[3] + ')';\n};\n\nGuiUtils.getColorMult = function (color, fac) {\n  var out = [color[0] * fac, color[1] * fac, color[2] * fac];\n  if (color.length === 4) out.push(color[3]);\n  return GuiUtils.getValidColor(out);\n};\n\nGuiUtils.getColorAdd = function (color, add) {\n  var out = [color[0] + add, color[1] + add, color[2] + add];\n  if (color.length === 4) out.push(color[3]);\n  return GuiUtils.getValidColor(out);\n};\n\nGuiUtils.rgbToHex = function (rgb) {\n  var h = '#';\n  for (var i = 0; i < 3; ++i) {\n    var c = Math.round(rgb[i] * 255).toString(16);\n    h += c.length === 1 ? '0' + c : c;\n  }\n  return h;\n};\n\nGuiUtils.hexToRgb = function (hex) {\n  var i = 0;\n  if (hex[0] === '#') hex = hex.slice(1);\n  var h = hex;\n  if (hex.length > 6) h = hex.slice(0, 6);\n  else if (hex.length < 6) {\n    h = '';\n    for (i = 0; i < 3; ++i)\n      h += hex[i] ? hex[i] + hex[i] : '00';\n  }\n  var col = [0, 0, 0];\n  for (i = 0; i < 3; ++i) {\n    var c = parseInt(h[i * 2] + h[i * 2 + 1], 16);\n    col[i] = (c !== c ? 0 : c) / 255;\n  }\n  return col;\n};\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (GuiUtils);\n\n\n//# sourceURL=webpack://yagui/./src/utils/GuiUtils.js?")},"./src/widgets/BaseWidget.js":function srcWidgetsBaseWidgetJs(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\nclass BaseWidget {\n\n  constructor() {}\n\n  _getInitialValue(valOrObject, callbackOrKey) {\n    if (typeof callbackOrKey !== 'string') return valOrObject;\n    return valOrObject[callbackOrKey];\n  }\n\n  _getCheckCallback(valOrObject, callbackOrKey) {\n    if (typeof callbackOrKey !== 'string') return callbackOrKey;\n    return function (val) {\n      valOrObject[callbackOrKey] = val;\n    };\n  }\n\n  _setDomContainer(container) {\n    this.domContainer = container;\n  }\n\n  setCallback(callback) {\n    this.callback = callback;\n  }\n\n  setVisibility(visible) {\n    if (!this.domContainer) return;\n    this.domContainer.hidden = !visible;\n  }\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (BaseWidget);\n\n\n//# sourceURL=webpack://yagui/./src/widgets/BaseWidget.js?")},"./src/widgets/Button.js":function srcWidgetsButtonJs(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var widgets_BaseWidget__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! widgets/BaseWidget */ \"./src/widgets/BaseWidget.js\");\n\n\nclass Button extends widgets_BaseWidget__WEBPACK_IMPORTED_MODULE_0__[\"default\"] {\n\n  constructor(name, callbackOrObject, key) {\n    super();\n\n    var callback = key ? callbackOrObject[key].bind(callbackOrObject) : callbackOrObject;\n\n    this.domButton = document.createElement('button');\n    this.domButton.className = 'gui-button';\n    this.domButton.innerHTML = name || '';\n    this.domButton.addEventListener('click', this._onClick.bind(this));\n\n    this.setCallback(callback);\n  }\n\n  setEnable(bool) {\n    this.domButton.disabled = bool === undefined ? false : !bool;\n  }\n\n  _onClick() {\n    if (this.callback) this.callback();\n  }\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Button);\n\n\n//# sourceURL=webpack://yagui/./src/widgets/Button.js?")},"./src/widgets/Checkbox.js":function srcWidgetsCheckboxJs(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var widgets_BaseWidget__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! widgets/BaseWidget */ \"./src/widgets/BaseWidget.js\");\n\n\nclass Checkbox extends widgets_BaseWidget__WEBPACK_IMPORTED_MODULE_0__[\"default\"] {\n\n  constructor(valOrObject, callbackOrKey) {\n    super();\n\n    var value = this._getInitialValue(valOrObject, callbackOrKey);\n    var callback = this._getCheckCallback(valOrObject, callbackOrKey);\n    this.domCheckbox = document.createElement('input');\n    this.domCheckbox.className = 'gui-input-checkbox';\n    this.domCheckbox.type = 'checkbox';\n\n    this.domLabelCheckbox = document.createElement('label');\n\n    this.setValue(value === undefined ? true : value);\n    this.setCallback(callback);\n  }\n\n  _onMouseDown() {\n    this.setValue(!this.domCheckbox.checked);\n  }\n\n  setValue(val, ignoreCB) {\n    this.domCheckbox.checked = val;\n    if (!ignoreCB && this.callback) this.callback(val);\n  }\n\n  getValue() {\n    return this.domCheckbox.checked;\n  }\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Checkbox);\n\n\n//# sourceURL=webpack://yagui/./src/widgets/Checkbox.js?")},"./src/widgets/Color.js":function srcWidgetsColorJs(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! utils/GuiUtils */ \"./src/utils/GuiUtils.js\");\n/* harmony import */ var widgets_BaseWidget__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! widgets/BaseWidget */ \"./src/widgets/BaseWidget.js\");\n\n\n\nvar vendors = ['-moz-', '-o-', '-webkit-', '-ms-', ''];\nvar urlAlpha = 'url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAIAAABLbSncAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAChJREFUeNpiPHPmDAMMGBsbw9lMDDgA6RKM%2F%2F%2F%2Fh3POnj1LCzsAAgwAQtYIcFfEyzkAAAAASUVORK5CYII%3D\")';\n\nclass Color extends widgets_BaseWidget__WEBPACK_IMPORTED_MODULE_1__[\"default\"] {\n\n  constructor(valOrObject, callbackOrKey) {\n    super();\n\n    var value = this._getInitialValue(valOrObject, callbackOrKey);\n    var callback = this._getCheckCallback(valOrObject, callbackOrKey);\n    if (value) this.color = utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getValidColor(value.slice());\n    else this.color = [1.0, 0.0, 0.0];\n\n    // container\n    this.domColor = document.createElement('div');\n    this.domColor.className = 'gui-widget-color';\n\n    // input text\n    this.domInputColor = document.createElement('input');\n    this.domPopup = document.createElement('div');\n\n    // hue picker\n    this.domHue = document.createElement('div');\n    this.domHue.className = 'gui-color-hue';\n    this.domHueKnob = document.createElement('div');\n    this.domHueKnob.className = 'gui-knob-hue';\n\n    // saturation picker\n    this.domSaturation = document.createElement('div');\n    this.domSaturation.className = 'gui-color-saturation';\n    var zAlphaSat = document.createElement('div');\n    this.domSaturation.appendChild(zAlphaSat);\n    this.domSaturationKnob = document.createElement('div');\n    this.domSaturationKnob.className = 'gui-knob-saturation';\n\n    this.domHue.appendChild(this.domHueKnob);\n    this.domPopup.appendChild(this.domSaturationKnob);\n    this.domPopup.appendChild(this.domSaturation);\n    this.domPopup.appendChild(this.domHue);\n    this.domColor.appendChild(this.domInputColor);\n    this.domColor.appendChild(this.domPopup);\n\n    this._hueGradient(this.domHue);\n    this._linearGradient(zAlphaSat, 'top', 'rgba(0,0,0,0)', '#000');\n\n    this.domColor.addEventListener('keydown', this._onInputDown.bind(this));\n    this.domSaturation.addEventListener('mousedown', this._onSaturationDown.bind(this));\n    this.domHue.addEventListener('mousedown', this._onHueDown.bind(this));\n    window.addEventListener('mouseup', this._onMouseUp.bind(this));\n    window.addEventListener('mouseout', this._onMouseUp.bind(this));\n    window.addEventListener('mousemove', this._onMouseMove.bind(this));\n\n    // alpha picker\n    this.hasAlpha = this.color.length === 4;\n    this.alpha = 1.0;\n    if (this.hasAlpha) {\n      this.domPopup.style.width = '142px';\n      this.domAlpha = document.createElement('div');\n      this.domAlpha.className = 'gui-color-alpha';\n      this.domAlphaKnob = document.createElement('div');\n      this.domAlphaKnob.className = 'gui-knob-alpha';\n\n      this._alphaGradient(this.domAlpha, 'top', 'rgba(0,0,0,1.0)', 'rgba(0,0,0,0.0)');\n\n      this.domAlpha.addEventListener('mousedown', this._onAlphaDown.bind(this));\n      this.domAlpha.appendChild(this.domAlphaKnob);\n      this.domPopup.appendChild(this.domAlpha);\n    }\n\n    this.editHue = this.editSaturation = this.editAlpha = false;\n    this.widgetHeight = this.widgetWidth = 100;\n    this.setValue(this.color);\n    this.setCallback(callback);\n  }\n\n  _onInputDown(ev) {\n    ev.stopPropagation();\n    if (ev.keyCode === 13)\n      this.setValue(utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].hexToRgb(ev.target.value));\n  }\n\n  _onUpdateSaturation(ev) {\n    var rect = this.domSaturation.getBoundingClientRect();\n    var hsv = utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].rgbToHsv(this.getValue());\n    hsv[1] = Math.min(1.0, Math.max(0.0, (ev.clientX - rect.left) / rect.width));\n    hsv[2] = Math.min(1.0, Math.max(0.0, 1.0 - (ev.clientY - rect.top) / rect.width));\n    this.setValue(utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].hsvToRgb(hsv), false, true);\n    this._updateGui();\n  }\n\n  _onUpdateHue(ev) {\n    var rect = this.domHue.getBoundingClientRect();\n    var hsv = utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].rgbToHsv(this.getValue());\n    hsv[0] = Math.min(1.0, Math.max(0.0, 1.0 - (ev.clientY - rect.top) / rect.height));\n    this.setValue(utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].hsvToRgb(hsv), false, true);\n    this._updateGui();\n  }\n\n  _onUpdateAlpha(ev) {\n    var rect = this.domAlpha.getBoundingClientRect();\n    var col = this.getValue();\n    col[3] = this.alpha = Math.min(1.0, Math.max(0.0, 1.0 - (ev.clientY - rect.top) / rect.height));\n    this.setValue(col, false, true);\n    this._updateGui();\n  }\n\n  _updateGui() {\n    var color = this.getValue();\n    var hsv = utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].rgbToHsv(color);\n\n    this.domSaturationKnob.style.marginLeft = this.widgetWidth * hsv[1] - 7 + 'px';\n    this.domSaturationKnob.style.marginTop = this.widgetHeight * (1.0 - hsv[2]) - 7 + 'px';\n\n    hsv[1] = hsv[2] = 1.0;\n    this._linearGradient(this.domSaturation, 'left', '#fff', utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getStrColor(utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].hsvToRgb(hsv)));\n\n    this.domHueKnob.style.marginTop = (1.0 - hsv[0]) * this.widgetHeight + 'px';\n\n    if (this.hasAlpha && color[3] !== undefined)\n      this.domAlphaKnob.style.marginTop = (1.0 - this.alpha) * this.widgetHeight + 'px';\n  }\n\n  _onMouseMove(ev) {\n    if (!this.editSaturation && !this.editHue && !this.editAlpha) return;\n    if (this.editSaturation) return this._onUpdateSaturation(ev);\n    if (this.editHue) return this._onUpdateHue(ev);\n    if (this.editAlpha) return this._onUpdateAlpha(ev);\n  }\n\n  _onSaturationDown(ev) {\n    this.editSaturation = true;\n    this._onMouseMove(ev);\n  }\n\n  _onHueDown(ev) {\n    this.editHue = true;\n    this._onMouseMove(ev);\n  }\n\n  _onAlphaDown(ev) {\n    this.editAlpha = true;\n    this._onMouseMove(ev);\n  }\n\n  _onMouseUp() {\n    this.editHue = this.editSaturation = this.editAlpha = false;\n  }\n\n  _hueGradient(dom) {\n    dom.style.background = '';\n    for (var i = 0, l = vendors.length; i < l; ++i)\n      dom.style.cssText += 'background: ' + vendors[i] + 'linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);';\n  }\n\n  _alphaGradient(dom, dir, col1, col2) {\n    dom.style.background = '';\n    for (var i = 0, l = vendors.length; i < l; ++i)\n      dom.style.cssText += 'background: ' + vendors[i] + 'linear-gradient(' + dir + ', ' + col1 + ',' + col2 + '),' + urlAlpha + ';';\n  }\n\n  _linearGradient(dom, dir, col1, col2) {\n    dom.style.background = '';\n    for (var i = 0, l = vendors.length; i < l; ++i)\n      dom.style.cssText += 'background: ' + vendors[i] + 'linear-gradient(' + dir + ', ' + col1 + ' 0%, ' + col2 + ' 100%);';\n  }\n\n  setValue(color, ignoreCB, ignoreUI) {\n    var c = this.color;\n    for (var i = 0, nbC = color.length; i < nbC; ++i)\n      c[i] = color[i];\n\n    var hex = utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].rgbToHex(color);\n    this.domInputColor.value = hex;\n    if (this.hasAlpha) {\n      if (color.length >= 4) this.alpha = color[3];\n      else color.push(this.alpha);\n      var col = 'rgba(' + parseInt(color[0] * 255, 10) + ',' + parseInt(color[1] * 255, 10) + ',' + parseInt(color[2] * 255, 10) + ',' + this.alpha + ')';\n      this._alphaGradient(this.domInputColor, '0deg', col, col);\n    } else {\n      this.domInputColor.style.background = hex;\n    }\n\n    // color of text\n    var hsv = utils_GuiUtils__WEBPACK_IMPORTED_MODULE_0__[\"default\"].rgbToHsv(color);\n    this.domSaturationKnob.style.borderColor = (hsv[2] < 0.5 || hsv[1] > 0.5) ? '#fff' : '#000';\n    this.domInputColor.style.color = (this.alpha > 0.2 && (hsv[2] < 0.5 || hsv[1] > 0.5)) ? '#fff' : '#000';\n    if (!ignoreUI) this._updateGui();\n    if (!ignoreCB && this.callback) this.callback(color);\n  }\n\n  getValue() {\n    return this.color;\n  }\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Color);\n\n\n//# sourceURL=webpack://yagui/./src/widgets/Color.js?")},"./src/widgets/Combobox.js":function srcWidgetsComboboxJs(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var widgets_BaseWidget__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! widgets/BaseWidget */ \"./src/widgets/BaseWidget.js\");\n\n\nclass Combobox extends widgets_BaseWidget__WEBPACK_IMPORTED_MODULE_0__[\"default\"] {\n\n  constructor(valOrObject, callbackOrKey, options) {\n    super();\n\n    var value = this._getInitialValue(valOrObject, callbackOrKey);\n    var callback = this._getCheckCallback(valOrObject, callbackOrKey);\n    options = options || {};\n    value = value !== undefined ? value : options[0];\n\n    this.isArray = options.length !== undefined;\n\n    this.domSelect = document.createElement('select');\n    this.domSelect.className = 'gui-select';\n    this.addOptions(options);\n\n    this.domSelect.addEventListener('change', this._onChange.bind(this));\n    this.setValue(value);\n    this.setCallback(callback);\n  }\n\n  _parseValue(val) {\n    return this.isArray ? parseInt(val, 10) : val;\n  }\n\n  _onChange(ev) {\n    this.setValue(ev.target.value);\n  }\n\n  addOptions(options) {\n    var keys = Object.keys(options);\n    for (var i = 0; i < keys.length; ++i) {\n      var opt = document.createElement('option');\n      opt.innerHTML = options[keys[i]];\n      opt.value = keys[i];\n      this.domSelect.appendChild(opt);\n    }\n  }\n\n  setValue(val, ignoreCB) {\n    this.domSelect.value = val;\n    if (!ignoreCB && this.callback) this.callback(this._parseValue(val));\n  }\n\n  getValue() {\n    return this._parseValue(this.domSelect.value);\n  }\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Combobox);\n\n\n//# sourceURL=webpack://yagui/./src/widgets/Combobox.js?")},"./src/widgets/MenuButton.js":function srcWidgetsMenuButtonJs(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var widgets_BaseWidget__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! widgets/BaseWidget */ \"./src/widgets/BaseWidget.js\");\n\n\nclass MenuButton extends widgets_BaseWidget__WEBPACK_IMPORTED_MODULE_0__[\"default\"] {\n\n  constructor(callbackOrObject, shortcutOrKey, shortcut) {\n    super();\n\n    var callback = callbackOrObject;\n    if (callback && typeof callback !== 'function') callback = callbackOrObject[shortcutOrKey].bind(callbackOrObject);\n    else shortcut = shortcutOrKey;\n\n    this.domSpan = document.createElement('span');\n    this.domSpan.className = 'shortcut';\n    this.domSpan.innerHTML = shortcut || '';\n\n    this.setCallback(callback);\n  }\n\n  _setDomContainer(container) {\n    this.domContainer = container;\n    container.addEventListener('click', this._onClick.bind(this));\n  }\n\n  _onClick() {\n    if (this.callback) this.callback();\n  }\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (MenuButton);\n\n\n//# sourceURL=webpack://yagui/./src/widgets/MenuButton.js?")},"./src/widgets/Slider.js":function srcWidgetsSliderJs(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var widgets_BaseWidget__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! widgets/BaseWidget */ \"./src/widgets/BaseWidget.js\");\n\n\nclass Slider extends widgets_BaseWidget__WEBPACK_IMPORTED_MODULE_0__[\"default\"] {\n\n  constructor(valOrObject, callbackOrKey, min, max, step) {\n    super();\n\n    var value = this._getInitialValue(valOrObject, callbackOrKey);\n    var callback = this._getCheckCallback(valOrObject, callbackOrKey);\n    value = value !== undefined ? value : 100;\n    min = min !== undefined ? min : 0;\n    max = max !== undefined ? max : 200;\n    step = step !== undefined ? step : 1;\n\n    // slider\n    this.domSlider = document.createElement('div');\n    this.domSlider.className = 'gui-slider';\n    this.domSliderFill = document.createElement('div');\n    this.domSlider.appendChild(this.domSliderFill);\n\n    // text input\n    this.domInputText = document.createElement('input');\n    this.domInputText.className = 'gui-input-number';\n    this.domInputText.type = 'number';\n    this.min = this.domInputText.min = min;\n    this.max = this.domInputText.max = max;\n    this.step = this.domInputText.step = step;\n\n    this.domInputText.addEventListener('keydown', this._onKeyDown.bind(this));\n    this.domInputText.addEventListener('change', this._onInputText.bind(this));\n    this.domInputText.addEventListener('blur', this._onInputText.bind(this));\n    this.domSlider.addEventListener('mousedown', this._onMouseDown.bind(this));\n    window.addEventListener('mouseup', this._onMouseUp.bind(this), true);\n    window.addEventListener('mousemove', this._onMouseMove.bind(this));\n\n    this.lastValue = value;\n    this.isDown = false;\n    this.setValue(value);\n    this.setCallback(callback);\n  }\n\n  _onInputText(ev) {\n    var val = parseFloat(ev.target.value);\n    if (val !== val || val === this.lastValue) return;\n    this.setValue(val);\n  }\n\n  _onKeyDown(ev) {\n    ev.stopPropagation();\n    if (ev.which === 13) // enter\n      this.domInputText.blur();\n  }\n\n  _onMouseMove(ev) {\n    ev.preventDefault();\n    if (!this.isDown)\n      return;\n    var rect = this.domSlider.getBoundingClientRect();\n    var val = this.min + (this.max - this.min) * ((ev.clientX - rect.left) / rect.width);\n    this.setValue(val);\n  }\n\n  _onMouseDown(ev) {\n    this.isDown = true;\n    this._onMouseMove(ev);\n  }\n\n  _onMouseUp() {\n    this.isDown = false;\n  }\n\n  _setDomContainer(container) {\n    this.domContainer = container;\n  }\n\n  getValue() {\n    return parseFloat(this.domInputText.value);\n  }\n\n  setValue(val, ignoreCB) {\n    this.lastValue = val;\n    val = Math.max(Math.min(val, this.max), this.min);\n    val = Math.round(val / this.step) * this.step;\n    this.domInputText.value = val;\n    var per = this.min;\n    if (this.max !== this.min) per = (val - this.min) / (this.max - this.min);\n    this.domSliderFill.style.width = 100 * per + '%';\n    if (!ignoreCB && this.callback) this.callback(val);\n  }\n\n  setMax(max) {\n    this.domInputText.max = this.max = max;\n    return this;\n  }\n\n  setMin(min) {\n    this.min = min;\n    return this;\n  }\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Slider);\n\n\n//# sourceURL=webpack://yagui/./src/widgets/Slider.js?")},"./src/widgets/Title.js":function srcWidgetsTitleJs(module,__webpack_exports__,__webpack_require__){"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var widgets_BaseWidget__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! widgets/BaseWidget */ \"./src/widgets/BaseWidget.js\");\n\n\nclass Title extends widgets_BaseWidget__WEBPACK_IMPORTED_MODULE_0__[\"default\"] {\n\n  constructor(name) {\n    super();\n\n    this.domText = document.createElement('div');\n    this.domText.innerHTML = name || '';\n    this.domText.className = 'group-title';\n  }\n\n  setText(text) {\n    this.domText.innerHTML = text;\n  }\n\n  setVisibility(visible) {\n    this.domText.hidden = !visible;\n  }\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (Title);\n\n\n//# sourceURL=webpack://yagui/./src/widgets/Title.js?")},"./src/yagui.js":function srcYaguiJs(module,exports,__webpack_require__){eval('var GuiMain = __webpack_require__(/*! GuiMain */ "./src/GuiMain.js").default;\n\nvar yagui = {\n  GuiMain: GuiMain\n};\n\nmodule.exports = yagui;\n\n\n//# sourceURL=webpack://yagui/./src/yagui.js?')}})},"object"===_typeof(exports)&&"object"===_typeof(module)?module.exports=factory():(__WEBPACK_AMD_DEFINE_ARRAY__=[],void 0===(__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof(__WEBPACK_AMD_DEFINE_FACTORY__=factory)?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__)||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},183:(e,t,r)=>{"use strict";r.d(t,{Z:()=>u});var i=r(52);var n;function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var s=(a(n={backgroundTitle:"背景",backgroundReset:"重設",backgroundImport:"匯入 (jpg, png...)",backgroundFill:"填充",cameraTitle:"鏡頭",cameraReset:"檢視",cameraCenter:"重設 (空白鍵)",cameraFront:"前視角 (F)",cameraLeft:"左視角 (L)",cameraTop:"俯視角 (T)",cameraMode:"模式",cameraOrbit:"軌道 (轉盤)",cameraSpherical:"球面 (軌跡球)",cameraPlane:"平面 (軌跡球)",cameraProjection:"投影",cameraPerspective:"透視角",cameraOrthographic:"等視角",cameraFov:"視野範圍",cameraPivot:"選擇軸心",fileTitle:"檔案 (匯入/匯出)",fileImportTitle:"匯入",fileAdd:"加入 (obj, sgl, ply, stl)",fileAutoMatrix:"縮放並置中",fileVertexSRGB:"sRGB 頂點色彩",fileExportSceneTitle:"匯出場景",fileExportAll:"匯出出口",fileExportSGL:"儲存 .sgl (SculptGL)",fileExportOBJ:"儲存 .obj",fileExportPLY:"儲存 .ply",fileExportSTL:"儲存 .stl",fileExportTextureTitle:null,fileExportTextureSize:null,fileExportColor:null,fileExportRoughness:null,fileExportMetalness:null,sceneTitle:"場景",sceneReset:"清除場景",sceneResetConfirm:"確認清除場景",sceneAddSphere:"加入球體",sceneAddCube:"加入立方體",sceneAddCylinder:"加入圓柱",sceneAddPlane:"加入平面",sceneAddTorus:"加入圓環",sceneSelection:"選取項目",sceneMerge:"合併選取項目",sceneDuplicate:"刪除選擇"},"sceneDuplicate",null),a(n,"meshTitle","網面"),a(n,"meshNbVertices","頂點 : "),a(n,"meshNbFaces","面 : "),a(n,"topologyTitle","網面結構(拓撲)"),a(n,"multiresTitle","多重解析度"),a(n,"multiresSubdivide","細分"),a(n,"multiresReverse","反轉"),a(n,"multiresResolution","解析度"),a(n,"multiresNoLower","沒有更低等級的解析度。"),a(n,"multiresNoHigher","沒有更高等級的解析度。"),a(n,"multiresDelHigher","刪除較高等級"),a(n,"multiresDelLower","刪除較低等級"),a(n,"multiresSelectLowest","反轉前請先選擇最低的解析度。"),a(n,"multiresSelectHighest","細分前請先選擇最高的解析度。"),a(n,"multiresWarnBigMesh",(function(e){return"下一個細分等級會達到 "+e+" 個面。\n若你清楚你自己正在做什麼，再點擊「細分」一次。"})),a(n,"multiresNotReversible","抱歉，無法反轉此網面。\n此網面不是由流形網面經過細分曲面 (loop-catmull) 而來。"),a(n,"remeshTitle","立體像素網面重構"),a(n,"remeshRemesh","網面重構"),a(n,"remeshResolution","解析度"),a(n,"remeshBlock","塊狀重構"),a(n,"dynamicTitle","動態網面結構"),a(n,"dynamicActivated","啟用 (無四邊形)"),a(n,"dynamicSubdivision","細分"),a(n,"dynamicDecimation","削減面數"),a(n,"dynamicLinear","線性細分"),a(n,"sculptTitle","雕刻和塗繪"),a(n,"sculptBrush","筆刷"),a(n,"sculptInflate","膨脹"),a(n,"sculptTwist","扭轉"),a(n,"sculptSmooth","平滑 (-Shift)"),a(n,"sculptFlatten","抹平"),a(n,"sculptPinch","捏塑"),a(n,"sculptCrease","皺褶"),a(n,"sculptDrag","拖拉"),a(n,"sculptPaint","塗繪"),a(n,"sculptMasking","遮罩 (-Ctrl)"),a(n,"sculptMove","移動"),a(n,"sculptLocalScale","局部縮放"),a(n,"sculptTransform","變形 (E)"),a(n,"sculptTransformMode","Transform mode"),a(n,"sculptTransformTranslate","Translate"),a(n,"sculptTransformRotate","Rotate"),a(n,"sculptTransformScale","Scale"),a(n,"sculptTransformAxis","Transform axis"),a(n,"sculptTransformAxisAll","All axes"),a(n,"sculptTransformAxisX","X axis"),a(n,"sculptTransformAxisY","Y axis"),a(n,"sculptTransformAxisZ","Z axis"),a(n,"sculptTransformSpace","Transform space"),a(n,"sculptTransformSpaceWorld","World"),a(n,"sculptTransformSpaceLocal","Local"),a(n,"sculptTransformSpaceNormal","Normal"),a(n,"sculptCommon","通用"),a(n,"sculptTool","工具"),a(n,"sculptSymmetry","對稱"),a(n,"sculptContinuous","連續"),a(n,"sculptRadius","半徑 (-X)"),a(n,"sculptIntensity","強度 (-C)"),a(n,"sculptHardness","硬度"),a(n,"sculptCulling","薄曲面 (僅影響前面頂點)"),a(n,"sculptAlphaTitle","透明色版 (Alpha)"),a(n,"sculptLockPositon","鎖定位置"),a(n,"sculptAlphaTex","紋理"),a(n,"sculptImportAlpha","匯入 alpha 紋理 (jpg, png...)"),a(n,"sculptNegative","反向 (N 或 -Alt)"),a(n,"sculptColor","反照率"),a(n,"sculptRoughness","粗糙度"),a(n,"sculptMetallic","金屬性"),a(n,"sculptClay","黏土"),a(n,"sculptAccumulate","累積 (每道筆劃無限制)"),a(n,"sculptColorGlobal","總體"),a(n,"sculptPickColor","選擇材質或顏色 (-S)"),a(n,"sculptTangentialSmoothing","僅放鬆"),a(n,"sculptTopologicalCheck","網面結構檢查"),a(n,"sculptMoveAlongNormal","沿法線方向移動 (N 或 -Alt)"),a(n,"sculptMaskingClear","清除 (-Ctrl + 拖動)"),a(n,"sculptMaskingInvert","反轉 (-Ctrl + 點擊)"),a(n,"sculptMaskingBlur","模糊"),a(n,"sculptMaskingSharpen","銳利化"),a(n,"sculptPBRTitle","PBR 材質"),a(n,"sculptPaintAll","塗繪全部"),a(n,"sculptExtractTitle","提取"),a(n,"sculptExtractThickness","厚度"),a(n,"sculptExtractAction","提取 !"),a(n,"stateTitle","記錄"),a(n,"stateUndo","復原"),a(n,"stateRedo","取消復原"),a(n,"stateMaxStack","最大推疊"),a(n,"pressureTitle","感壓繪圖板"),a(n,"pressureRadius","半徑感壓"),a(n,"pressureIntensity","強度感壓"),a(n,"renderingTitle","圖形繪算"),a(n,"renderingGrid","顯示格線"),a(n,"renderingSymmetryLine","顯示鏡像線"),a(n,"renderingMatcap","材質捕捉 (Matcap)"),a(n,"renderingCurvature","曲率"),a(n,"renderingPBR","物理式繪算(PBR)"),a(n,"renderingTransparency","透明"),a(n,"renderingNormal","法線著色器"),a(n,"renderingUV","UV 著色器"),a(n,"renderingShader","著色器"),a(n,"renderingMaterial","材質"),a(n,"renderingImportUV","匯入 (jpg, png...)"),a(n,"renderingImportMatcap","匯入 (jpg, png...)"),a(n,"renderingExtra","額外"),a(n,"renderingFlat","平整面"),a(n,"renderingWireframe","線框 (W)"),a(n,"renderingExposure","曝光"),a(n,"renderingEnvironment","環境"),a(n,"renderingIsolate","隔離/顯示 (I)"),a(n,"renderingFilmic","電影色調對應"),a(n,"contour","輪廓"),a(n,"contourShow","顯示輪廓"),a(n,"contourColor","顏色"),a(n,"darkenUnselected","未選取部分變暗"),a(n,"resolution","解析度"),a(n,"matcapPearl","珍珠"),a(n,"matcapClay","黏土"),a(n,"matcapSkin","膚色"),a(n,"matcapGreen","綠色"),a(n,"matcapWhite","白色"),a(n,"sketchfabTitle","前往 Sketchfab !"),a(n,"sketchfabUpload","上傳"),a(n,"sketchfabUploadMessage",'請輸入你的 sketchfab API 密鑰.\n你也可以不填寫留下 "guest" 進行匿名上傳。\n(當上傳中和完成時會跳出新視窗)'),a(n,"sketchfabUploadError",(function(e){return"Sketchfab 上傳錯誤 :\n"+e})),a(n,"sketchfabUploadSuccess","上傳成功 !\n這是你的連結 :"),a(n,"sketchfabAbort","中止最後上傳的項目 ?"),a(n,"sketchfabUploadProcessing","處理中...\n你的模型將會存放在："),a(n,"about","關於和說明"),a(n,"alphaNone","無"),a(n,"alphaSquare","方塊"),a(n,"alphaSkin","皮膚"),n),o=function e(t){var r=e.languages[e.select][t]||e.languages.english[t];return"string"==typeof r?r:"function"==typeof r?r.apply(this,Array.prototype.slice.call(arguments,1)):(console.error("No TR found for : "+t),t)};o.languages={english:{backgroundTitle:"Background",backgroundReset:"Reset",backgroundImport:"Import (jpg, png...)",backgroundFill:"Fill",cameraTitle:"Camera",cameraReset:"View",cameraCenter:"Reset (bar)",cameraFront:"Front (F)",cameraLeft:"Left (L)",cameraTop:"Top (T)",cameraMode:"Mode",cameraOrbit:"Orbit (Turntable)",cameraSpherical:"Spherical (Trackball)",cameraPlane:"Plane (Trackball)",cameraProjection:"Projection",cameraPerspective:"Perspective",cameraOrthographic:"Orthographic",cameraFov:"Fov",cameraPivot:"Picking pivot",fileTitle:"Files (import/export)",fileImportTitle:"Import",fileAdd:"Add (obj, sgl, ply, stl)",fileAutoMatrix:"Scale and center",fileVertexSRGB:"sRGB vertex color",fileExportSceneTitle:"Export Scene",fileExportAll:"Export all",fileExportSGL:"Save .sgl (SculptGL)",fileExportOBJ:"Save .obj",fileExportPLY:"Save .ply",fileExportSTL:"Save .stl",fileExportTextureTitle:"Export textures",fileExportTextureSize:"Size",fileExportColor:"Save diffuse",fileExportRoughness:"Save roughness",fileExportMetalness:"Save metalness",sceneTitle:"Scene",sceneReset:"Clear scene",sceneResetConfirm:"Confirm clear scene",sceneAddSphere:"Add sphere",sceneAddCube:"Add cube",sceneAddCylinder:"Add cylinder",sceneAddPlane:"Add plane",sceneAddTorus:"Add torus",sceneSelection:"Selection",sceneSelectAll:"Select all",sceneSelectInvert:"Invert selection",sceneSelectPrevious:"Select previous",sceneSelectNext:"Select next",sceneSelectMulti:"Tap to add/remove selection",sceneMerge:"Merge selection",sceneDuplicate:"Copy selection",sceneDelete:"Delete selection",meshTitle:"Mesh",meshNbVertices:"Vertex : ",meshNbFaces:"Faces : ",topologyTitle:"Topology",multiresTitle:"Multiresolution",multiresSubdivide:"Subdivide",multiresReverse:"Reverse",multiresResolution:"Resolution",multiresNoLower:"There is no lower resolution level.",multiresNoHigher:"There is no higher resolution level.",multiresDelHigher:"Delete higher",multiresDelLower:"Delete lower",multiresSelectLowest:"Select the lowest resolution before reversing.",multiresSelectHighest:"Select the highest resolution before subdividing.",multiresWarnBigMesh:function(e){return"The next subdivision level will reach "+e+' faces.\nIf you know what you are doing, click again on "subdivide".'},multiresNotReversible:"Sorry it is not possile to reverse this mesh.\nThe mesh is not a product of a (loop-catmull) subdivision surface on a manifold mesh.",remeshTitle:"Voxel remeshing (quads)",remeshRemesh:"Remesh",remeshResolution:"Resolution",remeshBlock:"Block",dynamicTitle:"Dynamic Topology",dynamicActivated:"Activated (no quads)",dynamicSubdivision:"Subdivision",dynamicDecimation:"Decimation",dynamicLinear:"Linear subdivision",sculptTitle:"Sculpting & Painting",sculptBrush:"Brush",sculptInflate:"Inflate",sculptTwist:"Twist",sculptSmooth:"Smooth (-Shift)",sculptFlatten:"Flatten",sculptPinch:"Pinch",sculptCrease:"Crease",sculptDrag:"Drag",sculptPaint:"Paint",sculptMasking:"Masking (-Ctrl)",sculptMove:"Move",sculptLocalScale:"Local scale",sculptTransform:"Transform (E)",sculptTransformMode:"Transform mode",sculptTransformTranslate:"Translate",sculptTransformRotate:"Rotate",sculptTransformScale:"Scale",sculptTransformAxis:"Transform axis",sculptTransformAxisAll:"All axes",sculptTransformAxisX:"X axis",sculptTransformAxisY:"Y axis",sculptTransformAxisZ:"Z axis",sculptTransformSpace:"Transform space",sculptTransformSpaceWorld:"World",sculptTransformSpaceLocal:"Local",sculptTransformSpaceNormal:"Normal",sculptElementSelect:"Element selection",sculptCommon:"Common",sculptTool:"Tool",sculptSymmetry:"Symmetry",sculptContinuous:"Continuous",sculptRadius:"Radius (-X)",sculptIntensity:"Intensity (-C)",sculptHardness:"Hardness",sculptCulling:"Thin surface (front vertex only)",sculptAlphaTitle:"Alpha",sculptLockPositon:"Lock position",sculptAlphaTex:"Texture",sculptImportAlpha:"Import alpha tex (jpg, png...)",sculptNegative:"Negative (N or -Alt)",sculptColor:"Albedo",sculptRoughness:"Roughness",sculptMetallic:"Metallic",sculptClay:"Clay",sculptAccumulate:"Accumulate (no limit per stroke)",sculptColorGlobal:"Global",sculptPickColor:"Material / Color picker (-S)",sculptTangentialSmoothing:"Relax only",sculptTopologicalCheck:"Topological check",sculptMoveAlongNormal:"Move along normal (N or -Alt)",sculptMaskingClear:"Clear (-Ctrl + Drag)",sculptMaskingInvert:"Invert (-Ctrl + Click)",sculptMaskingBlur:"Blur",sculptMaskingSharpen:"Sharpen",sculptPBRTitle:"PBR materials",sculptPaintAll:"Paint all",sculptExtractTitle:"Extract",sculptExtractThickness:"Thickness",sculptExtractAction:"Extract !",sculptElementSelectMode:"Element",sculptElementSelectVertex:"Vertex",sculptElementSelectEdge:"Edge",sculptElementSelectFace:"Face",sculptElementSelectAction:"Action",sculptElementSelectReplace:"Replace",sculptElementSelectAdd:"Add",sculptElementSelectRemove:"Remove",sculptElementSelectAll:"Select all",sculptElementSelectClear:"Clear selection",sculptElementSelectInvert:"Invert selection",stateTitle:"History",stateUndo:"Undo",stateRedo:"Redo",stateMaxStack:"Max Stack",pressureTitle:"Tablet pressure",pressureRadius:"Pressure radius",pressureIntensity:"Pressure intensity",renderingTitle:"Rendering",renderingGrid:"Show grid",renderingSymmetryLine:"Show mirror line",renderingMatcap:"Matcap",renderingCurvature:"Curvature",renderingPBR:"PBR",renderingTransparency:"Transparency",renderingNormal:"Normal shader",renderingUV:"UV shader",renderingShader:"Shader",renderingMaterial:"Material",renderingImportUV:"Import (jpg, png...)",renderingImportMatcap:"Import (jpg, png...)",renderingExtra:"Extra",renderingFlat:"Flat shading",renderingWireframe:"Wireframe (W)",renderingExposure:"Exposure",renderingEnvironment:"Environment",renderingIsolate:"Isolate/Show (I)",renderingFilmic:"Filmic tonemapping",contour:"Contour",contourShow:"Show contour",contourColor:"Color",darkenUnselected:"Darken unselected",resolution:"Resolution",matcapPearl:"Pearl",matcapClay:"Clay",matcapSkin:"Skin",matcapGreen:"Green",matcapWhite:"White",sketchfabTitle:"Go to Sketchfab !",sketchfabUpload:"Upload",sketchfabUploadMessage:'Please enter your sketchfab API Key.\nYou can also leave "guest" to upload anonymously.\n(a new window will pop up when the uploading and processing is finished)',sketchfabUploadError:function(e){return"Sketchfab upload error :\n"+e},sketchfabUploadSuccess:"Upload success !\nHere is your link :",sketchfabAbort:"Abort the last upload ?",sketchfabUploadProcessing:"Processing...\nYour model will be available at :",about:"About & Help",alphaNone:"None",alphaSquare:"Square",alphaSkin:"Skin",remeshTitleMC:"Voxel remeshing (manifold tris)",remeshRemeshMC:"Remesh",remeshSmoothingMC:"Relax topology"},日本語:{backgroundTitle:"バックグラウンド",backgroundReset:"リセット",backgroundImport:"インポート  (jpg, png...)",backgroundFill:null,cameraTitle:"カメラ",cameraReset:"View",cameraCenter:null,cameraFront:null,cameraLeft:null,cameraTop:null,cameraMode:"モード",cameraOrbit:null,cameraSpherical:"球体 (Trackball)",cameraPlane:"平面 (Trackball)",cameraProjection:"タイプ",cameraPerspective:"透視投影",cameraOrthographic:"平行投影",cameraFov:"視野",cameraPivot:"ピボット選択",fileTitle:"ファイル (インポート/エクスポート)",fileImportTitle:null,fileAdd:"Add (obj, sgl, ply, stl)",fileAutoMatrix:null,fileVertexSRGB:null,fileExportSceneTitle:null,fileExportAll:null,fileExportSGL:null,fileExportOBJ:null,fileExportPLY:null,fileExportSTL:null,fileExportTextureTitle:null,fileExportTextureSize:null,fileExportColor:null,fileExportRoughness:null,fileExportMetalness:null,sceneTitle:null,sceneReset:null,sceneAddSphere:null,sceneAddCube:null,sceneAddCylinder:null,sceneAddPlane:null,sceneAddTorus:null,sceneSelection:null,sceneMerge:null,sceneDuplicate:null,meshTitle:"メッシュ",meshNbVertices:null,meshNbFaces:null,topologyTitle:null,multiresTitle:null,multiresSubdivide:null,multiresReverse:null,multiresResolution:null,multiresNoLower:null,multiresNoHigher:null,multiresDelHigher:null,multiresDelLower:null,multiresSelectLowest:null,multiresSelectHighest:null,multiresWarnBigMesh:null,multiresNotReversible:null,remeshTitle:null,remeshRemesh:null,remeshResolution:null,remeshBlock:null,dynamicTitle:null,dynamicActivated:null,dynamicSubdivision:null,dynamicDecimation:null,dynamicLinear:null,sculptTitle:null,sculptBrush:"ブラシ",sculptInflate:"膨張",sculptTwist:"回転",sculptSmooth:"スムーズ化 (-Shift)",sculptFlatten:"フラット化",sculptPinch:"つまむ",sculptCrease:"しわ",sculptDrag:"ドラッグ",sculptPaint:"ペイント",sculptMasking:null,sculptMove:null,sculptLocalScale:null,sculptTransform:null,sculptTransformMode:"Transform mode",sculptTransformTranslate:"Translate",sculptTransformRotate:"Rotate",sculptTransformScale:"Scale",sculptTransformAxis:"Transform axis",sculptTransformAxisAll:"All axes",sculptTransformAxisX:"X axis",sculptTransformAxisY:"Y axis",sculptTransformAxisZ:"Z axis",sculptTransformSpace:"Transform space",sculptTransformSpaceWorld:"World",sculptTransformSpaceLocal:"Local",sculptTransformSpaceNormal:"Normal",sculptCommon:null,sculptTool:"ツール",sculptSymmetry:"対称加工",sculptContinuous:"連続加工",sculptRadius:"半径 (-X)",sculptIntensity:"明るさ (-C)",sculptHardness:null,sculptCulling:null,sculptAlphaTitle:null,sculptLockPositon:null,sculptAlphaTex:null,sculptImportAlpha:null,sculptNegative:"ネガティブ (N or -Alt)",sculptColor:null,sculptRoughness:null,sculptMetallic:null,sculptClay:"クレイ",sculptAccumulate:null,sculptColorGlobal:null,sculptPickColor:null,sculptTangentialSmoothing:null,sculptTopologicalCheck:null,sculptMoveAlongNormal:null,sculptMaskingClear:null,sculptMaskingInvert:null,sculptMaskingBlur:null,sculptMaskingSharpen:null,sculptPBRTitle:null,sculptPaintAll:null,sculptExtractTitle:null,sculptExtractThickness:null,sculptExtractAction:null,stateTitle:"履歴",stateUndo:"アンドゥ",stateRedo:"リドゥ",stateMaxStack:null,pressureTitle:"ワコムタブレット",pressureRadius:"圧力半径？",pressureIntensity:"圧力の強さ？",renderingTitle:null,renderingGrid:null,renderingSymmetryLine:null,renderingMatcap:null,renderingCurvature:null,renderingPBR:null,renderingTransparency:"透過",renderingNormal:"ノーマル",renderingUV:null,renderingShader:"シェーダー",renderingMaterial:null,renderingImportUV:null,renderingImportMatcap:null,renderingExtra:null,renderingFlat:"フラットシェーディング",renderingWireframe:"ワイヤーフレーム (W)",renderingExposure:null,renderingEnvironment:null,renderingIsolate:null,renderingFilmic:null,contour:null,contourShow:null,contourColor:null,darkenUnselected:null,resolution:null,matcapPearl:null,matcapClay:"クレイ",matcapSkin:"スキン",matcapGreen:null,matcapWhite:null,sketchfabTitle:"Sketchfabへ移動",sketchfabUpload:"アップロード",sketchfabUploadMessage:null,sketchfabUploadError:null,sketchfabUploadSuccess:null,sketchfabAbort:null,sketchfabUploadProcessing:null,about:null,alphaNone:null,alphaSquare:null,alphaSkin:null},中文:s,한국어:{backgroundTitle:"배경",backgroundReset:"초기화",backgroundImport:"가져오기 (jpg, png...)",backgroundFill:"화면 가득 채우기",cameraTitle:"카메라",cameraReset:"뷰",cameraCenter:"초기화 (bar)",cameraFront:"앞쪽 (F)",cameraLeft:"왼쪽 (L)",cameraTop:"위쪽 (T)",cameraMode:"조작방식",cameraOrbit:"궤도 (Turntable)",cameraSpherical:"구형 (Trackball)",cameraPlane:"평면 (Trackball)",cameraProjection:"사영법",cameraPerspective:"투시원근법",cameraOrthographic:"정사영법",cameraFov:"시야각",cameraPivot:"피봇 찍기",fileTitle:"파일 (가져오기/내보내기)",fileImportTitle:"가져오기",fileAdd:"추가 (obj, sgl, ply, stl)",fileAutoMatrix:"크기조정 및 중앙정렬",fileVertexSRGB:"sRGB 버텍스 색상",fileExportSceneTitle:"장면 내보내기",fileExportAll:"모두 내보내기",fileExportSGL:".sgl 파일로 저장하기",fileExportOBJ:".obj 파일로 저장하기",fileExportPLY:".ply 파일로 저장하기",fileExportSTL:".stl 파일로 저장하기",fileExportTextureTitle:null,fileExportTextureSize:null,fileExportColor:null,fileExportRoughness:null,fileExportMetalness:null,sceneTitle:"장면",sceneReset:"모두 없애기",sceneResetConfirm:"모두 제거 확인",sceneAddSphere:"구 추가하기",sceneAddCube:"정육면체 추가하기",sceneAddCylinder:"기둥 추가하기",sceneAddPlane:"평면 추가하기",sceneAddTorus:"도넛 추가하기",sceneSelection:"선택",sceneMerge:"장면 병합하기",sceneDuplicate:null,sceneDelete:"선택 항목 삭제",meshTitle:"메시",meshNbVertices:"버텍스 개수 : ",meshNbFaces:"페이스 개수 : ",topologyTitle:"토폴로지",multiresTitle:"다중 해상도",multiresSubdivide:"세분화",multiresReverse:"간소화",multiresResolution:"해상도",multiresNoLower:"더 낮은 해상도가 존재하지 않습니다.",multiresNoHigher:"더 높은 해상도가 존재하지 않습니다.",multiresDelHigher:"상위 단계 제거",multiresDelLower:"하위 단계 제거",multiresSelectLowest:"간소화 하기 전에 더 낮은 해상도를 고르세요.",multiresSelectHighest:"세분화 하기 전에 더 높은 해상도를 고르세요",multiresWarnBigMesh:function(e){return"다음 분할 단계의 면 개수는 "+e+' 개가 될 것입니다.\n지금 뭘 하려는건지 정확히 이해하고 있다면 "세분화" 버튼을 다시 누르세요.'},multiresNotReversible:"이 메시는 더이상 병합할 수 없습니다.\n이 메시는 다양체 메시상의 세분화(loop-catmull) 결과가 아닙니다.",remeshTitle:"복셀 리메싱",remeshRemesh:"리메시",remeshResolution:"해상도",remeshBlock:"각지게",dynamicTitle:"동적 토폴로지",dynamicActivated:"활성화 (사각형 유지 안함)",dynamicSubdivision:"세분화",dynamicDecimation:"간소화",dynamicLinear:"선형 세분화",sculptTitle:"스컬핑 & 페인팅",sculptBrush:"브러시",sculptInflate:"부풀리기",sculptTwist:"비틀기",sculptSmooth:"부드럽게 (-Shift)",sculptFlatten:"평평하게",sculptPinch:"꼬집기",sculptCrease:"주름내기",sculptDrag:"잡아끌기",sculptPaint:"칠하기",sculptMasking:"마스킹 (-Ctrl)",sculptMove:"잡아당기기",sculptLocalScale:"지역 스케일",sculptTransform:"변환 (E)",sculptTransformMode:"Transform mode",sculptTransformTranslate:"Translate",sculptTransformRotate:"Rotate",sculptTransformScale:"Scale",sculptTransformAxis:"Transform axis",sculptTransformAxisAll:"All axes",sculptTransformAxisX:"X axis",sculptTransformAxisY:"Y axis",sculptTransformAxisZ:"Z axis",sculptTransformSpace:"Transform space",sculptTransformSpaceWorld:"World",sculptTransformSpaceLocal:"Local",sculptTransformSpaceNormal:"Normal",sculptCommon:"일반",sculptTool:"도구",sculptSymmetry:"대칭",sculptContinuous:"누적",sculptRadius:"반경 (-X)",sculptIntensity:"세기 (-C)",sculptHardness:"경도",sculptCulling:"얇은 표면 (앞쪽 면만 적용)",sculptAlphaTitle:"알파",sculptLockPositon:"위치 고정",sculptAlphaTex:"텍스쳐",sculptImportAlpha:"알파 텍스쳐 가져오기 (jpg, png...)",sculptNegative:"반전 (N 또는 -Alt)",sculptColor:"알베도",sculptRoughness:"거칠기",sculptMetallic:"금속",sculptClay:"찰흙",sculptAccumulate:"누적 (획 당으로 제한받지 않음)",sculptColorGlobal:null,sculptPickColor:"재질 / 색상 선택 (-S)",sculptTangentialSmoothing:"완화 한정",sculptTopologicalCheck:"위상 검사",sculptMoveAlongNormal:"법선 방향으로 움직이기",sculptMaskingClear:"초기화 (-Ctrl + Drag)",sculptMaskingInvert:"반전 (-Ctrl + Click)",sculptMaskingBlur:"흐리게",sculptMaskingSharpen:"선명하게",sculptPBRTitle:"PBR 재질",sculptPaintAll:"전부 칠하기",sculptExtractTitle:"추출하기",sculptExtractThickness:"두께",sculptExtractAction:"추출!",stateTitle:"히스토리",stateUndo:"실행 취소",stateRedo:"다시 실행",stateMaxStack:"최대 실행취소 횟수",pressureTitle:"필압",pressureRadius:"필압반경",pressureIntensity:"필압 세기",renderingTitle:"렌더링",renderingGrid:"그리드 보기",renderingSymmetryLine:"대칭선 보기",renderingMatcap:"매트캡",renderingCurvature:"곡률 강조",renderingPBR:"PBR",renderingTransparency:"투명도",renderingNormal:"노말 셰이더",renderingUV:"UV 셰이더",renderingShader:"셰이더",renderingMaterial:"재질",renderingImportUV:"가져오기 (jpg, png...)",renderingImportMatcap:"가져오기 (jpg, png...)",renderingExtra:"그 외",renderingFlat:"플랫 셰이딩",renderingWireframe:"와이어프레임 (W)",renderingExposure:"노출",renderingEnvironment:"환경",renderingIsolate:"하나보기/모두보기 (I)",renderingFilmic:"영화적(filmic) 톤매핑",contour:"윤곽선",contourShow:"윤곽선 보기",contourColor:"색상",darkenUnselected:"선택안된건 어둡게",resolution:"해상도",matcapPearl:"진주",matcapClay:"찰흙",matcapSkin:"피부",matcapGreen:"초록",matcapWhite:"하양",sketchfabTitle:"Sketchfab에 올리기",sketchfabUpload:"올리기",sketchfabUploadMessage:null,sketchfabUploadError:null,sketchfabUploadSuccess:null,sketchfabAbort:null,sketchfabUploadProcessing:null,about:"SculptGL 정보",alphaNone:null,alphaSquare:null,alphaSkin:null},русский:{backgroundTitle:"Фон",backgroundReset:"Сброс",backgroundImport:"Импорт (jpg, png...)",backgroundFill:"Заполнить",cameraTitle:"Камера",cameraReset:"Вид",cameraCenter:"Сброс (bar)",cameraFront:"Спереди (F)",cameraLeft:"Слева (L)",cameraTop:"Сверху (T)",cameraMode:"Режим камеры",cameraOrbit:"Орбита (Вращение)",cameraSpherical:"Сферическая (трекбол)",cameraPlane:"Плоскость (трекбол)",cameraProjection:"Проекция",cameraPerspective:"Перспективная",cameraOrthographic:"Ортогональная",cameraFov:"Угол обзора",cameraPivot:"Выбор вращения",fileTitle:"Файл",fileImportTitle:"Импорт",fileAdd:"Добавить(obj,sgl,ply,stl)",fileAutoMatrix:"Масштаб-вид",fileVertexSRGB:"Цвета вершин sRGB",fileExportSceneTitle:"Экспорт сцены",fileExportAll:"Экспорт все",fileExportSGL:"Сохранить .sgl",fileExportOBJ:"Сохранить .obj",fileExportPLY:"Сохранить .ply",fileExportSTL:"Сохранить .stl",fileExportTextureTitle:null,fileExportTextureSize:null,fileExportColor:null,fileExportRoughness:null,fileExportMetalness:null,sceneTitle:"Сцена",sceneReset:"Очистить сцену",sceneResetConfirm:"Подтвердить четкую сцену",sceneAddSphere:"Добавить сферу",sceneAddCube:"Добавить куб",sceneAddCylinder:"Добавить цилиндр",sceneAddPlane:"Добавить плоскость",sceneAddTorus:"Добавить тор",sceneSelection:"Выбрать",sceneMerge:"Объединить",sceneDuplicate:null,sceneDelete:"Удалить выделение",meshTitle:"Сетка",meshNbVertices:"Вершины : ",meshNbFaces:"Грани : ",topologyTitle:"Топология",multiresTitle:"Детализация",multiresSubdivide:"Увеличить",multiresReverse:"Реверс",multiresResolution:"Разрешение",multiresNoLower:"Ниже уровня не существует.",multiresNoHigher:"Выше уровня не существует.",multiresDelHigher:"Удалить высокое",multiresDelLower:"Удалить низкое",multiresSelectLowest:"Выберете низкий перед реверсом.",multiresSelectHighest:"Выберете бысокий перед увеличением.",multiresWarnBigMesh:function(e){return"Следующий уровень "+e+' faces.\nЕсли вы уверены, снова нажмите на "разрешение".'},multiresNotReversible:"К сожалению это не возможно, чтобы изменить эту сетку.\nСетка не продуктивна.",remeshTitle:"Перестроить воксели",remeshRemesh:"Перестроить",remeshResolution:"Разрешение",remeshBlock:"Блоки-кубики",dynamicTitle:"Динамическая топология",dynamicActivated:"Активировать (без кубиков)",dynamicSubdivision:"Увеличить",dynamicDecimation:"Прореживание",dynamicLinear:"Линейное увеличение",sculptTitle:"Лепить и красить",sculptBrush:"3D Кисть",sculptInflate:"3D Надуть",sculptTwist:"3D Закручивание",sculptSmooth:"3D Сгладить (-Shift)",sculptFlatten:"3D Расплющить",sculptPinch:"3D Сдавить",sculptCrease:"3D Складка",sculptDrag:"3D Тянучка",sculptMove:"3D Перемещать",sculptLocalScale:"3D масштабирование",sculptPaint:"2D Кисть",sculptMasking:"2D Маска (-Ctrl)",sculptTransform:"Трансформация",sculptTransformMode:"Transform mode",sculptTransformTranslate:"Translate",sculptTransformRotate:"Rotate",sculptTransformScale:"Scale",sculptTransformAxis:"Transform axis",sculptTransformAxisAll:"All axes",sculptTransformAxisX:"X axis",sculptTransformAxisY:"Y axis",sculptTransformAxisZ:"Z axis",sculptTransformSpace:"Transform space",sculptTransformSpaceWorld:"World",sculptTransformSpaceLocal:"Local",sculptTransformSpaceNormal:"Normal",sculptCommon:"Общее",sculptTool:"Инструмент",sculptSymmetry:"Симетрия",sculptContinuous:"Спрей",sculptRadius:"Размер (-X)",sculptIntensity:"Сила (-C)",sculptHardness:"Жесткость",sculptCulling:"Тонкая поверхность(передние вершины)",sculptAlphaTitle:"Альфа",sculptLockPositon:"Фиксация",sculptAlphaTex:"Текстура",sculptImportAlpha:"Импорт альфа текстуры (jpg, png...)",sculptNegative:"Негатив (N или -Alt)",sculptColor:"Палитра",sculptRoughness:"Шероховатость",sculptMetallic:"Металлический",sculptClay:"Без учета содержимого",sculptAccumulate:"Наращивать без ограничений",sculptColorGlobal:"Глобальный",sculptPickColor:"Пипетка материал (-S)",sculptTangentialSmoothing:"Сглаживание по касательной",sculptTopologicalCheck:"Проверка топологии",sculptMoveAlongNormal:"Перемещать вдоль нормали",sculptMaskingClear:"Очистить (-Ctrl + Drag)",sculptMaskingInvert:"Инверсия (-Ctrl + Click)",sculptMaskingBlur:"Сгладить",sculptMaskingSharpen:"Резко",sculptPBRTitle:"PBR материал",sculptPaintAll:"Краска",sculptExtractTitle:"Извлечь",sculptExtractThickness:"Толщина",sculptExtractAction:"Извлечь!",stateTitle:"История",stateUndo:"Назад",stateRedo:"Вперед",stateMaxStack:"Количество шагов",pressureTitle:"Планшет pressure",pressureRadius:"Нажим-размер",pressureIntensity:"Нажим-жесткость",renderingTitle:"Визуализация",renderingGrid:"Показать сетку",renderingSymmetryLine:"Линия симетрии",renderingMatcap:null,renderingCurvature:"Рельефность",renderingPBR:"PBR",renderingTransparency:"Прозрачность",renderingNormal:"Карта нормалей",renderingUV:"UV",renderingShader:"Шейдеры",renderingMaterial:"Материал",renderingImportUV:"Импорт (jpg, png...)",renderingImportMatcap:"Импорт (jpg, png...)",renderingExtra:"Дополнительно",renderingFlat:"Плоскости",renderingWireframe:"Каркас (W)",renderingExposure:"Экспозиция",renderingEnvironment:"Отражение",renderingIsolate:"Изолировать / Показать (I)",renderingFilmic:"Пленка",contour:"Контур",contourShow:"Показать контур",contourColor:"Цвет",darkenUnselected:"Затемнить невыбранное",resolution:"Разрешение",matcapPearl:"Жемчуг",matcapClay:"Глина",matcapSkin:"Кожа",matcapGreen:"Зеленый",matcapWhite:"Белый",sketchfabTitle:"В Sketchfab.com ",sketchfabUpload:"Загрузить",sketchfabUploadMessage:"Ведите API-ключ sketchfab.\nОставьте слово «guest», чтобы загрузить модель анонимно.\n(По окончании загрузки и обработки откроется новое окно)",sketchfabUploadError:function(e){return"Ошибка загрузки в Sketchfab :\n"+e},sketchfabUploadSuccess:"Загрузка выполнена !\nВаша ссылка:",sketchfabAbort:"Прервать загрузку?",sketchfabUploadProcessing:"Обработка...\nВаша модель будет доступна после:",about:"О программе",alphaNone:"Нет",alphaSquare:"Квадрат",alphaSkin:"Кожа"},turkish:{backgroundTitle:"Arka plan",backgroundReset:"Temizle",backgroundImport:"İçe Aktar (jpg, png...)",backgroundFill:"Doldur",cameraTitle:"Kamera",cameraReset:"Görünüm",cameraCenter:"Temizle (boşluk)",cameraFront:"Ön (F)",cameraLeft:"Sol (L)",cameraTop:"Üst (T)",cameraMode:"Mod",cameraOrbit:"Eksen (Döner Tabla)",cameraSpherical:"Küresel (Trackball)",cameraPlane:"Düzlem (Trackball)",cameraProjection:"İz Düşüm",cameraPerspective:"Perspektif",cameraOrthographic:"Orthografik",cameraFov:"Görüş Alanı",cameraPivot:"Eksen",fileTitle:"Dosyalar (içeri/dışarı)",fileImportTitle:"İçe Aktar",fileAdd:"Aktar (obj, sgl, ply, stl)",fileAutoMatrix:"Ölçekle ve ortala",fileVertexSRGB:"sRGB verteks renk",fileExportSceneTitle:"Sahneyi Dışa Aktar",fileExportAll:"tümünü ver",fileExportSGL:"Kaydet .sgl (SculptGL)",fileExportOBJ:"Kaydet .obj",fileExportPLY:"Kaydet .ply",fileExportSTL:"Kaydet .stl",fileExportTextureTitle:null,fileExportTextureSize:null,fileExportColor:null,fileExportRoughness:null,fileExportMetalness:null,sceneTitle:"Sahne",sceneReset:"Sahneyi temizle",sceneResetConfirm:"Net sahneyi doğrulayın",sceneAddSphere:"Küre ekle",sceneAddCube:"Küp ekle",sceneAddCylinder:"Silindir ekle",sceneAddPlane:"Düzlem ekle",sceneAddTorus:"Halka ekle",sceneSelection:"Seçim",sceneMerge:"Seçimi birleştir",sceneDuplicate:null,sceneDelete:"Seçimi sil",meshTitle:"Nesne",meshNbVertices:"Verteks : ",meshNbFaces:"Cephe : ",topologyTitle:"Topoloji",multiresTitle:"Çoklu çözünürlük",multiresSubdivide:"Böl",multiresReverse:"Ters",multiresResolution:"Çözünürlük",multiresNoLower:"Daha düşük çözünürlük yok.",multiresNoHigher:"Daha yüksek çözünürlük yok.",multiresDelHigher:"Üst çözünürlüğü sil",multiresDelLower:"Alt çözünürlüğü sil",multiresSelectLowest:"Tersine çevirmeden önce en düşük çözünürlüğü seç.",multiresSelectHighest:"Tesine çevirmeden önce en yüksek çözünürlüğü seç.",multiresWarnBigMesh:function(e){return"Sonraki çözünürlük "+e+' cepheden oluşacak.\nEğer devam etmek istiyorsanız, tekrar "böl" butonuna basın.'},multiresNotReversible:"Malesef bu nesneyi tersine çevirmek mümkün değil.\nThe mesh is not a product of a (loop-catmull) subdivision surface on a manifold mesh.",remeshTitle:"Voksel Remeshing",remeshRemesh:"Remesh",remeshResolution:"Çözünürlük",remeshBlock:"Engelle",dynamicTitle:"Dinamik Topoloji",dynamicActivated:"Aktifleştirildi (no quads)",dynamicSubdivision:"Altbölüm",dynamicDecimation:"Üstbölüm",dynamicLinear:"Doğrusal altbölüm",sculptTitle:"Oyma & Boyama",sculptBrush:"Fırça",sculptInflate:"Şişir",sculptTwist:"Bükülme",sculptSmooth:"Yumuşat (-Shift)",sculptFlatten:"Düzleştir",sculptPinch:"Çimdik",sculptCrease:"Kıvrım",sculptDrag:"Sürükle",sculptPaint:"Boya",sculptMasking:"Maskeleme (-Ctrl)",sculptMove:"Taşı",sculptLocalScale:"Yerel ölçek",sculptTransform:"Transform (E)",sculptTransformMode:"Transform mode",sculptTransformTranslate:"Translate",sculptTransformRotate:"Rotate",sculptTransformScale:"Scale",sculptTransformAxis:"Transform axis",sculptTransformAxisAll:"All axes",sculptTransformAxisX:"X axis",sculptTransformAxisY:"Y axis",sculptTransformAxisZ:"Z axis",sculptTransformSpace:"Transform space",sculptTransformSpaceWorld:"World",sculptTransformSpaceLocal:"Local",sculptTransformSpaceNormal:"Normal",sculptCommon:"Genel",sculptTool:"Araç",sculptSymmetry:"Simetri",sculptContinuous:"Sürekli",sculptRadius:"Yarıçağ (-X)",sculptIntensity:"Yoğunluk (-C)",sculptHardness:"Sertlik",sculptCulling:"İnce yüzey (front vertex only)",sculptAlphaTitle:"Alfa",sculptLockPositon:"Pozisyonu kilitle",sculptAlphaTex:"Kaplama",sculptImportAlpha:"Alfa kaplama yükle (jpg, png...)",sculptNegative:"Negatif (N or -Alt)",sculptColor:"Aklık",sculptRoughness:"Pürüzlülük",sculptMetallic:"Metalik",sculptClay:"Kil",sculptAccumulate:"Biriktir (limitsiz)",sculptColorGlobal:"Evrensel",sculptPickColor:"Materyal / Renk seçici (-S)",sculptTangentialSmoothing:"Rahatlat",sculptTopologicalCheck:"Topoloji kontrol",sculptMoveAlongNormal:"Normal boyunca taşı (N or -Alt)",sculptMaskingClear:"Temizle (-Ctrl + Drag)",sculptMaskingInvert:"Tersine çevir (-Ctrl + Click)",sculptMaskingBlur:"Bulanıklaştır",sculptMaskingSharpen:"Keskinleştir",sculptPBRTitle:"PBR materyali",sculptPaintAll:"Tümünü boya",sculptExtractTitle:"Çıkar",sculptExtractThickness:"Kalınlık",sculptExtractAction:"Çıkar !",stateTitle:"Geçmiş",stateUndo:"Geri Al",stateRedo:"İleri Al",stateMaxStack:"Maksimum Yığın",pressureTitle:"Tablet pressure",pressureRadius:"Basınç çapı",pressureIntensity:"Basınç hassasiyeti",renderingTitle:"Sahneleme",renderingGrid:"Izgarayı göster",renderingSymmetryLine:"aynalama çizgisini göster",renderingMatcap:"Matcap",renderingCurvature:"Eğrilik",renderingPBR:"PBR",renderingTransparency:"Transparanlık",renderingNormal:"Normal shader",renderingUV:"UV shader",renderingShader:"Shader",renderingMaterial:"Materyal",renderingImportUV:"İçe AKtar (jpg, png...)",renderingImportMatcap:"İçe AKtar (jpg, png...)",renderingExtra:"Ekstra",renderingFlat:"Düz gölgeleme",renderingWireframe:"Tel kafes (W)",renderingExposure:"Teşir",renderingEnvironment:"Ortam",renderingIsolate:"İzole/Göster (I)",renderingFilmic:"Film Ton Eşleşmesi",contour:"Kontür",contourShow:"Kontürü göster",contourColor:"Renk",darkenUnselected:"Seçilmeyenleri koyu yap",resolution:"Çözünürlük",matcapPearl:"İnci",matcapClay:"Kil",matcapSkin:"Deri",matcapGreen:"Yeşil",matcapWhite:"Beyaz",sketchfabTitle:"Sketchfab'a git !",sketchfabUpload:"Yükle",sketchfabUploadMessage:'Lütfen sketchfab entegrasyon anahtarını giriniz.\nAnonim olarak kullanmak için "guest" olarak bırakınız.\n(İşleme ve yükleme tamamlandığında yeni bir pencere açılacak)',sketchfabUploadError:function(e){return"Sketchfab yükleme hatası :\n"+e},sketchfabUploadSuccess:"Yükleme başarılı !\nAdresiniz burada :",sketchfabAbort:"Son yüklemeyi iptal et ?",sketchfabUploadProcessing:"Hesaplanıyor...\nModeliniz şu adreste olacak :",about:"Hakkında & Yardım",alphaNone:"Hiç Biri",alphaSquare:"Kare",alphaSkin:"Deri"},svenska:{backgroundTitle:"Bakgrund",backgroundReset:"Återställ",backgroundImport:"Importera (jpg, png...)",backgroundFill:"Fyll",cameraTitle:"Kamera",cameraReset:"Vy",cameraCenter:"Återställ (bar)",cameraFront:"Fram (F)",cameraLeft:"Vänster (L)",cameraTop:"Över (T)",cameraMode:"Läge",cameraOrbit:"Omloppsbana (skivtallrik)",cameraSpherical:"Sfärisk (trackball)",cameraPlane:"Plan (trackball)",cameraProjection:"Projektion",cameraPerspective:"Perspektiv",cameraOrthographic:"Ortografisk",cameraFov:"Fov",cameraPivot:"Plocka pivot",fileTitle:"Filer (import/export)",fileImportTitle:"Importera",fileAdd:"Lägg till (obj, sgl, ply, stl)",fileAutoMatrix:"Skala och centrera",fileVertexSRGB:"sRGB vertexfärg",fileExportSceneTitle:"Exportera Scen",fileExportAll:"Exportera alla",fileExportSGL:"Spara .sgl (SculptGL)",fileExportOBJ:"Spara .obj",fileExportPLY:"Spara .ply",fileExportSTL:"Spara .stl",fileExportTextureTitle:null,fileExportTextureSize:null,fileExportColor:null,fileExportRoughness:null,fileExportMetalness:null,sceneTitle:"Scen",sceneReset:"Rensa scen",sceneResetConfirm:"Bekräfta klar scen",sceneAddSphere:"Lägg till sfär",sceneAddCube:"Lägg till kub",sceneAddCylinder:"Lägg till cylinder",sceneAddPlane:"Lägg till plan",sceneAddTorus:"Lägg till torus",sceneSelection:"Urval",sceneMerge:"Sammanfoga urval",sceneDuplicate:null,sceneDelete:"Radera valet",meshTitle:"Mesh",meshNbVertices:"Vertex : ",meshNbFaces:"Faces : ",topologyTitle:"Topologi",multiresTitle:"Upplösningar",multiresSubdivide:"Dela upp yta",multiresReverse:"Omvänd",multiresResolution:"Upplösning",multiresNoLower:"Det finns ingen lägre upplösningsnivå.",multiresNoHigher:"Det finns ingen högre upplösningsnivå.",multiresDelHigher:"Ta bort högre",multiresDelLower:"Ta bort lägre",multiresSelectLowest:"Välj den lägsta upplösningen innan omvändning.",multiresSelectHighest:"Välj den högsta upplösningen innan uppdelning.",multiresWarnBigMesh:function(e){return"Nästa underavdelning nivå kommer att ha "+e+' faces.\nOm du vet vad du gör, klicka igen på "dela upp yta".'},multiresNotReversible:"Tyvärr, det går inte att omvända denna mesh.\nMeshen är inte en produkt av en (loop-calmull) mångfaldsytindelning.",remeshTitle:"Voxel Meshombyggnation",remeshRemesh:"Bygg om mesh",remeshResolution:"Upplösning",remeshBlock:"Kuber",dynamicTitle:"Dynamisk Topologi",dynamicActivated:"Aktiverad (inga quads)",dynamicSubdivision:"Ytindelning",dynamicDecimation:"Decimering",dynamicLinear:"Linjär ytindelning",sculptTitle:"Skulptering & Måleri",sculptBrush:"Pensel",sculptInflate:"Blås upp",sculptTwist:"Tvista",sculptSmooth:"Jämna ut (-Shift)",sculptFlatten:"Platta till",sculptPinch:"Nyp",sculptCrease:"Vecka",sculptDrag:"Dra",sculptPaint:"Måla",sculptMasking:"Maskera (-Ctrl)",sculptMove:"Flytta",sculptLocalScale:"Skala lokalt",sculptTransform:"Transformera (E)",sculptTransformMode:"Transform mode",sculptTransformTranslate:"Translate",sculptTransformRotate:"Rotate",sculptTransformScale:"Scale",sculptTransformAxis:"Transform axis",sculptTransformAxisAll:"All axes",sculptTransformAxisX:"X axis",sculptTransformAxisY:"Y axis",sculptTransformAxisZ:"Z axis",sculptTransformSpace:"Transform space",sculptTransformSpaceWorld:"World",sculptTransformSpaceLocal:"Local",sculptTransformSpaceNormal:"Normal",sculptCommon:"Generellt",sculptTool:"Verktyg",sculptSymmetry:"Symmetri",sculptContinuous:"Kontinuerlig",sculptRadius:"Radie (-X)",sculptIntensity:"Intensitet (-C)",sculptHardness:"Hårdhet",sculptCulling:"Tunn yta (endast främre vertex)",sculptAlphaTitle:"Alfa",sculptLockPositon:"Lås position",sculptAlphaTex:"Textur",sculptImportAlpha:"Importera alfatextur (jpg, png...)",sculptNegative:"Negativ (N or -Alt)",sculptColor:"Albedo",sculptRoughness:"Ytjämnhet",sculptMetallic:"Metallisk",sculptClay:"Lera",sculptAccumulate:"Ackumulera (ingen gräns per strykning)",sculptColorGlobal:"Global",sculptPickColor:"Material / Färgvälgare (-S)",sculptTangentialSmoothing:"Tangentiell utjämning",sculptTopologicalCheck:"Topologisk check",sculptMoveAlongNormal:"Flytta längsmed normal (N or -Alt)",sculptMaskingClear:"Rensa (-Ctrl + Drag)",sculptMaskingInvert:"Invertera (-Ctrl + Click)",sculptMaskingBlur:"Gör suddig",sculptMaskingSharpen:"Gör skarp",sculptPBRTitle:"PBR-material",sculptPaintAll:"Måla allt",sculptExtractTitle:"Extrahera",sculptExtractThickness:"Tjocklek",sculptExtractAction:"Extrahera!",stateTitle:"Historia",stateUndo:"Ångra",stateRedo:"Gör om",stateMaxStack:"Ågra antal steg",pressureTitle:"pressureplatta",pressureRadius:"Tryckradie",pressureIntensity:"Tryckintensitet",renderingTitle:"Rendering",renderingGrid:"Visa rutnät",renderingSymmetryLine:"Visa speglingslinje",renderingMatcap:"MatCap",renderingCurvature:"Kurvatur",renderingPBR:"PBR",renderingTransparency:"Genomskinlighet",renderingNormal:"Normal shader",renderingUV:"UV-shader",renderingShader:"Shader",renderingMaterial:"Material",renderingImportUV:"Importera (jpg, png...)",renderingImportMatcap:"Importera (jpg, png...)",renderingExtra:"Extra",renderingFlat:"Platt shading",renderingWireframe:"Wireframe (W)",renderingExposure:"Exponering",renderingEnvironment:"Miljö",renderingIsolate:"Isolera/Visa (I)",renderingFilmic:"Filmiska färgtoner",contour:"Kontur",contourShow:"Visa kontur",contourColor:"Färg",darkenUnselected:"Skym ej valda",resolution:"Upplösning",matcapPearl:"Pärla",matcapClay:"Lera",matcapSkin:"Hud",matcapGreen:"Grön",matcapWhite:"Vit",sketchfabTitle:"Gå till Sketchfab!",sketchfabUpload:"Ladda upp",sketchfabUploadMessage:'Vänligen fyll i din sketchfab API-nyckel.\nDu kan även ange "guest" för att ladda upp anonymt.\n(ett nytt fönster kommer att öppnas när uppladdning och bearbetning är klar)',sketchfabUploadError:function(e){return"Sketchfab uppladdningsfel:\n"+e},sketchfabUploadSuccess:"Uppladdning lyckades!\nHär är din länk:",sketchfabAbort:"Avbryta senaste uppladdningen?",sketchfabUploadProcessing:"Bearbetar...\nDin modell kommer bli tillgänglig här:",about:"Om & Hjälp",alphaNone:"Ingen",alphaSquare:"Fyrkant",alphaSkin:"Hud"},français:{backgroundTitle:"Fond d'écran",backgroundReset:"Réinitialiser",backgroundImport:"Importer (jpg, png...)",backgroundFill:"Remplir",cameraTitle:"Caméra",cameraReset:"Vue",cameraCenter:"Reset (bar)",cameraFront:"De face (F)",cameraLeft:"De gauche (L)",cameraTop:"De haut (T)",cameraMode:"Mode",cameraOrbit:"Orbite (Turntable)",cameraSpherical:"Spherique (Trackball)",cameraPlane:"Planaire (Trackball)",cameraProjection:"Projection",cameraPerspective:"Perspective",cameraOrthographic:"Orthographique",cameraFov:"Champs de vision",cameraPivot:"Point de pivot",fileTitle:"Fichiers (importer/exporter)",fileImportTitle:"Importer",fileAdd:"Ajouter (obj, sgl, ply, stl)",fileAutoMatrix:"Mise a l'échelle et centrage",fileVertexSRGB:"Couleur de vertex en sRGB",fileExportSceneTitle:"Exporter Scene",fileExportAll:"Tout exporter",fileExportSGL:"Sauver .sgl (SculptGL)",fileExportOBJ:"Sauver .obj",fileExportPLY:"Sauver .ply",fileExportSTL:"Sauver .stl",fileExportTextureTitle:null,fileExportTextureSize:null,fileExportColor:null,fileExportRoughness:null,fileExportMetalness:null,sceneTitle:"Scène",sceneReset:"Réinitialiser scène",sceneResetConfirm:"Confirmer réinitialiser la scène?",sceneAddSphere:"Ajouter sphere",sceneAddCube:"Ajouter cube",sceneAddCylinder:"Ajouter cylindre",sceneAddPlane:"Ajouter plan",sceneAddTorus:"Ajouter tore",sceneSelection:"Sélection",sceneMerge:"Fusionner selection",sceneDuplicate:null,sceneDelete:"Supprimer la sélection",meshTitle:"Mesh",meshNbVertices:"Vertex : ",meshNbFaces:"Faces : ",topologyTitle:"Topologie",multiresTitle:"Multirésolution",multiresSubdivide:"Subdiviser",multiresReverse:"Inverser",multiresResolution:"Résolution",multiresNoLower:"Il n'y a pas de niveau de résolution inférieur.",multiresNoHigher:"Il n'y a pas de niveau de résolution plus élevé.",multiresDelHigher:"Suppression supérieur",multiresDelLower:"Suppression inférieur",multiresSelectLowest:"Sélectionnez la résolution la plus basse avant d'inverser.",multiresSelectHighest:"Sélectionnez la résolution la plus élevée avant de subdiviser.",multiresWarnBigMesh:function(e){return"Le prochain niveau de subdivision atteindra "+e+' faces.\nSi vous savez ce que vous faites, cliquez de nouveau sur "subdiviser".'},multiresNotReversible:"Désolé, il n'est pas possible d'inverser ce maillage.\nLe mesh n'est pas un produit d'une surface de subdivision (loop-catmull) provenant manifold.",remeshTitle:"Remaillage volumétrique",remeshRemesh:"Remaillage",remeshResolution:"Résolution",remeshBlock:"Bloc",dynamicTitle:"Topologie dynamique",dynamicActivated:"Activaté (pas quads)",dynamicSubdivision:"Subdivision",dynamicDecimation:"Décimation",dynamicLinear:"Subdivision linéaire",sculptTitle:"Sculpture & Painture",sculptBrush:"Brosse",sculptInflate:"Gonfler",sculptTwist:"Tordre",sculptSmooth:"Lisser (-Shift)",sculptFlatten:"Aplatir",sculptPinch:"Pincer",sculptCrease:"Plier",sculptDrag:"Tirer",sculptPaint:"Peindre",sculptMasking:"Masquer (-Ctrl)",sculptMove:"Bouger",sculptLocalScale:"Mise à l'échelle locale",sculptTransform:"Transformer (E)",sculptTransformMode:"Transform mode",sculptTransformTranslate:"Translate",sculptTransformRotate:"Rotate",sculptTransformScale:"Scale",sculptTransformAxis:"Transform axis",sculptTransformAxisAll:"All axes",sculptTransformAxisX:"X axis",sculptTransformAxisY:"Y axis",sculptTransformAxisZ:"Z axis",sculptTransformSpace:"Transform space",sculptTransformSpaceWorld:"World",sculptTransformSpaceLocal:"Local",sculptTransformSpaceNormal:"Normal",sculptCommon:"Commun",sculptTool:"Outil",sculptSymmetry:"Symétrie",sculptContinuous:"Continu",sculptRadius:"Rayon (-X)",sculptIntensity:"Intensité (-C)",sculptHardness:"Dureté",sculptCulling:"Surface fine (vertex de face uniquement)",sculptAlphaTitle:"Alpha",sculptLockPositon:"Bloquer position",sculptAlphaTex:"Texture",sculptImportAlpha:"Importer texture alpha (jpg, png...)",sculptNegative:"Négatif (N ou -Alt)",sculptColor:"Albedo",sculptRoughness:"Rugosité",sculptMetallic:"Métallique",sculptClay:"Argile",sculptAccumulate:"Accumuler effet",sculptColorGlobal:"Global",sculptPickColor:"Matériau / selection de couleur (-S)",sculptTangentialSmoothing:"Relaxer uniquement",sculptTopologicalCheck:"Vérification topologique",sculptMoveAlongNormal:"Extruder suivant la normale (N ou -Alt)",sculptMaskingClear:"Reset (-Ctrl + Drag)",sculptMaskingInvert:"Inverser (-Ctrl + Click)",sculptMaskingBlur:"Brouiller",sculptMaskingSharpen:"Aiguiser",sculptPBRTitle:"Matériaux physiques (PBR)",sculptPaintAll:"Peindre tout",sculptExtractTitle:"Extraire",sculptExtractThickness:"Epaisseur",sculptExtractAction:"Extraire !",stateTitle:"Historique",stateUndo:"Annuler",stateRedo:"Refaire",stateMaxStack:"Nombre maximale d'action",pressureTitle:"Pression de la tablette",pressureRadius:"Pression sur le rayon",pressureIntensity:"Pression sur l'intensité",renderingTitle:"Rendu",renderingGrid:"Afficher grille",renderingSymmetryLine:"Afficher ligne de symétrie",renderingMatcap:"Matcap",renderingCurvature:"Courbure",renderingPBR:"PBR",renderingTransparency:"Transparence",renderingNormal:"Normal shader",renderingUV:"UV shader",renderingShader:"Shader",renderingMaterial:"Matériau",renderingImportUV:"Importer (jpg, png...)",renderingImportMatcap:"Importer (jpg, png...)",renderingExtra:"Extra",renderingFlat:"Ombrage plat",renderingWireframe:"Fil de fer (W)",renderingExposure:"Exposition",renderingEnvironment:"Environment",renderingIsolate:"Isoler/Afficher (I)",renderingFilmic:"Tonemapping filmique",contour:"Contour",contourShow:"Afficher les contours",contourColor:"Couleur",darkenUnselected:"Assombrir non séléctioné",resolution:"Résolution",matcapPearl:"Perle",matcapClay:"Argile",matcapSkin:"Peau",matcapGreen:"Vert",matcapWhite:"Blanc",sketchfabTitle:"Vers Sketchfab !",sketchfabUpload:"Uploader",sketchfabUploadMessage:"Entrez votre clé d'API sketchfab.\n",sketchfabUploadError:function(e){return"Sketchfab upload error :\n"+e},sketchfabUploadSuccess:"Téléchargement fini !\nVoici le lien :",sketchfabAbort:"Annuler le dernier téléchargement ?",sketchfabUploadProcessing:"En traitement...\nLe modèle sera disponible sur :",about:"A propos & aide",alphaNone:"Vide",alphaSquare:"Carré",alphaSkin:"Peau",remeshTitleMC:"Remaillage surfacique (manifold tris)",remeshRemeshMC:"Remaillage",remeshSmoothingMC:"Lisser topologie"},deutsch:{backgroundTitle:"Hintergrund",backgroundReset:"Zurücksetzen",backgroundImport:"Importieren (jpg, png...)",backgroundFill:"Füllen",cameraTitle:"Kamera",cameraReset:"Ansicht",cameraCenter:"Reset (space)",cameraFront:"Front (F)",cameraLeft:"Links (L)",cameraTop:"Oben (T)",cameraMode:"Modus",cameraOrbit:"Orbit (Drehscheibe)",cameraSpherical:"Sphärisch (Rollkugel)",cameraPlane:"Ebene (Rollkugel)",cameraProjection:"Projektion",cameraPerspective:"Perspektivisch",cameraOrthographic:"Orthographisch",cameraFov:"Sichtfeld (fov)",cameraPivot:"Pivot auswählen",fileTitle:"Datei (import/export)",fileImportTitle:"Importieren",fileAdd:"Hinzufügen (obj, sgl, ply, stl)",fileAutoMatrix:"Skalieren und zentrieren",fileVertexSRGB:"Vertexfarbe sRGB",fileExportSceneTitle:"Exportieren",fileExportAll:"Alles Exportieren",fileExportSGL:"Speichern .sgl (SculptGL)",fileExportOBJ:"Speichern .obj",fileExportPLY:"Speichern .ply",fileExportSTL:"Speichern .stl",fileExportTextureTitle:"Texturen exportieren",fileExportTextureSize:"Größe",fileExportColor:"Farben speichern",fileExportRoughness:"Rauheit speichern",fileExportMetalness:"Metallisches speichern",sceneTitle:"Szene",sceneReset:"Szene löschen",sceneResetConfirm:"Bestätige das Löschen der aktuellen Szene",sceneAddSphere:"Kugel hinzufügen",sceneAddCube:"Würfel hinzufügen",sceneAddCylinder:"Zylinder hinzufügen",sceneAddPlane:"Ebene hinzufügen",sceneAddTorus:"Torus hinzufügen",sceneSelection:"Auswahl",sceneMerge:"Auswahl zusammenführen",sceneDuplicate:"Auswahl kopieren",sceneDelete:"Auswahl löschen",meshTitle:"Mesh",meshNbVertices:"Vertex : ",meshNbFaces:"Faces : ",topologyTitle:"Topologie",multiresTitle:"Mehrfachauflösung",multiresSubdivide:"Aufteilen",multiresReverse:"Umkehren",multiresResolution:"Auflösung",multiresNoLower:"Es gibt keine kleinere Auflösung.",multiresNoHigher:"Es gibt keine höhere Auflösung.",multiresDelHigher:"Höhere löschen",multiresDelLower:"Niedrigere löschen",multiresSelectLowest:"Wählen Sie vor dem Umkehren die kleinste Auflösung aus.",multiresSelectHighest:"Wählen Sie vor dem Umkehren die höchste Auflösung aus.",multiresWarnBigMesh:function(e){return"Die nächste Unterteilungsebene wird "+e+' Flächen erreichen\nWenn Sie wissen, was Sie tun, dann klicken Sie nocheinmal auf "umkehren".'},multiresNotReversible:"Es ist leider nicht möglich dieses Netz umzukehren.\nDas Netz ist kein Produkt einer (loop/catmull) Unterteilungsfläche auf eines mannigfaltigen Netzes",remeshTitle:"Voxel remeshing (Vierecke)",remeshRemesh:"Remesh",remeshResolution:"Auflösung",remeshBlock:"Block",dynamicTitle:"Dynamische Topologie",dynamicActivated:"Aktiviert (ohne Vierecke)",dynamicSubdivision:"Aufteilung",dynamicDecimation:"Dezimierung",dynamicLinear:"Lineare Aufteilung",sculptTitle:"Modellieren & Bemalen",sculptBrush:"Pinsel",sculptInflate:"Aufblasen",sculptTwist:"Verdrehen",sculptSmooth:"Glätten (-Shift)",sculptFlatten:"Ebnen",sculptPinch:"Kneifen",sculptCrease:"Falten",sculptDrag:"Ziehen",sculptPaint:"Malen",sculptMasking:"Maskieren (-Strg)",sculptMove:"Bewegen",sculptLocalScale:"Lokales Skalieren",sculptTransform:"Transformieren (E)",sculptTransformMode:"Transform mode",sculptTransformTranslate:"Translate",sculptTransformRotate:"Rotate",sculptTransformScale:"Scale",sculptTransformAxis:"Transform axis",sculptTransformAxisAll:"All axes",sculptTransformAxisX:"X axis",sculptTransformAxisY:"Y axis",sculptTransformAxisZ:"Z axis",sculptTransformSpace:"Transform space",sculptTransformSpaceWorld:"World",sculptTransformSpaceLocal:"Local",sculptTransformSpaceNormal:"Normal",sculptCommon:"Allgemein",sculptTool:"Werkzeuge",sculptSymmetry:"Symmetrie",sculptContinuous:"Kontinuierlich",sculptRadius:"Radius (-X)",sculptIntensity:"Intensität (-C)",sculptHardness:"Härte",sculptCulling:"Dünne Oberfläche (nur vorderer vertex)",sculptAlphaTitle:"Alpha",sculptLockPositon:"Verriegelungsposition",sculptAlphaTex:"Textur",sculptImportAlpha:"Alpha tex importieren(jpg, png...)",sculptNegative:"Negativ (N or -Alt)",sculptColor:"Albedo",sculptRoughness:"Rauheit",sculptMetallic:"Metallisches",sculptClay:"Lehm",sculptAccumulate:"Akkumulieren (Kein Limit pro Anschlag)",sculptColorGlobal:"Global",sculptPickColor:"Material / Farb Auswahl (-S)",sculptTangentialSmoothing:"Tangentiale Glättung",sculptTopologicalCheck:"Topologischer Check",sculptMoveAlongNormal:"Normal weiterlaufen (N or -Alt)",sculptMaskingClear:"Löschen (-Ctrl + Drag)",sculptMaskingInvert:"Invertieren (-Ctrl + Click)",sculptMaskingBlur:"Verwischen",sculptMaskingSharpen:"Schärfen",sculptPBRTitle:"PBR Materialen",sculptPaintAll:"Alles Anmalen",sculptExtractTitle:"Extrahieren",sculptExtractThickness:"Dicke",sculptExtractAction:"Extrahieren !",stateTitle:"Verlauf",stateUndo:"Rückgängig",stateRedo:"Wiederholen",stateMaxStack:"Max. Schritte",pressureTitle:"Tablet Druck",pressureRadius:"Druckradius",pressureIntensity:"Druckintensität",renderingTitle:"Rendering",renderingGrid:"Gitter anzeigen",renderingSymmetryLine:"Spiegellinie anzeigen",renderingMatcap:"Matcap",renderingCurvature:"Krümmung",renderingPBR:"PBR",renderingTransparency:"Transparenz",renderingNormal:"Normale Shader",renderingUV:"UV shader",renderingShader:"Shader",renderingMaterial:"Material",renderingImportUV:"Importieren (jpg, png...)",renderingImportMatcap:"Importieren (jpg, png...)",renderingExtra:"Extra",renderingFlat:"Flaches Schattieren",renderingWireframe:"Drahtgitter (W)",renderingExposure:"Belichtung",renderingEnvironment:"Umgebung",renderingIsolate:"Isoliert/Zeige (I)",renderingFilmic:"Filmische Tonzuordnung",contour:"Kontur",contourShow:"Kontur anzeigen",contourColor:"Farbe",darkenUnselected:"Nicht markiertes abdunkeln",resolution:"Auflösung",matcapPearl:"Perle",matcapClay:"Ton",matcapSkin:"Haut",matcapGreen:"Grün",matcapWhite:"Weiß",sketchfabTitle:"Hier gehts zu Sketchfab !",sketchfabUpload:"Hochladen",sketchfabUploadMessage:'Please enter your sketchfab API Key.\nYou can also leave "guest" to upload anonymously.\n(a new window will pop up when the uploading and processing is finished)',sketchfabUploadError:function(e){return"Sketchfab upload error :\n"+e},sketchfabUploadSuccess:"Upload success !\nHere is your link :",sketchfabAbort:"Abort the last upload ?",sketchfabUploadProcessing:"Processing...\nYour model will be available at :",about:"Über & Hilfe (Englisch)",alphaNone:"None",alphaSquare:"Würfel",alphaSkin:"Haut",remeshTitleMC:"Voxel remeshing (mannigfaltige Dreiecke)",remeshRemeshMC:"Remesh",remeshSmoothingMC:"Topologie entspannen"},italiano:{backgroundTitle:"Sfondo",backgroundReset:"Resetta",backgroundImport:"Importa (jpg, png...)",backgroundFill:"Riempi",cameraTitle:"Camera",cameraReset:"Vista",cameraCenter:"Resetta (bar)",cameraFront:"Fronte (F)",cameraLeft:"Sinistra (L)",cameraTop:"Sopra (T)",cameraMode:"Modalitá",cameraOrbit:"Orbita (Ruota intorno)",cameraSpherical:"Sferica (Trackball)",cameraPlane:"Planare (Trackball)",cameraProjection:"Proiezione",cameraPerspective:"Prospettiva",cameraOrthographic:"Ortografica",cameraFov:"Fov",cameraPivot:"Seleziona pivot",fileTitle:"Files (importa/esporta)",fileImportTitle:"Importa",fileAdd:"Aggiungi (obj, sgl, ply, stl)",fileAutoMatrix:"Scala e centra",fileVertexSRGB:"sRGB vertex color",fileExportSceneTitle:"Esporta Scena",fileExportAll:"Exporta tutto",fileExportSGL:"Salva .sgl (SculptGL)",fileExportOBJ:"Salva .obj",fileExportPLY:"Salva .ply",fileExportSTL:"Salva .stl",fileExportTextureTitle:"Esporta textures",fileExportTextureSize:"Dimensione",fileExportColor:"Salva diffuse",fileExportRoughness:"Salva roughness",fileExportMetalness:"Salva metalness",sceneTitle:"Scena",sceneReset:"Pulisci scena",sceneResetConfirm:"Conferma pulitura scena",sceneAddSphere:"Aggiungi sfera",sceneAddCube:"Aggiungi cubo",sceneAddCylinder:"Aggiungi cilindro",sceneAddPlane:"Aggiungi piano",sceneAddTorus:"Aggiungi toroide",sceneSelection:"Selezione",sceneMerge:"Unisci selezione",sceneDuplicate:"Copia selezione",sceneDelete:"Elimina selezione",meshTitle:"Mesh",meshNbVertices:"Vertex : ",meshNbFaces:"Faces : ",topologyTitle:"Topologia",multiresTitle:"Multirisoluzione",multiresSubdivide:"Suddivisione",multiresReverse:"Invertire",multiresResolution:"Risoluzione",multiresNoLower:"Non esiste un livello di risoluzione inferiore.",multiresNoHigher:"Non esiste un livello di risoluzione più alto.",multiresDelHigher:"Elimina superiore",multiresDelLower:"Elimina inferiore",multiresSelectLowest:"Selezionare la risoluzione più bassa prima di invertire.",multiresSelectHighest:"Seleziona la risoluzione più alta prima di suddividere.",multiresWarnBigMesh:function(e){return"Il livello di suddivisione successivo raggiungerà "+e+' facce.\nSe sai cosa stai facendo, clicca di nuovo su "Suddividi".'},multiresNotReversible:"Spiacenti, non è possibile invertire questa mesh.\nLa mesh non è un prodotto di una superficie di suddivisione (loop-catmull) su una mesh collettore.",remeshTitle:"Voxel remeshing (quads)",remeshRemesh:"Remesh",remeshResolution:"Risolutione",remeshBlock:"Blocca",dynamicTitle:"Topologia Dinamica",dynamicActivated:"Attivata (no quads)",dynamicSubdivision:"Suddivisione",dynamicDecimation:"Decimazione",dynamicLinear:"Suddivisione Lineare",sculptTitle:"Scalpisci & Dipingi",sculptBrush:"Spazzola",sculptInflate:"Gonfia",sculptTwist:"Torci",sculptSmooth:"Ammorbidisci (-Shift)",sculptFlatten:"Appiattisci",sculptPinch:"Pizzica",sculptCrease:"Piega",sculptDrag:"Trascina",sculptPaint:"Dipingi",sculptMasking:"Maschera (-Ctrl)",sculptMove:"Muovi",sculptLocalScale:"Scala Locale",sculptTransform:"Trasformazioni (E)",sculptTransformMode:"Transform mode",sculptTransformTranslate:"Translate",sculptTransformRotate:"Rotate",sculptTransformScale:"Scale",sculptTransformAxis:"Transform axis",sculptTransformAxisAll:"All axes",sculptTransformAxisX:"X axis",sculptTransformAxisY:"Y axis",sculptTransformAxisZ:"Z axis",sculptTransformSpace:"Transform space",sculptTransformSpaceWorld:"World",sculptTransformSpaceLocal:"Local",sculptTransformSpaceNormal:"Normal",sculptCommon:"Comune",sculptTool:"Strumento",sculptSymmetry:"Simmetria",sculptContinuous:"Continua",sculptRadius:"Raggio (-X)",sculptIntensity:"Intensità (-C)",sculptHardness:"Durezza",sculptCulling:"Superficie sottile (solo vertici frontali)",sculptAlphaTitle:"Alpha",sculptLockPositon:"Blocca posizione",sculptAlphaTex:"Texture",sculptImportAlpha:"Importa alpha tex (jpg, png...)",sculptNegative:"Negativo (N or -Alt)",sculptColor:"Albedo",sculptRoughness:"Rugosità",sculptMetallic:"Metallico",sculptClay:"Clay",sculptAccumulate:"Accumulazione (no limit per stroke)",sculptColorGlobal:"Globale",sculptPickColor:"Materiale / Color picker (-S)",sculptTangentialSmoothing:"Solo Relax",sculptTopologicalCheck:"Controllo Topologia",sculptMoveAlongNormal:"Muovi lungo la normale (N o -Alt)",sculptMaskingClear:"Pulisci (-Ctrl + Drag)",sculptMaskingInvert:"Inverti (-Ctrl + Click)",sculptMaskingBlur:"Sfoca",sculptMaskingSharpen:"Nitidezza",sculptPBRTitle:"Materiali PBR",sculptPaintAll:"Dipingi tutto",sculptExtractTitle:"Estrazione",sculptExtractThickness:"Assottigliamento",sculptExtractAction:"Estrai !",stateTitle:"Story",stateUndo:"Indietro",stateRedo:"Avanti",stateMaxStack:"Pila massima",pressureTitle:"Pressione tavoletta",pressureRadius:"Raggio pressione",pressureIntensity:"Intensità pressione",renderingTitle:"Rendering",renderingGrid:"Vedi Griglia",renderingSymmetryLine:"Vedi linea di specchiatura",renderingMatcap:"Matcap",renderingCurvature:"Curvature",renderingPBR:"PBR",renderingTransparency:"Trasparenza",renderingNormal:"Normal shader",renderingUV:"UV shader",renderingShader:"Shader",renderingMaterial:"Materiale",renderingImportUV:"Importa (jpg, png...)",renderingImportMatcap:"Importa (jpg, png...)",renderingExtra:"Extra",renderingFlat:"Shading piatto",renderingWireframe:"Wireframe (W)",renderingExposure:"Esposizione",renderingEnvironment:"Ambiente",renderingIsolate:"Isola/Vedi (I)",renderingFilmic:"Coloritura tipo Film",contour:"Contorno",contourShow:"Vedi contorno",contourColor:"Colore",darkenUnselected:"Scurisci i non selezionati",resolution:"Risolutione",matcapPearl:"Perla",matcapClay:"Argilla",matcapSkin:"Pelle",matcapGreen:"Verde",matcapWhite:"Bianco",sketchfabTitle:"Vai su Sketchfab !",sketchfabUpload:"Upload",sketchfabUploadMessage:'Inserisci la tua chiave API di sketchfab.\nPuoi anche lasciare "guest" per caricare in modo anonimo.\n(verrà visualizzata una nuova finestra al termine del caricamento e dell\'elaborazione)',sketchfabUploadError:function(e){return"Sketchfab errore upload :\n"+e},sketchfabUploadSuccess:"Caricato con successo !\nEcco il tuo link :",sketchfabAbort:"Annulla l'ultimo caricamento?",sketchfabUploadProcessing:"Processing...\nIl tuo modello sarà disponibile su :",about:"Informazioni & Aiuto",alphaNone:"Nessuno",alphaSquare:"Quadrata",alphaSkin:"Pelle",remeshTitleMC:"Voxel remeshing (manifold tris)",remeshRemeshMC:"Remesh",remeshSmoothingMC:"Relax topology"}},o.select="english";var l=window.navigator.language||window.navigator.userLanguage;switch(l&&(l=l.substr(0,2)),"ja"===l?o.select="日本語":"zh"===l?o.select="中文":"ko"===l?o.select="한국어":"tr"===l?o.select="turkish":"sv"===l?o.select="svenska":"fr"===l?o.select="français":"de"===l&&(o.select="deutsch"),(0,i.Z)().language){case"english":o.select="english";break;case"chinese":o.select="中文";break;case"korean":o.select="한국어";break;case"japanese":o.select="日本語";break;case"russian":o.select="русский";break;case"turkish":o.select="turkish";break;case"swedish":o.select="svenska";break;case"french":o.select="français";break;case"german":o.select="deutsch";break;case"italian":o.select="italiano"}const u=o},165:(e,t,r)=>{"use strict";r.d(t,{Z:()=>T});var i,n,a,s,o,l,u,c,h,d,f,p,_,m,g,v,y=r(174),b={normalizedMouse:function(e,t,r,i){return[2*e/r-1,1-2*t/i]},mouseOnUnitSphere:function(e){var t=e[0],r=e[1],i=1-t*t-r*r,n=[t,r,i>0?Math.sqrt(i):0];return y.R3.normalize(n,n)}};b.intersectionRayTriangleEdges=(i=1+1e-15,n=-1e-15,a=[0,0,0],s=[0,0,0],o=[0,0,0],function(e,t,r,l,u,c){y.R3.cross(a,t,l);var h=y.R3.dot(r,a);if(h>-1e-15&&h<1e-15)return-1;var d=1/h;y.R3.sub(s,e,u);var f=y.R3.dot(s,a)*d;if(f<n||f>i)return-1;y.R3.cross(o,s,r);var p=y.R3.dot(t,o)*d;if(p<n||f+p>i)return-1;var _=y.R3.dot(l,o)*d;return _<n?-1:(c&&y.R3.scaleAndAdd(c,e,t,_),_)}),b.intersectionRayTriangle=(l=[0,0,0],u=[0,0,0],function(e,t,r,i,n,a){return y.R3.sub(l,i,r),y.R3.sub(u,n,r),b.intersectionRayTriangleEdges(e,t,l,u,r,a)}),b.distance2PointTriangleEdges=(c=[0,0,0],function(e,t,r,i,n,a,s,o){y.R3.sub(c,i,e);var l,u,h,d,f,p=y.R3.dot(c,t),_=y.R3.dot(c,r),m=y.R3.sqrLen(c),g=Math.abs(n*s-a*a),v=a*_-s*p,b=a*p-n*_,T=4;if(v+b<=g)if(v<0)b<0?(T=4,p<0?(b=0,-p>=n?(v=1,l=n+2*p+m):l=p*(v=-p/n)+m):(v=0,_>=0?(b=0,l=m):-_>=s?(b=1,l=s+2*_+m):l=_*(b=-_/s)+m)):(T=3,v=0,_>=0?(b=0,l=m):-_>=s?(b=1,l=s+2*_+m):l=_*(b=-_/s)+m);else if(b<0)T=5,b=0,p>=0?(v=0,l=m):-p>=n?(v=1,l=n+2*p+m):l=p*(v=-p/n)+m;else{T=0;var k=1/g;l=(v*=k)*(n*v+a*(b*=k)+2*p)+b*(a*v+s*b+2*_)+m}else v<0?(T=2,(h=s+_)>(u=a+p)?(d=h-u)>=(f=n-2*a+s)?(v=1,b=0,l=n+2*p+m):l=(v=d/f)*(n*v+a*(b=1-v)+2*p)+b*(a*v+s*b+2*_)+m:(v=0,h<=0?(b=1,l=s+2*_+m):_>=0?(b=0,l=m):l=_*(b=-_/s)+m)):b<0?(T=6,(h=n+p)>(u=a+_)?(d=h-u)>=(f=n-2*a+s)?(b=1,v=0,l=s+2*_+m):l=(v=1-(b=d/f))*(n*v+a*b+2*p)+b*(a*v+s*b+2*_)+m:(b=0,h<=0?(v=1,l=n+2*p+m):p>=0?(v=0,l=m):l=p*(v=-p/n)+m)):(T=1,(d=s+_-a-p)<=0?(v=0,b=1,l=s+2*_+m):d>=(f=n-2*a+s)?(v=1,b=0,l=n+2*p+m):l=(v=d/f)*(n*v+a*(b=1-v)+2*p)+b*(a*v+s*b+2*_)+m);return l<0&&(l=0),o&&(o[0]=i[0]+v*t[0]+b*r[0],o[1]=i[1]+v*t[1]+b*r[1],o[2]=i[2]+v*t[2]+b*r[2],o[3]=T),l}),b.distance2PointTriangle=function(){var e=[0,0,0],t=[0,0,0];return function(r,i,n,a,s){y.R3.sub(e,n,i),y.R3.sub(t,a,i);var o=y.R3.sqrLen(e),l=y.R3.dot(e,t),u=y.R3.sqrLen(t);return b.distance2PointTriangleEdges(r,e,t,i,o,l,u,s)}}(),b.pointInsideTriangle=(h=[0,0,0],d=[0,0,0],f=[0,0,0],p=[0,0,0],_=[0,0,0],function(e,t,r,i){y.R3.sub(h,t,r),y.R3.sub(d,t,i),y.R3.sub(f,e,r),y.R3.sub(p,e,i);var n=y.R3.len(y.R3.cross(_,h,d)),a=y.R3.len(y.R3.cross(_,h,f)),s=y.R3.len(y.R3.cross(_,d,p)),o=y.R3.len(y.R3.cross(_,f,p));return Math.abs(n-(a+s+o))<1e-20}),b.triangleInsideSphere=function(e,t,r,i,n){return b.distanceSqToSegment(e,r,i)<t||b.distanceSqToSegment(e,i,n)<t||b.distanceSqToSegment(e,r,n)<t},b.distanceSqToSegment=(m=[0,0,0],g=[0,0,0],function(e,t,r){y.R3.sub(m,e,t),y.R3.sub(g,r,t);var i=y.R3.sqrLen(g),n=y.R3.dot(m,g)/i;return n<0?y.R3.sqrLen(m):n>1?y.R3.sqrLen(y.R3.sub(m,e,r)):(m[0]=e[0]-t[0]-n*g[0],m[1]=e[1]-t[1]-n*g[1],m[2]=e[2]-t[2]-n*g[2],y.R3.sqrLen(m))}),b.signedAngle2d=function(e,t){var r=e[0],i=e[1],n=t[0],a=t[1];return Math.atan2(r*a-i*n,r*n+i*a)},b.pointPlaneDistance=function(){var e=[0,0,0];return function(t,r,i){return y.R3.dot(y.R3.sub(e,t,r),i)}}(),b.mirrorPoint=function(){var e=[0,0,0];return function(t,r,i){return y.R3.sub(t,t,y.R3.scale(e,i,2*b.pointPlaneDistance(t,r,i)))}}(),b.vertexOnLine=(v=[0,0,0],function(e,t,r){y.R3.sub(v,r,t);var i=[0,0,0],n=y.R3.dot(v,y.R3.sub(i,e,t));return y.R3.scaleAndAdd(i,t,v,n/y.R3.sqrLen(v))}),b.intersectLinePlane=function(e,t,r,i,n){var a=y.R3.dot(y.R3.sub(n,e,r),i),s=y.R3.dot(y.R3.sub(n,t,r),i);if(a===s)return t;var o=-a/(s-a);return y.R3.scaleAndAdd(n,e,y.R3.sub(n,t,e),o)},b.getPerpendicularVector=function(e){var t=[0,0,0];return 0===e[0]?t[0]=1:0===e[1]?t[1]=1:0===e[2]?t[2]=1:(t[0]=e[2],t[1]=e[2],t[2]=-e[0]-e[1],y.R3.normalize(t,t)),t};const T=b},358:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var math3d_three_compat__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(174),math3d_Geometry__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(165),misc_Tablet__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(522),misc_Utils__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(781),gui_GuiTR__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(183);function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}var _TMP_NEAR=[0,0,0],_TMP_NEAR_1=[0,0,0],_TMP_FAR=[0,0,0],_TMP_INV=math3d_three_compat__WEBPACK_IMPORTED_MODULE_0__._E.create(),_TMP_INTER=[0,0,0],_TMP_INTER_1=[0,0,0],_TMP_V1=[0,0,0],_TMP_V2=[0,0,0],_TMP_V3=[0,0,0],Picking=function(){function e(t,r){_classCallCheck(this,e),this._mesh=null,this._main=t,this._pickedFace=-1,this._pickedVertices=[],this._interPoint=[0,0,0],this._rLocal2=0,this._rWorld2=0,this._eyeDir=[0,0,0],this._xSym=!!r,this._pickedNormal=[0,0,0],this._alphaOrigin=[0,0,0],this._alphaSide=0,this._alphaLookAt=math3d_three_compat__WEBPACK_IMPORTED_MODULE_0__._E.create(),this._alpha=null}return _createClass(e,[{key:"setIdAlpha",value:function(t){this._alpha=e.ALPHAS[t]}},{key:"getAlpha",value:function(e,t,r){var i=this._alpha;if(!i||!i._texture)return 1;var n=this._alphaLookAt,a=this._alphaSide,s=i._ratioY*(n[0]*e+n[4]*t+n[8]*r+n[12])/(this._xSym?-a:a);if(Math.abs(s)>1)return 0;var o=i._ratioX*(n[1]*e+n[5]*t+n[9]*r+n[13])/a;if(Math.abs(o)>1)return 0;var l=i._width;return s=(.5-.5*s)*l,o=(.5-.5*o)*i._height,i._texture[(0|s)+l*(0|o)]/255}},{key:"updateAlpha",value:function(e){var t=_TMP_V1,r=_TMP_V2,i=Math.sqrt(this._rLocal2);if(this._alphaSide=i*Math.SQRT1_2,math3d_three_compat__WEBPACK_IMPORTED_MODULE_0__.R3.sub(t,this._interPoint,this._alphaOrigin),0!==math3d_three_compat__WEBPACK_IMPORTED_MODULE_0__.R3.len(t)){math3d_three_compat__WEBPACK_IMPORTED_MODULE_0__.R3.normalize(t,t);var n=this._pickedNormal;math3d_three_compat__WEBPACK_IMPORTED_MODULE_0__.R3.scaleAndAdd(t,t,n,-math3d_three_compat__WEBPACK_IMPORTED_MODULE_0__.R3.dot(t,n)),math3d_three_compat__WEBPACK_IMPORTED_MODULE_0__.R3.normalize(t,t),e||math3d_three_compat__WEBPACK_IMPORTED_MODULE_0__.R3.copy(this._alphaOrigin,this._interPoint),math3d_three_compat__WEBPACK_IMPORTED_MODULE_0__.R3.scaleAndAdd(r,this._alphaOrigin,n,i),math3d_three_compat__WEBPACK_IMPORTED_MODULE_0__._E.lookAt(this._alphaLookAt,this._alphaOrigin,r,t)}}},{key:"initAlpha",value:function(){this.computePickedNormal(),this.updateAlpha()}},{key:"getMesh",value:function(){return this._mesh}},{key:"setLocalRadius2",value:function(e){this._rLocal2=e}},{key:"getLocalRadius2",value:function(){return this._rLocal2}},{key:"getLocalRadius",value:function(){return Math.sqrt(this._rLocal2)}},{key:"getWorldRadius2",value:function(){return this._rWorld2}},{key:"getWorldRadius",value:function(){return Math.sqrt(this._rWorld2)}},{key:"setIntersectionPoint",value:function(e){this._interPoint=e}},{key:"getEyeDirection",value:function(){return this._eyeDir}},{key:"getIntersectionPoint",value:function(){return this._interPoint}},{key:"getPickedVertices",value:function(){return this._pickedVertices}},{key:"getPickedFace",value:function(){return this._pickedFace}},{key:"getPickedNormal",value:function(){return this._pickedNormal}},{key:"intersectionMouseMeshes",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._main.getMeshes(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._main._mouseX,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._main._mouseY,i=this.unproject(t,r,0),n=this.unproject(t,r,.1),a=1/0,s=null,o=-1,l=0,u=e.length;l<u;++l){var c=e[l];if(c.isVisible()&&(math3d_three_compat__WEBPACK_IMPORTED_MODULE_0__._E.invert(_TMP_INV,c.getMatrix()),math3d_three_compat__WEBPACK_IMPORTED_MODULE_0__.R3.transformMat4(_TMP_NEAR_1,i,_TMP_INV),math3d_three_compat__WEBPACK_IMPORTED_MODULE_0__.R3.transformMat4(_TMP_FAR,n,_TMP_INV),this.intersectionRayMesh(c,_TMP_NEAR_1,_TMP_FAR))){var h=this.getIntersectionPoint(),d=math3d_three_compat__WEBPACK_IMPORTED_MODULE_0__.R3.dist(_TMP_NEAR_1,h)*c.getScale();d<a&&(a=d,s=c,math3d_three_compat__WEBPACK_IMPORTED_MODULE_0__.R3.copy(_TMP_INTER_1,h),o=this.getPickedFace())}}return this._mesh=s,math3d_three_compat__WEBPACK_IMPORTED_MODULE_0__.R3.copy(this._interPoint,_TMP_INTER_1),this._pickedFace=o,-1!==o&&this.updateLocalAndWorldRadius2(),!!s}},{key:"intersectionMouseMesh",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._main.getMesh(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._main._mouseX,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._main._mouseY,i=this.unproject(t,r,0),n=this.unproject(t,r,.1),a=math3d_three_compat__WEBPACK_IMPORTED_MODULE_0__._E.create();return math3d_three_compat__WEBPACK_IMPORTED_MODULE_0__._E.invert(a,e.getMatrix()),math3d_three_compat__WEBPACK_IMPORTED_MODULE_0__.R3.transformMat4(i,i,a),math3d_three_compat__WEBPACK_IMPORTED_MODULE_0__.R3.transformMat4(n,n,a),this.intersectionRayMesh(e,i,n)}},{key:"intersectionRayMesh",value:function(e,t,r){if(this._mesh=null,this._pickedFace=-1,math3d_three_compat__WEBPACK_IMPORTED_MODULE_0__.R3.copy(_TMP_NEAR,t),math3d_three_compat__WEBPACK_IMPORTED_MODULE_0__.R3.copy(_TMP_FAR,r),this._xSym){var i=e.getSymmetryOrigin(),n=e.getSymmetryNormal();math3d_Geometry__WEBPACK_IMPORTED_MODULE_1__.Z.mirrorPoint(_TMP_NEAR,i,n),math3d_Geometry__WEBPACK_IMPORTED_MODULE_1__.Z.mirrorPoint(_TMP_FAR,i,n)}var a=e.getVertices(),s=e.getFaces(),o=this.getEyeDirection();math3d_three_compat__WEBPACK_IMPORTED_MODULE_0__.R3.sub(o,_TMP_FAR,_TMP_NEAR),math3d_three_compat__WEBPACK_IMPORTED_MODULE_0__.R3.normalize(o,o);for(var l=e.intersectRay(_TMP_NEAR,o),u=1/0,c=l.length,h=0;h<c;++h){var d=4*l[h],f=3*s[d],p=3*s[d+1],_=3*s[d+2];_TMP_V1[0]=a[f],_TMP_V1[1]=a[f+1],_TMP_V1[2]=a[f+2],_TMP_V2[0]=a[p],_TMP_V2[1]=a[p+1],_TMP_V2[2]=a[p+2],_TMP_V3[0]=a[_],_TMP_V3[1]=a[_+1],_TMP_V3[2]=a[_+2];var m=math3d_Geometry__WEBPACK_IMPORTED_MODULE_1__.Z.intersectionRayTriangle(_TMP_NEAR,o,_TMP_V1,_TMP_V2,_TMP_V3,_TMP_INTER);m<0&&(p=s[d+3])!==misc_Utils__WEBPACK_IMPORTED_MODULE_3__.Z.TRI_INDEX&&(p*=3,_TMP_V2[0]=a[p],_TMP_V2[1]=a[p+1],_TMP_V2[2]=a[p+2],m=math3d_Geometry__WEBPACK_IMPORTED_MODULE_1__.Z.intersectionRayTriangle(_TMP_NEAR,o,_TMP_V1,_TMP_V3,_TMP_V2,_TMP_INTER)),m>=0&&m<u&&(u=m,math3d_three_compat__WEBPACK_IMPORTED_MODULE_0__.R3.copy(this._interPoint,_TMP_INTER),this._pickedFace=l[h])}return-1!==this._pickedFace?(this._mesh=e,this.updateLocalAndWorldRadius2(),!0):(this._rLocal2=0,!1)}},{key:"pickVerticesInSphere",value:function(e){for(var t=this._mesh,r=t.getVertices(),i=t.getVerticesSculptFlags(),n=this.getIntersectionPoint(),a=t.intersectSphere(n,e,!0),s=t.getVerticesFromFaces(a),o=s.length,l=++misc_Utils__WEBPACK_IMPORTED_MODULE_3__.Z.SCULPT_FLAG,u=new Uint32Array(misc_Utils__WEBPACK_IMPORTED_MODULE_3__.Z.getMemory(4*o),0,o),c=0,h=n[0],d=n[1],f=n[2],p=0;p<o;++p){var _=s[p],m=3*_,g=h-r[m],v=d-r[m+1],y=f-r[m+2];g*g+v*v+y*y<e&&(i[_]=l,u[c++]=_)}return this._pickedVertices=new Uint32Array(u.subarray(0,c)),this._pickedVertices}},{key:"_isInsideSphere",value:function(e,t,r){if(e===misc_Utils__WEBPACK_IMPORTED_MODULE_3__.Z.TRI_INDEX)return!1;var i=3*e;return math3d_three_compat__WEBPACK_IMPORTED_MODULE_0__.R3.sqrDist(t,this._mesh.getVertices().subarray(i,i+3))<=r}},{key:"pickVerticesInSphereTopological",value:function(e){var t=this._mesh,r=t.getNbVertices(),i=t.getVertices(),n=t.getFaces(),a=t.getVerticesRingVertStartCount(),s=t.getVerticesRingVert(),o=s instanceof Array?s:null,l=t.getVerticesSculptFlags(),u=t.getVerticesTagFlags(),c=++misc_Utils__WEBPACK_IMPORTED_MODULE_3__.Z.SCULPT_FLAG,h=++misc_Utils__WEBPACK_IMPORTED_MODULE_3__.Z.TAG_FLAG,d=this.getIntersectionPoint(),f=d[0],p=d[1],_=d[2],m=new Uint32Array(misc_Utils__WEBPACK_IMPORTED_MODULE_3__.Z.getMemory(4*r),0,r),g=4*this.getPickedFace(),v=1;this._isInsideSphere(n[g],d,e)?m[0]=n[g]:this._isInsideSphere(n[g+1],d,e)?m[0]=n[g+1]:this._isInsideSphere(n[g+2],d,e)?m[0]=n[g+2]:this._isInsideSphere(n[g+3],d,e)?m[0]=n[g+3]:v=0,1===v&&(l[m[0]]=c,u[m[0]]=h);for(var y=0;y<v;++y){var b,T,k=m[y];o?(b=0,T=(s=o[k]).length):T=(b=a[2*k])+a[2*k+1];for(var M=b;M<T;++M){var x=s[M];if(u[x]!==h){u[x]=h;var S=3*x,A=f-i[S],E=p-i[S+1],R=_-i[S+2];A*A+E*E+R*R>e||(l[x]=c,m[v++]=x)}}}return this._pickedVertices=new Uint32Array(m.subarray(0,v)),this._pickedVertices}},{key:"computeWorldRadius2",value:function(e){math3d_three_compat__WEBPACK_IMPORTED_MODULE_0__.R3.transformMat4(_TMP_INTER,this.getIntersectionPoint(),this._mesh.getMatrix());var t=this._main.getSculptManager().getCurrentTool().getScreenRadius();e||(t*=misc_Tablet__WEBPACK_IMPORTED_MODULE_2__.Z.getPressureRadius());var r=this.project(_TMP_INTER);return math3d_three_compat__WEBPACK_IMPORTED_MODULE_0__.R3.sqrDist(_TMP_INTER,this.unproject(r[0]+t,r[1],r[2]))}},{key:"updateLocalAndWorldRadius2",value:function(){this._mesh&&(this._rWorld2=this.computeWorldRadius2(),this._rLocal2=this._rWorld2/this._mesh.getScale2())}},{key:"unproject",value:function(e,t,r){return this._main.getCamera().unproject(e,t,r)}},{key:"project",value:function(e){return this._main.getCamera().project(e)}},{key:"computePickedNormal",value:function(){if(this._mesh&&!(this._pickedFace<0))return this.polyLerp(this._mesh.getNormals(),this._pickedNormal),math3d_three_compat__WEBPACK_IMPORTED_MODULE_0__.R3.normalize(this._pickedNormal,this._pickedNormal)}},{key:"polyLerp",value:function(e,t){var r=this._mesh.getVertices(),i=this._mesh.getFaces(),n=4*this._pickedFace,a=3*i[n],s=3*i[n+1],o=3*i[n+2],l=i[n+3],u=l!==misc_Utils__WEBPACK_IMPORTED_MODULE_3__.Z.TRI_INDEX;u&&(l*=3);var c=1/math3d_three_compat__WEBPACK_IMPORTED_MODULE_0__.R3.dist(this._interPoint,r.subarray(a,a+3)),h=1/math3d_three_compat__WEBPACK_IMPORTED_MODULE_0__.R3.dist(this._interPoint,r.subarray(s,s+3)),d=1/math3d_three_compat__WEBPACK_IMPORTED_MODULE_0__.R3.dist(this._interPoint,r.subarray(o,o+3)),f=u?1/math3d_three_compat__WEBPACK_IMPORTED_MODULE_0__.R3.dist(this._interPoint,r.subarray(l,l+3)):0,p=1/(c+h+d+f);return math3d_three_compat__WEBPACK_IMPORTED_MODULE_0__.R3.set(t,0,0,0),math3d_three_compat__WEBPACK_IMPORTED_MODULE_0__.R3.scaleAndAdd(t,t,e.subarray(a,a+3),c*p),math3d_three_compat__WEBPACK_IMPORTED_MODULE_0__.R3.scaleAndAdd(t,t,e.subarray(s,s+3),h*p),math3d_three_compat__WEBPACK_IMPORTED_MODULE_0__.R3.scaleAndAdd(t,t,e.subarray(o,o+3),d*p),u&&math3d_three_compat__WEBPACK_IMPORTED_MODULE_0__.R3.scaleAndAdd(t,t,e.subarray(l,l+3),f*p),t}}],[{key:"addAlpha",value:function(t,r,i,n){var a={};a._name=n,a._texture=t,a._ratioX=Math.max(1,r/i),a._ratioY=Math.max(1,i/r),a._ratioMax=Math.max(a._ratioX,a._ratioY),a._width=r,a._height=i;for(var s=1;e.ALPHAS[a._name];)a._name=n+s++;return e.ALPHAS[a._name]=a,e.ALPHAS_NAMES[a._name]=a._name,a}}]),e}();Picking.INIT_ALPHAS_NAMES=[(0,gui_GuiTR__WEBPACK_IMPORTED_MODULE_4__.Z)("alphaSquare"),(0,gui_GuiTR__WEBPACK_IMPORTED_MODULE_4__.Z)("alphaSkin")],Picking.INIT_ALPHAS_PATHS=["square.jpg","skin.jpg"];var readAlphas=function readAlphas(){if(window.module&&window.module.exports){var fs=eval("require")("fs"),path=eval("require")("path"),directoryPath=path.join(window.__filename,"../resources/alpha");fs.readdir(directoryPath,(function(e,t){if(!e)for(var r=0;r<t.length;++r){var i=t[r];"square.jpg"!=i&&"skin.jpg"!=i&&(Picking.INIT_ALPHAS_NAMES.push(i),Picking.INIT_ALPHAS_PATHS.push(i))}}))}};readAlphas();var none=(0,gui_GuiTR__WEBPACK_IMPORTED_MODULE_4__.Z)("alphaNone");Picking.ALPHAS_NAMES={},Picking.ALPHAS_NAMES[none]=none,Picking.ALPHAS={},Picking.ALPHAS[none]=null;const __WEBPACK_DEFAULT_EXPORT__=Picking},174:(e,t,r)=>{"use strict";r.d(t,{K4:()=>_,R3:()=>m,wO:()=>v,_E:()=>g,gf:()=>y});var i=r(498),n=new i.FM8,a=(new i.FM8,new i.Pa4),s=new i.Pa4,o=new i.Pa4,l=new i.Vkp,u=new i.yGw,c=new i.yGw,h=new i._fP,d=new i._fP,f=new i.Pa4(1,0,0),p=new i.Pa4(0,1,0),_={create:function(){return new Float32Array(2)},set:function(e,t,r){return e[0]=t,e[1]=r,e},sub:function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e},dist:function(e,t){return Math.hypot(e[0]-t[0],e[1]-t[1])},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]},len:function(e){return Math.hypot(e[0],e[1])},normalize:function(e,t){return n.set(t[0],t[1]).normalize(),e[0]=n.x,e[1]=n.y,e},scaleAndAdd:function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e}},m={create:function(){return new Float32Array(3)},fromValues:function(e,t,r){return new Float32Array([e,t,r])},set:function(e,t,r,i){return e[0]=t,e[1]=r,e[2]=i,e},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},sub:function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e},scale:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},scaleAndAdd:function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e},normalize:function(e,t){return a.set(t[0],t[1],t[2]).normalize(),e[0]=a.x,e[1]=a.y,e[2]=a.z,e},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},cross:function(e,t,r){return a.set(t[0],t[1],t[2]),s.set(r[0],r[1],r[2]),a.crossVectors(a,s),e[0]=a.x,e[1]=a.y,e[2]=a.z,e},len:function(e){return Math.hypot(e[0],e[1],e[2])},sqrLen:function(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]},dist:function(e,t){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])},sqrDist:function(e,t){var r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return r*r+i*i+n*n},negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},transformMat4:function(e,t,r){var i=t[0],n=t[1],a=t[2],s=r[3]*i+r[7]*n+r[11]*a+r[15];return e[0]=(r[0]*i+r[4]*n+r[8]*a+r[12])/(s||1),e[1]=(r[1]*i+r[5]*n+r[9]*a+r[13])/(s||1),e[2]=(r[2]*i+r[6]*n+r[10]*a+r[14])/(s||1),e},transformMat3:function(e,t,r){var i=t[0],n=t[1],a=t[2];return e[0]=r[0]*i+r[3]*n+r[6]*a,e[1]=r[1]*i+r[4]*n+r[7]*a,e[2]=r[2]*i+r[5]*n+r[8]*a,e},transformQuat:function(e,t,r){return a.set(t[0],t[1],t[2]),h.set(r[0],r[1],r[2],r[3]),a.applyQuaternion(h),e[0]=a.x,e[1]=a.y,e[2]=a.z,e}},g={create:function(){return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])},identity:function(e){return e.set([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),e},copy:function(e,t){return e.set(t),e},clone:function(e){return new Float32Array(e)},mul:function(e,t,r){return u.fromArray(t),c.fromArray(r),u.multiply(c),e.set(u.elements),e},translate:function(e,t,r){return u.fromArray(t),a.set(r[0],r[1],r[2]),u.multiply(c.makeTranslation(a.x,a.y,a.z)),e.set(u.elements),e},scale:function(e,t,r){return u.fromArray(t),a.set(r[0],r[1],r[2]),u.multiply(c.makeScale(a.x,a.y,a.z)),e.set(u.elements),e},rotate:function(e,t,r,i){return u.fromArray(t),a.set(i[0],i[1],i[2]).normalize(),u.multiply(c.makeRotationAxis(a,r)),e.set(u.elements),e},rotateX:function(e,t,r){return u.fromArray(t),u.multiply(c.makeRotationX(r)),e.set(u.elements),e},rotateZ:function(e,t,r){return u.fromArray(t),u.multiply(c.makeRotationZ(r)),e.set(u.elements),e},fromQuat:function(e,t){return h.set(t[0],t[1],t[2],t[3]),u.makeRotationFromQuaternion(h),e.set(u.elements),e},fromRotation:function(e,t,r){return a.set(r[0],r[1],r[2]).normalize(),u.makeRotationAxis(a,t),e.set(u.elements),e},invert:function(e,t){return u.fromArray(t),u.invert(),e.set(u.elements),e},perspective:function(e,t,r,i,n){var a=1/Math.tan(t/2);return e[0]=a/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=n?(n+i)/(i-n):-1,e[11]=-1,e[12]=0,e[13]=0,e[14]=n?2*n*i/(i-n):-2*i,e[15]=0,e},ortho:function(e,t,r,i,n,a,s){var o=1/(t-r),l=1/(i-n),u=1/(a-s);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+r)*o,e[13]=(n+i)*l,e[14]=(s+a)*u,e[15]=1,e},lookAt:function(e,t,r,i){return a.set(t[0],t[1],t[2]),s.set(r[0],r[1],r[2]),o.set(i[0],i[1],i[2]),u.lookAt(a,s,o),e.set(u.elements),e}},v={create:function(){return new Float32Array([1,0,0,0,1,0,0,0,1])},fromMat4:function(e,t){return u.fromArray(t),l.setFromMatrix4(u),e.set(l.elements),e},transpose:function(e,t){return l.fromArray(t),l.transpose(),e.set(l.elements),e},normalFromMat4:function(e,t){return u.fromArray(t),l.getNormalMatrix(u),e.set(l.elements),e}},y={create:function(){return new Float32Array([0,0,0,1])},fromValues:function(e,t,r,i){return new Float32Array([e,t,r,i])},identity:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},normalize:function(e,t){return h.set(t[0],t[1],t[2],t[3]).normalize(),e[0]=h.x,e[1]=h.y,e[2]=h.z,e[3]=h.w,e},invert:function(e,t){return h.set(t[0],t[1],t[2],t[3]).invert(),e[0]=h.x,e[1]=h.y,e[2]=h.z,e[3]=h.w,e},conjugate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},mul:function(e,t,r){return h.set(t[0],t[1],t[2],t[3]),d.set(r[0],r[1],r[2],r[3]),h.multiply(d),e[0]=h.x,e[1]=h.y,e[2]=h.z,e[3]=h.w,e},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},rotateX:function(e,t,r){return h.set(t[0],t[1],t[2],t[3]),h.multiply(d.setFromAxisAngle(f,r)),e[0]=h.x,e[1]=h.y,e[2]=h.z,e[3]=h.w,e},rotateY:function(e,t,r){return h.set(t[0],t[1],t[2],t[3]),h.multiply(d.setFromAxisAngle(p,r)),e[0]=h.x,e[1]=h.y,e[2]=h.z,e[3]=h.w,e},setAxisAngle:function(e,t,r){return a.set(t[0],t[1],t[2]).normalize(),h.setFromAxisAngle(a,r),e[0]=h.x,e[1]=h.y,e[2]=h.z,e[3]=h.w,e},slerp:function(e,t,r,i){return h.set(t[0],t[1],t[2],t[3]),d.set(r[0],r[1],r[2],r[3]),h.slerp(d,i),e[0]=h.x,e[1]=h.y,e[2]=h.z,e[3]=h.w,e}}},839:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});var i=r(781),n={Action:{NOTHING:0,MASK_EDIT:1,SCULPT_EDIT:2,CAMERA_ZOOM:3,CAMERA_ROTATE:4,CAMERA_PAN:5,CAMERA_PAN_ZOOM_ALT:6},Tools:{BRUSH:0,INFLATE:1,TWIST:2,SMOOTH:3,FLATTEN:4,PINCH:5,CREASE:6,DRAG:7,PAINT:8,MOVE:9,MASKING:10,LOCALSCALE:11,TRANSFORM:12,ELEMENTSELECT:13},Shader:{PBR:0,FLAT:1,NORMAL:2,WIREFRAME:3,UV:4,MATCAP:5,SELECTION:6,BACKGROUND:7,MERGE:8,FXAA:9,CONTOUR:10,PAINTUV:11,BLUR:12},Projection:{PERSPECTIVE:0,ORTHOGRAPHIC:1},CameraMode:{ORBIT:0,SPHERICAL:1,PLANE:2},MultiState:{NONE:0,SCULPT:1,CAMERA:2,PICKING:3}},a=Object.keys(n.Tools).length;n.KeyAction=i.Z.extend({INTENSITY:a++,RADIUS:a++,NEGATIVE:a++,PICKER:a++,DELETE:a++,CAMERA_FRONT:a++,CAMERA_TOP:a++,CAMERA_LEFT:a++,CAMERA_RESET:a++,STRIFE_LEFT:a++,STRIFE_RIGHT:a++,STRIFE_UP:a++,STRIFE_DOWN:a++,WIREFRAME:a++,REMESH:a++},n.Tools);const s=n},50:()=>{if(window.Map||(window.Map=function(){this.map={}},window.Map.prototype={set:function(e,t){this.map[e]=t},get:function(e){return this.map[e]}}),!Float32Array.prototype.slice){var e=function(e,t){return new this.constructor(this.subarray(e,t))};Int8Array.prototype.slice=e,Uint8Array.prototype.slice=e,Uint8ClampedArray.prototype.slice=e,Int16Array.prototype.slice=e,Uint16Array.prototype.slice=e,Int32Array.prototype.slice=e,Uint32Array.prototype.slice=e,Float32Array.prototype.slice=e,Float64Array.prototype.slice=e}String.prototype.endsWith||(String.prototype.endsWith=function(e){return this.slice(-e.length)===e}),String.prototype.startsWith||(String.prototype.startsWith=function(e){return this.slice(0,e.length)===e});for(var t=["moz","webkit"],r=0;r<t.length&&!window.requestAnimationFrame;++r)window.requestAnimationFrame=window[t[r]+"RequestAnimationFrame"];window.requestAnimationFrame||window.alert("browser is too old. Probably no webgl there anyway")},522:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});var i={radiusFactor:.75,intensityFactor:0,pressure:.5,getPressureIntensity:function(){return 1+i.intensityFactor*(2*i.pressure-1)},getPressureRadius:function(){return 1+i.radiusFactor*(2*i.pressure-1)}};const n=i},781:(e,t,r)=>{"use strict";r.d(t,{Z:()=>l});var i=r(174),n={SCALE:100,TAG_FLAG:1,SCULPT_FLAG:1,STATE_FLAG:1,TRI_INDEX:4294967295,cursors:{}};n.cursors.dropper="url(resources/dropper.png) 5 25, auto",n.linearToSRGB1=function(e){return e<.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055},n.sRGBToLinear1=function(e){return e<.04045?e*(1/12.92):Math.pow((e+.055)*(1/1.055),2.4)},n.extend=function(e,t){for(var r=Object.keys(t),i=0,n=r.length;i<n;++i){var a=r[i];void 0===e[a]&&(e[a]=t[a])}return e},n.invert=function(e){for(var t=Object.keys(e),r={},i=0,n=t.length;i<n;++i)r[e[t[i]]]=t[i];return r},n.replaceElement=function(e,t,r){for(var i=0,n=e.length;i<n;++i)if(e[i]===t)return void(e[i]=r)},n.removeElement=function(e,t){for(var r=0,i=e.length;r<i;++r)if(e[r]===t)return e[r]=e[i-1],void e.pop()},n.appendArray=function(e,t){var r=e.length,i=t.length;e.length+=i;for(var n=0;n<i;++n)e[r+n]=t[n]},n.isPowerOfTwo=function(e){return 0!==e&&0==(e&e-1)},n.nextHighestPowerOfTwo=function(e){--e;for(var t=1;t<32;t<<=1)e|=e>>t;return e+1};var a,s,o=function(e,t){return e-t};n.tidy=function(e){e.sort(o);var t=e.length,r=0,i=0;for(r=1;r<t;++r)e[i]!==e[r]&&(e[++i]=e[r]);r>1&&(e.length=i+1)},n.intersectionArrays=function(e,t){for(var r=0,i=0,n=[],a=e.length,s=t.length;r<a&&i<s;)e[r]<t[i]?r++:e[r]>t[i]?i++:(n.push(e[r]),++r,++i);return n},n.littleEndian=(a=new ArrayBuffer(2),new DataView(a).setInt16(0,256,!0),256===new Int16Array(a)[0]),n.getBytes=function(e,t){return[e[t].charCodeAt(),e[t+1].charCodeAt(),e[t+2].charCodeAt(),e[t+3].charCodeAt()]},n.getUint32=function(e,t){var r=n.getBytes(e,t);return r[0]<<0|r[1]<<8|r[2]<<16|r[3]<<24},n.getFloat32=function(e,t){var r=n.getBytes(e,t),i=1-2*(r[3]>>7),a=(r[3]<<1&255|r[2]>>7)-127,s=(127&r[2])<<16|r[1]<<8|r[0];return 128===a?0!==s?NaN:i*(1/0):-127===a?i*s*Math.pow(2,-149):i*(1+s*Math.pow(2,-23))*Math.pow(2,a)},n.ab2str=function(e){for(var t="",r=new Uint8Array(e),i=65535,n=0,a=r.length;n<a;n+=i){var s=r.subarray(n,i<a-n?i+n:a);t+=String.fromCharCode.apply(null,s)}return t},n.getMemory=(s=new ArrayBuffer(1e5),function(e){return s.byteLength>=e?s:s=new ArrayBuffer(e)}),n.now=Date.now||function(){return(new Date).getTime()},n.throttle=function(e,t){var r,i=[],a=null,s=0,o=function(){s=n.now(),a=null,r=e.apply(e,i)};return function(){for(var l=n.now(),u=t-(l-s),c=i.length=arguments.length,h=0;h<c;++h)i[h]=arguments[h];return u<=0||u>t?(window.clearTimeout(a),a=null,s=l,r=e.apply(e,i)):a||(a=window.setTimeout(o,u)),r}},n.normalizeArrayVec3=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,r=0,i=e.length/3;r<i;++r){var n=3*r,a=e[n],s=e[n+1],o=e[n+2],l=a*a+s*s+o*o;0!==l?(l=1/Math.sqrt(l),t[n]=a*l,t[n+1]=s*l,t[n+2]=o*l):t[n]=1}return t},n.convertArrayVec3toSRGB=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,r=0,i=e.length;r<i;++r)t[r]=n.linearToSRGB1(e[r]);return t},n.convertArrayVec3toLinear=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,r=0,i=e.length;r<i;++r)t[r]=n.sRGBToLinear1(e[r]);return t},n.computeWorldVertices=function(e,t){var r=e.getNbVertices(),n=e.getVertices().subarray(0,3*r);t||(t=new Float32Array(3*r));for(var a=e.getMatrix(),s=i.R3.create(),o=0;o<r;++o){var l=3*o;i.R3.set(s,n[l],n[l+1],n[l+2]),i.R3.transformMat4(s,s,a),t[l]=s[0],t[l+1]=s[1],t[l+2]=s[2]}return t};const l=n},52:(e,t,r)=>{"use strict";r.d(t,{Z:()=>h});var i,n=r(839),a=n.Z.KeyAction,s=function(e,t){return void 0===e?t:"false"!==e&&"0"!==e},o=function(e,t,r,i){var n=parseFloat(e);return n||0===n?Math.max(t,Math.min(r,n)):i},l=function(e,t,r,i){var n=parseInt(e,10);return n||0===n?Math.max(t,Math.min(r,n)):i},u=function(e,t,r){if(t){var i=e[t.toUpperCase()];if(void 0!==i)return i}return r},c=function(){if(i)return i;i={};var e=function(){for(var e=window.location.search.substr(1).split("&"),t={},r=0,i=e.length;r<i;r++){var n=e[r].split("=",2);2===n.length&&(t[n[0].toLowerCase()]=n[1])}return t}();return i.language=e.language,i.scalecenter=s(e.scalecenter,!1),i.grid=s(e.grid,!0),i.outline=s(e.outline,!1),i.outlinecolor=function(e,t){if(!e)return t;var r=e.split(",");if(r.length<3)return t;var i=t.slice();return i[0]=parseInt(r[0]||0,10)/255,i[1]=parseInt(r[1]||0,10)/255,i[2]=parseInt(r[2]||0,10)/255,void 0!==r[3]&&(i[3]=parseFloat(r[3])),i}(e.outlinecolor,[.3,0,0,1]),i.mirrorline=s(e.mirrorline,!1),i.darkenunselected=s(e.darkenunselected,!0),i.projection=u(n.Z.Projection,e.projection,n.Z.Projection.PERSPECTIVE),i.cameramode=u(n.Z.CameraMode,e.cameramode,n.Z.Projection.ORBIT),i.pivot=s(e.pivot,!0),i.fov=o(e.fov,10,90,45),i.flatshading=s(e.flatshading,!1),i.wireframe=s(e.wireframe,!1),i.curvature=o(e.curvature,0,5,0),i.exposure=o(e.exposure,0,5),i.environment=l(e.environment,0,1/0,0),i.matcap=l(e.matcap,0,1/0,3),i.shader=u(n.Z.Shader,e.shader,n.Z.Shader.MATCAP),i.filmic=s(e.filmic,!1),i.modelurl=e.modelurl,i.shortcuts=function(e){var t={};if(t["0".charCodeAt(0)]=a.MOVE,t["1".charCodeAt(0)]=a.BRUSH,t["2".charCodeAt(0)]=a.INFLATE,t["3".charCodeAt(0)]=a.TWIST,t["4".charCodeAt(0)]=a.SMOOTH,t["5".charCodeAt(0)]=a.FLATTEN,t["6".charCodeAt(0)]=a.PINCH,t["7".charCodeAt(0)]=a.CREASE,t["8".charCodeAt(0)]=a.DRAG,t["9".charCodeAt(0)]=a.PAINT,t["E".charCodeAt(0)]=a.TRANSFORM,t["C".charCodeAt(0)]=a.INTENSITY,t["X".charCodeAt(0)]=a.RADIUS,t["N".charCodeAt(0)]=a.NEGATIVE,t["S".charCodeAt(0)]=a.PICKER,t[46]=a.DELETE,t["F".charCodeAt(0)]=a.CAMERA_FRONT,t["T".charCodeAt(0)]=a.CAMERA_TOP,t["L".charCodeAt(0)]=a.CAMERA_LEFT,t[32]=a.CAMERA_RESET,t[37]=a.STRIFE_LEFT,t[39]=a.STRIFE_RIGHT,t[38]=a.STRIFE_UP,t[40]=a.STRIFE_DOWN,t["W".charCodeAt(0)]=a.WIREFRAME,t["R".charCodeAt(0)]=a.REMESH,!e)return t;for(var r=e.split(","),i=0,n=r.length;i<n;i++){var s=r[i].split(":",2);if(2===s.length){var o=s[1].toUpperCase(),l=parseInt(o,10);o=l==l&&l>=10?l:o.charCodeAt(0);var u=a[s[0].toUpperCase()];void 0!==u&&(t[o]=u)}}return t}(e.shortcuts),i};c(),c.getShortKey=function(e){return e>=96&&e<=105&&(e-=48),c().shortcuts[e]};const h=c}},__webpack_module_cache__={};function __webpack_require__(e){if(__webpack_module_cache__[e])return __webpack_module_cache__[e].exports;var t=__webpack_module_cache__[e]={id:e,loaded:!1,exports:{}};return __webpack_modules__[e].call(t.exports,t,t.exports,__webpack_require__),t.loaded=!0,t.exports}return __webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=(e,t)=>{for(var r in t)__webpack_require__.o(t,r)&&!__webpack_require__.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),__webpack_require__(871)})()}));